// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
/*
 jQuery Knob*/
require({cache:{"widgets/Visibility/js/VisibilityControl":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/event dojo/Deferred dojo/_base/lang dojo/_base/array dojo/on dojo/number dojo/string dojo/dom-style dojo/mouse dojo/promise/all dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!../templates/VisibilityControl.html jimu/dijit/Message esri/dijit/util/busyIndicator esri/graphic esri/layers/GraphicsLayer esri/tasks/FeatureSet esri/graphicsUtils esri/symbols/SimpleMarkerSymbol esri/renderers/SimpleRenderer esri/Color esri/dijit/analysis/CreateViewshed esri/layers/FeatureLayer esri/geometry/Polygon esri/geometry/geometryEngine ./geometryUtils jimu/dijit/CoordinateControl ./util jimu/utils dojo/keys dijit/focus ./portal-publish dojo/dom-class dojo/dom-construct esri/renderers/UniqueValueRenderer jimu/LayerStructure ../js/symbologySettings esri/tasks/GeometryService dijit/form/NumberTextBox jimu/dijit/CheckBox ./jquery.knob.min".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x,w,A,z,G,I,K,R,U,ba,ca,da,ja,ea,L,O,S,T,J){return H([c,g,n],{templateString:q,baseClass:"jimu-widget-visibility-control",FOV:180,LA:180,map:null,_currentOpenPanel:"mainPage",portalPublishObj:null,_renderer:null,Azimuth1:null,Azimuth2:null,graphics:null,_layerList:null,fillStyles:null,lineStyles:null,constructor:function(N){H.safeMixin(this,N);this.nls=N.nls},postCreate:function(){this.openAtStartAysn=!0;this.fillStyles={esriSFSBackwardDiagonal:"backwarddiagonal",
esriSFSCross:"cross",esriSFSDiagonalCross:"diagonalcross",esriSFSForwardDiagonal:"forwarddiagonal",esriSFSHorizontal:"horizontal",esriSFSNull:"none",esriSFSSolid:"solid",esriSFSVertical:"vertical"};this.lineStyles={esriSLSDash:"dash",esriSLSDashDot:"dashdot",esriSLSDashDotDot:"longdashdotdot",esriSLSDot:"dot",esriSLSLongDash:"longdash",esriSLSLongDashDot:"longdashdot",esriSLSNull:"none",esriSLSShortDash:"shortdash",esriSLSShortDashDot:"shortdashdot",esriSLSShortDashDotDot:"shortdashdotdot",esriSLSShortDot:"shortdot",
esriSLSSolid:"solid"};var N=[],C;l.forEach("meters kilometers miles feet yards nauticalMiles".split(" "),m.hitch(this,function(Q){C={value:Q,label:window.jimuNls.units[Q]};N.push(C)}));this.observerHeightDD.addOption(N);this.utils=new U({appConfig:this.appConfig,nls:this.nls});this.distanceUnitDD.addOption(m.clone(N));this.config.hasOwnProperty("observeHeight")&&this.observerHeight.setValue(this.config.observeHeight);this.config.hasOwnProperty("minimumObservableDistanceValue")&&this.minObsRange.setValue(this.config.minimumObservableDistanceValue);
this.config.hasOwnProperty("maximumObservableDistanceValue")&&this.maxObsRange.setValue(this.config.maximumObservableDistanceValue);this.observerHeightDD.set("value",this.config.defaultObserverHeightUnit);this.distanceUnitDD.set("value",this.config.defaultObservableDistanceUnit);this.angleUnits.setValue(this.config.defaultAngleUnits);if(this.portalUrl){this._initGL();this._createSettings();this._layerList=this._getAllMapLayers();this._ptSym=new E(this.pointSymbol);var P=new x(this._ptSym);this._observerLocation=
new y({id:"observerLocation"});this._observerLocation.spatialReference=this.map.spatialReference;this._observerLocation.setRenderer(P);this.map.addLayer(this._observerLocation);this.distanceUnit=this.distanceUnitDD.get("value");this.observerHeightUnit=this.observerHeightDD.get("value");this.inputControl=new R({parentWidget:this.parentWidget,label:this.nls.observerLocation,input:!0,showCopyButton:!1,showFormatButton:!0,showDrawPoint:!0,drawButtonLabel:this.nls.addPointToolTip,graphicsLayer:this._observerLocation});
this.inputControl.placeAt(this.observerCoordsContainer);this.inputControl.startup();this._syncEvents();this.minObsRange.invalidMessage=this.nls.invalidMessage;this.minObsRange.rangeMessage=this.nls.minimumRangeMessage;this.maxObsRange.invalidMessage=this.nls.invalidMessage;this.maxObsRange.rangeMessage=this.nls.maximumRangeMessage;this.observerHeight.invalidMessage=this.nls.invalidMessage;this.observerHeight.rangeMessage=this.nls.observerRangeMessage}else this._showPortalURLError(this.nls.portalURLError);
this.resetInputColor();setTimeout(m.hitch(this,function(){this._suppoprtAccessibility()}),100)},startup:function(){this.busyIndicator=u.create({target:this.domNode.parentNode.parentNode.parentNode,backgroundOpacity:0});this.FOVInput.id="fovinput"+this.parentWidget.id;var N=m.hitch(this,function(C,P,Q){this.LA=this.angleUnits.checked?C/17.777777777778:C;this.FOV=Math.round(P);this.tooltip.innerHTML=this.angleUnits.checked?$("#"+this.FOVInput.id).val()+" "+this.nls.milsLabel:Q+" "+this.nls.degreesLabel});
$("#"+this.FOVInput.id).knob({min:0,max:360,cursor:360,width:160,height:160,draw:function(){N(this.v,this.o.cursor,this.cv);window.isRTL&&this.i.css({"margin-right":"-"+(3*this.w/4+2>>0)+"px","margin-left":"auto"})}})},destroy:function(){this.map.removeLayer(this._observerLocation);this.map.removeLayer(this.graphicsLayer)},_showPortalURLError:function(N){f.set(this.controls,"display","none");f.set(this.buttonContainer,"display","none");this.errorText.innerHTML=N;f.set(this.errorText,"display","")},
_initGL:function(){this.graphicsLayer=new y;this.graphicsLayer.name="Viewshed Layer";this.map.addLayer(this.graphicsLayer)},_syncEvents:function(){this.own(b(this.btnCreate,"click",m.hitch(this,this.createButtonWasClicked)),b(this.btnCreate,"keydown",m.hitch(this,function(N){N.keyCode!==ca.ENTER&&N.keyCode!==ca.SPACE||this.createButtonWasClicked()})),b(this.btnClear,"click",m.hitch(this,function(){ea.add(this.saveToLayerIcon,"esriCTHidden");this.onClearBtnClicked();this._suppoprtAccessibility()})),
b(this.btnClear,"keydown",m.hitch(this,function(N){if(N.keyCode===ca.ENTER||N.keyCode===ca.SPACE)ea.add(this.saveToLayerIcon,"esriCTHidden"),this.onClearBtnClicked(),this._suppoprtAccessibility()})),b(this.minObsRange,"change",m.hitch(this,this.minObsRangeKeyWasPressed)),b(this.FOVInput,"mousemove",m.hitch(this,this.mouseMoveOverFOVInput)),b(this.FOVInput,e.leave,m.hitch(this,this.mouseMoveOutFOVInput)),b(this.FOVGroup,e.leave,m.hitch(this,function(){this.tooltip.hidden=!0})),b(this.FOVGroup,e.enter,
m.hitch(this,this.mouseMoveOverFOVGroup)),b(this.FOVInput,e.enter,m.hitch(this,function(){this.tooltip.hidden=!0})),b(this.FOVInput,"keypress",m.hitch(this,function(N){isNaN(N.key)&&13!==N.charCode&&p.stop(N)})),this.angleUnits.on("change",m.hitch(this,this.angleUnitsDidChange)),this.observerHeightDD.on("change",m.hitch(this,this.distanceUnitDDDidChange)),this.distanceUnitDD.on("change",m.hitch(this,this.distanceUnitDDDidChange)),b(this.inputControl.dt,"DrawComplete",m.hitch(this,function(){this.feedbackDidComplete();
da.focus(this.inputControl.coordtext)})),b(this.inputControl,"get-coordinate-complete",m.hitch(this,this.feedbackDidComplete)),b(this.saveToLayerIcon,"click",m.hitch(this,function(){ea.contains(this.saveToLayerIcon,"esriCTHidden")||this._showPanel("publishPage")})),b(this.saveToLayerIcon,"keydown",m.hitch(this,function(N){if(N.keyCode===ca.ENTER||N.keyCode===ca.SPACE)ea.contains(this.saveToLayerIcon,"esriCTHidden")||this._showPanel("publishPage")})),b(this.settingsIcon,"click",m.hitch(this,function(){ea.contains(this.settingsIcon,
"esriCTHidden")||this._showPanel("settingsPage")})),b(this.settingsIcon,"keydown",m.hitch(this,function(N){if(N.keyCode===ca.ENTER||N.keyCode===ca.SPACE)ea.contains(this.settingsIcon,"esriCTHidden")||this._showPanel("settingsPage")})),b(this.settingsPanelBackButton,"click",m.hitch(this,function(){ea.contains(this.settingsPanelBackButton,"esriCTHidden")||(this._SettingsInstance.onSettingsChanged(),this._showPanel("mainPage"))})),b(this.settingsPanelBackButton,"keydown",m.hitch(this,function(N){N.keyCode!==
ca.ENTER&&N.keyCode!==ca.SPACE||ea.contains(this.settingsPanelBackButton,"esriCTHidden")||(this._SettingsInstance.onSettingsChanged(),this._showPanel("mainPage"))})))},minObsRangeKeyWasPressed:function(){this.minObsRange.isValid()&&(this.maxObsRange.constraints.min=Number(this.minObsRange.value)+.001,this.maxObsRange.set("value",Number(this.minObsRange.value)+1),this.maxObsRange.set("value",this.maxObsRange.value&&this.maxObsRange.value>this.minObsRange.value?this.maxObsRange.value:Number(this.minObsRange.value)+
1))},mouseMoveOverFOVGroup:function(){!1===this.FOVInput.disabled&&(this.mouseMoveOverFOVInput(),this.tooltip.hidden=!1)},mouseMoveOverFOVInput:function(){var N=this.tooltip;!1===this.FOVInput.disabled&&$(document).ready(function(){$(document).mousemove(function(C){f.set(N,{left:C.pageX+10+"px",top:C.pageY+10+"px"})})})},mouseMoveOutFOVInput:function(){this.tooltip.hidden=!1;this.FOVInput.blur()},angleUnitsDidChange:function(){this.angleUnits.checked?($("#"+this.FOVInput.id).trigger("configure",{max:6400,
units:"mils",milsValue:6400}),$("#"+this.FOVInput.id).val(6400).trigger("change")):($("#"+this.FOVInput.id).trigger("configure",{max:360,units:"degrees",milsValue:6400}),$("#"+this.FOVInput.id).val(360).trigger("change"));this.resetInputColor()},distanceUnitDDDidChange:function(){var N="",C={};this.distanceUnit=this.distanceUnitDD.get("value");this.observerHeightUnit=this.observerHeightDD.get("value");if(this.distanceUnit){switch(this.distanceUnit){case "miles":C.max=31;break;case "nauticalMiles":C.max=
26.9383;break;case "kilometers":C.max=50;break;case "yards":C.max=54680;break;case "feet":C.max=164041;break;case "meters":C.max=5E4}N=d.substitute(this.nls.maximumRangeMessage,{units:window.jimuNls.units[this.distanceUnit],limit:a.format(C.max,{places:2,locale:k.locale})});C.min=Number(this.minObsRange.value)+.001;this.maxObsRange.set("constraints",C);this.maxObsRange.set("rangeMessage",N)}},feedbackDidComplete:function(){this.inputControl.deactivateDrawTool();this.map.enableMapNavigation();this.enableFOVDial()},
enableFOVDial:function(){this.FOVInput.disabled&&(this.FOVInput.disabled=!1,$("#"+this.FOVInput.id).trigger("configure",{fgColor:"#00ff66",bgColor:"#f37371",inputColor:"#ccc"}));this.resetInputColor()},_createWedgesUsingBuffers:function(N,C,P,Q){C=B.getGeometries(C);Q=I.geodesicBuffer(C,[Q],"meters",!0);0<P?(P=I.geodesicBuffer(C,[P],"meters",!0),Q=I.difference(Q[0],P[0])):Q=Q[0];N.resolve([Q,Q])},_createWedgesUsingAngles:function(N,C,P,Q,Y,fa){C=C.geometry;var na=[];var la=[];this.Azimuth1=P>Q?P-
360:P;fa=K.getPointsForArc(P,Q,C,fa);la.push([C.x,C.y]);l.forEach(fa,function(aa){la.push([aa.x,aa.y])});la.push([C.x,C.y]);if(0<Y){var W=K.getDestinationPoint(C,P,Y);P=K.getPointsForArc(P,Q,C,Y);na.push([W.x,W.y]);l.forEach(fa,function(aa){na.push([aa.x,aa.y])});P.reverse();l.forEach(P,function(aa){na.push([aa.x,aa.y])});na.push([W.x,W.y])}else na=la;P=new G(na);P.setSpatialReference(C.spatialReference);Q=new G(la);Q.setSpatialReference(C.spatialReference);N.resolve([P,Q])},_createWedges:function(N,
C,P){var Q=new r;this.Azimuth1=parseInt(this.LA-this.FOV/2,10);0>this.Azimuth1&&(this.Azimuth1+=360);this.Azimuth2=parseInt(this.LA+this.FOV/2,10);360<this.Azimuth2&&(this.Azimuth2-=360);360===this.FOV?(this.Azimuth1=0,this.Azimuth2=360,this._createWedgesUsingBuffers(Q,N,C,P)):this._createWedgesUsingAngles(Q,N[0],this.Azimuth1,this.Azimuth2,C,P);return Q.promise},_getFeatureCollectionLayer:function(N){l.forEach(N,m.hitch(this,function(C,P){C.attributes={};C.attributes.ObjectID=P}));return new z({featureSet:{features:N,
geometryType:"esriGeometryPoint"},layerDefinition:{name:"InputLayer",geometryType:"esriGeometryPoint",objectIdField:"ObjectID",fields:[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID"}]}})},_initAnalysisProcess:function(N){this._createWedges(N.InputObserver.features,N.MinimumRadius,N.MaximumRadius).then(m.hitch(this,function(C){var P=[];if(C&&2===C.length){var Q=this.appConfig.geometryService;var Y=new J(Q);Q=K.getProjectedGeometry(C[0],this.map.spatialReference,Y).then(m.hitch(this,function(fa){this._wedgeGeometry=
fa}));P.push(Q);C=K.getProjectedGeometry(C[1],this.map.spatialReference,Y).then(m.hitch(this,function(fa){this._fullWedgeGeometry=fa}));P.push(C);h(P).then(m.hitch(this,function(){this._createViewShed(N)}))}}))},_createViewShed:function(N){N={portalUrl:this.portalUrl,inputLayer:this._getFeatureCollectionLayer(N.InputObserver.features),maxDistanceUnits:"Meters",maximumDistance:N.MaximumRadius,observerHeightUnits:"Meters",observerHeight:N.ObserverHeight,showSelectAnalysisLayer:!1,targetHeightUnits:"Meters",
map:this.map,showChooseExtent:!1,returnFeatureCollection:!0};N=new A(N);N.startup();N.on("job-result",m.hitch(this,this._onViewShedCreated));N.on("job-status",m.hitch(this,function(C){"esriJobFailed"===C.jobStatus&&this._showJobError(C)}));N.on("job-fail",m.hitch(this,this._showJobError));N._form.validate()?(this.busyIndicator.show(),N._handleSaveBtnClick()):new v({message:this.nls.validationError})},_showJobError:function(N){new v({message:N.message});this.busyIndicator.hide()},_onViewShedCreated:function(N){var C=
[];l.forEach(N.value.featureSet.features,m.hitch(this,function(P){P=new G(P.geometry);P.setSpatialReference(this.map.spatialReference);(P=I.difference(this._wedgeGeometry,P))&&(P=I.difference(this._wedgeGeometry,P));P=new t(P);P.setAttributes({type:1});C.push(P)}));this._showGraphicsOnMap(C)},_drawWedge:function(N,C){for(var P=new r,Q=0,Y=N.length;Q<Y;Q++){var fa=N[Q];fa&&fa.geometry&&(C?fa.setAttributes({type:2}):fa.setAttributes({type:3}),this.graphicsLayer.add(fa))}P.resolve("success");return P.promise},
_drawViewshed:function(N){var C=new r;this.graphics=[];var P=new t(this._wedgeGeometry);P.setAttributes({type:0,regionType:"nonVisible"});for(var Q=0,Y=N.length;Q<Y;Q++){var fa=N[Q];if(fa&&fa.geometry){var na=fa.geometry;fa.setAttributes({type:1,regionType:"visible"});var la=fa;this.graphicsLayer.add(fa)}}na&&(this.graphics.push(la),N=I.difference(this._wedgeGeometry,na),P=new t(N),P.setAttributes({type:0,regionType:"nonVisible"}));this.graphics.push(P);this.graphicsLayer.add(P);C.resolve("success");
return C.promise},_showGraphicsOnMap:function(N){this._drawWedge([new t(this._fullWedgeGeometry)],!0);this._drawWedge([new t(this._wedgeGeometry)],!1);this._drawViewshed(N).then(m.hitch(this,function(){this.map.setExtent(B.graphicsExtent(this.graphicsLayer.graphics),!0);ea.remove(this.saveToLayerIcon,"esriCTHidden");this.busyIndicator.hide();this._createPortalPublishUI();this._suppoprtAccessibility()}))},createButtonWasClicked:function(){if(this.inputControl.getMapCoordinateDD()&&this.minObsRange.isValid()&&
this.maxObsRange.isValid()&&this.observerHeight.isValid()&&0!==parseInt(this.FOVInput.value,10)&&!isNaN(parseInt(this.FOVInput.value,10))){var N=new t(this.inputControl.getMapCoordinateDD()),C=new D;C.features=[N];N={InputObserver:C,MinimumRadius:this.utils.convertToMeters(this.minObsRange.value,this.distanceUnit),MaximumRadius:this.utils.convertToMeters(this.maxObsRange.value,this.distanceUnit),ObserverHeight:this.utils.convertToMeters(this.observerHeight.value,this.observerHeightUnit)};this._initAnalysisProcess(N)}else new v({message:this.nls.validationError})},
onClearBtnClicked:function(){this.angleUnits&&(this.angleUnits.setValue(this.config.defaultAngleUnits),this.observerHeightDD.set("value",this.config.defaultObserverHeightUnit),this.distanceUnitDD.set("value",this.config.defaultObservableDistanceUnit),this.config.hasOwnProperty("observeHeight")&&this.observerHeight.setValue(this.config.observeHeight),this.config.hasOwnProperty("minimumObservableDistanceValue")&&this.minObsRange.setValue(this.config.minimumObservableDistanceValue),this.config.hasOwnProperty("maximumObservableDistanceValue")&&
setTimeout(m.hitch(this,function(){this.maxObsRange.setValue(this.config.maximumObservableDistanceValue)}),100),this.minObsRangeKeyWasPressed(),this.graphicsLayer.clear(),this.inputControl.clear(),this.FOVInput.disabled=!0,this.angleUnitsDidChange(),$("#"+this.FOVInput.id).trigger("configure",{fgColor:"#ccc",bgColor:"#ccc",inputColor:"#ccc"}),this.tooltip.hidden=!0,this.resetInputColor())},resetInputColor:function(){setTimeout(m.hitch(this,function(){f.set(this.FOVInput,"color","gray")}),100)},_suppoprtAccessibility:function(){"mainPage"===
this._currentOpenPanel&&(ba.initFirstFocusNode(this.parentWidget.domNode,this.settingsIcon),ba.isAutoFocusFirstNodeWidget(this)&&da.focus(this.settingsIcon),ba.initLastFocusNode(this.parentWidget.domNode,this.btnClear));"publishPage"===this._currentOpenPanel&&this.portalPublishObj._setFirstLastFocusNodes();"settingsPage"===this._currentOpenPanel&&(ba.initFirstFocusNode(this.parentWidget.domNode,this.settingsPanelBackButton),this._SettingsInstance._setLastFocusNode())},_createPortalPublishUI:function(){this.portalPublishObj=
new ja({config:this.config,appConfig:this.appConfig,graphicsLayer:this.graphicsLayer,graphics:this.graphics,_renderer:this._renderer,map:this.map,nls:this.nls,parentNode:this.parentWidget.domNode,observerHeight:this.observerHeight.value,minObsRange:this.minObsRange.value,maxObsRange:this.maxObsRange.value,distanceUnitDD:this.distanceUnitDD.getOptions(this.distanceUnitDD.value).label,observerHeightDD:this.observerHeightDD.getOptions(this.observerHeightDD.value).label,angleUnits:this.nls.degreesLabel,
centerPoint:this.inputControl.coordtext.value,fovStartAngle:this.Azimuth1,fovEndAngle:this.Azimuth2,_layerList:this._layerList});L.empty(this.portalPublishContainer);this.portalPublishObj.placeAt(this.portalPublishContainer);this.portalPublishObj.startup();this.own(b(this.portalPublishObj,"displayMainPageOnBack",m.hitch(this,function(){this._showPanel("mainPage")})));this._showPanel("publishPage")},_showPanel:function(N){if(this._currentOpenPanel){var C=this._getNodeByName(this._currentOpenPanel);
ea.add(C,"esriCTHidden")}C=this._getNodeByName(N);ea.remove(C,"esriCTHidden");this._lastOpenPanel=this._currentOpenPanel;this._currentOpenPanel=N;this._suppoprtAccessibility()},_getNodeByName:function(N){switch(N){case "mainPage":var C=this.visibiltyWidget;break;case "publishPage":C=this.portalPublishContainer;break;case "settingsPage":C=this.settingsContainer}return C},_createRendererForPublishLayer:function(N){var C=new w(N.visibleSectionFillColor.color),P=255*(1-N.visibleSectionFillColor.transparency),
Q=new w(N.visibleSectionOutlineColor.color),Y=255*(1-N.visibleSectionOutlineColor.transparency),fa=new w(N.nonVisibleSectionFillColor.color),na=255*(1-N.nonVisibleSectionFillColor.transparency),la=new w(N.nonVisibleSectionOutlineColor.color);this._renderer=new O({type:"uniqueValue",field1:"RegionType",uniqueValueInfos:[{value:1,symbol:{color:[C.r,C.g,C.b,P],outline:{color:[Q.r,Q.g,Q.b,Y],width:.75,type:"esriSLS",style:N.visibleSectionOutlineColor.type},type:"esriSFS",style:N.visibleSectionFillColor.type}},
{value:0,symbol:{color:[fa.r,fa.g,fa.b,na],outline:{color:[la.r,la.g,la.b,255*(1-N.nonVisibleSectionOutlineColor.transparency)],width:1,type:"esriSLS",style:N.nonVisibleSectionOutlineColor.type},type:"esriSFS",style:N.nonVisibleSectionFillColor.type}}]});this._renderer.removeValue("others")},_createRendererForGraphicsLayer:function(N){var C=new w(N.visibleSectionFillColor.color),P=255*(1-N.visibleSectionFillColor.transparency),Q=new w(N.visibleSectionOutlineColor.color),Y=255*(1-N.visibleSectionOutlineColor.transparency),
fa=new w(N.nonVisibleSectionFillColor.color),na=255*(1-N.nonVisibleSectionFillColor.transparency),la=new w(N.nonVisibleSectionOutlineColor.color);N=new O({type:"uniqueValue",field1:"type",uniqueValueInfos:[{value:1,symbol:{color:[C.r,C.g,C.b,P],outline:{color:[Q.r,Q.g,Q.b,Y],width:.75,type:"esriSLS",style:N.visibleSectionOutlineColor.type},type:"esriSFS",style:N.visibleSectionFillColor.type}},{value:0,symbol:{color:[fa.r,fa.g,fa.b,na],outline:{color:[la.r,la.g,la.b,255*(1-N.nonVisibleSectionOutlineColor.transparency)],
width:1,type:"esriSLS",style:N.nonVisibleSectionOutlineColor.type},type:"esriSFS",style:N.nonVisibleSectionFillColor.type}},{value:2,symbol:{color:[0,0,0,0],outline:{color:[0,0,0,1],width:1,type:"esriSLS",style:"esriSLSDash"},type:"esriSFS",style:"esriSFSSolid"}},{value:3,symbol:{color:[0,0,0,0],outline:{color:[255,0,0,1],width:1,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"}}]});N.removeValue("others");this.graphicsLayer.setRenderer(N);this.graphicsLayer.refresh()},_getAllMapLayers:function(){var N=
[];S.getInstance().traversal(function(C){"undefined"!==typeof C._layerInfo.layerObject.type&&-1===C._layerInfo.layerObject.type.indexOf("tile")&&"esriGeometryPolygon"===C._layerInfo.layerObject.geometryType&&N.push(C._layerInfo.layerObject)});return N},_createSettings:function(){this._SettingsInstance=new T({nls:this.nls,config:this.config,appConfig:this.appConfig,refDomNode:this.parentWidget.domNode},L.create("div",{},this.symbologySettingsNode));this.own(this._SettingsInstance.on("settingsChanged",
m.hitch(this,function(N){this._createRendererForPublishLayer(N);this._createRendererForGraphicsLayer(N)})));this._SettingsInstance.startup()}})})},"esri/dijit/util/busyIndicator":function(){define("dijit/registry dojo/_base/lang dojo/_base/window dojo/dom dojo/dom-construct dojox/widget/Standby require".split(" "),function(H,k,p,r,m,l,b){var a={_defaultStandbyParams:{image:b.toUrl("../images/loading-throb.gif"),color:"#fff",opacity:.75,duration:200},create:function(d){if(d=this._normalizeParams(d))return d=
new l(a._toStandbyParams(d)),m.place(d.domNode,p.doc.body),a._createHandle(d)},_normalizeParams:function(d){if(d){if(d.target)return d;if("string"===typeof d){var f=H.byId(d);d=f?f.domNode:r.byId(d)}else d=d.domNode?d.domNode:r.byId(d);if(d)return{target:d}}},_toStandbyParams:function(d){d.imageUrl&&(d.image=d.imageUrl);d.backgroundColor&&(d.color=d.backgroundColor);d.backgroundOpacity&&(d.opacity=d.backgroundOpacity);d.fadeDuration&&(d.duration=d.fadeDuration);return k.mixin({},a._defaultStandbyParams,
d)},_createHandle:function(d){return{show:function(){d&&d.show()},hide:function(){d&&d.hide()},destroy:function(){d&&(d.destroy(),d=null)}}}};return a})},"dojox/widget/Standby":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/array dojo/_base/event dojo/_base/sniff dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/window dojo/_base/window dojo/_base/fx dojo/fx dijit/_Widget dijit/_TemplatedMixin dijit/registry".split(" "),function(H,k,p,r,m,l,b,a,d,
f,e,h,c,g,n,q,v){H.experimental("dojox.widget.Standby");return k("dojox.widget.Standby",[n,q],{image:require.toUrl("dojox/widget/Standby/images/loading.gif").toString(),imageText:"Please Wait...",text:"Please wait...",centerIndicator:"image",target:"",color:"#C0C0C0",duration:500,zIndex:"auto",opacity:.75,templateString:'\x3cdiv\x3e\x3cdiv style\x3d"display: none; opacity: 0; z-index: 9999; position: absolute; cursor:wait;" dojoAttachPoint\x3d"_underlayNode"\x3e\x3c/div\x3e\x3cimg src\x3d"${image}" style\x3d"opacity: 0; display: none; z-index: -10000; position: absolute; top: 0px; left: 0px; cursor:wait;" dojoAttachPoint\x3d"_imageNode"\x3e\x3cdiv style\x3d"opacity: 0; display: none; z-index: -10000; position: absolute; top: 0px;" dojoAttachPoint\x3d"_textNode"\x3e\x3c/div\x3e\x3c/div\x3e',
_underlayNode:null,_imageNode:null,_textNode:null,_centerNode:null,_displayed:!1,_resizeCheck:null,_started:!1,_parent:null,startup:function(u){if(!this._started){if("string"===typeof this.target){var t=v.byId(this.target);this.target=t?t.domNode:l.byId(this.target)}this.text&&(this._textNode.innerHTML=this.text);"image"===this.centerIndicator?(this._centerNode=this._imageNode,b.set(this._imageNode,"src",this.image),b.set(this._imageNode,"alt",this.imageText)):this._centerNode=this._textNode;f.set(this._underlayNode,
{display:"none",backgroundColor:this.color});f.set(this._centerNode,"display","none");this.connect(this._underlayNode,"onclick","_ignore");this.domNode.parentNode&&this.domNode.parentNode!=h.body()&&h.body().appendChild(this.domNode);7==m("ie")&&(this._ieFixNode=a.create("div"),f.set(this._ieFixNode,{opacity:"0",zIndex:"-1000",position:"absolute",top:"-1000px"}),h.body().appendChild(this._ieFixNode));this.inherited(arguments)}},show:function(){this._displayed||(this._anim&&(this._anim.stop(),delete this._anim),
this._displayed=!0,this._size(),this._disableOverflow(),this._fadeIn())},hide:function(){if(this._displayed)try{this._anim&&(this._anim.stop(),delete this._anim),this._size()}catch(u){console.error(u)}finally{this._fadeOut(),this._displayed=!1,null!==this._resizeCheck&&(clearInterval(this._resizeCheck),this._resizeCheck=null)}},isVisible:function(){return this._displayed},onShow:function(){},onHide:function(){},uninitialize:function(){this._displayed=!1;this._resizeCheck&&clearInterval(this._resizeCheck);
f.set(this._centerNode,"display","none");f.set(this._underlayNode,"display","none");7==m("ie")&&this._ieFixNode&&(h.body().removeChild(this._ieFixNode),delete this._ieFixNode);this._anim&&(this._anim.stop(),delete this._anim);this._centerNode=this._textNode=this._imageNode=this.target=null;this.inherited(arguments)},_size:function(){if(this._displayed){var u=b.get(h.body(),"dir");u&&(u=u.toLowerCase());var t=this._scrollerWidths(),y=this.target,D=f.get(this._centerNode,"display");f.set(this._centerNode,
"display","block");var B=d.position(y,!0);if(y===h.body()||y===h.doc)B=e.getBox(),B.x=B.l,B.y=B.t;var E=d.getMarginBox(this._centerNode);f.set(this._centerNode,"display",D);if(this._ieFixNode){var x=-this._ieFixNode.offsetTop/1E3;B.x=Math.floor((B.x+.9)/x);B.y=Math.floor((B.y+.9)/x);B.w=Math.floor((B.w+.9)/x);B.h=Math.floor((B.h+.9)/x)}var w=f.get(y,"zIndex"),A=D=w;if("auto"===this.zIndex)if("auto"!=w)D=parseInt(D,10),A=parseInt(A,10);else{var z=y;if(z&&z!==h.body()&&z!==h.doc)for(z=y.parentNode,
x=-1E5;z&&z!==h.body();)(w=f.get(z,"zIndex"))&&"auto"!==w&&(w=parseInt(w,10),x<w&&(x=w,D=w+1,A=w+1)),z=z.parentNode}else D=parseInt(this.zIndex,10),A=parseInt(this.zIndex,10);f.set(this._centerNode,"zIndex",A);f.set(this._underlayNode,"zIndex",D);if((D=y.parentNode)&&D!==h.body()&&y!==h.body()&&y!==h.doc){z=B.h;A=B.w;y=d.position(D,!0);this._ieFixNode&&(x=-this._ieFixNode.offsetTop/1E3,y.x=Math.floor((y.x+.9)/x),y.y=Math.floor((y.y+.9)/x),y.w=Math.floor((y.w+.9)/x),y.h=Math.floor((y.h+.9)/x));y.w-=
D.scrollHeight>D.clientHeight&&0<D.clientHeight?t.v:0;y.h-=D.scrollWidth>D.clientWidth&&0<D.clientWidth?t.h:0;"rtl"===u&&(m("opera")?(B.x+=D.scrollHeight>D.clientHeight&&0<D.clientHeight?t.v:0,y.x+=D.scrollHeight>D.clientHeight&&0<D.clientHeight?t.v:0):m("ie")?y.x+=D.scrollHeight>D.clientHeight&&0<D.clientHeight?t.v:0:m("webkit"));y.w<B.w&&(B.w-=y.w);y.h<B.h&&(B.h-=y.h);var G=y.y,I=y.y+y.h,K=B.y,R=B.y+z;u=y.x;x=y.x+y.w;w=B.x;var U=B.x+A;if(R>G&&K<G)B.y=y.y,z-=G-K,B.h=z<y.h?z:B.h-2*(D.scrollWidth>
D.clientWidth&&0<D.clientWidth?t.h:0);else if(K<I&&R>I)B.h=I-K;else if(R<=G||K>=I)B.h=0;if(U>u&&w<u)B.x=y.x,A-=u-w,B.w=A<y.w?A:B.w-2*(D.scrollHeight>D.clientHeight&&0<D.clientHeight?t.w:0);else if(w<x&&U>x)B.w=x-w;else if(U<=u||w>=x)B.w=0}0<B.h&&0<B.w?(f.set(this._underlayNode,{display:"block",width:B.w+"px",height:B.h+"px",top:B.y+"px",left:B.x+"px"}),t=["borderRadius","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"],this._cloneStyles(t),m("ie")||(t=
"MozBorderRadius MozBorderRadiusTopleft MozBorderRadiusTopright MozBorderRadiusBottomleft MozBorderRadiusBottomright WebkitBorderRadius WebkitBorderTopLeftRadius WebkitBorderTopRightRadius WebkitBorderBottomLeftRadius WebkitBorderBottomRightRadius".split(" "),this._cloneStyles(t,this)),t=B.h/2-E.h/2,D=B.w/2-E.w/2,B.h>=E.h&&B.w>=E.w?f.set(this._centerNode,{top:t+B.y+"px",left:D+B.x+"px",display:"block"}):f.set(this._centerNode,"display","none")):(f.set(this._underlayNode,"display","none"),f.set(this._centerNode,
"display","none"));if(null===this._resizeCheck){var ba=this;this._resizeCheck=setInterval(function(){ba._size()},100)}}},_cloneStyles:function(u){p.forEach(u,function(t){f.set(this._underlayNode,t,f.get(this.target,t))},this)},_fadeIn:function(){var u=this,t=c.animateProperty({duration:u.duration,node:u._underlayNode,properties:{opacity:{start:0,end:u.opacity}}}),y=c.animateProperty({duration:u.duration,node:u._centerNode,properties:{opacity:{start:0,end:1}},onEnd:function(){u.onShow();delete u._anim}});
this._anim=g.combine([t,y]);this._anim.play()},_fadeOut:function(){var u=this,t=c.animateProperty({duration:u.duration,node:u._underlayNode,properties:{opacity:{start:u.opacity,end:0}},onEnd:function(){f.set(this.node,{display:"none",zIndex:"-1000"})}}),y=c.animateProperty({duration:u.duration,node:u._centerNode,properties:{opacity:{start:1,end:0}},onEnd:function(){f.set(this.node,{display:"none",zIndex:"-1000"});u.onHide();u._enableOverflow();delete u._anim}});this._anim=g.combine([t,y]);this._anim.play()},
_ignore:function(u){u&&r.stop(u)},_scrollerWidths:function(){var u=a.create("div");f.set(u,{position:"absolute",opacity:0,overflow:"hidden",width:"50px",height:"50px",zIndex:"-100",top:"-200px",padding:"0px",margin:"0px"});var t=a.create("div");f.set(t,{width:"200px",height:"10px"});u.appendChild(t);h.body().appendChild(u);t=d.getContentBox(u);f.set(u,"overflow","scroll");var y=d.getContentBox(u);h.body().removeChild(u);return{v:t.w-y.w,h:t.h-y.h}},_setTextAttr:function(u){this.text=this._textNode.innerHTML=
u},_setColorAttr:function(u){f.set(this._underlayNode,"backgroundColor",u);this.color=u},_setImageTextAttr:function(u){b.set(this._imageNode,"alt",u);this.imageText=u},_setImageAttr:function(u){b.set(this._imageNode,"src",u);this.image=u},_setCenterIndicatorAttr:function(u){this.centerIndicator=u;"image"===u?(this._centerNode=this._imageNode,f.set(this._textNode,"display","none")):(this._centerNode=this._textNode,f.set(this._imageNode,"display","none"))},_setTargetAttr:function(u){if("string"===typeof u){var t=
v.byId(u);this._set("target",t?t.domNode:l.byId(u))}else this._set("target",u)},_disableOverflow:function(){if(this.target===h.body()||this.target===h.doc){this._overflowDisabled=!0;var u=h.body();this._oldOverflow=u.style&&u.style.overflow?f.get(u,"overflow"):"";if(m("ie")&&!m("quirks")){if(u.parentNode&&u.parentNode.style&&u.parentNode.style.overflow)this._oldBodyParentOverflow=u.parentNode.style.overflow;else try{this._oldBodyParentOverflow=f.get(u.parentNode,"overflow")}catch(t){this._oldBodyParentOverflow=
"scroll"}f.set(u.parentNode,"overflow","hidden")}f.set(u,"overflow","hidden")}},_enableOverflow:function(){if(this._overflowDisabled){delete this._overflowDisabled;var u=h.body();m("ie")&&!m("quirks")&&(u.parentNode.style.overflow=this._oldBodyParentOverflow,delete this._oldBodyParentOverflow);f.set(u,"overflow",this._oldOverflow);if(m("webkit")){var t=a.create("div",{style:{height:"2px"}});u.appendChild(t);setTimeout(function(){u.removeChild(t)},0)}delete this._oldOverflow}}})})},"esri/dijit/analysis/CreateViewshed":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/json dojo/has dojo/json dojo/string dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/number dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/Button dijit/form/CheckBox dijit/form/Form dijit/form/Select dijit/form/TextBox dijit/form/NumberSpinner dijit/form/ValidationTextBox dijit/layout/ContentPane dijit/form/FilteringSelect dijit/Dialog ../../kernel ../../lang ./AnalysisBase ./_AnalysisOptions ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ../../toolbars/draw ../PopupTemplate ../../layers/FeatureLayer ../../graphic ./utils ./AnalysisRegistry ./CreditEstimator ../../symbols/PictureMarkerSymbol dijit/form/HorizontalSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dojo/i18n!../../nls/jsapi dojo/text!./templates/CreateViewshed.html".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x,w,A,z,G,I,K,R,U,ba,ca,da,ja,ea,L,O,S,T,J,N,C,P,Q,Y,fa,na,la,W){H=k([v,u,t,y,D,ja,da],{declaredClass:"esri.dijit.analysis.CreateViewshed",templateString:W,widgetsInTemplate:!0,inputLayer:null,maximumDistance:15,maxDistanceUnits:"Kilometers",targetHeight:0,targetHeightUnits:"Meters",observerHeight:1.75,observerHeightUnits:"Meters",outputLayerName:null,i18n:null,map:null,toolName:"CreateViewshed",helpFileName:"CreateViewshed",resultParameter:"viewshedLayer",
constructor:function(aa,oa){oa=aa.distanceDefaultUnits||"Miles";this._pbConnects=[];aa.containerNode&&(this.container=aa.containerNode);this.maxDistanceUnits=aa.maxDistanceUnits?aa.maxDistanceUnits:oa;this.maximumDistance=ca.isDefined(aa.maximumDistance)?aa.maximumDistance:"Miles"===oa?9:15;this.observerHeightUnits=aa.observerHeightUnits?aa.observerHeightUnits:"Miles"===oa?"Feet":"Meters";this.observerHeight=ca.isDefined(aa.observerHeight)?aa.observerHeight:"Miles"===oa?6:1.75;this.targetHeightUnits=
aa.targetHeightUnits?aa.targetHeightUnits:"Miles"===oa?"Feet":"Meters"},destroy:function(){this.inherited(arguments);r.forEach(this._pbConnects,m.disconnect);delete this._pbConnects},postMixInProperties:function(){this.inherited(arguments);p.mixin(this.i18n,la.findHotSpotsTool);p.mixin(this.i18n,la.createViewshedTool);this.set("drawPointLayerName",this.i18n.pointlayerName)},postCreate:function(){this.inherited(arguments);n.add(this._form.domNode,"esriSimpleForm");this._outputLayerInput.set("validator",
p.hitch(this,this.validateServiceName));this.showCredits=!1;this._buildUI()},startup:function(){},_handleModeCrumbClick:function(aa){aa.preventDefault();this._onClose(!0)},_onClose:function(aa){aa&&this._pointfeatureLayer&&(this.map.removeLayer(this._pointfeatureLayer),r.forEach(this.inputLayers,function(oa,ha){oa===this._pointfeatureLayer&&(this._analysisSelect.removeOption({value:ha+1,label:this._pointfeatureLayer.name}),this.inputLayers.splice(ha,1))},this));this._handleInputDrawPointChange(!1);
this.emit("close",{save:!aa})},clear:function(){this._pointfeatureLayer&&(this.map.removeLayer(this._pointfeatureLayer),r.forEach(this.inputLayers,function(aa,oa){aa===this._pointfeatureLayer&&(this._analysisSelect.removeOption({value:oa+1,label:this._pointfeatureLayer.name}),this.inputLayers.splice(oa,1))},this));this._handleInputDrawPointChange(!1)},_handleShowCreditsClick:function(aa){aa.preventDefault();aa={};var oa=this.get("observerHeight"),ha=this.get("targetHeight"),pa=this.get("maximumDistance");
this._form.validate()&&(aa.inputLayer=b.toJson(this.constructAnalysisInputLyrObj(this.get("inputLayer"))),0<=pa&&(aa.maximumDistance=pa,aa.maxDistanceUnits=this.get("maxDistanceUnits")),0<=oa&&(aa.observerHeight=oa,aa.observerHeightUnits=this.get("observerHeightUnits")),0<=ha&&(aa.targetHeight=ha,aa.targetHeightUnits=this.get("targetHeightUnits")),this.returnFeatureCollection||(aa.OutputName=b.toJson({serviceProperties:{name:this.get("outputLayerName")}})),this.returnFeatureCollection||(aa.OutputName=
b.toJson({serviceProperties:{name:this.get("outputLayerName")}})),this.showChooseExtent&&this._useExtentCheck.get("checked")&&(aa.context=b.toJson({extent:this.map.extent._normalize(!0)})),this.getCreditsEstimate(this.toolName,aa).then(p.hitch(this,function(F){this._usageForm.set("content",F);this._usageDialog.show()})))},_handleSaveBtnClick:function(aa){if(this._form.validate()){this._saveBtn.set("disabled",!0);aa={};var oa={};var ha=this.get("observerHeight");var pa=this.get("targetHeight"),F=this.get("maximumDistance");
aa.inputLayer=b.toJson(this.constructAnalysisInputLyrObj(this.get("inputLayer")));0<=F&&(aa.maximumDistance=F,aa.maxDistanceUnits=this.get("maxDistanceUnits"));0<=ha&&(aa.observerHeight=ha,aa.observerHeightUnits=this.get("observerHeightUnits"));0<=pa&&(aa.targetHeight=pa,aa.targetHeightUnits=this.get("targetHeightUnits"));this.returnFeatureCollection||(aa.OutputName=b.toJson({serviceProperties:{name:this.get("outputLayerName")}}));this.showChooseExtent&&!this.get("disableExtent")&&this._useExtentCheck.get("checked")&&
(aa.context=b.toJson({extent:this.map.extent._normalize(!0)}));this.returnFeatureCollection&&(ha={outSR:this.map.spatialReference},this.showChooseExtent&&this._useExtentCheck.get("checked")&&(ha.extent=this.map.extent._normalize(!0)),aa.context=b.toJson(ha));aa.returnFeatureCollection=this.returnFeatureCollection;oa.jobParams=aa;oa.itemParams={description:this.i18n.itemDescription,tags:f.substitute(this.i18n.itemTags,{layername:this.inputLayer.name,fieldname:aa.field?aa.field:""}),snippet:this.i18n.itemSnippet};
this.showSelectFolder&&(oa.itemParams.folder=this.get("folderId"));this.execute(oa)}},_save:function(){},_buildUI:function(){this._loadConnections();this.signInPromise.then(p.hitch(this,N.initHelpLinks,this.domNode,this.showHelp,{analysisGpServer:this.analysisGpServer}));var aa=!0;this.get("showSelectAnalysisLayer")&&(this.inputLayers&&this.inputLayer&&!N.isLayerInLayers(this.inputLayer,this.inputLayers)&&(this.inputLayers.push(this.inputLayer),-1!==this.inputLayer.name.indexOf("Drawn Input Points")&&
(this.map.addLayer(this.inputLayer),this._pointfeatureLayer=this.inputLayer)),this.get("inputLayer")||!this.get("inputLayers")||this.rerun||this.set("inputLayer",this.inputLayers[0]),N.populateAnalysisLayers(this,"inputLayer","inputLayers",{posIncrement:1}));this.outputLayerName&&(this._outputLayerInput.set("value",this.outputLayerName),aa=!1);N.addReadyToUseLayerOption(this,[this._analysisSelect]);this._updateAnalysisLayerUI(aa);e.set(this._chooseFolderRow,"display",!0===this.showSelectFolder?"block":
"none");this.showSelectFolder&&this.getFolderStore().then(p.hitch(this,function(oa){this.folderStore=oa;N.setupFoldersUI({folderStore:this.folderStore,folderId:this.folderId,folderName:this.folderName,folderSelect:this._webMapFolderSelect,username:this.portalUser?this.portalUser.username:""})}));e.set(this._chooseExtentDiv,"display",!0===this.showChooseExtent?"inline-block":"none");e.set(this._showCreditsLink,"display",!0===this.showCredits?"block":"none");this._distanceUnitsSelect.addOption([{value:"Miles",
label:this.i18n.miles},{value:"Yards",label:this.i18n.yards},{value:"Feet",label:this.i18n.feet},{type:"separator"},{value:"Kilometers",label:this.i18n.kilometers},{value:"Meters",label:this.i18n.meters}]);this.maxDistanceUnits&&(this._distanceUnitsSelect.set("value",this.maxDistanceUnits),this._handleMaxDstUnitsChange(this.maxDistanceUnits));this.maximumDistance&&this._maximumDistanceInput.set("value",this.maximumDistance);this._obsrUnitsSelect.addOption([{value:"Miles",label:this.i18n.miles},{value:"Yards",
label:this.i18n.yards},{value:"Feet",label:this.i18n.feet},{type:"separator"},{value:"Kilometers",label:this.i18n.kilometers},{value:"Meters",label:this.i18n.meters}]);this.observerHeightUnits&&this._obsrUnitsSelect.set("value",this.observerHeightUnits);this.observerHeight&&this._obsrHeightInput.set("value",this.observerHeight);this._targetUnitsSelect.addOption([{value:"Miles",label:this.i18n.miles},{value:"Yards",label:this.i18n.yards},{value:"Feet",label:this.i18n.feet},{type:"separator"},{value:"Kilometers",
label:this.i18n.kilometers},{value:"Meters",label:this.i18n.meters}]);this.targetHeightUnits&&this._targetUnitsSelect.set("value",this.targetHeightUnits);this.targetHeight&&this._targetHgtInput.set("value",this.targetHeight)},_loadConnections:function(){this.on("start",p.hitch(this,"_onClose",!1));this._connect(this._closeBtn,"onclick",p.hitch(this,"_onClose",!0))},validateServiceName:function(aa){return N.validateServiceName(aa,{textInput:this._outputLayerInput,isItem:!this.returnFeatureCollection})},
_handleInputDrawPointChange:function(aa){aa?(this.emit("drawtool-activate",{}),this._pointfeatureLayer||this._createPointFeatColl(),this._pointtoolbar.activate(O.POINT)):this._pointtoolbar.deactivate()},_createPointFeatColl:function(){var aa=N.createPointFeatureCollection(this.drawPointLayerName);this._pointfeatureLayer=new T(aa,{id:this.drawPointLayerName});this.map.addLayer(this._pointfeatureLayer);m.connect(this._pointfeatureLayer,"onClick",p.hitch(this,function(oa){this.map.infoWindow.setFeatures([oa.graphic])}))},
_addPointFeatures:function(aa){var oa=[],ha={};aa=new J(aa);ha.description="blayer desc";ha.title="blayer";aa.setAttributes(ha);oa.push(aa);this._pointfeatureLayer.applyEdits(oa,null,null);if(0===this.inputLayers.length||this.inputLayers[this.inputLayers.length-1]!==this._pointfeatureLayer)this.inputLayers.push(this._pointfeatureLayer),oa=this.inputLayers.length-1,ha=this._analysisSelect.getOptions(),this._analysisSelect.removeOption(ha),ha=r.map(ha,function(pa){pa.selected=!1;return pa}),this._analysisSelect.addOption({value:oa+
1,label:this._pointfeatureLayer.name,selected:!0}),this._analysisSelect.addOption(ha),this._handleAnalysisLayerChange(oa+1)},_handleMaxDstChange:function(){this._maximumDistanceInput.validate()},_handleMaxDstUnitsChange:function(aa){var oa="",ha={min:0};"Miles"===aa?(ha.max=31,oa=f.substitute(this.i18n.maxDistanceValidMsg,{units:aa,limit:31})):"Kilometers"===aa?(ha.max=50,oa=f.substitute(this.i18n.maxDistanceValidMsg,{units:aa,limit:50})):"Yards"===aa?(ha.max=54680,oa=f.substitute(this.i18n.maxDistanceValidMsg,
{units:aa,limit:54680})):"Feet"===aa?(ha.max=164041,oa=f.substitute(this.i18n.maxDistanceValidMsg,{units:aa,limit:164041})):"Meters"===aa&&(ha.max=5E4,oa=f.substitute(this.i18n.maxDistanceValidMsg,{units:aa,limit:5E4}));this._maximumDistanceInput.set("constraints",ha);this._maximumDistanceInput.set("rangeMessage",oa)},_handleAnalysisLayerChange:function(aa){"browse"===aa||"browselayers"===aa?(this._createBrowseItems({browseValue:aa,disabledSubResources:[this.inputLayer]},{tags:["point"],geometryTypes:[C.GeometryTypes.Point,
C.GeometryTypes.MultiPoint]},this._analysisSelect),this._analysisPointDrawBtn.reset()):(this.inputLayer=this.inputLayers[aa-1],this._updateAnalysisLayerUI(!0))},_handleBrowseItemsSelect:function(aa,oa){aa&&aa.selection&&N.addAnalysisReadyLayer({item:aa.selection,layers:this.inputLayers,layersSelect:this._analysisSelect,posIncrement:1,browseDialog:aa.dialog||this._browsedlg,widget:this},oa).always(p.hitch(this,this._updateAnalysisLayerUI,!0))},_updateAnalysisLayerUI:function(aa){this.inputLayer&&(h.set(this._interpolateToolDescription,
"innerHTML",f.substitute(this.i18n.toolDefine,{layername:this.inputLayer.name})),aa&&(this.outputLayerName=f.substitute(this.i18n.outputLayerName,{layername:this.inputLayer.name})),this._outputLayerInput.set("value",this.outputLayerName),this._pointfeatureLayer&&this._pointfeatureLayer.name!==this.inputLayer.name&&this._analysisPointDrawBtn.reset())},_setAnalysisGpServerAttr:function(aa){aa&&(this.analysisGpServer=aa,this.set("toolServiceUrl",this.analysisGpServer+"/"+this.toolName))},_setInputLayersAttr:function(aa){this.inputLayers=
aa||[]},_setInputLayerAttr:function(aa){this.inputLayer=aa},_getInputLayerAttr:function(){return this.inputLayer},_getOutputLayerNameAttr:function(){this._outputLayerInput&&(this.outputLayerName=this._outputLayerInput.get("value"));return this.outputLayerName},_setOutputLayerNameAttr:function(aa){this.outputLayerName=aa},_setMapAttr:function(aa){this.map=aa;this._pointtoolbar=new O(this.map);m.connect(this._pointtoolbar,"onDrawEnd",p.hitch(this,this._addPointFeatures))},_getMapAttr:function(){return this.map},
_setDisableRunAnalysisAttr:function(aa){this._saveBtn.set("disabled",aa)},_setDisableExtentAttr:function(aa){this._useExtentCheck.set("checked",!aa);this._useExtentCheck.set("disabled",aa)},_getDisableExtentAttr:function(){this._useExtentCheck.get("disabled")},_setMaxDistanceUnitsAttr:function(aa){this.maxDistanceUnits=aa},_getMaxDistanceUnitsAttr:function(){this._distanceUnitsSelect&&this._distanceUnitsSelect.get("value")&&(this.maxDistanceUnits=this._distanceUnitsSelect.get("value"));return this.maxDistanceUnits},
_setMaximumDistanceAttr:function(aa){this.maximumDistance=aa},_getMaximumDistanceAttr:function(){return this._maximumDistanceInput.get("value")},_setObserverHeightUnitsAttr:function(aa){this.observerHeightUnits=aa},_getObserverHeightUnitsAttr:function(){this._obsrUnitsSelect&&this._obsrUnitsSelect.get("value")&&(this.observerHeightUnits=this._obsrUnitsSelect.get("value"));return this.observerHeightUnits},_setObserverHeightAttr:function(aa){this.observerHeight=aa},_getObserverHeightAttr:function(){return this._obsrHeightInput.get("value")},
_setTargetHeightUnitsAttr:function(aa){this.targetHeightUnits=aa},_getTargetHeightUnitsAttr:function(){this._targetUnitsSelect&&this._targetUnitsSelect.get("value")&&(this.targetHeightUnits=this._targetUnitsSelect.get("value"));return this.targetHeightUnits},_setTargetHeightAttr:function(aa){this.targetHeight=aa},_getTargetHeightAttr:function(){return this._targetHgtInput.get("value")},_setDrawPointLayerNameAttr:function(aa){this.drawPointLayerName=aa},_getDrawPointLayerNameAttr:function(){return this._pointfeatureLayer.name},
_getDrawLayerAttr:function(){var aa=[];this._featureLayer&&aa.push(this._featureLayer);this._pointfeatureLayer&&aa.push(this._pointfeatureLayer);return aa},_connect:function(aa,oa,ha){this._pbConnects.push(m.connect(aa,oa,ha))}});a("extend-esri")&&p.setObject("dijit.analysis.CreateViewshed",H,ba);return H})},"esri/dijit/analysis/AnalysisBase":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has dojo/json dojo/Deferred dojo/promise/all dojo/when dojo/data/ItemFileWriteStore dojo/string dojo/Evented dojo/_base/kernel dojo/Stateful ../../kernel ../../lang ../../request ../../tasks/Geoprocessor dojo/i18n!../../nls/jsapi ./utils ./storageUtils ./ItemTypes ../../IdentityManager".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E){k=k([n,c],{declaredClass:"esri.dijit.analysis.AnalysisBase",isOutputLayerItemUpdated:!1,analysisGpServer:null,toolName:null,portalUrl:null,jobParams:null,itemParams:null,gp:null,resultParameter:null,signInPromise:null,getResultLyrInfos:!1,checkCreditLimits:!1,useGPCreditTask:!0,_isGPCreditSync:!0,_jobInfo:null,_popupInfo:null,_toolServiceUrl:null,_counter:null,_analysisType:"feature",doRefreshItem:!0,doSaveJobInfo:!1,doSaveInStorage:!1,_doDeleteViewResult:!1,
outputName:"OutputName",_freeGPTools:["CreateWatersheds","CreateViewshed","TraceDownstream"],constructor:function(x){this.isOutputLayerItemUpdated=!1;this._rids=[];this._counter=0;this._popupInfo=[];x.analysisGpServer?this._signIn(x.analysisGpServer):x.portalUrl&&(this.portalUrl=x.portalUrl,this._signIn(x.portalUrl,!0));this.i18n={};p.mixin(this.i18n,y.common);p.mixin(this.i18n,y.analysisTools);p.mixin(this.i18n,y.analysisMsgCodes);p.mixin(this.i18n,y.analysisSettings);this.signInPromise.then(p.hitch(this,
this._initErrorHelpMap))},execute:function(x){var w;this.jobParams=x.jobParams;this.jobParams.actualOutputName=this.outputName;var A=this.jobParams[this.outputName];this._analysisType=x.analysisType||"feature";this._updateContext();var z=m.fromJson(this.jobParams.context);A&&(w=m.fromJson(A));!A||w&&!w.serviceProperties?(this.itemParams=null,this.jobParams.resultName=this.get("resultName")):this.showGeoAnalyticsParams&&A&&z&&z.dataStore&&-1===["BDS","GDB"].indexOf(z.dataStore)?(this.jobParams._gaxOutName=
w.serviceProperties.name.replace(/[\s]|\-|\./g,"_"),this.jobParams[this.outputName]=null,this.jobParams.outputType=E.BDFSTEMPLATE,this.itemParams=null):(this.showGeoAnalyticsParams&&"CopyToDataStore"===this.toolName&&z&&z.dataStore&&-1!==["BDS","GDB"].indexOf(z.dataStore)&&(delete z.dataStore,this.jobParams.context=m.toJson(z)),this.itemParams=x.itemParams);v.isDefined(x.isSpatioTemporalDataStore)&&(this._isSpatioTemporalDataStore=D.settingsVM&&D.settingsVM.datastore&&"CopyToDataStore"!==this.toolName?
"BDS"===D.settingsVM.datastore:x.isSpatioTemporalDataStore);this.signInPromise.then(p.hitch(this,this._checkUser))},_updateContext:function(){var x;this.rerun&&this.context&&this._useExtentCheck&&!this._useExtentCheck.get("checked")&&(this.context.extent=null);this.context&&((x=m.fromJson(this.jobParams.context))||(x={}),this.context.outSR&&!x.outSR&&(x.outSR=this.context.outSR),this.context.processSR&&!x.processSR&&(x.processSR=this.context.processSR),this.context.extent&&!x.extent&&(x.extent=this.context.extent),
this.showGeoAnalyticsParams&&this.context.dataStore&&!x.dataStore&&(x.dataStore=this.context.dataStore),"raster"===this.analysisMode&&(this.context.cellSize&&!x.cellSize&&(x.cellSize=this.context.cellSize),this.context.mask&&!x.mask&&(x.mask=this.context.mask),!this.context.snapRaster||x.snapRaster||this.isDetectObjectTool||(x.snapRaster=this.context.snapRaster),this.isDLTool||this.isOutputFeatureTool||this.isProximityTool||!this.context.resamplingMethod||x.resamplingMethod||(x.resamplingMethod=this.context.resamplingMethod)),
this.isDLTool&&(this.context.processorType&&!x.processorType&&(x.processorType=this.context.processorType),"feature"===this._analysisType&&this.context.cellSize&&!x.cellSize&&(x.cellSize=this.context.cellSize)),this.isPPFTool&&(this.context.parallelProcessingFactor&&!x.parallelProcessingFactor&&(x.parallelProcessingFactor=this.context.parallelProcessingFactor),this.context.recycleProcessingWorkers&&!x.recycleProcessingWorkers&&(x.recycleProcessingWorkers=this.context.recycleProcessingWorkers),this.context.retryOnFailures&&
!x.retryOnFailures&&(x.retryOnFailures=this.context.retryOnFailures)),this.jobParams.context=m.toJson(x))},_checkUser:function(){var x;if(x=q.id.findCredential(this.portalUrl).userId)x=this.portalUrl+"/sharing/rest/community/users/"+x,u({url:x,content:{f:"json"}}).then(p.hitch(this,this._handleUserProfileResponse),p.hitch(this,function(w){this.emit("job-fail",{message:w.message+(w.details?w.details.toString():""),jobParams:this.jobParams})}))},getUserProfile:function(){var x=new a;this.userProfile?
x.resolve(this.userProfile):this.signInPromise.then(p.hitch(this,function(w){if(w=w.userId)w=this.portalUrl+"/sharing/rest/community/users/"+w,u({url:w,content:{f:"json"}}).then(p.hitch(this,function(A){this.userProfile=A;x.resolve(A)}),p.hitch(this,function(A){x.reject(A)}))}));return x.promise},_handleUserProfileResponse:function(x){var w=this.jobParams.outputType&&this.jobParams.outputType===E.FLAYERVIEW;if(v.isDefined(x)&&v.isDefined(x.orgId))if(-1===r.indexOf(["account_admin","account_publisher",
"org_admin","org_publisher"],x.role))this.emit("job-fail",{message:this.i18n.pubRoleMsg,messageCode:"AB_0001",jobParams:this.jobParams});else if(v.isDefined(x.availableCredits)&&this.get("checkCreditLimits")&&!w&&!this._byPassCreditCheck(this.toolName)){var A,z={},G=this.toolName,I=new a;var K=this._cleanUpJobParamsForSubmit();for(A in K)K.hasOwnProperty(A)&&("object"===typeof K[A]?z[A]=m.toJson(K[A]):-1!==r.indexOf(["measurementtype"],A.toLowerCase())&&"StraightLine"!==K[A]?(w=m.fromJson(K[A]),z[A]=
w?w.name.replace(/[\s~`!#$%\^&*+=\-\[\]\\';,\/{}|\\":<>\?]/g,""):"DrivingTime"):z[A]=K[A]);this.isRaster&&(G=this.rasterGPToolName,z.functionArguments&&(z.functionArguments=m.fromJson(z.functionArguments)),z.context&&(z.context=m.fromJson(z.context)));v.isDefined(this.itemParams)&&!this.isRaster?I=this._checkServiceName(x.orgId,!0):I.resolve(!0);I.then(p.hitch(this,function(R){R&&(this.isRaster&&v.isDefined(this.estimatedCost)?x.availableCredits>this.estimatedCost?this._runJob():this.emit("job-fail",
{message:this.i18n.insufficientCreditsMsg,messageCode:"AB_0001",jobParams:this.jobParams}):this.getCreditsEstimate(G,z,this.isRaster).always(p.hitch(this,function(U){var ba=U&&v.isDefined(U.cost)?U.cost:U.maximumCost;v.isDefined(ba)&&x.availableCredits>ba?this._runJob():U&&(U.messageCode||U.message)&&0!==U.status?(ba=v.isDefined(this.i18n[U.messageCode])?this.i18n[U.messageCode]:U.message,ba=v.isDefined(U.params)?h.substitute(ba,U.params):ba,this.emit("job-fail",{message:ba,messageCode:"AB_0001",
jobParams:this.jobParams})):this.isRaster&&v.isDefined(ba)&&x.availableCredits<ba?this.emit("job-fail",{message:this.i18n.insufficientCreditsMsg,messageCode:"AB_0001",jobParams:this.jobParams}):this._runJob()})))}))}else v.isDefined(this.itemParams)?this._checkServiceName(x.orgId):(this.emit("start",this.jobParams),this._submitGpJob());else this.emit("job-fail",{message:this.i18n.orgUsrMsg,jobParams:this.jobParams})},_runJob:function(){v.isDefined(this.itemParams)?("raster"===this._analysisType?this._createImageService():
this._createService(),this.emit("start",this.jobParams)):(this.emit("start",this.jobParams),this._submitGpJob())},_checkServiceName:function(x,w){var A=new a;q.id.findCredential(this.portalUrl);x=this.portalUrl+"/sharing/rest/portals/"+x+"/isServiceNameAvailable";var z=m.fromJson(this.jobParams[this.outputName]);v.isDefined(z.serviceProperties)&&v.isDefined(z.serviceProperties.name)&&(z.serviceProperties.name=z.serviceProperties.name.replace(/[\s]|\-|\./g,"_"),this.jobParams[this.outputName]=m.toJson(z));
u({url:x,content:{name:z.serviceProperties.name,type:"raster"===this._analysisType?"Image Service":"Feature Service",f:"json"}}).then(p.hitch(this,function(G){G.available?(w||("raster"===this._analysisType?this._createImageService():this._createService(),this.emit("start",this.jobParams)),A.resolve(!0)):(this.emit("job-fail",{message:this.i18n.servNameExists,type:"warning",messageCode:"AB_0002",jobParams:this.jobParams}),A.resolve(!1))}),p.hitch(this,function(G){this.emit("job-fail",{message:G.message+
(G.details?G.details.toString():""),jobParams:this.jobParams});A.resolve(!1)}));return A},_checkServiceNameOnly:function(x,w){var A=new a;q.id.findCredential(this.portalUrl);u({url:this.portalUrl+"/sharing/rest/portals/"+x+"/isServiceNameAvailable",content:{name:w,type:"Image Service",f:"json"}}).then(p.hitch(this,function(z){z.available?A.resolve(!0):(this.emit("job-fail",{message:this.i18n.servNameExists,type:"warning",messageCode:"AB_0002",jobParams:this.jobParams}),A.resolve(!1))}),p.hitch(this,
function(z){this.emit("job-fail",{message:z.message+(z.details?z.details.toString():""),jobParams:this.jobParams});A.resolve(!1)}));return A},_createService:function(){var x=this._submitGpJob;var w=q.id.findCredential(this.portalUrl).userId;var A=m.fromJson(this.jobParams[this.outputName]);if(w){var z=this.itemParams.folder;w=this.portalUrl+"/sharing/rest/content/users/"+w+(z&&"/"!==z?"/"+z:"")+"/createService";A={createParameters:m.toJson({currentVersion:10.2,serviceDescription:"",hasVersionedData:!1,
supportsDisconnectedEditing:!1,hasStaticData:!0,maxRecordCount:2E3,supportedQueryFormats:"JSON",capabilities:"Query",description:"",copyrightText:"",allowGeometryUpdates:!1,syncEnabled:!1,editorTrackingInfo:{enableEditorTracking:!1,enableOwnershipAccessControl:!1,allowOthersToUpdate:!0,allowOthersToDelete:!0},xssPreventionInfo:{xssPreventionEnabled:!0,xssPreventionRule:"InputOnly",xssInputRule:"rejectInvalid"},tables:[],name:A.serviceProperties.name}),outputType:"featureService",f:"json"};this._isSpatioTemporalDataStore&&
(z=m.fromJson(A.createParameters),z.options={dataSourceType:"spatiotemporal"},A.createParameters=m.toJson(z));this.jobParams.outputType&&this.jobParams.outputType===E.FLAYERVIEW&&(z=m.fromJson(A.createParameters),p.mixin(A,this._getViewCreateParams()),A.createParameters=m.toJson(z),x=this._addViewDefinition);u({url:w,content:A},{usePost:!0}).then(p.hitch(this,x),p.hitch(this,this._handleCreateServiceError))}},_createImageService:function(){var x=q.id.findCredential(this.portalUrl).userId;var w=m.fromJson(this.jobParams[this.outputName]);
if(x){var A=this.itemParams.folder;x=this.portalUrl+"/sharing/rest/content/users/"+x+(A&&"/"!==A?"/"+A:"")+"/createService";w={createParameters:m.toJson({name:w.serviceProperties.name,description:"",capabilities:w.serviceProperties.capabilities||"Image",properties:{isCached:!0,path:"@",description:"",copyright:""}}),outputType:"imageService",f:"json"};u({url:x,content:w},{usePost:!0}).then(p.hitch(this,this._submitGpJob),p.hitch(this,this._handleCreateServiceError))}},_handleCreateServiceError:function(x){this.emit("job-fail",
{message:x.message+(x.details?x.details.toString():""),jobParams:this.jobParams})},_getViewCreateParams:function(){return{isView:!0}},_addViewDefinition:function(x){var w;if(this.itemParams){this.currentGpItemId=x.itemId;var A=m.fromJson(this.jobParams[this.outputName]);A.serviceProperties&&(A.serviceProperties.serviceUrl=x.serviceurl);A.itemProperties={itemId:x.itemId};this.itemParams.folder&&(A.itemProperties.folderId=this.itemParams.folder);this.jobParams[this.outputName]=m.toJson(A)}this.getViewParams({jobParams:this.jobParams,
resultService:{url:x.serviceurl,itemId:x.itemId}}).then(p.hitch(this,function(z){w=z;var G={jobId:"ViewJob_"+(new Date).getTime(),jobStatus:"esriJobSubmitted",jobParams:this.jobParams};this._addToDefinition(x.serviceurl,w).then(p.hitch(this,function(I){var K={value:{}};this._doDeleteViewResult||(this._jobInfo.jobStatus="esriJobSucceeded",setTimeout(p.hitch(this,function(){this.itemParams.properties={jobUrl:I.serviceurl+"/jobs/"+this._jobInfo.jobId,jobType:"GPServer",jobId:this._jobInfo.jobId,jobStatus:"completed"};
this._readItem()}),300),this.doSaveJobInfo&&this.saveJobInfo(this._jobInfo),K.outputLayerName=m.fromJson(this.jobParams[this.outputName]).serviceProperties.name,K.value.itemId=this.currentGpItemId,K.analysisInfo={toolName:this.toolName,secondaryOutputs:this.secondaryOutputs,jobParams:this.jobParams},this.emit("job-result",K))}),p.hitch(this,this._gpJobFailed));this.emit("job-submit",this.jobParams);setTimeout(p.hitch(this,function(){this._jobInfo=G;this._jobInfo.jobStatus="esriJobExecuting";this._readItem();
this.emit("job-status",this._jobInfo)},0))}),p.hitch(this,this._gpJobFailed))},_addToDefinition:function(x,w){x=x.replace("/rest/services","/rest/admin/services")+"/addToDefinition";var A=q.id.findCredential(this.portalUrl);w={f:"json",addToDefinition:m.toJson(w),token:A.token};return u({url:x,content:w},{usePost:!0})},_getAdminLayerInfo:function(x){x=x.replace("/rest/services","/rest/admin/services");var w={f:"json",token:q.id.findCredential(this.portalUrl).token};return u({url:x,content:w})},_getSelf:function(x){return u({url:x+
"/sharing/rest/portals/self",content:{culture:g.locale,f:"json"},callbackParamName:"callback",timeout:0},{})},_submitGpJob:function(x){var w=m.fromJson(this.jobParams.context);this._doCancelCleanup=!1;if(this.itemParams){this.currentGpItemId=x.itemId;var A=m.fromJson(this.jobParams[this.outputName]);A.serviceProperties&&(A.serviceProperties.serviceUrl=x.serviceurl);A.itemProperties={itemId:x.itemId};this.itemParams.folder&&(A.itemProperties.folderId=this.itemParams.folder);this.jobParams[this.outputName]=
m.toJson(A)}if(this.analysisGpServer){this._toolServiceUrl&&this.gp||this.set("toolServiceUrl",this.analysisGpServer+"/"+this.toolName);this.gp.setUpdateDelay(3E3);if(this.showGeoAnalyticsParams&&this.jobParams._gaxOutName&&w.dataStore&&-1===["BDS","GDB"].indexOf(w.dataStore)){var z=this.jobParams[this.outputName]=this.jobParams._gaxOutName;delete this.jobParams._gaxOutName}this.itemParams||delete this.jobParams.resultName;this.gp.submitJob(this._cleanUpJobParamsForSubmit(),p.hitch(this,this._gpJobComplete),
p.hitch(this,this._gpJobStatus),p.hitch(this,this._gpJobFailed));this.itemParams||(this.jobParams.resultName=this.get("resultName"));z&&(this.jobParams[this.outputName]=null);this.emit("job-submit",this.jobParams)}else this._getSelf(this.portalUrl).then(p.hitch(this,function(G){this.analysisGpServer=G.helperServices.analysis&&G.helperServices.analysis.url?G.helperServices.analysis.url:null;this.set("toolServiceUrl",this.analysisGpServer+"/"+this.toolName);this.gp.setUpdateDelay(3E3);this.itemParams||
delete this.jobParams.resultName;this.gp.submitJob(this.jobParams,p.hitch(this,this._gpJobComplete),p.hitch(this,this._gpJobStatus),p.hitch(this,this._gpJobFailed));this.itemParams||(this.jobParams.resultName=this.get("resultName"));this.emit("job-submit",this.jobParams)}))},_cleanUpJobParamsForSubmit:function(){var x=p.mixin({},this.jobParams),w=["actualOutputName","aLayer","attributeExprObj","data","resultName"].concat(this.removeJobParamKeys||[]),A;for(A in x)x.hasOwnProperty(A)&&-1!==w.indexOf(A)&&
delete x[A];return x},_updateItem:function(x){var w;if(w=q.id.findCredential(this.portalUrl).userId){var A=this.itemParams.folder;w=this.portalUrl+"/sharing/rest/content/users/"+w+(A&&"/"!==A?"/"+A:"")+"/items/"+this.currentGpItemId+"/update";if(x)var z=x.item.properties;v.isDefined(z)||(z={});v.isDefined(z.jobUrl)||(z.jobUrl=this._toolServiceUrl+"/jobs/"+this._jobInfo.jobId,z.jobType="GPServer",z.jobId=this._jobInfo.jobId,z.jobStatus="processing",this.itemParams.properties=z);z=p.mixin({f:"json"},
this.itemParams);x&&z.folder===x.item.folder&&delete z.folder;x&&x.item&&z.tags===x.item.tags.toString()&&delete z.tags;x&&x.item&&z.snippet===x.item.snippet&&delete z.snippet;x&&x.item&&z.description===x.item.description&&delete z.description;z.properties&&(z.properties=m.toJson(z.properties));z.text&&(z.text=m.toJson(z.text));x=u({url:w,content:z},{usePost:!0});x.then(p.hitch(this,this._handleItemUpdate),p.hitch(this,this._handleUpdateItemError));return x}},_handleItemUpdate:function(x){this.isOutputLayerItemUpdated=
!0},_handleItemDataUpdate:function(x){},_handleUpdateItemError:function(x){this.isOutputLayerItemUpdated=!0;this.emit("job-fail",{message:x.message+(x.details?x.details.toString():""),jobParams:this.jobParams})},_handleErrorResponse:function(x){this.emit("job-fail",x)},_refreshItem:function(){var x;if(x=q.id.findCredential(this.portalUrl).userId){var w=this.itemParams.folder;x=this.portalUrl+"/sharing/rest/content/users/"+x+(w&&"/"!==w?"/"+w:"")+"/items/"+this.currentGpItemId+"/refresh";x=u({url:x,
content:{f:"json"}},{usePost:!0})}else x=new a,x.resolve();return x.promise},_handleItemRefresh:function(x){},_readItem:function(){var x;if(x=q.id.findCredential(this.portalUrl).userId){var w=this.itemParams.folder;x=this.portalUrl+"/sharing/rest/content/users/"+x+(w&&"/"!==w?"/"+w:"")+"/items/"+this.currentGpItemId;x=u({url:x,content:{f:"json"}});return x.then(p.hitch(this,this._updateItem))}},getItemInfo:function(x){if(q.id.findCredential(this.portalUrl).userId)return x=this.portalUrl+"/sharing/rest/content/items/"+
x,u({url:x,content:{f:"json"}})},_gpJobStatus:function(x){x.jobParams=this.jobParams;x.resultParameter=this.resultParameter;x.returnProcessInfo=this.jobParams.returnProcessInfo;x.getResultLyrInfos=this.getResultLyrInfos;x.currentGpItemId=this.currentGpItemId;x.itemParams=this.itemParams;"esriJobFailed"===x.jobStatus||"esriJobSucceeded"===x.jobStatus||"esriJobTimedOut"===x.jobStatus?(x.messages&&(x.message=this._buildErrorMsg(x)),this._checkTimer&&(clearInterval(this._checkTimer),this._checkTimer=
null,this._gpJobComplete(x)),"esriJobFailed"!==x.jobStatus&&"esriJobTimedOut"!==x.jobStatus||this._deleteItem(!1)):-1===["esriJobCancelling","esriJobCancelled"].indexOf(x.jobStatus)||this._doCancelCleanup||(this._handleOnCancel(x),this._doCancelCleanup=!0);this.doSaveJobInfo&&this.saveJobInfo(x);this.emit("job-status",x);this._jobInfo=x;this.itemParams&&!this.isOutputLayerItemUpdated&&this._readItem()},_updateRefreshItem:function(x){var w=[],A=x[0];w.push(this._readItem(this.doRefreshItem));d(w).then(p.hitch(this,
function(z){A.outputLayerName=m.fromJson(this.jobParams[this.outputName]).serviceProperties.name;A.value.itemId=this.currentGpItemId;A.analysisInfo={toolName:this.toolName,secondaryOutputs:this.secondaryOutputs,jobParams:this.jobParams};this.doRefreshItem?this._refreshItem().always(p.hitch(this,function(){this.emit("job-result",A)})):this.emit("job-result",A)}),p.hitch(this,this._handleDeleteItemError))},_gpJobComplete:function(x){var w;"esriJobSucceeded"===x.jobStatus&&(x.jobParams=this.jobParams,
this.emit("job-success",x),d(this._getGpResultData(x)).then(p.hitch(this,function(A){A=r.filter(A,function(z){var G=!0;v.isDefined(z.value.empty)?G=z.value.empty:v.isDefined(z.value.url)||v.isDefined(z.value.itemId)?G=!1:v.isDefined(z.value.featureSet)?G=!1:this.jobParams.outputType===E.BDFSTEMPLATE&&(G=!1);if(!G)return z},this);0===A.length?(this.currentGpItemId&&this._deleteItem(!1),this.showGeoAnalyticsParams&&x.messages&&(x.message=this._buildErrorMsg(x)),this.emit("job-fail",{message:this.showGeoAnalyticsParams?
x.message:this.i18n.emptyResultInfoMsg,type:"warning",jobParams:this.jobParams})):(v.isDefined(this.itemParams)&&this.itemParams.properties&&this.itemParams.properties.jobStatus&&"processing"===this.itemParams.properties.jobStatus&&(this.itemParams.properties.jobStatus="completed"),r.forEach(A,function(z){if(z.value.featureSet&&!z.value.url)z.value.featureSet.spatialReference=z.value.layerDefinition.spatialReference;else if(z.value.url&&-1!==z.value.url.indexOf("/FeatureServer/")&&z.value.layerInfo&&
z.value.layerInfo.popupInfo){var G=z.value.url.match(/[0-9]+$/g)[0];this._popupInfo[G]=z.value.layerInfo.popupInfo}},this),w=A[0],w.results=A,this.jobParams.returnProcessInfo?this.gp.getResultData(x.jobId,"processInfo").then(p.hitch(this,function(z){var G=[];r.forEach(z.value,function(I){G.push(m.fromJson(I))},this);this.currentGpItemId?(this.itemParams.description=D.buildReport(G),this._updateRefreshItem(A)):(w.analysisReport=D.buildReport(G),w.outputLayerName=this.jobParams.resultName,this.emit("job-result",
w))})):this.currentGpItemId?this._updateRefreshItem(A):(w.outputLayerName=this.jobParams.resultName,this.emit("job-result",w)))})))},_gpJobFailed:function(x){var w=p.clone(x);w.jobParams=this.jobParams;this._checkTimer&&(clearInterval(this._checkTimer),this._checkTimer=null);x.messages&&(x.message=this._buildErrorMsg(x));this.emit("job-fail",w)},_getGpResultData:function(x){var w=[],A=[];"string"===typeof this.resultParameter?A.push(this.resultParameter):this.resultParameter instanceof Array&&(A=
this.resultParameter,this.secondaryOutputs&&this.secondaryOutputNames&&(A=r.filter(A,function(z){z=this.secondaryOutputs.indexOf(z);return-1===z?!0:x.jobParams.hasOwnProperty(this.secondaryOutputNames[z])},this)));r.forEach(A,function(z,G){w.push(this.gp.getResultData(x.jobId,z))},this);return w},_handleOnCancel:function(x){this.itemParams?this._deleteItem(!0,x):this.emit("job-cancel",x)},cancel:function(x){this.jobParams.outputType&&this.jobParams.outputType===E.FLAYERVIEW?(this._doDeleteViewResult=
!0,this._deleteItem(!0)):this.gp.cancelJob(x.jobId).then(p.hitch(this,function(w){"esriJobCancelled"===w.jobStatus&&this._handleOnCancel(w)}),function(w){})},checkJobStatus:function(x){this.signInPromise.then(p.hitch(this,function(){this.gp.setUpdateDelay(3E3);this._checkTimer=setInterval(p.hitch(this,this._checkStatus,x,p.hitch(this,this._gpJobStatus),p.hitch(this,this._gpJobFailed)),3E3)}))},_checkStatus:function(x,w,A){this.gp.checkJobStatus(x,w,A)},_deleteItem:function(x,w){var A;if((A=q.id.findCredential(this.portalUrl).userId)&&
this.itemParams){var z=v.isDefined(this.itemParams.folder)?this.itemParams.folder:"";A=this.portalUrl+"/sharing/rest/content/users/"+A+(z&&"/"!==z?"/"+z:"")+"/items/"+this.currentGpItemId+"/delete";u({url:A,content:{f:"json"}},{usePost:!0}).then(p.hitch(this,this._handleItemDelete,x,w),p.hitch(this,this._handleDeleteItemError))}},_handleItemDelete:function(x,w,A){x&&this.emit("job-cancel",w)},_handleDeleteItemError:function(x){this.emit("job-fail",{message:x.message+(x.details?x.details.toString():
""),jobParams:this.jobParams})},_initFolderStore:function(x,w){this._fportal=this.portalSelf?new x.Portal({url:this.portalUrl,self:this.portalSelf}):new x.Portal(this.portalUrl);this._fportal.signIn().then(p.hitch(this,function(A){this.portalUser=A;this.portalUser.getFolders().then(p.hitch(this,function(z){z=D.createFolderStore(z,this.portalUser.username);w.resolve(z)}))}))},getFolderStore:function(){var x=new a,w,A,z,G;this.folderStore?x.resolve(this.folderStore):this.signInPromise.then(p.hitch(this,
function(I){w=["../../arcgis/Portal"];A=this._counter++;z=this;this._rids&&this._rids.push(A);H(w,function(K){G=z._rids?r.indexOf(z._rids,A):-1;-1!==G&&(z._rids.splice(G,1),z._initFolderStore(K,x))})}));return x},_checkToolUrl:function(){var x=new a;this.analysisGpServer?(this._toolServiceUrl&&this.gp||this.set("toolServiceUrl",this.analysisGpServer+"/"+this.toolName),x.resolve({success:!0})):this._getSelf(this.portalUrl).then(p.hitch(this,function(w){(this.analysisGpServer=w.helperServices.analysis&&
w.helperServices.analysis.url?w.helperServices.analysis.url:null)&&this.set("toolServiceUrl",this.analysisGpServer+"/"+this.toolName);x.resolve({success:!0})}));return x},getCreditsEstimate:function(x,w,A){this.start=window.performance.now();var z,G,I,K,R,U={};var ba=new a;this._checkToolUrl().then(p.hitch(this,function(ca){this._toolServiceUrl?K=this._toolServiceUrl:(I=this.portalUrl&&-1!==this.portalUrl.indexOf("dev")?"dev":this.portalUrl&&-1!==this.portalUrl.indexOf("qa")?"qa":"",K="http://analysis"+
I+".arcgis.com/arcgis/rest/services/tasks/GPServer/"+this.toolName);this.useGPCreditTask?(R=this.portalSelf||this._portal,A?(z=R&&R.helperServices&&R.helperServices.rasterAnalytics.url?R.helperServices.rasterAnalytics.url+"/EstimateRasterAnalysisCost":K.replace("/tasks/GPServer/"+x,"/RasterAnalysisTools/GPServer/EstimateRasterAnalysisCost"),U.name=x,U.parameters=w,ca=w.context,ca.cellSize=this.context.cellSize,!ca.extent&&this.context.extent&&(ca.extent=this.context.extent),ca={jobParams:{inputAnalysisTask:m.toJson(U),
context:m.toJson(ca)},resultParameter:"outCost",def:ba,isGPCreditSync:!1}):(z=R&&R.helperServices&&R.helperServices.creditEstimation&&R.helperServices.creditEstimation.url?R.helperServices.creditEstimation.url+"/EstimateCredits":K.replace("/tasks/GPServer/"+x,"/Estimate/GPServer/EstimateCredits"),ca={jobParams:{taskName:x,taskParameters:m.toJson(w)},resultParameter:"creditEstimate",def:ba,isGPCreditSync:this._isGPCreditSync}),this._getGPCreditEstimate(z,ca)):(z=K.replace("/"+x,"/exts/Estimate/"+x),
G=p.mixin({f:"json"},w),u({url:z,content:G},{usePost:!0}).then(p.hitch(this,function(da){this.end=window.performance.now();console.log("Analysis Credit Estimator SOE Sync Time : "+(this.end-this.start)+" milliseconds");ba.resolve(da)}),function(da){ba.resolve(da)}))}));return ba.promise},_getGPCreditEstimate:function(x,w){this.creditGP=new t(x);this.creditGP.setUpdateDelay(1E3);w.isGPCreditSync?this.creditGP.execute(w.jobParams,p.hitch(this,this._getGPCreditResult,w.def,w.resultParameter,w.isGPCreditSync),
p.hitch(this,this._creditGPJobFailed,w.def,w.isGPCreditSync)):this.creditGP.submitJob(w.jobParams,p.hitch(this,this._getGPCreditResult,w.def,w.resultParameter,w.isGPCreditSync),p.hitch(this,this._creditGPJobFailed,w.def,w.isGPCreditSync),p.hitch(this,this._creditGPJobFailed,w.def,w.isGPCreditSync))},_getGPCreditResult:function(x,w,A,z){A?(this.end=window.performance.now(),console.log("Analysis Credit Estimator GP Sync Time : "+(this.end-this.start)+" milliseconds"),x.resolve(z[0].value)):this.creditGP.getResultData(z.jobId,
w).then(p.hitch(this,function(G,I){I&&I.value&&0<=I.value.credits&&(I.value.cost=I.value.credits);this.end=window.performance.now();console.log("Analysis Credit Estimator GP Async Time : "+(this.end-this.start)+" milliseconds");G.resolve(I.value)},x),p.hitch(this,function(G,I){G.resolve(I)},x))},_creditGPJobFailed:function(x,w,A){w?!A.code||400!==A.code&&-1===A.code.indexOf("IdentityManagerBase.")?0===A.status&&A.message&&(A.messages=[A.message],x.resolve(this._buildErrorMsg(A))):(A.messages=A.details,
x.resolve(A)):"esriJobFailed"!==A.jobStatus&&"esriJobCancelled"!==A.jobStatus||x.resolve(this._buildErrorMsg(A))},_signIn:function(x,w){var A,z;this.signInPromise=new a;if(w){w=["../../arcgis/Portal"];var G=this._counter++;var I=this;this._rids&&this._rids.push(G);H(w,p.hitch(this,function(K){A=I._rids?r.indexOf(I._rids,G):-1;-1!==A&&(I._rids.splice(A,1),this._portal=this.portalSelf?new K.Portal({url:x,self:this.portalSelf}):new K.Portal(x),this._portal.signIn().then(p.hitch(this,function(R){this.portalUser=
R;this._portal.helperServices&&this._portal.helperServices.analysis&&this._portal.helperServices.analysis.url?(this.analysisGpServer=this._portal.helperServices.analysis.url,this.showGeoAnalyticsParams&&this._portal.helperServices.geoanalytics&&(this.analysisGpServer=this._portal.helperServices.geoanalytics.url),u({url:this.analysisGpServer,content:{f:"json"},callbackParamName:"callback"}).then(p.hitch(this,function(U){z=q.id.findCredential(this.analysisGpServer);this.signInPromise.resolve(z)}),p.hitch(this,
function(U){this.signInPromise.reject(U)}))):this.signInPromise.resolve(R)}),p.hitch(this,this._handleSignInError)))}))}else u({url:x,content:{f:"json"},callbackParamName:"callback"}).then(p.hitch(this,function(K){K=q.id.findCredential(x);if(v.isDefined(K)){var R=q.id.findServerInfo(this._toolServiceUrl);v.isDefined(R)&&v.isDefined(R.owningSystemUrl)&&(this.portalUrl=R.owningSystemUrl);this.signInPromise.resolve(K)}else q.id.getCredential(x).then(p.hitch(this,function(U){U=q.id.findCredential(x);
R=q.id.findServerInfo(this._toolServiceUrl);v.isDefined(R)&&v.isDefined(R.owningSystemUrl)&&(this.portalUrl=R.owningSystemUrl);this.signInPromise.resolve(U)}),p.hitch(this,this._handleSignInError))}),p.hitch(this,this._handleSignInError));return this.signInPromise},_handleSignInError:function(x){this.emit("job-fail",{message:this.i18n.analysisSignInErrorMsg,messageCode:"AB_0003"});this.signInPromise.reject(x)},_buildErrorMsg:function(x){var w="",A=[],z,G;this.errorHelpMap||this._initErrorHelpMap();
A=r.filter(x.messages,function(I){if(("esriJobMessageTypeError"===I.type||"esriJobMessageTypeWarning"===I.type)&&-1!==I.description.indexOf("messageCode"))return I.description},this);0<A.length&&r.forEach(A,function(I){try{z=m.fromJson(I.description)}catch(K){z=I.description}G="";"esriJobMessageTypeWarning"===I.type&&(x.type="warning");z.messageCode?(G=v.isDefined(this.i18n[z.messageCode])?this.i18n[z.messageCode]:z.message,G=v.isDefined(z.params)?h.substitute(G,z.params):G,w+=G+"\x26nbsp;",(I=this._addLearnMoreErrorLink(z.messageCode))&&
(w+=I)):z.error&&z.error.messageCode?(G=v.isDefined(this.i18n[z.error.messageCode])?this.i18n[z.error.messageCode]:z.error.message,G=v.isDefined(z.error.params)?h.substitute(G,z.error.params):G,w+=G+"\x26nbsp;",(I=this._addLearnMoreErrorLink(z.error.messageCode))&&(w+=I)):w+=z+"\x26nbsp;"},this);return w},_toolServiceUrlSetter:function(x){this._toolServiceUrl=x;this.gp=new t(x)},_setToolServiceUrlAttr:function(x){this._toolServiceUrl=x;this.gp=new t(x)},checkCreditLimitsAttr:function(x){this.checkCreditLimits=
x},saveJobInfo:function(x){if(this.doSaveJobInfo&&this.currentGpItemId&&-1!==r.indexOf(["esriJobSucceeded"],x.jobStatus)){p.mixin(x.jobParams,{extentCheck:this._useExtentCheck&&this._useExtentCheck.get("checked")});r.forEach(x.messages,function(z){z.description=D.safetagsReplace(z.description)},this);x={toolName:this.toolName,jobParams:x.jobParams,timestamp:Date.now(),portalUrl:this.portalUrl,jobInfo:{jobId:x.jobId,jobStatus:x.jobStatus,messages:x.messages,analysisServer:"bigdata"===this.analysisMode?
"geoanalytics":"default"===this.analysisMode?"standard":this.analysisMode}};"CopyToDataStore"===this.toolName&&(x.jobParams.isSpatioTemporalDataStore=this._isSpatioTemporalDataStore);"bigdata"===this.analysisMode&&x.jobParams.timeStepReference&&(x.jobParams.timeReferenceType=this.get("timeReferenceType"));"bigdata"===this.analysisMode&&x.jobParams.timeBoundaryReference&&(x.jobParams.timeBoundaryReferenceType=this.get("timeBoundaryReferenceType"));for(A in x.jobParams)if(x.jobParams.hasOwnProperty(A)&&
v.isDefined(x.jobParams[A])){if("object"===typeof x.jobParams[A]&&x.jobParams[A].serviceToken||"string"===typeof x.jobParams[A]&&-1!==x.jobParams[A].indexOf("serviceToken")){var w="string"===typeof x.jobParams[A]?m.fromJson(x.jobParams[A]):x.jobParams[A];w&&w.serviceToken&&(delete w.serviceToken,x.jobParams[A]="string"===typeof x.jobParams[A]?m.toJson(w):w)}if("object"===typeof x.jobParams[A]&&!p.isArray(x.jobParams[A])&&x.jobParams[A].filter||"string"===typeof x.jobParams[A]&&-1!==x.jobParams[A].search(/[<>]/g))"object"===
typeof x.jobParams[A]&&x.jobParams[A].filter&&!p.isArray(x.jobParams[A])?x.jobParams[A].filter=D.safetagsReplace(x.jobParams[A].filter):"string"===typeof x.jobParams[A]&&-1!==x.jobParams[A].search(/[<>]/g)&&(x.jobParams[A]=D.safetagsReplace(x.jobParams[A]))}var A=q.id.findCredential(this.portalUrl);this.currentGpItemId&&(A={id:this.currentGpItemId,folderId:this.itemParams.folder,owner:A.userId},B.addToItemResource(A,x));this.doSaveInStorage&&B.addToStorage(x)}},_initErrorHelpMap:function(){if(this.isSingleTenant){var x=
H.toUrl("./help/errorhelpmap_enterprise.json");u({url:x}).then(p.hitch(this,function(w){this.errorHelpMap=w.map}))}},_addLearnMoreErrorLink:function(x){if(this.isSingleTenant){var w=this.portalSelf&&this.portalSelf.helpMap&&this.portalSelf.helpMap.m;x=w&&w[this.errorHelpMap[x]];w=this&&this.portalSelf?this.portalSelf.helpBase:null;var A=this.analysisGpServer&&-1!==this.analysisGpServer.indexOf("dev")?"dev":this.analysisGpServer&&-1!==this.analysisGpServer.indexOf("qa")?"uat":"";if(v.isDefined(x)){var z=
"http://doc"+A+".arcgis.com/en/arcgis-online/analyze/"+x;this.isSingleTenant&&w?z=w+x:this.isSingleTenant&&!w&&(z="http://server"+A+".arcgis.com/en/portal/latest/use/"+x)}z&&(z="\x3cbr/\x3e\x3cbr/\x3e\x3cdiv class\x3d'esriHelpPopup'\x3e\x3ca class\x3d'action zoomTo' href\x3d'"+z+"' target\x3d'_help'\x3e"+this.i18n.learnMore+"\x3c/a\x3e\x3c/div\x3e\x3cbr/\x3e\x3cbr/\x3e");return z}},getLearnMoreLink:function(x){return x?this._addLearnMoreErrorLink(x):""},_byPassCreditCheck:function(x){return-1!==this._freeGPTools.indexOf(x)}});
l("extend-esri")&&p.setObject("dijit.analysis.AnalysisBase",k,q);return k})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),function(H,
k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E){H=H(h,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(x){this._jobUpdateHandler=k.hitch(this,this._jobUpdateHandler);this._getJobStatus=k.hitch(this,this._getJobStatus);this._getResultDataHandler=
k.hitch(this,this._getResultDataHandler);this._getResultImageHandler=k.hitch(this,this._getResultImageHandler);this._executeHandler=k.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(x){this.updateDelay=x},setProcessSpatialReference:function(x){this.processSpatialReference=x},setOutputSpatialReference:function(x){this._setOutSR(x)},setOutSpatialReference:function(x){this._setOutSR(x)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(x){this.outSpatialReference=this.outputSpatialReference=x},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(x,w,A){for(var z in x){var G=x[z];k.isArray(G)?x[z]=m.toJson(p.map(G,function(I){return this._gpEncode({item:I},!0).item},this)):G instanceof Date&&(x[z]=G.getTime())}return this._encode(x,w,A)},_decode:function(x){var w=x.dataType,
A=new y(x);if(-1!==p.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],w))return A;if("GPLinearUnit"===w)A.value=new q(A.value);else if("GPFeatureRecordSetLayer"===w||"GPRecordSet"===w)A.value=new c(A.value);else if("GPDataFile"===w)A.value=new v(A.value);else if("GPDate"===w)x=A.value,k.isString(x)?A.value=new t({date:x}):A.value=new Date(x);else if("GPRasterData"===w||"GPRasterDataLayer"===w)x=x.value.mapImage,A.value=x?new E(x):new u(A.value);else if(-1!==w.indexOf("GPMultiValue:")){var z=w.split(":")[1];
x=A.value;A.value=p.map(x,function(G){return this._decode({paramName:"_name",dataType:z,value:G}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+A.dataType),A=null;return A},submitJob:function(x,w,A,z,G){var I=this._getOutSR(),K=G.assembly;x=this._gpEncode(k.mixin({},this._url.query,{f:"json","env:outSR":I?I.wkid||m.toJson(I.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||m.toJson(this.processSpatialReference.toJson()):
null},x),null,K&&K[0]);var R=this._jobUpdateHandler,U=this._errorHandler;return d({url:this._url.path+"/submitJob",content:x,callbackParamName:"callback",load:function(ba,ca){R(ba,ca,!1,w,A,G.dfd)},error:function(ba){U(ba,z,G.dfd)}})},_jobUpdateHandler:function(x,w,A,z,G,I){var K=x.jobId;w=new g(x);this._successHandler([w],"onStatusUpdate",G,A&&I);if(!A)switch(clearTimeout(this._updateTimers[K]),this._updateTimers[K]=null,I&&I.progress(w),x.jobStatus){case g.STATUS_SUBMITTED:case g.STATUS_EXECUTING:case g.STATUS_WAITING:case g.STATUS_NEW:var R=
this._getJobStatus;this._updateTimers[K]=setTimeout(function(){R(K,A,z,G,I)},this.updateDelay);break;default:this._successHandler([w],"onJobComplete",z,I)}},_getJobStatus:function(x,w,A,z,G){var I=this._jobUpdateHandler;d({url:this._url.path+"/jobs/"+x,content:k.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(K,R){I(K,R,w,A,z,G)},error:this._errorHandler})},_getResultDataHandler:function(x,w,A,z,G){try{var I=this._decode(x);this._successHandler([I],"onGetResultDataComplete",
A,G)}catch(K){this._errorHandler(K,z,G)}},getResultData:function(x,w,A,z){var G=this._getResultDataHandler,I=this._errorHandler,K=new r(f._dfdCanceller);K._pendingDfd=d({url:this._url.path+"/jobs/"+x+"/results/"+w,content:k.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(R,U){G(R,U,A,z,K)},error:function(R){I(R,z,K)}});return K},checkJobStatus:function(x,w,A){var z=this._jobUpdateHandler,G=this._errorHandler,I=new r(f._dfdCanceller);I._pendingDfd=
d({url:this._url.path+"/jobs/"+x,content:k.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(K,R){z(K,R,!0,null,w,I)},error:function(K){G(K,A,I)}});return I},cancelJob:function(x,w,A){var z=this._errorHandler,G=new r(f._dfdCanceller);G._pendingDfd=d({url:this._url.path+"/jobs/"+x+"/cancel",content:k.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:k.hitch(this,function(I,K){this._successHandler([I],"onJobCancel",w,G)}),error:function(I){z(I,A,G)}});
return G},execute:function(x,w,A,z){var G=this._getOutSR(),I=z.assembly;x=this._gpEncode(k.mixin({},this._url.query,{f:"json","env:outSR":G?G.wkid||m.toJson(G.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||m.toJson(this.processSpatialReference.toJson()):null},x),null,I&&I[0]);var K=this._executeHandler,R=this._errorHandler;return d({url:this._url.path+"/execute",content:x,callbackParamName:"callback",load:function(U,ba){K(U,ba,w,A,z.dfd)},error:function(U){R(U,
A,z.dfd)}})},_executeHandler:function(x,w,A,z,G){try{var I=x.results,K,R=x.messages;var U=0;for(K=I.length;U<K;U++)I[U]=this._decode(I[U]);U=0;for(K=R.length;U<K;U++)R[U]=new n(R[U]);this._successHandler([I,R],"onExecuteComplete",A,G)}catch(ba){this._errorHandler(ba,z,G)}},_getResultImageHandler:function(x,w,A,z,G){try{var I=this._decode(x);this._successHandler([I],"onGetResultImageComplete",A,G)}catch(K){this._errorHandler(K,z,G)}},getResultImage:function(x,w,A,z,G){var I=this._getResultImageHandler,
K=this._errorHandler;A=this._gpEncode(k.mixin({},this._url.query,{f:"json"},A.toJson()));var R=new r(f._dfdCanceller);R._pendingDfd=d({url:this._url.path+"/jobs/"+x+"/results/"+w,content:A,callbackParamName:"callback",load:function(U,ba){I(U,ba,z,G,R)},error:function(U){K(U,G,R)}});return R},cancelJobStatusUpdates:function(x){clearTimeout(this._updateTimers[x]);this._updateTimers[x]=null},getResultImageLayer:function(x,w,A,z){if(null==w){var G=this._url.path.indexOf("/GPServer/");x=this._url.path.substring(0,
G)+"/MapServer/jobs/"+x}else x=this._url.path+"/jobs/"+x+"/results/"+w;this._url.query&&(x+="?"+b.objectToQuery(this._url.query));w=null==w?new B(x,{imageParameters:A}):new D(x,{imageParameters:A},!0);this.onGetResultImageLayerComplete(w);z&&z(w);return w},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});e._createWrappers(H);
l("extend-esri")&&k.setObject("tasks.Geoprocessor",H,a);return H})},"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(H,k,p,r,m){H=H(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(l){this.messages=[];k.mixin(this,l);l=this.messages;var b,a=l.length;for(b=0;b<a;b++)l[b]=new m(l[b])},jobId:"",jobStatus:""});k.mixin(H,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",
STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});p("extend-esri")&&k.setObject("tasks.JobInfo",H,r);return H})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(H,k,p,r){H=H(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(m){k.mixin(this,
m)}});k.mixin(H,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});p("extend-esri")&&k.setObject("tasks.GPMessage",H,r);return H})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(H,k,p,r){H=H(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(m){m&&k.mixin(this,m)},distance:0,units:null,toJson:function(){var m={};this.distance&&(m.distance=this.distance);this.units&&(m.units=this.units);return m}});p("extend-esri")&&k.setObject("tasks.LinearUnit",H,r);return H})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(H,k,p,r){H=H(null,{declaredClass:"esri.tasks.DataFile",
constructor:function(m){m&&k.mixin(this,m)},url:null,itemID:null,toJson:function(){var m={};this.url&&(m.url=this.url);this.itemID&&(m.itemID=this.itemID);return m}});p("extend-esri")&&k.setObject("tasks.DataFile",H,r);return H})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(H,k,p,r){H=H(null,{declaredClass:"esri.tasks.RasterData",constructor:function(m){m&&k.mixin(this,m)},url:null,format:null,itemID:null,toJson:function(){var m=
{};this.url&&(m.url=this.url);this.format&&(m.format=this.format);this.itemID&&(m.itemID=this.itemID);return m}});p("extend-esri")&&k.setObject("tasks.RasterData",H,r);return H})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(H,k,p,r,m){H=H(null,{declaredClass:"esri.tasks.Date",constructor:function(l){l&&(l.format&&(this.format=l.format),this.date=p.parse(l.date,{selector:"date",datePattern:this.format}))},date:new Date,
format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:p.format(this.date,{selector:"date",datePattern:this.format}),format:this.format}}});r("extend-esri")&&k.setObject("tasks.Date",H,m);return H})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(H,k,p,r){H=H(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(m){k.mixin(this,m)}});p("extend-esri")&&k.setObject("tasks.ParameterValue",H,r);return H})},
"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(H,k,p,r,m,l,b){H=H(b,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(a,d){d&&d.imageParameters&&d.imageParameters.extent&&(this.initialExtent=this.fullExtent=d.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=k.hitch(this,this.getImageUrl);
this.loaded=!0;this.onLoad(this)},getImageUrl:function(a,d,f,e){var h=a.spatialReference.wkid;e(this._url.path+"?"+m.objectToQuery(k.mixin(this._params,{f:"image",bbox:p.toJson(a.toJson()),bboxSR:h,imageSR:h,size:d+","+f})))}});r("extend-esri")&&k.setObject("tasks._GPResultImageLayer",H,l);return H})},"esri/dijit/analysis/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/event dojo/_base/fx dojo/_base/json dojo/_base/kernel dojo/dom-attr dojo/has dojo/i18n dojo/io-query dojo/i18n!../../nls/jsapi dojo/json dojo/string dojo/query dojo/date/locale dojo/dom-style dojo/dom-class dojo/dom-construct dojo/Deferred dojo/promise/all dojo/fx/easing dojo/number dojo/_base/window dojo/when dojo/dom dojo/on dojo/data/ItemFileWriteStore dojo/topic dojo/store/Memory dojox/mvc/equals dijit/registry dijit/Dialog dijit/form/CheckBox ../../kernel ../../lang ../../units ../../request ./HelpWindow ../../tasks/query ../../dijit/BrowseItems ../../layers/FeatureLayer ./PluginAnalysisLayers ../../tasks/Geoprocessor ../../dijit/SingleFilter ./FeatureRecordSetLayer ./PluginLayers ./PCSList ./ItemTypes ../../layers/ArcGISImageServiceLayer ../../layers/RasterXLayer ../../layers/RasterFunction ./AnalysisRegistry ../RasterFunctionEditor/utils".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x,w,A,z,G,I,K,R,U,ba,ca,da,ja,ea,L,O,S,T,J,N,C,P,Q,Y,fa,na,la,W,aa,oa,ha,pa){H={};k.mixin(H,{_helpDialog:null,systemRFTGroupName:"Raster Function Templates",i18n:null,UNITSMAP:{Feet:"esriFeet",Yards:"esriYards",Miles:"esriMiles",Meters:"esriMeters",Kilometers:"esriKilometers",NauticalMiles:"esriNauticalMiles"},initHelpLinks:function(F,M,Z){if(F){var X=ba.byNode(F),ka=X?X.get("helpFileName"):Z&&Z.helpFileName?Z.helpFileName:null,V=X?X.get("isSingleTenant"):
Z&&Z.isSingleTenant?Z.isSingleTenant:!1,ia=ha.Modes.standard,ma=X&&X.portalSelf?X.portalSelf.helpBase:Z&&Z.helpBase?Z.helpBase:null,ra=X&&X.portalSelf;this._helpDialog||(this._helpDialog=new S({isPortal:V,portalSelf:ra}));X&&(X.showGeoAnalyticsParams||X.showBigData)||Z&&Z.analysisMode&&Z.analysisMode===ha.Modes.Bigdata?(ka+="_bd",ia=ha.Modes.Bigdata):Z&&Z.analysisMode&&"raster"===Z.analysisMode&&(ka+="_ra",ia=ha.Modes.Raster);q("[esriHelpTopic]",F).forEach(function(sa,Ba,wa){sa&&(u.set(sa,"display",
ea.isDefined(M)&&!0!==M?"none":""),ea.isDefined(sa._helpClickHandler)&&(sa._helpClickHandler.remove(),sa._helpClickHandler=null),sa._helpClickHandler=G(sa,"click",k.hitch(this,function(ta){m.stop(ta);Z&&Z.showHelpFromUrl&&Z.helpUrl?this._helpDialog.show(ta,{showHelpFromUrl:Z.showHelpFromUrl,helpUrl:Z.helpUrl}):this._helpDialog.show(ta,{helpId:d.get(sa,"esriHelpTopic"),helpFileName:ka,analysisGpServer:Z&&Z.analysisGpServer?Z.analysisGpServer:null,helpParentNode:F,isPortal:V,analysisMode:ia,helpBase:ma,
portalSelf:X&&X.portalSelf})})))},this)}},constructAnalysisFeatColl:function(F){var M={},Z;M.featureCollection=F.layerDefinition;for(Z in M.featureCollection)M.featureCollection.hasOwnProperty(Z)&&"objectIdField"===Z&&(M.featureCollection.objectIdFieldName=k.clone(M.featureCollection.objectIdField),delete M.featureCollection.objectIdField);M.featureCollection.features=F.featureSet.features;return M},constructAnalysisInputLyrObj:function(F,M,Z){if(F instanceof W||"Image Service"===F.type||"esri.layers.RasterXLayer"===
F.declaredClass)return pa.getRasterJsonFromLayer(F);var X={},ka="";ea.isDefined(Z)||(Z=!0);if(F.getMap)var V=F.getMap();else F._map&&(V=F._map);if(F.url&&!F._collection)X={url:F.url},this.isHostedService(F.url),F.getDefinitionExpression&&F.getDefinitionExpression()?X.filter=F.getDefinitionExpression():ea.isDefined(F.definitionExpression)&&""!==F.definitionExpression&&(X.filter=F.definitionExpression),F.useMapTime&&F.timeInfo&&V&&V.timeExtent&&Z&&(V.timeExtent.startTime?(ka+=V.timeExtent.startTime.getTime(),
V.timeExtent.endTime&&(ka+=","+V.timeExtent.endTime.getTime())):V.timeExtent.endTime&&(ka+=V.timeExtent.endTime.getTime()),ka&&(X.time=ka)),F.credential&&(X.serviceToken=F.credential.token),-1!==X.url.indexOf("?")&&(Z=X.url.substring(X.url.indexOf("?")+1,X.url.length),Z=h.queryToObject(Z),k.mixin(X,Z),X.url=X.url.substring(0,X.url.indexOf("?")));else if(!F.url||F._collection)try{X=F.toJson()}catch(ia){F._json=g.parse(F._json),X=F.toJson()}X.name=F.name;M&&(X=new Y(X));return X},formatDate:function(F){return v.format(F,
{datePattern:"yyyy-MM-dd",selector:"date"})+" "+v.format(F,{selector:"time",timePattern:"HH:mm:ss"})},isHostedService:function(F){if(!F)return!1;var M=-1!==F.indexOf(".arcgis.com/");F=-1!==F.indexOf("/services")||-1!==F.indexOf("//tiles")||-1!==F.indexOf("//features");return M&&F},isPortalHostedService:function(F){return F?-1!==F.toLowerCase().indexOf("/hosted/"):!1},isTimeEnabled:function(F){var M=10.2<=F.version&&F._useStandardizedQueries;return F.useMapTime&&F.timeInfo&&(M||10.2<=F.version)||ea.isDefined(F.time)},
isTimeInstantLayer:function(F){return ea.isDefined(F.timeInfo)&&ea.isDefined(F.timeInfo.startTimeField)&&!ea.isDefined(F.timeInfo.endTimeField)||ea.isDefined(F.time)&&ea.isDefined(F.time.timeType)&&"instant"===F.time.timeType},buildReport:function(F,M){var Z="";M||(M={},k.mixin(M,c.analysisMsgCodes));p.forEach(F,function(X,ka){if("string"===typeof X.message){var V=ea.isDefined(M[X.messageCode])?M[X.messageCode]:X.message;Z+=X.style.substring(0,X.style.indexOf("\x3c/"))+(this._isEmptyObject(X.params)?
V:n.substitute(V,X.params))+X.style.substring(X.style.indexOf("\x3c/"))}else if(k.isArray(X.message)){var ia=[];var ma=k.clone(X.style);p.forEach(X.message,function(ra,sa){ma=ma.replace(/<\//,"${"+sa+"}");V=ea.isDefined(M[X.messageCode+"_"+sa])?M[X.messageCode+"_"+sa]:ra;V=this._isEmptyObject(X.params)?V:n.substitute(V,X.params);"string"===typeof V&&(V=this.safetagsReplace(V));ia.push(V+"\x3c/")},this);ma=n.substitute(ma,ia);Z+=ma}},this);return Z},getLayerFeatureCount:function(F,M){var Z=new T,X=
new D;M||(M={});Z.geometry=M.geometry;Z.geometryType=M.geometryType||"esriGeometryEnvelope";F.url||Z.geometry?(F.url&&(Z.where=M.where||"1\x3d1",F.getDefinitionExpression&&F.getDefinitionExpression()&&!M.where?Z.where=F.getDefinitionExpression():ea.isDefined(F.definitionExpression)&&""!==F.definitionExpression&&!M.where&&(Z.where=F.definitionExpression)),X=F.queryCount(Z)):X.resolve(F.graphics.length);return X.promise},createPolygonFeatureCollection:function(F){var M={layerDefinition:null,featureSet:{features:[],
geometryType:ha.GeometryTypes.Polygon}};M.layerDefinition={currentVersion:10.2,copyrightText:"",defaultVisibility:!0,relationships:[],isDataVersioned:!1,supportsRollbackOnFailureParameter:!0,supportsStatistics:!0,supportsAdvancedQueries:!0,geometryType:ha.GeometryTypes.Polygon,minScale:0,maxScale:0,objectIdField:"OBJECTID",templates:[],type:"Feature Layer",displayField:"TITLE",visibilityField:"VISIBLE",name:F,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",allowGeometryUpdates:!0,htmlPopupType:"",
hasM:!1,hasZ:!1,globalIdField:"",supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:-1,indexes:[],types:[],drawingInfo:{renderer:{type:"simple",symbol:{color:[0,0,0,255],outline:{color:[0,0,0,255],width:3,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSNull"},label:"",description:""},transparency:0,labelingInfo:null,fixedSymbols:!0},fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",
editable:!0},{alias:"Visible",name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return M},createPointFeatureCollection:function(F){var M={layerDefinition:null,featureSet:{features:[],geometryType:ha.GeometryTypes.Point}};M.layerDefinition={objectIdField:"OBJECTID",templates:[],type:"Feature Layer",drawingInfo:{renderer:{field1:"TYPEID",
type:"simple",symbol:{height:24,xoffset:0,yoffset:12,width:24,contentType:"image/png",type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/GreenStickpin.png"},description:"",value:"0",label:"Stickpin"}},displayField:"TITLE",visibilityField:"VISIBLE",name:F,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",types:[],geometryType:ha.GeometryTypes.Point,fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",
editable:!0},{alias:"Visible",name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return M},createFolderStore:function(F,M){var Z=new I({data:{identifier:"id",label:"name",items:[]}});Z.newItem({name:M,id:""});p.forEach(F,function(X){Z.newItem({name:X.title,id:X.id})});return Z},setupFoldersUI:function(F){F.folderSelect.set("store",
F.folderStore);F.folderSelect.set("required",!0);F.folderSelect.set("searchAttr","name");ea.isDefined(F.folderId)?F.folderStore.get(F.folderId).then(k.hitch(this,function(M){ea.isDefined(M)?F.folderSelect.set("item",M):F.folderStore.get("").then(function(Z){F.folderSelect.set("item",Z)},this)})):F.folderName?F.folderStore.fetch({query:{name:F.folderName},onComplete:k.hitch(this,function(M){ea.isDefined(M)&&0<M.length?F.folderSelect.set("item",M[0]):F.folderStore.get("").then(function(Z){F.folderSelect.set("item",
Z)},this)})}):F.username?F.folderSelect.set("displayedValue",F.username):F.folderStore.get("").then(function(M){F.folderSelect.set("item",M)},this)},_isEmptyObject:function(F){for(var M in F)if(F.hasOwnProperty(M))return!1;return!0},validateServiceName:function(F,M){var Z=/(:|&|<|>|%|#|\?|\\|"|\/|\+|=|\*|@|'|;|\||,)/g.test(F),X=!0,ka=!0;if(ea.isDefined(M)&&M.textInput)var V=M.textInput;ea.isDefined(M)&&ea.isDefined(M.isItem)&&(ka=M.isItem);this.initI18n();if(0===F.length||0===n.trim(F).length){var ia=
this.i18n.requiredValue;X=!1}else if(Z)ia=this.i18n.invalidServiceName,X=!1;else if(ka&&98<F.length)ia=this.i18n.invalidServiceNameLength,X=!1;else if(ka&&170<encodeURIComponent(F).length){for(F+="";170<encodeURIComponent(F).length;)F=F.substring(0,F.length-1);ia=n.substitute(this.i18n.suggestedServiceNameLength,{count:F.length});X=!1}V&&!X&&V.set("invalidMessage",ia);return X},getStepNumber:function(F){q(".esriAnalysisNumberLabel",F).forEach(function(M,Z){Z=this._getNumberLabel(Z);d.set(M,"innerHTML",
Z)},this)},_getNumberLabel:function(F){var M="";this.initI18n();switch(F){case 0:M=this.i18n.oneLabel;break;case 1:M=this.i18n.twoLabel;break;case 2:M=this.i18n.threeLabel;break;case 3:M=this.i18n.fourLabel;break;case 4:M=this.i18n.fiveLabel;break;case 5:M=this.i18n.sixLabel;break;case 6:M=this.i18n.sevenLabel;break;case 7:M=this.i18n.eightLabel;break;case 8:M=this.i18n.nineLabel;break;case 9:M=this.i18n.tenLabel;break;case 10:M=this.i18n.elevenLabel;break;case 11:M=this.i18n.twelveLabel;break;case 12:M=
this.i18n.thirteenLabel}return M},populateAnalysisLayers:function(F,M,Z,X){if(F){var ka=[],V=F.get(M);M=X&&X.layerSelect?X.layerSelect:F._analysisSelect;F.rerun&&!V&&(X||(X={}),X.chooseBlank=!0);F._titleRow&&u.set(F._titleRow,"display","none");F._analysisLabelRow&&u.set(F._analysisLabelRow,"display","table-row");F._selectAnalysisRow&&(u.set(F._selectAnalysisRow,"display","table-row"),u.set(F._analysisSelect.domNode.parentNode,"padding-bottom","1em"));F.domNode&&this.getStepNumber(F.domNode);ea.isDefined(X)&&
X.chooseLabel&&ka.push({value:-1,label:this.i18n.chooseLabel});ea.isDefined(X)&&X.chooseBlank&&ka.push({value:"  ",label:""});ea.isDefined(X)&&ea.isDefined(X.posIncrement)||(ea.isDefined(X)||(X={}),X.posIncrement=0);F.get(Z)||F.set(Z,[]);p.forEach(F.get(Z),function(ia,ma){ma+=X.posIncrement;ma={value:ea.isDefined(X)&&X.chooseLabel?""+ma+1:""+ma,label:ia.name};V&&(ia.name===V.name||ia.url&&V.url&&ia.url===V.url)&&(ma.selected=!0);ka.push(ma)},this);M.addOption(ka);M.set("required",!0);X.chooseBlank&&
"  "===M.get("value")&&setTimeout(k.hitch(this,this._validateSelectUI,M),100)}},isValidAnalysisLayer:function(F){var M="",Z=!0;var X={isValid:Z,validationMessage:M};var ka,V,ia=0,ma=0,ra=0,sa,Ba,wa,ta=!0;if(!ea.isDefined(F)||!ea.isDefined(F.toolName))return X;this.initI18n();X=F.toolName;var va=F.layers;var qa=F.analysisLayer;var ua=X.charAt(0).toLowerCase()+X.substring(1);var za=this.i18n;F=F.showReadyToUseLayers||!1;p.forEach(va,function(Aa){ta=!1;if(Aa instanceof W||"esri.layers.RasterXLayer"===
Aa.declaredClass)sa=!0;sa&&1<Aa.bandCount&&(Ba=!0);sa&&1===Aa.bandCount&&(wa=!0);Aa.geometryType===ha.GeometryTypes.Point&&(Ea=!0,ia++);if(Aa.geometryType===ha.GeometryTypes.Point||Aa.geometryType===ha.GeometryTypes.MultiPoint)ka=!0;Aa.geometryType===ha.GeometryTypes.Line&&(V=!0,ra++);Aa.geometryType===ha.GeometryTypes.Polygon&&(Oa=!0,ma++)},this);if(-1!==p.indexOf(["CreateDriveTimeAreas","PlanRoutes","ConnectOriginsToDestinations"],X)&&(!Ea||qa&&qa.geometryType!==ha.GeometryTypes.Point))M=n.substitute(this.i18n.selectPointLayer,
{toolName:za[ua]}),Z=!1;else if("AggregatePoints"!==X&&"InterpolatePoints"!==X||(!qa||qa.geometryType===ha.GeometryTypes.Point||qa.geometryType===ha.GeometryTypes.MultiPoint)&&ka)if("CalculateDensity"===X&&(!ka&&!V||qa&&qa.geometryType!==ha.GeometryTypes.Point&&qa.geometryType!==ha.GeometryTypes.MultiPoint&&qa.geometryType!==ha.GeometryTypes.Line))M=n.substitute(this.i18n.areaFeatureInvalidMsg,{toolName:za[ua]}),Z=!1;else if("FindHotSpots"!==X&&"FindOutliers"!==X||F||!(!ka&&!Oa||qa&&qa.geometryType!==
ha.GeometryTypes.Point&&qa.geometryType!==ha.GeometryTypes.MultiPoint&&qa.geometryType!==ha.GeometryTypes.Polygon))if("OverlayLayers"!==X&&"AggregatePoints"!==X&&"SummarizeWithin"!==X&&"SummarizeNearby"!==X&&"FindNearest"!==X&&"MergeLayers"!==X||F||0!==va.length&&(1!==va.length||va[0]!==qa&&ea.isDefined(qa)))if("ConnectOriginsToDestinations"===X&&!F&&(ta||2>ia))M=n.substitute(this.i18n.odPointMsg,{toolName:za[ua]}),Z=!1;else if(this.isFindCentroids(X)&&this.isPointLayer(qa))M=n.substitute(this.i18n.selectNoPointLayer,
{toolName:za[ua]}),Z=!1;else if("AggregatePoints"===X&&!F&&1<va.length){var Oa=p.some(va,function(Aa){return Aa.geometryType===ha.GeometryTypes.Polygon});Oa||(M=n.substitute(this.i18n.aggregatePolyMsg,{toolName:za[ua]}),Z=!1)}else if("MergeLayers"===X&&!F&&1<va.length)1<ia||1<ra||1<ma||(M=this.i18n.mergeValidationMsg,Z=!1);else if("SummarizeWithin"!==X&&"DissolveBoundaries"!==X||(!qa||qa.geometryType===ha.GeometryTypes.Polygon)&&Oa||F)if("ExtractData"===X)(Z=p.some(va,function(Aa){return-1!==Aa.capabilities.indexOf("Extract")}))||
(M=n.substitute(this.i18n.extractValidationMsg));else if(("ConnectOriginsToDestinations"===X||X===ha.Tools.ChooseBestFacilities)&&1<va.length){var Ea=p.some(va,function(Aa){var Wa=ea.isDefined(qa)&&qa.id===Aa.id;return Aa.geometryType===ha.GeometryTypes.Point&&!Wa});Ea||(M=n.substitute(X===ha.Tools.ChooseBestFacilities?this.i18n.selectPointLayer:this.i18n.odPointMsg,{toolName:za[ua]}),Z=!1)}else"CalculateSlope"===X||"DeriveAspect"===X||"RemapValues"===X?sa?wa||(Z=!1,M=n.substitute(this.i18n.noSingleBandISMsg,
{toolName:za[ua]})):(Z=!1,M=n.substitute(this.i18n.noImageServiceMsg,{toolName:za[ua]})):"ExtractRaster"===X?sa||(Z=!1,M=n.substitute(this.i18n.noImageServiceMsg,{toolName:za[ua]})):"MonitorVegetation"===X&&(sa?Ba||(Z=!1,M=n.substitute(this.i18n.noMultiBandISMsg,{toolName:za[ua]})):(Z=!1,M=n.substitute(this.i18n.noImageServiceMsg,{toolName:za[ua]})));else M=n.substitute(this.i18n.selectPolyLayer,{toolName:za[ua]}),Z=!1;else M=n.substitute(this.i18n.overlayValidationMsg,{toolName:za[ua]}),Z=!1;else M=
n.substitute(this.i18n.hotspotsLineFeatureMsg,{toolName:za[ua]}),Z=!1;else M=n.substitute(this.i18n.selectPointLayer,{toolName:za[ua]}),Z=!1;return X={isValid:Z,validationMessage:M}},isFindCentroids:function(F){return F===ha.Tools.FindCentroids},isPointLayer:function(F){return F&&F.geometryType===ha.GeometryTypes.Point},initI18n:function(){this.i18n||(this.i18n={},k.mixin(this.i18n,c.common),k.mixin(this.i18n,c.analysisTools),k.mixin(this.i18n,c.analysisMsgCodes),k.mixin(this.i18n,c.browseLayersDlg),
k.mixin(this.i18n,c.driveTimes),k.mixin(this.i18n,c.calculateFields))},addBrowseAnalysisDialog:function(F){if(F&&F.widget){this.i18n||this.initI18n();var M="esri/dijit/analysis/PluginAnalysisLayers",Z=function(va){return"\x3cimg class\x3d'grid-item galleryThumbnail' width\x3d'120px' height\x3d'80px' alt\x3d'' src\x3d'"+(va.thumbnailUrl||this._portal.staticImagesUrl+"/desktopapp.png")+"'\x3e"},X=function(va){return'\x3cdiv class\x3d"galleryLabelContainer"\x3e\x3cspan alt\x3d\''+(va.title||va.name||
"\x3cNo Title\x3e")+"'\x3e"+(va.title.replace(/_/g," ")||va.name.replace(/_/g," ")||"\x3cNo Title\x3e")+"\x3c/span\x3e\x3c/div\x3e"},ka=function(va){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'16px' height\x3d'16px' alt\x3d'' src\x3d'"+va.iconUrl+"'/\x3e"},V=function(va){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'16px' height\x3d'16px' alt\x3d'' src\x3d'"+va.iconUrl+"'/\x3e"},ia=w.doc.createDocumentFragment();ia=y.create("div",{style:"width:100%;height:100%;"},ia);var ma=y.create("div",
{style:"width:100%;height:10%;","class":""}),ra=y.create("div",{style:"width:100%"},ia),sa=this._isCustomAnalysisQuery(F.widget);1===F.browseType?(M="esri/dijit/analysis/PluginLayers",M={portalUrl:F.widget.get("portalUrl"),message:"",plugin:M,sortDescending:!0,sort:"title",self:F.widget.get("portalSelf"),itemsPerPage:100,demandList:!0,extent:F.widget.get("map").extent,useExtent:!1,fetchTimeout:600,galleryTemplate:"\x3cdiv class\x3d'listServiceTitle'\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%'\x3e\x3ctr width\x3d'100%'\x3e\x3ctd nowrap\x3d'nowrap'\x3e  \x3cdiv  style\x3d\"position:absolute;left:80px; top:10px; width:1px; height:1px; background: transparent;\"\x3e\x3c/div\x3e\x3cdiv style\x3d'overflow:hidden;'\x3e\x3ca style\x3d\"height:16px;\"\x3e${item.title}\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%'\x3e\x3ctr width\x3d'100%' class\x3d'bottomRowTable'\x3e\x3ctd width\x3d'20'\x3e  \x3cspan class\x3d'esriAlignLeading'\x3e${item:_formatThumbnail}\x3c/span\x3e\x3c/td\x3e\x3ctd nowrap\x3d'nowrap'\x3e  \x3cspan class\x3d'esriAlignLeading' style\x3d'color:#656565;'\x3e${item.owner}\x3c/span\x3e\x3c/td\x3e\x3ctd style\x3d'padding-right:5px;padding-left:3px;'\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e",
showInfoPanel:!0,isAutoClose:!1,checkIsButtonEnabled:!0,formatThumbnail:V,formatInfoPanelImage:ka,"class":"esriAnalysisLayersItems"}):M={portalUrl:F.widget.get("portalUrl"),message:"",plugin:M,sortDescending:!0,sort:"title",self:F.widget.get("portalSelf"),pagingLinks:1,rowsPerPage:6,"class":"esriBrowseAnalysisLayers itemsGallery esriFloatLeading",extent:F.widget.get("map").extent,useExtent:!sa,fetchTimeout:600,galleryTemplate:'\x3cdiv style\x3d\'opacity:1;\' class\x3d\'grid-item gallery-view galleryNode\'\x3e${item:_formatItemTitle}${item:_formatThumbnail}\x3cdiv class\x3d"linksDiv" style\x3d\'display:none;\'\x3e\x3cdiv class\x3d"esriItemLinks"\x3e\x3cdiv class\x3d"esriFloatLeading"\x3e\x3ca style\x3d"text-decoration: none;"\x3e\x3cspan\x3eAdd layer to analysis\x3c/span\x3e\x3cdiv class\x3d"dijitReset dijitInline esriArrows"\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
formatItemTitle:X,showInfoPanel:!1,showTooltip:!0,formatThumbnail:Z,style:"width:48em;height:100%;clear:both;"};X=y.toDom('\x3cdiv class\x3d"esriBrowseOptions"\x3e');y.place(X,ma);Z=y.create("div",{"class":"esriBrowseOption"},X);if(!F.browseType||1!==F.browseType){X=y.create("div",{"class":"esriBrowseOption"},X);var Ba=new da({name:"addlayer",id:F.widget.id+(F.browseType?F.browseType:"")+"_addlayercheck","class":"",value:!1,checked:!1},y.create("input",{},X));y.create("label",{"for":F.widget.id+"_addlayercheck",
"class":"esriBrowseOption_label",innerHTML:this.i18n.addLayer},X)}X=!0;F.browseType&&1===F.browseType?X=!1:sa&&(X=!1);X=new da({name:"extentcheck",id:F.widget.id+(F.browseType?F.browseType:"")+"_addextentcheck","class":"",value:X,checked:X},y.create("input",{},Z));y.create("label",{"for":F.widget.id+(F.browseType?F.browseType:"")+"_addextentcheck","class":"esriBrowseOption_label",innerHTML:this.i18n.withinMapArea},Z);M.messageRight=ma;var wa=new J(M,ra);X.on("change",k.hitch(this,function(va){wa.set("useExtent",
va)}));var ta=new ca({title:1===F.browseType?this.i18n.browseLayers:sa?this.i18n.browseAnalysisLayers:this.i18n.browseAnalysisTitle,content:ia,browseItems:wa,addlayerCheckBox:Ba,style:F.browseType&&1===F.browseType?"":"padding:.75em 0;background-color: #fff;width:50em;"});F.widget.own(ta.on("hide",k.hitch(ta,function(va){ta.browseItems.reset()})));return ta}},addAnalysisReadyLayer:function(F,M){function Z(wa){var ta;if("Feature Service"===V.type){var va=new N(V.url,{outFields:["*"]});k.mixin(V,va)}"Image Service"===
V.type&&(va=-1<wa.capabilities.indexOf("TilesOnly")?new aa(V.url,{outFields:["*"]}):new W(V.url,{outFields:["*"]}),k.mixin(V,va));k.mixin(V,wa);V.id=V.title+"_"+wa.id;V.title=F.item.selectedLayer?V.title+"-"+wa.name:V.title.replace(/_/g," ");V.name=V.title;V.version=V.currentVersion;if(ma&&F.widget.showBrowseLayers){var qa=(ta=F.layersSelect.get("store"))&&ta.data;ta=2;ta=qa.splice(qa.length-ta,ta);var ua={id:qa.length,label:V.title,name:V.title,url:V.url};qa.push(ua);qa=qa.concat(ta);ta=new R({data:qa,
idProperty:"id"});F.layersSelect.set("store",ta);F.layersSelect.set("value",ua.name)}else{qa=F.layersSelect.getOptions();if(F.widget.useArcGISComponents&&(F.widget.showBrowseLayers||F.widget.showReadyToUseLayers))ta=2;else if(F.widget.showBrowseLayers&&F.widget.showReadyToUseLayers)ta=3;else if(F.widget.showBrowseLayers||F.widget.showReadyToUseLayers)ta=2;ta=qa.splice(qa.length-ta,ta);F.layersSelect.removeOption(ta);qa=F.layers.length;F.posIncrement&&(qa+=F.posIncrement);qa=""+qa;ta.unshift({value:qa,
label:V.title,selected:!0});F.layersSelect.addOption(ta);F.layersSelect.set("value",qa)}va&&(V.lyr=va,va.name=V.name);V.linfo=wa;F.layers.push(V);if(F.browseDialog.addlayerCheckBox&&F.browseDialog.addlayerCheckBox.get("checked")||ia||M)this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=F.widget.map.on("layer-add",k.hitch(this,function(za){this._addLayerHandle.remove();F.widget.emit("add-ready-to-use-layer",{layer:za.layer,layerInfo:wa,item:V})})),F.widget.map.addLayer(va);F.browseDialog.browseItems&&
F.browseDialog.browseItems.clear()}if(ea.isDefined(F)&&ea.isDefined(F.item)&&ea.isDefined(F.layersSelect)&&ea.isDefined(F.layers)&&ea.isDefined(F.browseDialog)){F.browseDialog.hide&&F.browseDialog.hide();var X,ka;(X=!F.item.selectedLayer&&F.item.url?F.item.type===la.IS?F.item.url:F.item.url+"/0":F.item.selectedLayer.url)&&-1!==window.location.protocol.indexOf("https:")&&(X=X.replace("http:","https:"));var V={url:X,itemId:F.item.id,title:F.item.title,type:F.item.type,analysisReady:!0};X=p.some(F.layers,
function(wa,ta){var va=wa.analysisReady&&V.analysisReady&&wa.itemId===V.itemId;F.item.selectedLayer&&F.item.selectedLayer.url&&(va=wa.itemId&&V.itemId?wa.itemId===V.itemId&&wa.url===V.url:wa.url===V.url);va&&(ka=ta);return va});var ia;F.browseDialog.browseItems&&q(".js-add-layer-checkbox",F.browseDialog.browseItems.infoPanel).forEach(function(wa){ia=wa.checked});var ma=-1!==F.layersSelect.baseClass.indexOf("dijitComboBox");var ra=new D;var sa="sync";if(X){F.posIncrement&&(ka+=F.posIncrement);if(F.browseDialog.addlayerCheckBox&&
F.browseDialog.addlayerCheckBox.get("checked")||ia||M){F.posIncrement||(F.posIncrement=0);var Ba=F.layers[ka-F.posIncrement];F.widget.map.getLayer(Ba.lyr.id)||(this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=F.widget.map.on("layer-add",k.hitch(this,function(wa){this._addLayerHandle.remove();F.widget.emit("add-ready-to-use-layer",{layer:wa.layer,layerInfo:Ba.linfo,item:Ba})})),F.widget.map.addLayer(Ba.lyr))}ma?F.layersSelect.set("value",F.layers[ka-1].name):F.layersSelect.set("value",
""+ka);F.browseDialog.browseItems&&F.browseDialog.browseItems.clear();ra.resolve()}else F.item.selectedLayer?(V.url=F.item.selectedLayer.url,ra.then(k.hitch(this,Z)),setTimeout(function(){ra.resolve(F.item.selectedLayer)},500)):(sa=F.item.itemDataUrl?O({url:F.item.itemDataUrl,content:{f:"json"}}):"sync",A(sa,k.hitch(this,function(wa){wa&&wa.layers&&wa.layers[0].id&&(V.url=V.url.substring(0,V.url.lastIndexOf("/0"))+"/"+wa.layers[0].id);O({url:V.url,content:{f:"json"}}).then(k.hitch(this,function(ta){Z(ta);
ra.resolve()}))})));return ra.promise}},addReadyToUseLayerOption:function(F,M){F&&(F.showReadyToUseLayers||F.showBrowseLayers)&&(M||(M=[]),F.signInPromise||(F.signInPromise=new D,setTimeout(k.hitch(this,function(){F.signInPromise.resolve()}),100)),F.i18n||(this.initI18n(),F.i18n=this.i18n),F.signInPromise.then(k.hitch(this,function(){p.forEach(M,function(Z){var X=Z.select||Z;if(-1!==X.baseClass.indexOf("dijitComboBox")&&F.showBrowseLayers){if(Z=X.get("store"))Z.put({id:"separator",name:"separator",
label:"\x3chr\x3e"}),Z.put({id:"browselayers",name:"browselayers",label:F.i18n.browseLayers})}else{var ka=X.getOptions();p.some(ka,function(V){return"separator"===V.type},this)||!F.showReadyToUseLayers&&!F.showBrowseLayers||X.addOption({type:"separator",value:""});this.addBrowseOptionForTool({select:X,disableLAAL:Z.disableLAAL},F)}},this);F.showReadyToUseLayers&&!ea.isDefined(F._browsedlg)&&(F._browsedlg=this.addBrowseAnalysisDialog({widget:F}),F.own(F._browsedlg.browseItems.on("select-change",k.hitch(F,
F._handleBrowseItemsSelect)),F._browsedlg.on("hide",k.hitch(F,function(){p.forEach(M,function(Z){"browse"===Z.get("value")&&Z.reset()});F.layersSelect&&F.layersSelect.reset()}))));F.showBrowseLayers&&!ea.isDefined(F._browseLyrsdlg)&&(F._browseLyrsdlg=this.addBrowseAnalysisDialog({widget:F,browseType:1}),F.own(F._browseLyrsdlg.on("browseitems-close",k.hitch(this,function(Z){"add-layer"===Z.action&&(F._browseLyrsdlg.browseItems.plugIn._grid&&(Z.selection.selectedLayer=F._browseLyrsdlg.browseItems.plugIn._selectedLayer,
F._handleBrowseItemsSelect({dialog:F._browseLyrsdlg,selection:Z.selection})),F._browseLyrsdlg.browseItems.closeInfoPanel())})),F._browseLyrsdlg.on("hide",k.hitch(F,function(){p.forEach(M,function(Z){"browselayers"===Z.get("value")&&Z.reset()})}))))})))},addBrowseOptionForTool:function(F,M){var Z=F.select,X=F.disableLAAL||!1,ka=Z.getOptions();F=[];var V=!1;if(!p.some(ka,function(ia){return"browselayers"===ia.value||"browse"===ia.value},this)){if(0<ka.length&&"separator"!==ka[ka.length-1].type||0===
ka.length)F.push({type:"separator"}),V=!0;M.useArcGISComponents&&(M.showBrowseLayers||M.showReadyToUseLayers)?F.push({value:"browselayers",label:M.i18n.browseAnalysisLayers}):(!X&&M.showReadyToUseLayers&&(X=M.i18n.browseAnalysisTitle,this._isCustomAnalysisQuery(M)&&(X=M.i18n.browseAnalysisLayers),F.push({value:"browse",label:X})),M.showBrowseLayers&&F.push({value:"browselayers",label:M.i18n.browseLayers}));(!0===V&&1<F.length||!1===V&&0<F.length)&&Z.addOption(F)}},_isCustomAnalysisQuery:function(F){var M=
'title:"Living Atlas Analysis Layers" AND owner:esri',Z=!1;F&&F.isSingleTenant&&(M='title:"Living Atlas Analysis Layers" AND owner:esri_livingatlas');F.portalSelf&&F.portalSelf.analysisLayersGroupQuery&&F.portalSelf.analysisLayersGroupQuery!==M?Z=!0:F._portal&&F._portal.analysisLayersGroupQuery&&F._portal.analysisLayersGroupQuery!==M&&(Z=!0);return Z},getMaxInputByMode:function(F){if(F&&F.units&&F.type&&F.limits&&F.travelMode){var M,Z=F.limits.maximumBreakDistanceValue,X=F.limits.maximumBreakDistanceValueUnits,
ka=F.limits.maximumBreakTimeValue,V=F.limits.maximumBreakTimeValueUnits,ia=this.isWalkingTravelMode(F.travelMode.travelMode);ia&&(Z=F.limits.maximumBreakWalkingDistanceValue,X=F.limits.maximumBreakWalkingDistanceValueUnits,ka=F.limits.maximumBreakWalkingTimeValue,V=F.limits.maximumBreakWalkingTimeValueUnits);"reachableStreets"===F.alternateLimits&&(V=this.generateLimitsForReachableStreets({limits:F.limits,isWalking:ia}),Z=V.driveDistanceLimit,X=V.driveDistanceUnit,ka=V.driveTimeLimit,V=V.driveTimeUnit);
"unreachableAreas"===F.alternateLimits&&(V=this.generateLimitsForUnreachableAreas({limits:F.limits,isWalking:ia}),Z=V.driveDistanceLimit,X=V.driveDistanceUnit,ka=V.driveTimeLimit,V=V.driveTimeUnit);ka*=this.perMinute(V);Z*=this.perMile(X);"StraightLine"===F.type?"Miles"===F.units?M=1E3:"Yards"===F.units?M=176E4:"Kilometers"===F.units?M=x.format(1609.344,{places:2}):"Meters"===F.units?M=x.format(1609344,{places:2}):"Feet"===F.units&&(M=528E4):this.isDistanceMode(F.travelMode)?"Miles"===F.units?M=Z:
"Yards"===F.units?M=1760*Z:"Kilometers"===F.units?M=x.format(1.609344*Z,{places:2}):"Meters"===F.units?M=x.format(1609.344*Z,{places:2}):"Feet"===F.units&&(M=5280*Z):this.isTimeMode(F.travelMode)&&("Minutes"===F.units?M=ka:"Seconds"===F.units?M=60*ka:"Hours"===F.units&&(M=ka/60));return"string"===typeof M?x.parse(M):parseFloat(M)}},isWalkingTravelMode:function(F){if(F&&F.restrictionAttributeNames)return F.restrictionAttributeNames.some(function(M){return"walking"===M.toLowerCase()})},isDistanceMode:function(F){return"Distance"===
F.units},isTimeMode:function(F){return"Time"===F.units},generateLimitsForUnreachableAreas:function(F){var M={driveDistanceLimit:null,driveDistanceUnit:null,driveTimeLimit:null,driveTimeUnit:null};F.isWalking?(M.driveDistanceLimit=F.limits.maximumBreakWalkingDistanceValueDetailedPolygons,M.driveDistanceUnit=F.limits.maximumBreakWalkingDistanceValueUnitsDetailedPolygons,M.driveTimeLimit=F.limits.maximumBreakWalkingTimeValueDetailedPolygons,M.driveTimeUnit=F.limits.maximumBreakWalkingTimeValueUnitsDetailedPolygons):
(M.driveDistanceLimit=F.limits.maximumBreakDistanceValueDetailedPolygons,M.driveDistanceUnit=F.limits.maximumBreakDistanceValueUnitsDetailedPolygons,M.driveTimeLimit=F.limits.maximumBreakTimeValueDetailedPolygons,M.driveTimeUnit=F.limits.maximumBreakTimeValueUnitsDetailedPolygons);return M},generateLimitsForReachableStreets:function(F){var M={driveDistanceLimit:null,driveDistanceUnit:null,driveTimeLimit:null,driveTimeUnit:null};F.isWalking?(M.driveDistanceLimit=F.limits.maximumBreakWalkingDistanceValueServiceAreaLines,
M.driveDistanceUnit=F.limits.maximumBreakWalkingDistanceValueUnitsServiceAreaLines,M.driveTimeLimit=F.limits.maximumBreakWalkingTimeValueServiceAreaLines,M.driveTimeUnit=F.limits.maximumBreakWalkingTimeValueUnitsServiceAreaLines):(M.driveDistanceLimit=F.limits.maximumBreakDistanceValueServiceAreaLines,M.driveDistanceUnit=F.limits.maximumBreakDistanceValueUnitsServiceAreaLines,M.driveTimeLimit=F.limits.maximumBreakTimeValueServiceAreaLines,M.driveTimeUnit=F.limits.maximumBreakTimeValueUnitsServiceAreaLines);
return M},updateModeConstraints:function(F){if(F&&F.validateWidget&&F.units&&F.type&&F.travelMode){var M=F.validateWidget.get("constraints");M.max=this.getMaxInputByMode(F);F.validateWidget.set(M)}},getTravelModes:function(F){var M=new D,Z,X,ka,V;ea.isDefined(this.travelModes)&&0<this.travelModes.length?M.resolve(this.travelModes):F&&F.widget?F.widget.signInPromise.then(k.hitch(this,function(ia){(V=F.widget.get("helperServices"))&&V.routingUtilities?(ka=V.routingUtilities.url,Z="sync"):Z=F.widget._getSelf(F.widget.portalUrl);
A(Z,k.hitch(this,function(ma){ma&&ma.helperServices&&ma.helperServices.routingUtilities&&(ka=ma.helperServices.routingUtilities.url);ea.isDefined(ka)?(X=new P(ka+"/GetTravelModes"),X.execute({}).then(k.hitch(this,function(ra){this.travelModes=p.map(ra[0].value&&ra[0].value.features,function(sa){return b.fromJson(sa.attributes.TravelMode)});ra[1]&&ra[1].paramName&&"defaultTravelMode"===ra[1].paramName&&(this.defaultTravelModeId=ra[1].value);M.resolve(this.travelModes)}),k.hitch(this,function(ra){M.reject(ra)}))):
M.reject(Error("Missing Routing Utility Service to get Travel Modes"))}),function(ma){M.reject(ma)})})):M.reject(Error("Missing parameter: params.widget required parameter"));return M.promise},populateTravelModes:function(F){if(F&&F.selectWidget&&F.widget){var M=[],Z=F.allowmode||"all",X=!1;this.initI18n();F.addStraightLine&&M.push({value:"StraightLine",label:'\x3cdiv class\x3d"esriFloatLeading bufferIcon esriStraightLineDistanceIcon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;"\x3e'+
this.i18n.straightLineDistance+"\x3c/div\x3e",selected:F.value&&"StraightLine"===F.value});this.getTravelModes({widget:F.widget}).then(k.hitch(this,function(ka){var V=ea.isDefined(F.enableTravelModes)&&!F.enableTravelModes;p.forEach(ka,function(ia,ma){ma=this.createOptionForTravelMode(ia,{name:ia.name,disabled:V,separator:F.separator});this.isTravelModeAllowed(Z,ma.units)&&("all"!==Z&&(ma.value=ma.value.replace(ma.units,"")),F.value&&F.value.id===ia.id?U(F.value,ia)&&(ma.selected=!ma.disabled,X=!0):
!F.value&&F.selectDefaultMode&&this.defaultTravelModeId&&this.defaultTravelModeId===ia.id&&(ma.selected=!0),M.push(ma))},this);!X&&this.isRequiredToAddTravelMode(F)&&this.isTravelModeAllowed(Z,this.getTravelModeUnits(F.value))&&M.push(this.getOptionForCustomTravelMode(F,V));F.selectWidget.removeOption();F.selectWidget.addOption(M);F.widget.emit("travelmodes-added",{travelOptions:M})}),k.hitch(this,function(ka){M&&0<M.length&&(F.selectWidget.removeOption(),F.selectWidget.addOption(M),F.widget.emit("travelmodes-added",
{travelOptions:M}))}))}},getTravelModeLabel:function(F,M){M=M?M:F.name;return'\x3cdiv class\x3d"esriFloatLeading bufferIcon esri'+this.getTravelModei18nKey(F.type)+this.getTravelModeUnits(F)+'Icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;" title\x3d"'+F.description+'"\x3e'+M+"\x3c/div\x3e"},getTravelModeUnits:function(F){var M=F.units||name.split(/\s/)[1];return M=F.impedanceAttributeName===F.timeAttributeName?"Time":F.impedanceAttributeName===F.distanceAttributeName?
"Distance":"Other"},getTravelModeValue:function(F,M){return F.replace(/\s/g,M||"")},getTravelModei18nKey:function(F){return"AUTOMOBILE"===F?"Driving":"TRUCK"===F?"Trucking":"WALK"===F?"Walking":"Other"},isTravelModeAllowed:function(F,M){return"all"===F||F.toLowerCase()===M.toLowerCase()},isRequiredToAddTravelMode:function(F){return F.widget.rerun&&"StraightLine"!==F.value},isTrafficBasedTravelMode:function(F){var M=this.getTravelModei18nKey(F.type).toLowerCase();return"time"===this.getTravelModeUnits(F).toLowerCase()&&
("driving"===M||"trucking"===M)},getOptionForCustomTravelMode:function(F,M){F=this.createOptionForTravelMode(F.value,{name:"\x26lt"+F.value.name+"\x26gt",disabled:M,separator:F.separator});F.selected=!0;return F},createOptionForTravelMode:function(F,M){return{label:this.getTravelModeLabel(F,M.name),value:this.getTravelModeValue(M.name,M.separator),travelMode:F,disabled:M.disabled,modei18nKey:this.getTravelModei18nKey(F.type).toLowerCase(),units:this.getTravelModeUnits(F)}},updateDisplay:function(F,
M,Z){(new q.NodeList(F)).style("display",M?Z?Z:"block":"none")},isGreaterThanZero:function(){return 0<this.get("value")},getExprFunctions:function(){this.i18n||this.initI18n();this.exprFunctions||(this.exprFunctions=[{type:"NumType",label:n.substitute(this.i18n.asMetersFunc,{functionName:"as_meters(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_meters()"},{type:"NumType",label:n.substitute(this.i18n.asKilometersFunc,{functionName:"as_kilometers(\x3ci\x3enumber\x3c/i\x3e)",
num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_kilometers()"},{type:"NumType",label:n.substitute(this.i18n.asFeetFunc,{functionName:"as_feet(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_feet()"},{type:"NumType",label:n.substitute(this.i18n.asYardsFunc,{functionName:"as_yards(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_yards()"},{type:"NumType",label:n.substitute(this.i18n.asMilesFunc,{functionName:"as_miles(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),
name:"as_miles()"},{type:"NumType",label:n.substitute(this.i18n.asNuaticalMilesFunc,{functionName:"as_nautical_miles(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_nautical_miles()"},{type:"NumType",label:n.substitute(this.i18n.absFunc,{functionName:"abs(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"abs()"},{type:"NumType",label:n.substitute(this.i18n.logFunc,{functionName:"log(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"log()"},
{type:"NumType",label:n.substitute(this.i18n.sinFunc,{functionName:"sin(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"sin()"},{type:"NumType",label:n.substitute(this.i18n.cosFunc,{functionName:"cos(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"cos()"},{type:"NumType",label:n.substitute(this.i18n.tanFunc,{functionName:"tan(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"tan()"},{type:"NumType",label:n.substitute(this.i18n.squareRootFunc,
{functionName:"sqrt(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"sqrt()"},{type:"NumType",label:n.substitute(this.i18n.minFunc,{functionName:"min(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"min()"},{type:"NumType",label:n.substitute(this.i18n.maxFunc,{functionName:"max(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"max()"},{type:"NumType",label:n.substitute(this.i18n.constrainFunc,{functionName:"constrain(\x3ci\x3enumber\x3c/i\x3e, \x3ci\x3elow\x3c/i\x3e, \x3ci\x3ehigh\x3c/i\x3e",
num:"\x3ci\x3enumber\x3c/i\x3e",low:"\x3ci\x3elow\x3c/i\x3e",high:"\x3ci\x3ehigh\x3c/i\x3e"}),name:"constrain(,,)"},{type:"NumType",label:n.substitute(this.i18n.iffFunc,{functionName:"iif(\x3ci\x3econdition\x3c/i\x3e,\x3ci\x3evalue if TRUE\x3c/i\x3e,\x3ci\x3evalue if FALSE\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"iif(,,)"},{type:"NumType",label:n.substitute(this.i18n.whenFunc,{functionName:"when(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"when(,)"},{type:"NumType",
label:n.substitute(this.i18n.decodeFunc,{functionName:"decode(\x3ci\x3eexpression\x3c/i\x3e, \x3ci\x3ecase1,return1,..caseN,returnN\x3c/i\x3e, \x3ci\x3edefault\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"decode(,,,)"}]);return this.exprFunctions},addAttributeOptions:function(F){this.initI18n();ea.isDefined(F.allowSelectLabel)||(F.allowSelectLabel=!0);var M=[],Z=ea.isDefined(F.emptyValue)?F.emptyValue:"";if(F.allowNumericType||void 0===F.allowNumericType)M=[ha.FieldTypes.Short,ha.FieldTypes.Integer,
ha.FieldTypes.Float,ha.FieldTypes.Double];var X=F.layer;var ka=F.selectWidget;var V=X?X.fields:[];ka.removeOption(ka.getOptions());F.allowSelectLabel&&ka.addOption({value:Z,label:this.i18n.attribute});F.allowStringType&&M.push(ha.FieldTypes.String);F.allowDateType&&M.push(ha.FieldTypes.Date);var ia=[];p.forEach(V,function(ma){-1!==p.indexOf(M,ma.type)&&ma.name!==X.objectIdField&&ia.push({value:ma.name,label:ea.isDefined(ma.alias)&&""!==ma.alias?ma.alias:ma.name,type:ma.type===ha.FieldTypes.String?
ha.PseudoFieldTypes.String:ma.type===ha.FieldTypes.Date?ha.PseudoFieldTypes.Date:ha.PseudoFieldTypes.Number})},this);if(0===ia.length)return!1;ka.addOption(ia);ea.isDefined(F.priorityChange)?ka.set("value",Z,F.priorityChange):ka.set("value",Z);ka.set("disabled",!X||0===X.fields.length);return!0},addStatisticsOptions:function(F){this.initI18n();var M=F.selectWidget,Z=[{value:"SUM",label:this.i18n.sum},{value:"MIN",label:this.i18n.minimum},{value:"MAX",label:this.i18n.maximum},{value:"MEAN",label:F.showGeoAnalyticsParams?
this.i18n.mean:this.i18n.average},{value:"STDDEV",label:this.i18n.standardDev}],X=[{value:"MIN",label:this.i18n.minimum},{value:"MAX",label:this.i18n.maximum}],ka=[{value:"First",label:this.i18n.first},{value:"Last",label:this.i18n.last}],V=ea.isDefined(F.emptyValue)?F.emptyValue:"";M.removeOption(M.getOptions());M.addOption([{value:V,label:this.i18n.statistic}]);F.showGeoAnalyticsParams&&(M.addOption({value:"COUNT",label:this.i18n.count}),Z.push({value:"VARIANCE",label:this.i18n.variance}),Z.splice(4,
0,{value:"RANGE",label:this.i18n.range}));F.showFirstLastStats&&M.addOption(ka);F.type&&"number"!==F.type?F.type&&"string"===F.type?(M.addOption({value:"ANY",label:this.i18n.any}),F.selectWidget.optionsType="string"):F.type&&"date"===F.type&&(M.addOption(X),F.selectWidget.optionsType="date"):(M.addOption(Z),F.selectWidget.optionsType="number");M.set("value",V)},addFillOptions:function(F){var M=F.selectWidget,Z=[{value:"ZEROES",label:this.i18n.zeroes},{value:"SPATIAL_NEIGHBORS",label:this.i18n.spatialneighbhors},
{value:"SPACE_TIME_NEIGHBORS",label:this.i18n.spacetimeneighbors},{value:"TEMPORAL_TREND",label:this.i18n.temporaltrend}];M.removeOption(M.getOptions());M.addOption([{value:"0",label:this.i18n.fill}]);F.type&&"number"!==F.type||M.addOption(Z)},perMeter:function(F){var M=1;switch(F){case L.MILLIMETERS:M=1E3;break;case L.CENTIMETERS:M=100;break;case L.DECIMETERS:M=10;break;case L.METERS:M=1;break;case L.KILOMETERS:M=.001;break;case L.INCHES:M=39.370079;break;case L.FEET:M=3.2808399;break;case L.YARDS:M=
1.0936133;break;case L.MILES:M=6.2137119E-4;break;case L.NAUTICAL_MILES:M=5.399568E-4;break;case L.ACRES:M=2.4710538E-4;break;case L.ARES:M=.01;break;case L.HECTARES:M=1E-4;break;case L.SQUARE_INCHES:M=1550.0031;break;case L.SQUARE_FEET:M=10.7639104;break;case L.SQUARE_YARDS:M=1.19599005;break;case L.SQUARE_MILES:M=3.86102159E-7;break;case L.SQUARE_NAUTICAL_MILES:M=2.9155335E-7;break;case L.SQUARE_MILLIMETERS:M=1E6;break;case L.SQUARE_CENTIMETERS:M=1E4;break;case L.SQUARE_DECIMETERS:M=100;break;case L.SQUARE_METERS:M=
1;break;case L.SQUARE_KILOMETERS:M=1E-6}return M},perMile:function(F){var M=1;switch(F){case "Feet":M=1.89394E-4;break;case "Yards":M=5.68182E-4;break;case "Meters":M=6.21371E-4;break;case "Kilometers":M=.621371}return M},perMinute:function(F){var M=1;switch(F){case "Seconds":M=.0166667;break;case "Hours":M=60}return M},getType:function(F){var M=null;switch(F){case L.ACRES:M=2;break;case L.ARES:M=2;break;case L.CENTIMETERS:M=1;break;case L.DECIMETERS:M=1;break;case L.FEET:M=1;break;case L.HECTARES:M=
2;break;case L.INCHES:M=1;break;case L.KILOMETERS:M=1;break;case L.METERS:M=1;break;case L.MILES:M=1;break;case L.MILLIMETERS:M=1;break;case L.NAUTICAL_MILES:M=1;break;case L.SQUARE_CENTIMETERS:M=2;break;case L.SQUARE_DECIMETERS:M=2;break;case L.SQUARE_FEET:M=2;break;case L.SQUARE_INCHES:M=2;break;case L.SQUARE_KILOMETERS:M=2;break;case L.SQUARE_METERS:M=2;break;case L.SQUARE_MILES:M=2;break;case L.SQUARE_MILLIMETERS:M=2;break;case L.SQUARE_NAUTICAL_MILES:M=2;break;case L.SQUARE_YARDS:M=2;break;case L.YARDS:M=
1;break;default:M=0}return M},unitConversion:function(F,M,Z){var X=!0;ea.isDefined(F)||(this.emitError("The 'From' Value must be a valid numeric value: "+F),X=!1);ea.isDefined(M)||(this.emitError("The 'From' Units must be defined: "+M),X=!1);ea.isDefined(Z)||(this.emitError("The 'To' Units must be defined: "+Z),X=!1);F instanceof Array&&(this.emitError("Only single 'From' Value supported: "+F),X=!1);M instanceof Array&&(this.emitError("Only single 'From' Units supported: "+M),X=!1);Z instanceof Array&&
(this.emitError("Only single 'To' Units supported: "+Z),X=!1);var ka=this.getType(M),V=this.getType(Z);0===ka&&(this.emitError("Unsupported 'From' Units: "+M),X=!1);0===V&&(this.emitError("Unsupported 'To' Units: "+Z),X=!1);ka!==V&&(this.emitError("Incompatible 'From' and 'To' Units: "+M+" and "+Z),X=!1);return X?M===Z?+F:+F/this.perMeter(M)*this.perMeter(Z):Number.NaN},emitError:function(F){console.log("error",Error(F))},isEmpty:function(F){for(var M in F)if(F.hasOwnProperty(M))return!1;return g.stringify(F)===
g.stringify({})},getRoutingUtilities:function(F){var M=new D,Z={},X,ka,V,ia;F||M.reject(Error("Missing parameter: widget required parameter"));-1!==p.indexOf(["CreateDriveTimeAreas","EnrichLayer","SummarizeNearby"],F.toolName)?k.mixin(Z,{toolName:"GenerateServiceAreas",serviceName:"asyncServiceArea"}):F.toolName===ha.Tools.ChooseBestFacilities?k.mixin(Z,{toolName:"SolveLocationAllocation",serviceName:"asyncLocationAllocation"}):"PlanRoutes"===F.toolName?k.mixin(Z,{toolName:"SolveVehicleRoutingProblem",
serviceName:"asyncVRP"}):"FindNearest"===F.toolName?k.mixin(Z,{toolName:"FindClosestFacilities",serviceName:"asyncClosestFacility"}):"ConnectOriginsToDestinations"===F.toolName&&k.mixin(Z,{toolName:"FindRoutes",serviceName:"asyncRoute"});this.routingUtilities||(this.routingUtilities={});this.routingUtilities&&this.routingUtilities[F.toolName]?M.resolve(this.routingUtilities[F.toolName]):F.signInPromise.then(k.hitch(this,function(ma){(ia=F.get("helperServices"))&&ia.routingUtilities?(V=ia.routingUtilities.url,
X="sync"):X=F._getSelf(F.portalUrl);A(X,k.hitch(this,function(ra){ra&&ra.helperServices&&ra.helperServices.routingUtilities&&(V=ra.helperServices.routingUtilities.url);ea.isDefined(V)||M.reject(Error("Missing Routing Utility Service to get Network Analysis Service Limits."));ka=new P(V+"/GetToolInfo");ka.execute(Z).then(k.hitch(this,function(sa){sa&&0<sa.length&&sa[0].value?(this.routingUtilities[F.toolName]=sa[0].value,M.resolve(sa[0].value)):M.reject("Routing Utility Service 'GetToolInfo' job did not return service limits.")}),
function(sa){M.reject(sa)})}))}),function(ma){M.reject(ma)});return M.promise},getNetworkAnalysisLimits:function(F){var M=new D;F||M.reject(Error("Missing parameter: widget required parameter"));this.getRoutingUtilities(F).then(k.hitch(this,function(Z){Z.serviceLimits?M.resolve(Z.serviceLimits):M.reject()}),function(Z){M.reject(Z)});return M.promise},isEsriWorldGeocoder:function(F){var M=this.isAgoWorldGeocodeServer(F);F=this.isAgoWorldGeocodeServerProxy(F);return M||F},isAgoWorldGeocodeServer:function(F){return F&&
!!F.match(/(arcgis.com\/arcgis\/rest\/services\/world\/geocodeserver).*/ig)},isCustomGeoEnrichmentServer:function(F,M){var Z=(F||"").toLowerCase();F=-1<Z.indexOf("/geoenrichmentserver")&&-1<Z.indexOf("/servers/")&&-1<Z.indexOf("/rest/services/");M=!M&&Z.indexOf("utility")&&-1<Z.indexOf(".arcgis.com");return F&&M},isAgoWorldGeocodeServerProxy:function(F){return F&&!!F.match(/(\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/ig)},isWorldGeoLocator:function(F){return F&&!!F.match(/(\/rest\/services\/world\/geocodeserver).*/ig)},
showMessages:function(F,M,Z){d.set(M,"innerHTML",F);l.fadeIn({node:Z,easing:E.quadIn,onEnd:k.hitch(this,function(){u.set(Z,{display:""})})}).play()},hideMessages:function(F){l.fadeOut({node:F,easing:E.quadOut,onEnd:function(){u.set(F,{display:"none"})}}).play()},getHelpUrl:function(F){if(F.topic&&F.widget){var M;F.widget.portalSelf&&F.widget.portalSelf.helpBase?M=F.widget.portalSelf.helpBase+"index.html#":!F.widget.isSingleTenant||F.widget.portalSelf&&F.widget.portalSelf.helpBase||(M="http://server.arcgis.com/en/portal/latest/use/");
"BufferExpression"===F.topic&&(M+="Use_expressions_with_GeoAnalytics_Tools/019300000183000000/");return M}},isPCS:function(F){return!!F&&!!na&&-1!==p.indexOf(na,F)},isPCSByLayerType:function(F){var M=!!F&&!!F.fullExtent&&this.isPCS(F.fullExtent.spatialReference.wkid);!M&&F.extent&&(M=!!F&&!!F.extent&&this.isPCS(F.extent.spatialReference.wkid));!M&&F.spatialReference&&(M=!!F&&!!F.spatialReference&&this.isPCS(F.spatialReference.wkid));return M},checkPCSforAnalysis:function(F){var M=F.widget&&F.widget.toolName,
Z=!!F.widget&&!!F.widget.context&&!!F.widget.context.processSR&&this.isPCS(F.widget.context.processSR.wkid),X=!0,ka=F.jobParams||F.widget.jobParams,V=!!F.widget&&!!F.widget.context&&!!F.widget.context.processSR&&!!F.widget.context.processSR.wkid;if(!M||!ka||!F.widget.showGeoAnalyticsParams)return!1;var ia="\x3ca  href\x3d'#' id\x3d'"+F.widget.id+"_warn_settings_link'\x3e"+F.widget.i18n.analysisSettings+"\x3c/a\x3e\x3cdiv class\x3d'esriAnalysisSettingsIcon'\x3e\x3c/div\x3e";var ma=n.substitute(F.widget.i18n.PCSReqMsg,
{defaultSpatialRef:F.widget.i18n.worldCylindrical,settingsIcon:ia});"FindHotSpots"!==M&&"FindPointClusters"!==M||Z?"CalculateDensity"!==M&&"FindPointClusters"!==M&&"GeographicallyWeightedRegression"!==M||Z?"AggregatePoints"!==M||-1===p.indexOf(["HEXAGON","SQUARE"],ka.binType)||Z?"SummarizeWithin"===M&&ka.summaryPolygons&&!Z?X=this.isPCSByLayerType(F.widget.sumWithinLayer):"SummarizeWithin"!==M||-1===p.indexOf(["HEXAGON","SQUARE"],ka.binType)||Z?"JoinFeatures"===M&&ka.spatialNearDistance&&"Near"===
ka.spatialRelationship&&!Z?(X=this.isPCSByLayerType(F.widget.targetLayer))||(ma=n.substitute(F.widget.i18n.JFPCSReqMsg,{settingsIcon:ia})):"BuildMultiVariableGrid"!==M||Z?"CalculateMotionStatistics"===M&&"Planar"===ka.distanceMethod&&(1<ka.motionStatistics.split(",").length||1===ka.motionStatistics.split(",").length&&-1===ka.motionStatistics.indexOf("Duration"))&&!Z?(X=this.isPCSByLayerType(F.widget.inputLayer))||(ma=n.substitute(F.widget.i18n.CMSPCSReqMsg,{settingsIcon:ia})):"TraceProximityEvents"!==
M||"Planar"!==ka.distanceMethod||Z||(X=this.isPCSByLayerType(F.widget.inputLayer))||(ma=n.substitute(F.widget.i18n.TPEPCSReqMsg,{settingsIcon:ia})):X=p.every(F.inputLayers,function(ra){return this.isPCSByLayerType(ra)},this):X=this.isPCSByLayerType(F.widget.summaryLayer):X=this.isPCSByLayerType(F.widget.pointLayer):(X=this.isPCSByLayerType(F.widget.inputLayer),"GeographicallyWeightedRegression"!==M||X||(ma=n.substitute(F.widget.i18n.GWRPCSReqMsg,{settingsIcon:ia}))):(X=this.isPCSByLayerType(F.widget.analysisLayer),
"FindPointClusters"!==M||X||(ma=n.substitute(F.widget.i18n.FPCSReqMsg,{settingsIcon:ia})));X||F.hasPCSWarnShown||(F.widget.set("disableRunAnalysis",X),this.settingsVM&&this.settingsDlg&&F.widget._bodyNode&&F.widget._errorMessagePane&&(this.showMessages(ma,F.widget._bodyNode,F.widget._errorMessagePane),z.byId(F.widget.id+"_warn_settings_link")&&G(z.byId(F.widget.id+"_warn_settings_link"),"click",k.hitch(F.widget,F.widget.showSettingsDlg))));!X&&F.hasPCSWarnShown&&V&&(X=!0);return X},tryParseJSON:function(F){try{var M=
g.parse(F);if(M&&"object"===typeof M&&null!==M)return M}catch(Z){}return!1},decodeTag:function(F){return{"\x26lt;":"\x3c","\x26gt;":"\x3e"}[F]||F},stringDecode:function(F){return F.replace(/(&lt;|&gt;)/g,this.decodeTag)},jobParamsToWidgetProps:function(F){if(F&&F.jobParams){var M=F.jobParams,Z=new D,X=[],ka=[],V;for(V in M){var ia;M.hasOwnProperty(V)&&("string"===typeof M[V]&&-1!==M[V].search(/(&lt;|&gt;)/g)&&(M[V]=this.stringDecode(M[V])),ia="string"===typeof M[V]?this.tryParseJSON(M[V]):M[V])&&
(-1!==V.toLowerCase().indexOf("layer")&&"object"===typeof ia?ka.push({key:V,obj:ia}):ia&&(ia.Raster||ia.url)&&ka.push({key:V,obj:ia}),M[V]=ia)}for(V=0;V<ka.length;V++){ia=ka[V].obj;var ma=ka[V].key;"object"===typeof ia&&ia.length?(M[ma]=[],p.forEach(ia,function(ra,sa){this._getFlayers(ra,ma,M,X,!0,sa)},this)):"object"===typeof ia&&ia.Raster?(ia.url=ia.Raster.url,this._getFlayers(ia,ma,M,X,!0,"Raster")):this._getFlayers(ia,ma,M,X)}B(X).then(k.hitch(this,function(){Z.resolve(F)}),k.hitch(this,function(){Z.resolve(F)}));
return Z.promise}},_getLayerType:function(F){return F?-1!==F.indexOf("BigDataCatalogServer")?la.BIGDATA:-1!==F.indexOf("ImageServer")?la.IS:la.FS:null},_getFlayers:function(F,M,Z,X,ka,V){if(F.url){var ia=O({url:F.url,content:{f:"json"}});var ma=new D;X.push(ma);ia.then(k.hitch(this,function(ra,sa,Ba,wa,ta){var va=this._getLayerType(ra.url);if(va===la.FS){var qa=new N(ra.url,{mode:N.MODE_ONDEMAND,outFields:["*"],resourceInfo:ta});ra.filter&&qa.setDefinitionExpression(ra.filter);qa.filter=ra.filter}else va===
la.BIGDATA?(qa=ta,k.mixin(qa,ra)):va===la.IS&&(ta=ra.Raster||ra,qa=new W(ta.url),ta.renderingRule&&qa.setRenderingRule(new oa(ta.renderingRule)),ta.name&&(qa.name=ta.name),ra.Raster&&ra.Raster.url===ra.url&&delete ra.url);ra.name&&(qa.name=ra.name);ka?Z[sa][wa]=qa:ka&&va===la.IS?k.mixin(Z[sa][wa],qa):Z[sa]=qa;Ba.resolve()},F,M,ma,V),k.hitch(this,function(ra,sa,Ba,wa,ta){ra={name:ra.name,empty:!0};ka?Z[sa][wa]=ra:Z[sa]=ra;Ba.resolve()},F,M,ma,V))}else X=new N(F,{outFields:["*"]}),F.name&&(X.name=F.name),
ka?Z[M][V]=X:Z[M]=X},isLayerInLayers:function(F,M){return p.some(M,function(Z){return this.isSameLayer(F,Z)},this)},addBlankOption:function(F,M){M&&M.length?M.push({value:"  ",label:""}):F.addOption({value:"  ",label:""});setTimeout(k.hitch(this,this._validateSelectUI,F),100)},_validateSelectUI:function(F){F._hasBeenBlurred=!0;F.set("focused",!0);F.validate();F.set("focused",!1);F._hasBeenBlurred=!1;setTimeout(k.hitch(this,function(){F.reset()}),1E3)},updateExpressions:function(F){F&&F.selectedInputLayers&&
F.inputLayers&&F.data&&F.expressions&&(p.forEach(F.selectedInputLayers,function(M,Z){p.forEach(F.inputLayers,function(X,ka){X&&M&&(!M.url&&!X.url&&M.name===X.name||M.url&&X.url&&M.url===X.url)&&(M._oldIndex=Z,M._newIndex=ka)})}),p.forEach(F.data,function(M,Z){0<Z&&M&&(Z=F.expressions[Z-1],ea.isDefined(M.layer)&&(M.layer=Z&&Z.layer),ea.isDefined(M.selectingLayer)&&(M.selectingLayer=Z&&Z.selectingLayer))}),p.forEach(F.data,function(M){var Z=!1,X=!1;p.forEach(F.selectedInputLayers,function(ka){ea.isDefined(M.layer)&&
M.layer===ka._oldIndex&&!Z&&(M.layer=ka._newIndex,Z=!0);ea.isDefined(M.selectingLayer)&&M.selectingLayer===ka._oldIndex&&!X&&(M.selectingLayer=ka._newIndex,X=!0)},this)},this))},isBigDataTypeTobeAdded:function(F){return-1==p.indexOf(F,'type:"Big Data File Share"')?!0:!1},removeDuplicates:function(F,M){for(var Z=[],X={},ka=0;ka<F.length;ka++)X[F[ka]]?X[F[ka]]+=1:(Z.push(F[ka]),X[F[ka]]=1);return M?X:Z},isPoint:function(F){return F&&F.geometryType===ha.GeometryTypes.Point},isLine:function(F){return F&&
F.geometryType===ha.GeometryTypes.Line},isPolygon:function(F){return F&&F.geometryType===ha.GeometryTypes.Polygon},isSameLayer:function(F,M){return F&&M&&(F.name&&M.name&&F.name===M.name||F.url&&M.url&&F.url===M.url)},getTimeType:function(F){return F?ea.isDefined(F.timeInfo)&&ea.isDefined(F.timeInfo.startTimeField)&&!ea.isDefined(F.timeInfo.endTimeField)?ha.TimeTypes.Instant:ea.isDefined(F.timeInfo)&&ea.isDefined(F.timeInfo.startTimeField)&&ea.isDefined(F.timeInfo.endTimeField)?ha.TimeTypes.Interval:
ea.isDefined(F.time)&&ea.isDefined(F.time.timeType)?F.time.timeType:!1:!1},fetchGroupForRFT:function(F){var M=new D,Z=a.locale,X=Z?Z.substring(0,2):"en";Z=this.systemRFTGroupName+" owner: ("+("en"===X?["esri_en"]:["esri_en","esri_"+X]).join(" OR ")+")";F.queryGroups({q:Z},!0).then(function(ka){0<ka.total&&ka.results?(ka=ka.results,ka=this.findRFTLocaleGroup(ka,X)||this.findRFTLocaleGroup(ka,"en"),M.resolve(ka)):M.resolve(null)}.bind(this));return M},findRFTLocaleGroup:function(F,M){var Z;F.some(function(X){var ka=
X.owner;if(ka&&ka.substring(ka.length-2)===M)return Z=X,!0});return Z},updateOptions:function(F,M){if(F){for(;0<F.getOptions().length;)F.removeOption(F.getOptions());F._setDisplay("");M&&0<M.length&&F.addOption(M)}},addOptionsFromLayers:function(F){F.select&&F.layers&&(F.customOptions=F.customOptions||[],F.forbiddenLayers=F.forbiddenLayers||[],F.layers.forEach(function(M,Z){this.isLayerInLayers(M,F.forbiddenLayers)||F.customOptions.push({value:Z.toString(),label:M.name,selected:F.selectedOption&&
this.isSameLayer(F.selectedOption,M)})},this),this.updateOptions(F.select,F.customOptions),this.addBrowseOptionForTool({select:F.select,disableLAAL:!0},F.widget))},replaceTag:function(F){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;"}[F]||F},safetagsReplace:function(F){return F.replace(/[<>]/g,this.replaceTag)}});f("extend-esri")&&k.setObject("dijit.analysis.utils",H,ja);return H})},"dojo/fx/easing":function(){define(["../_base/lang"],function(H){var k={linear:function(p){return p},quadIn:function(p){return Math.pow(p,
2)},quadOut:function(p){return p*(p-2)*-1},quadInOut:function(p){p*=2;return 1>p?Math.pow(p,2)/2:-1*(--p*(p-2)-1)/2},cubicIn:function(p){return Math.pow(p,3)},cubicOut:function(p){return Math.pow(p-1,3)+1},cubicInOut:function(p){p*=2;return 1>p?Math.pow(p,3)/2:(Math.pow(p-2,3)+2)/2},quartIn:function(p){return Math.pow(p,4)},quartOut:function(p){return-1*(Math.pow(p-1,4)-1)},quartInOut:function(p){p*=2;return 1>p?Math.pow(p,4)/2:-.5*(Math.pow(p-2,4)-2)},quintIn:function(p){return Math.pow(p,5)},quintOut:function(p){return Math.pow(p-
1,5)+1},quintInOut:function(p){p*=2;return 1>p?Math.pow(p,5)/2:(Math.pow(p-2,5)+2)/2},sineIn:function(p){return-1*Math.cos(Math.PI/2*p)+1},sineOut:function(p){return Math.sin(Math.PI/2*p)},sineInOut:function(p){return-1*(Math.cos(Math.PI*p)-1)/2},expoIn:function(p){return 0==p?0:Math.pow(2,10*(p-1))},expoOut:function(p){return 1==p?1:-1*Math.pow(2,-10*p)+1},expoInOut:function(p){if(0==p)return 0;if(1==p)return 1;p*=2;if(1>p)return Math.pow(2,10*(p-1))/2;--p;return(-1*Math.pow(2,-10*p)+2)/2},circIn:function(p){return-1*
(Math.sqrt(1-Math.pow(p,2))-1)},circOut:function(p){return Math.sqrt(1-Math.pow(p-1,2))},circInOut:function(p){p*=2;return 1>p?-.5*(Math.sqrt(1-Math.pow(p,2))-1):.5*(Math.sqrt(1-Math.pow(p-2,2))+1)},backIn:function(p){return Math.pow(p,2)*(2.70158*p-1.70158)},backOut:function(p){--p;return Math.pow(p,2)*(2.70158*p+1.70158)+1},backInOut:function(p){p*=2;if(1>p)return Math.pow(p,2)*(3.5949095*p-2.5949095)/2;p-=2;return(Math.pow(p,2)*(3.5949095*p+2.5949095)+2)/2},elasticIn:function(p){if(0==p||1==p)return p;
--p;return-1*Math.pow(2,10*p)*Math.sin(2*(p-.075)*Math.PI/.3)},elasticOut:function(p){return 0==p||1==p?p:Math.pow(2,-10*p)*Math.sin(2*(p-.075)*Math.PI/.3)+1},elasticInOut:function(p){if(0==p)return 0;p*=2;if(2==p)return 1;var r=.3*1.5,m=r/4;if(1>p)return--p,-.5*Math.pow(2,10*p)*Math.sin(2*(p-m)*Math.PI/r);--p;return.5*Math.pow(2,-10*p)*Math.sin(2*(p-m)*Math.PI/r)+1},bounceIn:function(p){return 1-k.bounceOut(1-p)},bounceOut:function(p){return p<1/2.75?7.5625*Math.pow(p,2):p<2/2.75?7.5625*Math.pow(p-
1.5/2.75,2)+.75:p<2.5/2.75?7.5625*Math.pow(p-2.25/2.75,2)+.9375:7.5625*Math.pow(p-2.625/2.75,2)+.984375},bounceInOut:function(p){return.5>p?k.bounceIn(2*p)/2:k.bounceOut(2*p-1)/2+.5}};H.setObject("dojo.fx.easing",k);return k})},"dojox/mvc/equals":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/Stateful","./StatefulArray"],function(H,k,p,r){var m=function(l,b,a){a=a||m;var d=[a.getType(l),a.getType(b)];return d[0]!=d[1]?!1:a["equals"+d[0].replace(/^[a-z]/,function(f){return f.toUpperCase()})](l,
b)};return k.setObject("dojox.mvc.equals",k.mixin(m,{getType:function(l){return k.isArray(l)?"array":k.isFunction((l||{}).getTime)?"date":null!=l&&("[object Object]"=={}.toString.call(l)||k.isFunction((l||{}).set)&&k.isFunction((l||{}).watch))?"object":"value"},equalsArray:function(l,b){for(var a=0,d=Math.max(l.length,b.length);a<d;a++)if(!m(l[a],b[a]))return!1;return!0},equalsDate:function(l,b){return l.getTime()==b.getTime()},equalsObject:function(l,b){var a=k.mixin({},l,b),d;for(d in a)if(!(d in
p.prototype||"_watchCallbacks"==d||m(l[d],b[d])))return!1;return!0},equalsValue:function(l,b){return l===b}}))})},"dojox/mvc/StatefulArray":function(){define(["dojo/_base/lang","dojo/Stateful"],function(H,k){function p(m){m._watchElementCallbacks&&m._watchElementCallbacks(void 0,[],[]);return m}var r=function(m){m=H._toArray(m||[]);m.constructor=r;return H.mixin(m,{pop:function(){return this.splice(this.get("length")-1,1)[0]},push:function(){this.splice.apply(this,[this.get("length"),0].concat(H._toArray(arguments)));
return this.get("length")},reverse:function(){return p([].reverse.apply(this,H._toArray(arguments)))},shift:function(){return this.splice(0,1)[0]},sort:function(){return p([].sort.apply(this,H._toArray(arguments)))},splice:function(l,b){var a=this.get("length");l+=0>l?a:0;var d=Math.min(l,a),f=this.slice(l,l+b),e=H._toArray(arguments).slice(2);[].splice.apply(this,[l,b].concat(Array(e.length)));for(var h=0;h<e.length;h++)this[d+h]=e[h];this._watchElementCallbacks&&this._watchElementCallbacks(l,f,
e);this._watchCallbacks&&this._watchCallbacks("length",a,a-f.length+e.length);return f},unshift:function(){this.splice.apply(this,[0,0].concat(H._toArray(arguments)));return this.get("length")},concat:function(l){return new r([].concat.apply(this,arguments))},join:function(l){for(var b=[],a=this.get("length"),d=0;d<a;d++)b.push(this.get(d));return b.join(l)},slice:function(l,b){var a=this.get("length");b=(void 0===b?a:b)+(0>b?a:0);var d=[];for(l=l+(0>l?a:0)||0;l<Math.min(b,this.get("length"));l++)d.push(this.get(l));
return new r(d)},watchElements:function(l){var b=this._watchElementCallbacks,a=this;b||(b=this._watchElementCallbacks=function(f,e,h){for(var c=[].concat(b.list),g=0;g<c.length;g++)c[g].call(a,f,e,h)},b.list=[]);b.list.push(l);var d={};d.unwatch=d.remove=function(){for(var f=b.list,e=0;e<f.length;e++)if(f[e]==l){f.splice(e,1);break}};return d}},k.prototype,{set:function(l,b){if("length"==l)l=this.get("length"),l<b?this.splice.apply(this,[l,0].concat(Array(b-l))):b<l&&this.splice.apply(this,[b,l-b]);
else{var a=this.length;k.prototype.set.call(this,l,b);a!=this.length&&k.prototype.set.call(this,"length",this.length)}return this},isInstanceOf:function(l){return k.prototype.isInstanceOf.apply(this,arguments)||l==r}})};r._meta={bases:[k]};return H.setObject("dojox.mvc.StatefulArray",r)})},"esri/dijit/analysis/HelpWindow":function(){define("require dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/_base/kernel dojo/aspect dojo/has dojo/dom-construct dojo/dom-class dojo/dom-attr dojo/dom-style dojo/query dojo/window dojo/dom-geometry dijit/_Widget dijit/TooltipDialog dijit/popup ../../kernel ../../lang ../../urlUtils ../../request ../_EventedWidget dojo/i18n!../../nls/jsapi".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x,w){p=p([v],{declaredClass:"esri.dijit.analysis.HelpWindow",i18n:null,onlineHelpMap:null,showLearnMore:!1,"class":"esriAnalyisHelpWindow",constructor:function(A){this.isPortal=A&&A.isPortal},postMixInProperties:function(){this.inherited(arguments);this.i18n={};r.mixin(this.i18n,w.common);r.mixin(this.i18n,w.analysisHelp)},postCreate:function(){this.inherited(arguments);var A=["ar","he"],z;for(z=0;z<A.length;z+=1){var G=A[z];b.locale&&-1!==b.locale.indexOf(G)&&
(-1!==b.locale.indexOf("-")?-1!==b.locale.indexOf(G+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0)}var I=this.isPortal?"./help/helpmap_enterprise.json":"./help/helpmap.json";A=H.toUrl(I);E({url:A}).then(r.hitch(this,function(K){this.onlineHelpMap=K.map}),function(K){console.error("Unable to load",I,K)});this._initSelfHelpMap()},_getAbsoluteUrl:function(A){var z=B.getProtocolForWebResource();if(/^https?:/i.test(A))return A;if(/^\/\//i.test(A))return z+A;if(/^\//i.test(A))return z+"//"+window.location.host+
A},_computeSize:function(A){var z={w:400,h:200};d("esri-mobile")?z={w:"50%",h:"90%"}:-1!==A.indexOf("Category")?(z.w=400,z.h=320):-1!==A.indexOf("Tool")?(z.w=400,z.h=320):-1!==A.indexOf("toolDescription")&&(z.w=400,z.h=520);return z},_initSelfHelpMap:function(){this.isPortal&&this.portalSelf&&this.portalSelf.helpMap&&(this.selfHelpMap=this.portalSelf.helpMap.m)},_setHelpTopicAttr:function(A){this.tooltipHelpDlg&&(t.close(this.tooltipHelpDlg),this.tooltipHelpDlg.destroy(),this.tooltipHelpDlg=null);
var z="";this.showLearnMore=!1;var G=this._analysisGpServer&&-1!==this._analysisGpServer.indexOf("dev")?"dev":this._analysisGpServer&&-1!==this._analysisGpServer.indexOf("qa")?"uat":"";z=this.isPortal?"-PortalOnly":"-OnlineOnly";var I=r.clone(b.locale);var K="es-es es-mx fr-fr fr-ch it-ch it-it de-de de-ch".split(" ");"nb"===I?I="no":-1!==k.indexOf(K,I)&&(I=I.split("-")[0]);var R="ar bg bs ca cs da de es el et fi fr he hr hu id it ja ko lt lv ru nl no pl pt-br pt-pt ro sl sk sv sr th tr uk vi zh-cn zh-hk zh-tw".split(" ");
var U="ar de es fr it ja ko ru pl pt-br zh-cn".split(" ");if("SHOWHELPURL"===A)K=this.helpIdUrl,this.showLearnMore=!1;else{K=H.toUrl("esri/dijit/analysis/help/"+this.helpFileName+".html");var ba=this.helpFileName;if(D.isDefined(this.onlineHelpMap)&&D.isDefined(this.onlineHelpMap[ba])&&D.isDefined(this.onlineHelpMap[ba][A])){this.showLearnMore=!0;var ca="https://doc"+G+".arcgis.com/en/arcgis-online/analyze/"+this.onlineHelpMap[ba][A];this.isPortal&&this.helpBase&&this.selfHelpMap&&(ca=this.helpBase+
this.selfHelpMap[this.onlineHelpMap[ba][A]])}-1!==k.indexOf(R,I)&&(-1!==I.indexOf("-")&&(I=I.split("-"),I=I[0]+"-"+I[1].toUpperCase()),K=H.toUrl("esri/dijit/analysis/help/"+I+"/"+this.helpFileName+".html"));-1!==k.indexOf(U,I)&&this.showLearnMore&&(ca="https://doc"+G+".arcgis.com/"+I+"/arcgis-online/analyze/"+this.onlineHelpMap[ba][A],this.isPortal&&this.helpBase&&this.selfHelpMap?ca=this.helpBase+this.selfHelpMap[this.onlineHelpMap[ba][A]]:this.isPortal&&!this.helpBase&&(ca="https://server"+G+".arcgis.com/"+
I+"/portal/latest/use/"+this.onlineHelpMap[ba][A]))}this._size=G=this._computeSize(A);this.tooltipHelpDlg=new u({preload:!0,content:"\x3cdiv class\x3d'' style\x3d'position:relative'\x3cdiv class\x3d'sizer content'\x3e\x3cdiv class\x3d'contentPane'\x3e\x3cdiv class\x3d'esriFloatTrailing' style\x3d'padding:0;'\x3e\x3ca href\x3d'#' class\x3d'esriAnalysisCloseIcon' title\x3d'"+this.i18n.close+"'\x3e\x3c/a\x3e\x3c/div\x3e\x3ciframe frameborder\x3d'0'  id\x3d'"+A+"' src\x3d'"+K+"#"+A+z+"' width\x3d'"+G.w+
"' height\x3d'"+G.h+"' marginheight\x3d'0' marginwidth\x3d'0'\x3e\x3c/iframe\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'actionsPane'\x3e\x3cdiv class\x3d'actionList"+(this.showLearnMore?"'\x3e":" hidden'\x3e")+"\x3ca class\x3d'action zoomTo' href\x3d'"+(this.showLearnMore?ca:"#")+"' target\x3d'_help'\x3e"+this.i18n.learnMore+"\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e","class":"esriHelpPopup esriHelpPopupWrapper esriAnalyisHelpWindow"});this.tooltipHelpDlg.startup()},
show:function(A,z){this.helpFileName=z.helpFileName;this._analysisGpServer=z.analysisGpServer;this.isPortal=z.isPortal;this.helpBase=z.helpBase;z.portalSelf&&(this.portalSelf=z.portalSelf);this.selfHelpMap||this._initSelfHelpMap();z.analysisMode&&(this.analysisMode=z.analysisMode);z.showHelpFromUrl&&z.helpUrl&&(this.showHelpFromUrl=z.showHelpFromUrl,this.helpIdUrl=z.helpUrl,z.helpId="SHOWHELPURL");this.set("helpTopic",z.helpId);var G=a.after(t,"open",r.hitch(this,function(){g(".esriAnalysisCloseIcon",
this.tooltipHelpDlg.domNode).on("click",r.hitch(this,this.close));G.remove()})),I=A.pageX,K=n.getBox(),R;var U=!1;if(z.helpParentNode)var ba=z.helpParentNode;ba&&(R=q.position(ba));R&&K.w-A.pageX<R.w?(U=!0,I=R.x-this._size.w-10,this._isRightToLeft&&(I-=10)):this._isRightToLeft&&I-40<this._size.w&&(I=R.w+this._size.w+80);t.open({popup:this.tooltipHelpDlg,x:!0===this._isRightToLeft||U?I-40:I+40,y:A.screenY-A.pageY+10,onCancel:r.hitch(this,function(){this.close()}),onExecute:function(){this.close()}});
this.tooltipHelpDlg.domNode.parentNode&&c.set(this.tooltipHelpDlg.domNode.parentNode,"overflowY","hidden")},close:function(A,z){t.close(this.tooltipHelpDlg)}});d("extend-esri")&&r.setObject("dijit.analysis.HelpWindow",p,y);return p})},"esri/dijit/BrowseItems":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/event dojo/dom-class dojo/dom-style dojo/dom-attr dojo/string dojo/on dojo/aspect dojo/has dojo/dom dojo/dom-construct dojo/mouse dojo/topic dojo/query dojo/parser dijit/registry dijit/TooltipDialog dijit/popup dojo/promise/all dojo/Deferred dgrid/Grid dgrid/extensions/Pagination dgrid/extensions/DijitRegistry dgrid/OnDemandGrid dgrid/Selection dgrid/selector dgrid/Keyboard dgrid/util/mouse dgrid/util/touch put-selector/put dojo/store/Observable dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../arcgis/Portal ../Evented ../PluginTarget dojo/i18n!../nls/jsapi ./_AppTemplateFiltersMixin ./_RefreshMixin ../kernel ../lang ../config ../geometry/webMercatorUtils ../tasks/GeometryService ../SpatialReference dojo/NodeList-dom".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x,w,A,z,G,I,K,R,U,ba,ca,da,ja,ea,L,O,S,T,J,N,C,P,Q,Y,fa,na){var la=H(null,{idProperty:"id",constructor:function(W){H.safeMixin(this,W)},get:function(W,aa){return L.PortalUtil.request(this.portalUrl+"content/items/"+W,aa).then(function(oa){return new L.PortalItem(k.mixin(oa,{portal:this.portal}))})},getIdentity:function(W){return W[this.idProperty]},query:function(W,aa){W=k.isObject(W)?W:{q:W};var oa=null;if(aa){W=k.mixin(W,{num:aa.count,start:(aa.start||
0)+1});if(aa.sort&&aa.sort.length){var ha=aa.sort[0];W=k.mixin(W,{sortField:encodeURIComponent("created"===ha.attribute?"uploaded":ha.attribute),sortOrder:ha.descending?"desc":"asc"})}aa.useExtent&&aa.extent&&(W.bbox=aa.extent);aa.queryType&&"group"===aa.queryType&&(oa="group")}aa="group"===oa?this.portal.queryGroups(W,!0).then(function(pa){pa.results.total=pa.total;return pa.results}):this.portal.queryItems(W,!0).then(function(pa){pa.results.total=pa.total;return pa.results});return L.PortalResult(aa)}});
r=H([da,ja,ea,S],{templateString:'\x3cdiv\x3e\x3cdiv class\x3d"top-bar"\x3e\x3cdiv  class\x3d"esriFloatLeading instructions"\x3e\x3cspan class\x3d"messageLeft hide" data-dojo-attach-point\x3d"messageNodeLeft"\x3e\x3c/span\x3e\x3cspan class\x3d"messageRight hide" data-dojo-attach-point\x3d"messageNodeRight"\x3e\x3c/span\x3e\x3ca tabIndex\x3d"-1" data-dojo-attach-point\x3d"helpLink" class\x3d"esriHelpIcon hide" title\x3d"${i18n.browseItems.learnMoreConfigurableApps}" href\x3d"#" target\x3d"_blank"\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d"${id}_search"class\x3d"searchBar esriFloatTrailing"\x3e\x3cinput tabIndex\x3d"1" placeholder\x3d"${i18n.browseItems.searchTitle}" class\x3d"esriSearchBox dijitTextBox" type\x3d"search"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"gallery"\x3e\x3cdiv class\x3d"gallery-left  quiet-scroll"\x3e\x3cul class\x3d"filters"\x3e\x3c/ul\x3e\x3c/div\x3e\x3cdiv class\x3d"templates gallery-right"\x3e\x3cp id\x3d"${id}_filterTitle" class\x3d"filter-title hide" data-dojo-attach-point\x3d"filterDescription"\x3e\x3c/p\x3e\x3cdiv id\x3d"${id}_grid"class\x3d"dgrid-autoheight quiet-scroll"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv  class\x3d"loaderWrap" data-dojo-attach-point\x3d"loaderWrap"\x3e\x3c/div\x3e\x3cdiv  class\x3d"js-info-panel templateInfoPanel" data-dojo-attach-point\x3d"infoPanel"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
galleryTemplate:"\x3cdiv style\x3d'opacity:1;' class\x3d'grid-item gallery-view'\x3e${item:_formatThumbnail}${item:_formatItemTitle}\x3cp class\x3d\"template-overlay\" style\x3d\"display:none;\"\x3e${i18n.browseItems.selectDetails}\x3c/p\x3e\x3c/div\x3e",infoPanelTemplate:'\x3cdiv\x3e\x3cdiv class\x3d"template-info-showing"\x3e\x3cdiv class\x3d"thumbnail"\x3e\x3cimg src\x3d"${item:_formatInfoPanelImage}"\x3e\x3c/div\x3e\x3ch4\x3e${item.title}\x3c/h4\x3e\x3cdiv class\x3d"template-info"\x3e\x3cp class\x3d"quiet-scroll"\x3e${item.snippet}\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-actions"\x3e\x3cbutton class\x3d"btn blue btn-main" id\x3d"on-next"\x3e${i18n.browseItems.configure}\x3c/button\x3e\x3cbutton class\x3d"btn btn-cancel" id\x3d"close-panel"\x3e${i18n.common.close}\x3c/button\x3e\x3c/div\x3e\x3cdiv\x3e',
_popupTemplate:'\x3cdiv class\x3d"esriBrowsePopup quiet-scroll"\x3e\x3cp\x3e{summary}\x3c/p\x3e\x3c/div\x3e',showInfoPanel:!0,isAutoClose:!0,showTooltip:!1,filterWithinGroup:!0,checkIsButtonEnabled:!1,baseClass:"esriBrowseItemsCtr",i18n:T,postMixInProperties:function(){this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.self?(this._portal=new L.Portal({url:this.portalUrl,self:this.self}),this._init(),this._portal.on("load",k.hitch(this,function(){this.emit("portal-load",
{portal:this._portal});this._fetchData()}))):(this._portal=new L.Portal(this.portalUrl),this._portal.signIn().then(k.hitch(this,function(){this.emit("portal-load",{portal:this._portal});this._init();this._fetchData()})))},_init:function(){this._canSearchPublic=this.self?this.self.canSearchPublic:this._portal.canSearchPublic;this.query=k.mixin(this.query||{},{get:function(W){return this[W]&&this[W].length?"("+this[W].join(" OR ")+") ":""},toString:function(){return{q:this.get("groups")+this.get("tags")+
this.get("persistentTypekeywords")+this.get("typekeywords")+this.get("types")+this.get("owners")+this.get("orgids")+this.get("custom")+(this.query||"")+(this.search||"")+' -type:"Attachment" -tags:"mature support"'}}});this.self?this.self.canSearchPublic=!0:this._portal.canSearchPublic=!0;this.galleryTemplate=this.plugIn&&this.plugIn.galleryTemplate||this.galleryTemplate;this.infoPanelTemplate=this.plugIn&&this.plugIn.infoPanelTemplate||this.infoPanelTemplate;if(this.helpLinkUrl=this.plugIn&&this.plugIn.helpLinkUrl||
"")a.set(this.helpLink,"href",this.helpLinkUrl),l.remove(this.helpLink,"hide");v(".templates",this.domNode).addClass("fade");v(".dgrid-footer",this.domNode).addClass("hide");b.set(this.infoPanel,"display","none")},destroy:function(){this.inherited(arguments);this._grid&&this._grid.destroy();this._img_connect&&(this._img_connect.remove(),this._img_connect_error.remove());this._queryTimer&&clearTimeout(this._queryTimer);this._grid=this._portal=null},closeInfoPanel:function(){c.byId("close-panel").click()},
_setItemQueryAttr:function(W){this.itemQuery=W},_setPluginAttr:function(W){this.addPlugin(W)},_setMessageAttr:function(W){this.set("messageRight",W)},_setMessageRightAttr:function(W){"string"===typeof W?a.set(this.messageNodeRight,"innerHTML",W):W instanceof HTMLElement&&g.place(W,this.messageNodeRight);l.remove(this.messageNodeRight,"hide")},_setMessageLeftAttr:function(W){"string"===typeof W?a.set(this.messageNodeLeft,"innerHTML",W):W instanceof HTMLElement&&g.place(W,this.messageNodeLeft);l.remove(this.messageNodeLeft,
"hide")},_setDisabledAttr:function(W){var aa=t.findWidgets(this.domNode).concat(t.findWidgets(this._content));p.forEach(aa,function(oa){oa.set("disabled",W)});l[W?"add":"remove"](this._interval.domNode,"dijitTextBoxDisabled")},_setSortAttr:function(W){this.sortAttribute=W},_setSortDescendingAttr:function(W){this.sortDescending=W},_getSelectionAttr:function(){var W=this._grid.selection,aa;for(aa in W)if(W.hasOwnProperty(aa))break;return aa&&this._grid.row(aa).data},_setGalleryTemplateAttr:function(W){P.isDefined(W)&&
(this.galleryTemplate=W)},_setFormatThumbnailAttr:function(W){P.isDefined(W)&&"function"===typeof W&&(this._formatThumbnail=W)},_setFormatItemTitleAttr:function(W){P.isDefined(W)&&"function"===typeof W&&(this._formatItemTitle=W)},_setRowsPerPageAttr:function(W){this._set("rowsPerPage",W)},_setPagingLinksAttr:function(W){this._set("pagingLinks",W)},_getQueryAttr:function(){return this.query},_setQueryAttr:function(W){this._set("query",W);this._grid&&this._grid.set("query",W.toString())},_setExtentAttr:function(W){W&&
this._set("extent",this._extentToString(W))},_setUseExtentAttr:function(W){this._set("useExtent",W)},_setQueryTypeAttr:function(W){this._set("queryType",W)},_setFetchTimeoutAttr:function(W){this._set("fetchTimeout",W)},_setShowInfoPanelAttr:function(W){this._set("showInfoPanel",W)},_setSelectionModeAttr:function(W){-1===p.indexOf(["extended","toggle","multiple","single","none"],W)&&(console.log("Incorrect Value provided for selectionMode. It is one of the following: extended, toggle, multiple, single, none"),
W="single");this._set("selectionMode",W)},_setDemandListAttr:function(W){this._set("demandList",W)},_validate:function(){return!!this.get("selection")},reset:function(){v(".esriSearchBox",c.byId(this.id+"_search")).forEach(function(pa){a.set(pa,"value","")});this.query.search="";if(this.plugIn.filters){var W=[],aa=[],oa=[],ha=[];v("li.active",this.domNode).forEach(function(pa){l.remove(pa,"active");var F=this.plugIn.filters[pa.childNodes[0].id];pa=p.map(F.tags,function(X){return'tags:"'+X+'"'},this);
var M=p.map(F.owners,function(X){return'owner:"'+X+'"'},this),Z=p.map(F.orgids,function(X){return'orgid:"'+X+'"'},this);F=p.map(F.typekeywords,function(X){return'typekeywords:"'+X+'"'},this);W.push(pa);oa.push(M);ha.push(Z);aa.push(F)},this);this.query.tags=p.filter(this.query.tags,function(pa){return-1!==p.indexOf(W,pa)});this.query.owners=p.filter(this.query.owners,function(pa){return-1!==p.indexOf(oa,pa)});this.query.orgids=p.filter(this.query.orgids,function(pa){return-1!==p.indexOf(ha,pa)});
this.query.typekeywords=p.filter(this.query.typekeywords,function(pa){return-1!==p.indexOf(aa,pa)});c.byId("all").click()}},_showPopup:function(W){if(!this._isInsideTooltipDialog){this._closePopup();var aa=this._grid.row(W);W=v("img",aa.element)[0];if(aa={summary:aa.data.snippet},aa.summary)this._tooltip=new y({content:k.replace(this._popupTemplate,aa),onMouseEnter:k.hitch(this,function(){this._isInsideTooltipDialog=!0}),onMouseLeave:k.hitch(this,function(){this._isInsideTooltipDialog=!1;this._closePopup()})}),
D.open({className:"esriBrowsePopupCtr",popup:this._tooltip,around:W,orient:["after-centered","before-centered"]}),this._onCloseConnect=v(".dijitDialogCloseIcon",this._tooltip.domNode).on("click",k.hitch(this,function(oa){oa.preventDefault();this._closePopup()}))}},_closePopup:function(){this._tooltip&&(this._onCloseConnect&&this._onCloseConnect.remove(),D.close(this._tooltip),this._tooltip.destroyRecursive(),this._tooltip=this._onCloseConnect=void 0)},_clearQueryTimeout:function(){clearTimeout(this._queryTimer);
this._queryTimer=null},_clearClosePanelTimeout:function(){clearTimeout(this._panelClosing);this._panelClosing=null;p.forEach(this._panelClickHandles,"item.remove();");g.empty(this.infoPanel)},_createGrid:function(){var W=H([x,w,G,N,A]),aa=new ca(new la({portal:this._portal})),oa=this.query,ha=k.hitch(this,function(M){M.snippet=M.snippet||"";var Z=ba("div");M=d.substitute(this.galleryTemplate,{item:M,i18n:this.i18n},null,this);g.place(M,Z);return Z}),pa={};this.get("demandList")&&(W=H([x,z,G,N,A]));
this.get("useExtent")&&(pa.extent=this.get("extent"),pa.useExtent=this.get("useExtent"));this.get("queryType")&&(pa.queryType=this.get("queryType"));var F={store:aa,query:oa.toString(),selectionMode:this.selectionMode||"single",pagingLinks:this.get("pagingLinks")||2,rowsPerPage:this.plugIn&&this.plugIn.rowsPerPage||this.get("itemsPerPage")||6,loadingMessage:"Loading items...",showLoadingMessage:!1,renderRow:ha,noDataMessage:this.i18n.gallery.noItemsToDisplay,deselectOnRefresh:!("multiple"===this.selectionMode||
"extended"===this.selectionMode||"toggle"===this.selectionMode),sort:[{attribute:this.sortAttribute||"title",descending:this.sortDescending||!1}],queryOptions:pa};this.get("demandList")&&(F={store:aa,query:oa.toString(),minRowsPerPage:this.plugIn&&this.plugIn.rowsPerPage||this.get("itemsPerPage")||50,selectionMode:this.selectionMode||"single",loadingMessage:"Loading items...",showLoadingMessage:!1,renderRow:ha,pagingMethod:"throttleDelayed",noDataMessage:this.i18n.gallery.noItemsToDisplay,deselectOnRefresh:!("multiple"===
this.selectionMode||"extended"===this.selectionMode||"toggle"===this.selectionMode),sort:[{attribute:this.sortAttribute||"title",descending:this.sortDescending||!1}],queryOptions:pa});this._grid=new W(F,this.id+"_grid");this._grid.startup();this.own(f(this.domNode,"click",k.hitch(this,function(M){c.byId("close-panel")&&this.isAutoClose&&c.byId("close-panel").click()})),this._grid.on(R.enterRow,k.hitch(this,function(M){!1===l.contains(this.domNode,"showing")&&this.showInfoPanel&&this._showOverlay(!0,
M);this.showTooltip&&!this.showInfoPanel&&this._showPopup(M)})),this._grid.on(R.leaveRow,k.hitch(this,function(M){this._showOverlay(!1,M);this.showTooltip&&!this.showInfoPanel&&this._closePopup(M)})),this._grid.on(".dgrid-row:click",k.hitch(this,function(M){this.emit("grid-row-click",M);if(!1===l.contains(this.domNode,"showing")&&this.showInfoPanel){M.preventDefault();m.stop(M);this._clearClosePanelTimeout();var Z=this.get("selection");this._showOverlay(!1,M);this.showInfoPanel&&this.infoPanelTemplate?
(b.set(this.infoPanel,"display","block"),g.place(d.substitute(this.infoPanelTemplate,{item:Z,i18n:this.i18n},function(X){return P.isDefined(X)?X:""},this),this.infoPanel)):b.set(this.infoPanel,"display","none");this.emit("show-info-panel");l.add(this.domNode,"showing");this._panelClickHandles=[v(".template-info-showing .thumbnail img",this.domNode).on("error",k.hitch(this,function(X){a.set(X.target,"src",Z.thumbnailUrl)})),v(".panel-actions .btn").on("click",k.hitch(this,function(X){X.preventDefault();
m.stop(X);this.checkIsButtonEnabled&&l.contains(X.target,"disabled")||("close-panel"===X.target.id?(l.remove(this.domNode,"showing"),b.set(this.infoPanel,"display","none"),this._panelClosing=setTimeout(k.hitch(this,function(){p.forEach(void 0,"item.remove();");g.empty(this.infoPanel)},250))):(q.publish("/esri/browseitems/close",X.target.id,this.get("selection")),X={selection:this.get("selection"),action:X.target.id},this.emit("browseitems-close",X)))})),v(".js-info-panel",this.domNode).on("click",
k.hitch(this,function(X){this.isAutoClose&&(X.preventDefault(),m.stop(X))})),f(v(".dgrid-footer,.dgrid-header",this._grid.domNode),n.leave,k.hitch(this,function(X){this.showTooltip&&!this.showInfoPanel&&this._closePopup()}))]}})),this._grid.on("dgrid-refresh-complete",k.hitch(this,function(M){v(".templates",this.domNode).removeClass("fade");v(".loaderWrap",this.domNode).addClass("hide");v(".dgrid-footer",this.domNode)[this._grid._total<=this._grid.rowsPerPage?"addClass":"removeClass"]("hide");this.showTooltip&&
!this.showInfoPanel&&this._closePopup()})),this._grid.on("refresh",k.hitch(this,function(){this.showTooltip&&!this.showInfoPanel&&this._closePopup();this._img_connect&&(this._img_connect.remove(),this._img_connect_error.remove(),this._img_connect_error=this._img_connect=null);this._img_connect=v(".grid-item-thumb",this._grid.domNode).on("load",k.hitch(this,function(M){(M=this._grid.row(M))&&M.element&&v(".grid-item",M.element).addClass("fadeIn").style("opacity","1")}));this._img_connect_error=v(".grid-item-thumb",
this._grid.domNode).on("error",k.hitch(this,function(M){a.set(M.target,"src",this._portal.staticImagesUrl+"/desktopapp.png")}))})),f(c.byId(this.id+"_search"),"keyup",k.hitch(this,function(M){M.preventDefault();this._clearQueryTimeout();this._queryTimer=setTimeout(k.hitch(this,function(){this.query.search=a.get(M.target,"value");this._fetchItems(this.query).then(k.hitch(this,function(){this._clearQueryTimeout()}))}),this.searchKeypressDelay||450)})),f(c.byId(this.id+"_search"),"search",k.hitch(this,
function(M){this._queryTimer||(M.preventDefault(),this.query.search=a.get(M.target,"value"),this._fetchItems(this.query))})),this.watch("extent",k.hitch(this,function(M,Z,X){this._grid.queryOptions.extent=this.get("extent");this._grid.queryOptions.useExtent=this.get("useExtent");this._grid.query.bbox=this._grid.queryOptions.useExtent?this._grid.queryOptions.extent:"";this._grid.refresh()})),this.watch("useExtent",k.hitch(this,function(M,Z,X){this._grid.queryOptions.extent=this.get("extent");this._grid.queryOptions.useExtent=
X;this._grid.query.bbox=this._grid.queryOptions.useExtent?this._grid.queryOptions.extent:"";this._grid.refresh()})));this.showInfoPanel||("single"===this._grid.selectionMode?this.own(this._grid.on("dgrid-select,dgrid-deselect",k.hitch(this,function(M){M={selection:this.get("selection")};this.emit("select-change",M)}))):-1!==p.indexOf(["toggle","multiple","extended"],this._grid.selectionMode)&&this.own(this._grid.on("dgrid-select,dgrid-deselect",k.hitch(this,function(M){M=M.grid.selection;var Z,X=
[];for(Z in M)M[Z]&&X.push(this._grid.row(Z).data);this.emit("select-change",{selection:X})}))));this.emit("grid-ready",{grid:this._grid,ready:!0})},_createFilters:function(){if(this.plugIn&&this.plugIn.filters){var W=this.plugIn.filters,aa=this.plugIn.filterStrings,oa,ha=v(".filters",this.domNode)[0];for(oa in W)g.create("li",{"class":"all"===oa?"active":"",innerHTML:"\x3ca id\x3d'"+oa+"'  href\x3d'#'\x3e"+aa[oa].title+"\x3c/a\x3e"},ha);this.own(f(ha,"li a:click",k.hitch(this,function(pa){pa.preventDefault();
var F=pa.target;v(".active",ha).removeClass("active");l.add(F.parentNode,"active");v(".templates",this.domNode).addClass("fade");setTimeout(k.hitch(this,function(){l["all"===F.id?"add":"remove"](this.filterDescription,"hide");a.set(this.filterDescription,"innerHTML",aa[F.id].description||"")}),225);pa=k.mixin({},W[F.id]||{});this.query.tags=p.map(pa.tags||[],function(M){return'tags:"'+M+'"'});this.query.owners=p.map(pa.owners,function(M){return'owner:"'+M+'"'});this.query.orgids=p.map(pa.orgids,function(M){return'orgid:"'+
M+'"'});this.query.typekeywords=[].concat(p.map(pa.typekeywords||[],function(M){return'typekeywords:"'+M+'"'}));this.filterWithinGroup||(this.query.groups=p.map(pa.groups,function(M){return'group:"'+M+'"'}));this._fetchItems(this.query)})));l.add(this.domNode,"filters");l.remove(this.domNode,"nofilters")}else l.add(this.domNode,"nofilters"+(this.plugIn&&this.plugIn.extraClasses?" "+this.plugIn.extraClasses.join(" "):"")),l.remove(this.domNode,"filters")},_showOverlay:function(W,aa){(aa=this._grid.row(aa))&&
v(".template-overlay",aa.element).style("display",W?"":"none")},_fetchData:function(){this._user=this._portal.getPortalUser();return this.plugIn&&this.plugIn.fetchData?this.plugIn.fetchData():this._fetchItems(this.itemQuery)},_fetchItems:function(W,aa){var oa={sort:[{attribute:this.sortAttribute||"title",descending:this.sortDescending||!1}]},ha=new E;this.get("useExtent")&&(oa.extent=this.get("extent"),oa.useExtent=this.get("useExtent"));this.get("queryType")&&(oa.queryType=this.get("queryType"));
v(".templates",this.domNode).addClass("fade");v(".dgrid-footer",this.domNode).addClass("hide");v(".loaderWrap",this.domNode).removeClass("hide");setTimeout(k.hitch(this,function(){this.query=k.mixin(this.query,W);this._grid?this._grid.set("query",this.query.toString(),oa):(this._createFilters(),this._createGrid());ha.resolve(this._grid)}),60);return ha},_formatThumbnail:function(W){var aa=W.thumbnailUrl||this._portal.staticImagesUrl+"/desktopapp.png";W.thumbnailUrl=aa;return"\x3cimg class\x3d'grid-item-thumb' width\x3d'187px' height\x3d'125px' alt\x3d'' src\x3d'"+
aa+"'\x3e"},_formatInfoPanelImage:function(W){var aa=W.screenshots&&W.screenshots.length?W.screenshots[0]:null;return aa?W.itemUrl+"/info/"+aa:W.thumbnailUrl},_formatItemTitle:function(W){return"\x3ch5\x3e"+(W.title||W.name||"\x3cNo Title\x3e")+"\x3c/h5\x3e"},clear:function(){this._grid.clearSelection()},doProject:function(W,aa){var oa=[102113,102100,3857],ha=new E;var pa=function(M,Z){!(M&&0<M.length&&M[0]&&"extent"==M[0].type)||isNaN(M[0].xmin)||isNaN(M[0].ymin)||isNaN(M[0].xmax)||isNaN(M[0].ymax)?
M&&0<M.length&&M[0]&&"point"==M[0].type&&!isNaN(M[0].x)&&!isNaN(M[0].y)&&ha.resolve(M,Z):ha.resolve(M,Z)};if(null!=W.spatialReference.wkid&&4326==W.spatialReference.wkid&&null!=aa.wkid&&this.contains(oa,aa.wkid)){W.ymin=Math.max(W.ymin,-89.99);W.ymax=Math.min(W.ymax,89.99);W=Y.geographicToWebMercator(W);if((oa=W.spatialReference._getInfo())&&W.xmin>W.xmax){pa=oa.valid[1]-W.xmin;var F=W.xmax-oa.valid[0];pa>F?W.xmax=oa.valid[1]+F:W.xmin=oa.valid[0]-pa}W.spatialReference.wkid=aa.wkid;ha.resolve([W])}else null!=
W.spatialReference.wkid&&this.contains(oa,W.spatialReference.wkid)&&null!=aa.wkid&&4326==aa.wkid?(W=Y.webMercatorToGeographic(W),(oa=W.spatialReference._getInfo())&&W.xmin>W.xmax&&(pa=oa.valid[1]-W.xmin,F=W.xmax-oa.valid[0],pa>F?W.xmax=oa.valid[1]+F:W.xmin=oa.valid[0]-pa),ha.resolve([W])):(this.geometryService||(this.geometryService=new fa(Q.defaults.geometryService)),this.geometryService.project([W],aa,pa));return ha},contains:function(W,aa){for(var oa=W.length;oa--;)if(W[oa]===aa)return!0;return!1},
_extentToGCS:function(W){W=W.shiftCentralMeridian(!0);return Y.webMercatorToGeographic(W)},_extentToString:function(W){var aa="";null!=W&&(W=this._extentToGCS(W),aa=this._roundValue(W.xmin,1E4)+","+this._roundValue(W.ymin,1E4)+","+this._roundValue(W.xmax,1E4)+","+this._roundValue(W.ymax,1E4));return aa},_roundValue:function(W,aa){return Math.round(W*aa)/aa}});h("extend-esri")&&k.setObject("dijit.BrowseItems",r,C);return r})},"dgrid/extensions/Pagination":function(){define("../_StoreMixin dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/Deferred dojo/on dojo/query dojo/string dojo/has put-selector/put ../util/misc dojo/i18n!./nls/pagination dojo/_base/sniff xstyle/css!../css/extensions/Pagination.css".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h){function c(n){n.noDataNode?(f(n.noDataNode,"!"),delete n.noDataNode):n.cleanup();n.contentNode.innerHTML=""}function g(n){if(n.loadingNode)f(n.loadingNode,"!"),delete n.loadingNode;else if(n._oldPageNodes){for(var q in n._oldPageNodes)n.removeRow(n._oldPageNodes[q]);delete n._oldPageNodes;n._oldPageObserver&&(n._oldPageObserver.cancel(),n._numObservers--,delete n._oldPageObserver)}delete n._isLoading}return k("dgrid.extensions.Pagination",H,{rowsPerPage:10,pagingTextBox:!1,
previousNextArrows:!0,firstLastArrows:!1,pagingLinks:2,pageSizeOptions:null,showLoadingMessage:!0,i18nPagination:h,showFooter:!0,_currentPage:1,_total:0,buildRendering:function(){this.inherited(arguments);var n=this,q=this.paginationNode=f(this.footerNode,"div.dgrid-pagination"),v=this.paginationStatusNode=f(q,"div.dgrid-status"),u=this.i18nPagination;v.tabIndex=0;this._updatePaginationSizeSelect();this._updateRowsPerPageOption();v.innerHTML=a.substitute(u.status,{start:1,end:1,total:0});q=this.paginationNavigationNode=
f(q,"div.dgrid-navigation");this.firstLastArrows&&(v=this.paginationFirstNode=f(q,"span.dgrid-first.dgrid-page-link","\u00ab"),v.setAttribute("aria-label",u.gotoFirst),v.tabIndex=0);this.previousNextArrows&&(v=this.paginationPreviousNode=f(q,"span.dgrid-previous.dgrid-page-link","\u2039"),v.setAttribute("aria-label",u.gotoPrev),v.tabIndex=0);this.paginationLinksNode=f(q,"span.dgrid-pagination-links");this.previousNextArrows&&(v=this.paginationNextNode=f(q,"span.dgrid-next.dgrid-page-link","\u203a"),
v.setAttribute("aria-label",u.gotoNext),v.tabIndex=0);this.firstLastArrows&&(v=this.paginationLastNode=f(q,"span.dgrid-last.dgrid-page-link","\u00bb"),v.setAttribute("aria-label",u.gotoLast),v.tabIndex=0);this._listeners.push(l(q,".dgrid-page-link:click,.dgrid-page-link:keydown",function(t){if("keydown"!==t.type||13===t.keyCode)if(t=this.className,!(n._isLoading||-1<t.indexOf("dgrid-page-disabled"))){var y=n._currentPage;var D=Math.ceil(n._total/n.rowsPerPage);this===n.paginationPreviousNode?n.gotoPage(y-
1):this===n.paginationNextNode?n.gotoPage(y+1):this===n.paginationFirstNode?n.gotoPage(1):this===n.paginationLastNode?n.gotoPage(D):"dgrid-page-link"===t&&n.gotoPage(+this.innerHTML)}}))},destroy:function(){this.inherited(arguments);this._pagingTextBoxHandle&&this._pagingTextBoxHandle.remove()},_updatePaginationSizeSelect:function(){var n=this.pageSizeOptions,q=this.paginationSizeSelect;if(n&&n.length){if(!q){q=this.paginationSizeSelect=f(this.paginationNode,"select.dgrid-page-size[aria-label\x3d"+
this.i18nPagination.rowsPerPage+"]");var v=this._paginationSizeChangeHandle=l(q,"change",r.hitch(this,function(){this.set("rowsPerPage",+this.paginationSizeSelect.value)}));this._listeners.push(v)}for(v=q.options.length=0;v<n.length;v++)f(q,"option",n[v],{value:n[v],selected:this.rowsPerPage===n[v]});this._updateRowsPerPageOption()}else n&&n.length||!q||(f(q,"!"),this.paginationSizeSelect=null,this._paginationSizeChangeHandle.remove())},_setPageSizeOptions:function(n){this.pageSizeOptions=n&&n.sort(function(q,
v){return q-v});this._updatePaginationSizeSelect()},_updateRowsPerPageOption:function(){var n=this.rowsPerPage,q=this.pageSizeOptions,v=this.paginationSizeSelect;v&&(0>p.indexOf(q,n)?this._setPageSizeOptions(q.concat([n])):v.value=""+n)},_setRowsPerPage:function(n){this.rowsPerPage=n;this._updateRowsPerPageOption();this.gotoPage(1)},_updateNavigation:function(){function n(G,I){if(v.pagingTextBox&&G==y&&1<E)I=f(t,"input.dgrid-page-input[type\x3dtext][value\x3d$]",y),I.setAttribute("aria-label",u.jumpPage),
v._pagingTextBoxHandle=l(I,"change",function(){var R=+this.value;!isNaN(R)&&0<R&&R<=E&&v.gotoPage(+this.value)}),w&&"INPUT"===w.tagName&&I.focus();else{var K=G===y;I=f(t,"span"+(K?".dgrid-page-disabled":"")+".dgrid-page-link",G+(I?" ":""));I.setAttribute("aria-label",u.gotoPage);I.tabIndex=K?-1:0;A===G&&(K?G<E?A++:z.focus():I.focus());K||(z=I)}}function q(G,I){f(G,(I?".":"!")+"dgrid-page-disabled");G.tabIndex=I?-1:0}var v=this,u=this.i18nPagination,t=this.paginationLinksNode,y=this._currentPage,D=
this.pagingLinks,B=this.paginationNavigationNode,E=Math.ceil(this._total/this.rowsPerPage),x=this._pagingTextBoxHandle,w=document.activeElement,A,z;w&&e.contains(this.paginationNavigationNode,w)?"dgrid-page-link"===w.className&&(A=+w.innerHTML):w=null;x&&x.remove();t.innerHTML="";b(".dgrid-first, .dgrid-previous",B).forEach(function(G){q(G,1===y)});b(".dgrid-last, .dgrid-next",B).forEach(function(G){q(G,y>=E)});if(D&&0<E){n(1,!0);B=y-D;for(2<B?f(t,"span.dgrid-page-skip","..."):B=2;B<Math.min(y+D+
1,E);B++)n(B,!0);y+D+1<E&&f(t,"span.dgrid-page-skip","...");1<E&&n(E)}else v.pagingTextBox&&n(y);w&&-1===w.tabIndex&&(D=b("[tabindex\x3d'0']",this.paginationNavigationNode),w===this.paginationPreviousNode||w===this.paginationFirstNode?w=D[0]:D.length&&(w=D[D.length-1]),w&&w.focus())},refresh:function(){var n=this;this.inherited(arguments);if(this.store)return this.gotoPage(1).then(function(q){setTimeout(function(){l.emit(n.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:n,results:q})},
0);return q});console.warn("Pagination requires a store to operate.")},_onNotification:function(n){n.length!==this._rowsOnPage&&this.gotoPage(this._currentPage)},renderArray:function(n,q){var v=this,u=this.inherited(arguments);this._lastCollection=null;q||(this._topLevelRequest&&this._topLevelRequest!==n&&(this._topLevelRequest.cancel(),delete this._topLevelRequest),"function"===typeof n.cancel&&(this._topLevelRequest=n),m.when(n,function(){v._topLevelRequest&&delete v._topLevelRequest}));return u},
insertRow:function(){var n=this._oldPageNodes,q=this.inherited(arguments);n&&q===n[q.id]&&delete n[q.id];return q},gotoPage:function(n){var q=this,v=new m;this._trackError(function(){var u=q.rowsPerPage,t=(n-1)*u,y=r.mixin(q.get("queryOptions"),{start:t,count:u}),D=q.contentNode,B;if(q.showLoadingMessage){c(q);var E=q.loadingNode=f(D,"div.dgrid-loading");E.innerHTML=q.loadingMessage}else{q._oldPageNodes=E={};D=D.children;var x=0;for(B=D.length;x<B;x++)E[D[x].id]=D[x];q._oldPageObserver=q.observers.pop()}q._isLoading=
!0;var w=q.store.query(q.query,y);m.when(q.renderArray(w,null,y),function(A){g(q);q.scrollTo({y:0});m.when(w.total,function(z){z||(q.noDataNode&&(f(q.noDataNode,"!"),delete q.noDataNode),q.noDataNode=f(q.contentNode,"div.dgrid-no-data"),q.noDataNode.innerHTML=q.noDataMessage);q.paginationStatusNode.innerHTML=a.substitute(q.i18nPagination.status,{start:Math.min(t+1,z),end:Math.min(z,t+u),total:z});q._total=z;q._currentPage=n;q._rowsOnPage=A.length;q._updateNavigation()});(7>d("ie")||d("ie")&&d("quirks"))&&
q.resize();v.resolve(w)},function(A){g(q);v.reject(A)});return v.promise})||v.reject();return v.promise}})})},"dgrid/extensions/DijitRegistry":function(){define(["dojo/_base/declare","dojo/dom-geometry","dijit/registry"],function(H,k,p){return H("dgrid.extensions.DijitRegistry",null,{minSize:0,maxSize:Infinity,layoutPriority:0,showTitle:!0,buildRendering:function(){p.add(this);this.inherited(arguments);this.domNode.setAttribute("widgetId",this.id)},startup:function(){if(!this._started){this.inherited(arguments);
var r=p.getEnclosingWidget(this.domNode.parentNode);r&&r.isLayoutContainer&&this._resizeHandle.remove()}},destroyRecursive:function(){this.destroy()},destroy:function(){this.inherited(arguments);p.remove(this.id)},getChildren:function(){return[]},isLeftToRight:function(){return!this.isRTL},resize:function(r){r&&k.setMarginBox(this.domNode,r);this.inherited(arguments)},_set:function(r,m){this[r]=m},watch:function(){},getParent:function(){return p.getEnclosingWidget(this.domNode.parentNode)}})})},"dgrid/selector":function(){define("dojo/_base/kernel dojo/_base/array dojo/_base/lang dojo/on dojo/aspect dojo/_base/sniff put-selector/put".split(" "),
function(H,k,p,r,m,l,b){p.getObject("dgrid.selector",!0);return dgrid.selector=function(a,d){function f(u){return!n.allowSelect(n.row(u))}function e(u){return function(t){var y=t.rows,D=y.length;t="false";var B;for(B=0;B<D;B++){var E=n.cell(y[B],a.id).element;E&&(E=(E.contents||E).input)&&!E.disabled&&(E.checked=u,E.setAttribute("aria-checked",u))}if("checkbox"==q.type){y=n.selection;D=!1;for(B in y)if(y[B]!=n.allSelected){D=!0;break}q.indeterminate=D;q.checked=n.allSelected;D?t="mixed":n.allSelected&&
(t="true");q.setAttribute("aria-checked",t)}}}function h(u){if("click"==u.type||32==u.keyCode||!l("opera")&&13==u.keyCode||0===u.keyCode){var t=n.row(u);n._selectionTriggerEvent=u;if(t){if(n.allowSelect(t)){var y=n._lastSelected&&n.row(n._lastSelected);"radio"==d?y&&y.id==t.id||(n.clearSelection(),n.select(t,null,!0),n._lastSelected=t.element):t&&(u.shiftKey?e(!0)({rows:[t]}):y=null,y=u.shiftKey?y:null,n.select(y||t,t,y?void 0:null),n._lastSelected=t.element)}}else b(this,(n.allSelected?"!":".")+
"dgrid-select-all"),n[n.allSelected?"clearSelection":"selectAll"]();n._selectionTriggerEvent=null}}function c(){n._hasSelectorInputListener=!0;g.push(n.on(".dgrid-selector:click,.dgrid-selector:keydown",h));var u=n._handleSelect;n._handleSelect=function(D){this.cell(D).column!=a&&u.apply(this,arguments)};if("function"==typeof a.disabled){var t=n.allowSelect,y=a.disabled;n.allowSelect=function(D){var B=t.call(this,D);return y===f?B:B&&!y.call(a,D.data)}}a.disabled=f;g.push(n.on("dgrid-select",e(!0)));
g.push(n.on("dgrid-deselect",e(!1)))}var g=[],n,q;a||(a={});a.type&&(a.selectorType=a.type,H.deprecated("columndef.type","use columndef.selectorType instead","dgrid 0.4"));a.selectorType=d=d||a.selectorType||"checkbox";a.sortable=!1;var v="function"==typeof d?d:function(u,t,y){var D=t.parentNode;n._hasSelectorInputListener||c();var B=a.disabled;b(D&&D.contents?D:t,".dgrid-selector");t=t.input||(t.input=b(t,"input[type\x3d"+d+"]",{tabIndex:isNaN(a.tabIndex)?-1:a.tabIndex,disabled:B&&("function"==typeof B?
B.call(a,y):B),checked:u}));t.setAttribute("aria-checked",!!u);return t};m.after(a,"init",function(){n=a.grid});m.after(a,"destroy",function(){k.forEach(g,function(u){u.remove()});n._hasSelectorInputListener=!1});a.renderCell=function(u,t,y,D,B){t=(t=u&&n.row(u))&&n.selection[t.id];v(t,y,u)};a.renderHeaderCell=function(u){var t="label"in a?a.label:a.field||"";"radio"!=d&&n.allowSelectAll?v(!1,u,{}):(u.appendChild(document.createTextNode(t)),n._hasSelectorInputListener||c());q=u.lastChild};return a}})},
"dgrid/Keyboard":function(){define("dojo/_base/declare dojo/aspect dojo/on dojo/_base/lang dojo/has put-selector/put ./util/misc dojo/_base/Deferred dojo/_base/sniff".split(" "),function(H,k,p,r,m,l,b,a){function d(w){w.preventDefault()}var f={checkbox:1,radio:1,button:1},e=/\bdgrid-cell\b/,h=/\bdgrid-row\b/,c=H("dgrid.Keyboard",null,{pageSkip:10,tabIndex:0,keyMap:null,headerKeyMap:null,postMixInProperties:function(){this.inherited(arguments);this.keyMap||(this.keyMap=r.mixin({},c.defaultKeyMap));
this.headerKeyMap||(this.headerKeyMap=r.mixin({},c.defaultHeaderKeyMap))},postCreate:function(){function w(G){var I=G.target;return I.type&&(!f[I.type]||32==G.keyCode)}function A(G){function I(){z._focusedHeaderNode&&(z._focusedHeaderNode.tabIndex=-1);if(z.showHeader){if(K)for(var ca=0,da,ja=z.headerNode.getElementsByTagName("th");da=ja[ca];++ca){if(R.test(da.className)){z._focusedHeaderNode=ba=da;break}}else z._focusedHeaderNode=ba=z.headerNode;ba&&(ba.tabIndex=z.tabIndex)}}var K=z.cellNavigation,
R=K?e:h,U=G===z.headerNode,ba=G;U?(I(),k.after(z,"renderHeader",I,!0)):k.after(z,"renderArray",function(ca){return a.when(ca,function(da){var ja=z._focusedNode||ba;if(R.test(ja.className)&&b.contains(G,ja))return da;for(var ea=0,L=G.getElementsByTagName("*"),O;O=L[ea];++ea)if(R.test(O.className)){ja=z._focusedNode=O;break}ja.tabIndex=z.tabIndex;return da})});z._listeners.push(p(G,"mousedown",function(ca){w(ca)||z._focusOnNode(ca.target,U,ca)}));z._listeners.push(p(G,"keydown",function(ca){if(!ca.metaKey&&
!ca.altKey){var da=z[U?"headerKeyMap":"keyMap"][ca.keyCode];da&&!w(ca)&&da.call(z,ca)}}))}this.inherited(arguments);var z=this;this.tabableHeader&&(A(this.headerNode),this._listeners.push(p(this.headerNode,"dgrid-cellfocusin",function(){z.scrollTo({x:this.scrollLeft})})));A(this.contentNode);this._debouncedEnsureScroll=b.debounce(this._ensureScroll,this)},removeRow:function(w){if(!this._focusedNode)return this.inherited(arguments);var A=this,z=document.activeElement===this._focusedNode,G=this[this.cellNavigation?
"cell":"row"](this._focusedNode),I=G.row||G,K;w=w.element||w;w===I.element&&((K=this.down(I,!0))&&K.element!==w||(K=this.up(I,!0)),this._removedFocus={active:z,rowId:I.id,columnId:G.column&&G.column.id,siblingId:K&&K.element!==w?K.id:void 0},setTimeout(function(){A._removedFocus&&A._restoreFocus(I.id)},0),this._focusedNode=null);this.inherited(arguments)},insertRow:function(w){var A=this.inherited(arguments);this._removedFocus&&!this._removedFocus.wait&&this._restoreFocus(A);return A},_restoreFocus:function(w){var A=
this._removedFocus,z;if((w=(w=w&&this.row(w))&&w.element&&w.id===A.rowId?w:"undefined"!==typeof A.siblingId&&this.row(A.siblingId))&&w.element){if(!w.element.parentNode.parentNode){A.wait=!0;return}"undefined"!==typeof A.columnId&&(z=this.cell(w,A.columnId))&&z.element&&(w=z);A.active&&0!==w.element.offsetHeight?this._focusOnNode(w,!1,null):(l(w.element,".dgrid-focus"),w.element.tabIndex=this.tabIndex,this._focusedNode=w.element)}delete this._removedFocus},addKeyHandler:function(w,A,z){return k.after(this[z?
"headerKeyMap":"keyMap"],w,A,!0)},_ensureRowScroll:function(w){var A=this.getScrollPosition().y;A>w.offsetTop?this.scrollTo({y:w.offsetTop}):A+this.contentNode.offsetHeight<w.offsetTop+w.offsetHeight&&this.scrollTo({y:w.offsetTop-this.contentNode.offsetHeight+w.offsetHeight})},_ensureColumnScroll:function(w){var A=this.getScrollPosition().x,z=w.offsetLeft;if(A>z)this.scrollTo({x:z});else{var G=this.bodyNode.clientWidth;w=w.offsetWidth;var I=z+w;A+G<I&&this.scrollTo({x:G>w?I-G:z})}},_ensureScroll:function(w,
A){this.cellNavigation&&(this.columnSets||1<this.subRows.length)&&!A&&this._ensureRowScroll(w.row.element);this.bodyNode.clientWidth<this.contentNode.offsetWidth&&this._ensureColumnScroll(w.element)},_focusOnNode:function(w,A,z){var G="_focused"+(A?"Header":"")+"Node",I=this[G],K=this.cellNavigation?"cell":"row",R=this[K](w),U;if(w=R&&R.element){if(this.cellNavigation){var ba=w.getElementsByTagName("input");var ca=0;for(U=ba.length;ca<U;ca++){var da=ba[ca];if((-1!=da.tabIndex||"_dgridLastValue"in
da)&&!da.disabled){8>m("ie")&&(da.style.position="relative");da.focus();8>m("ie")&&(da.style.position="");var ja=!0;break}}}null!==z&&(z=r.mixin({grid:this},z),z.type&&(z.parentType=z.type),z.bubbles||(z.bubbles=!0));I&&(l(I,"!dgrid-focus[!tabIndex]"),8>m("ie")&&(I.style.position=""),z&&(z[K]=this[K](I),p.emit(I,"dgrid-cellfocusout",z)));I=this[G]=w;z&&(z[K]=R);G=this.cellNavigation?e:h;!ja&&G.test(w.className)&&(8>m("ie")&&(w.style.position="relative"),w.tabIndex=this.tabIndex,w.focus());l(w,".dgrid-focus");
z&&p.emit(I,"dgrid-cellfocusin",z);this._debouncedEnsureScroll(R,A)}},focusHeader:function(w){this._focusOnNode(w||this._focusedHeaderNode,!0)},focus:function(w){(w=w||this._focusedNode)?this._focusOnNode(w,!1):this.contentNode.focus()}}),g=c.moveFocusVertical=function(w,A){if(this._focusOnNode&&w.target!==this.contentNode){var z=this.cellNavigation,G=this[z?"cell":"row"](w);G=z&&G.column.id;A=this.down(this._focusedNode,A,!0);z&&(A=this.cell(A,G));this._focusOnNode(A,!1,w);w.preventDefault()}};H=
c.moveFocusUp=function(w){g.call(this,w,-1)};var n=c.moveFocusDown=function(w){g.call(this,w,1)},q=c.moveFocusPageUp=function(w){g.call(this,w,-this.pageSkip)},v=c.moveFocusPageDown=function(w){g.call(this,w,this.pageSkip)},u=c.moveFocusHorizontal=function(w,A){if(this.cellNavigation&&w.target!==this.contentNode){var z=!this.row(w);this._focusOnNode(this.right(this["_focused"+(z?"Header":"")+"Node"],A),z,w);w.preventDefault()}},t=c.moveFocusLeft=function(w){u.call(this,w,-1)},y=c.moveFocusRight=function(w){u.call(this,
w,1)},D=c.moveHeaderFocusEnd=function(w,A){if(this.cellNavigation){var z=this.headerNode.getElementsByTagName("th");this._focusOnNode(z[A?0:z.length-1],!0,w)}w.preventDefault()},B=c.moveHeaderFocusHome=function(w){D.call(this,w,!0)},E=c.moveFocusEnd=function(w,A){var z=this,G=this.cellNavigation,I=this.contentNode,K=I.scrollTop+(A?0:I.scrollHeight);I=I[A?"firstChild":"lastChild"];var R=-1<I.className.indexOf("dgrid-preload"),U=R?I[(A?"next":"previous")+"Sibling"]:I,ba=U.offsetTop+(A?0:U.offsetHeight);
if(R){for(;U&&0>U.className.indexOf("dgrid-row");)U=U[(A?"next":"previous")+"Sibling"];if(!U)return}if(!R||1>I.offsetHeight)G&&(U=this.cell(U,this.cell(w).column.id)),this._focusOnNode(U,!1,w);else{m("dom-addeventlistener")||(w=r.mixin({},w));var ca=k.after(this,"renderArray",function(da){ca.remove();return a.when(da,function(ja){ja=ja[A?0:ja.length-1];G&&(ja=z.cell(ja,z.cell(w).column.id));z._focusOnNode(ja,!1,w)})})}K===ba&&w.preventDefault()},x=c.moveFocusHome=function(w){E.call(this,w,!0)};c.defaultKeyMap=
{32:d,33:q,34:v,35:E,36:x,37:t,38:H,39:y,40:n};c.defaultHeaderKeyMap={32:d,35:D,36:B,37:t,39:y};return c})},"dgrid/util/mouse":function(){define(["dojo/_base/lang","dojo/on","dojo/dom","dojo/query"],function(H,k,p){function r(l,b){return function(a,d){return k(a,l+":"+b,function(f){if(!p.isDescendant(f.relatedTarget,this))return d.call(this,f)})}}var m={enterRow:r(".dgrid-content .dgrid-row","mouseover"),enterCell:r(".dgrid-content .dgrid-cell","mouseover"),enterHeaderCell:r(".dgrid-header .dgrid-cell",
"mouseover"),leaveRow:r(".dgrid-content .dgrid-row","mouseout"),leaveCell:r(".dgrid-content .dgrid-cell","mouseout"),leaveHeaderCell:r(".dgrid-header .dgrid-cell","mouseout"),createDelegatingHandler:r};H.getObject("dgrid.util.mouse",!0);H.mixin(dgrid.util.mouse,m);return m})},"dgrid/util/touch":function(){define(["dojo/on","dojo/query"],function(H,k){function p(m,l,b,a){if(!(1<b.targetTouches.length)){var d=b.changedTouches[0],f=d.screenX,e=d.screenY;a&&b.preventDefault();var h=H(m,"touchend",function(c){var g=
c.changedTouches[0];c.targetTouches.length||(Math.abs(g.screenX-f)<r.tapRadius&&Math.abs(g.screenY-e)<r.tapRadius&&(a&&c.preventDefault(),l.call(this,c)),h.remove())})}}var r={tapRadius:10,dbltapTime:250,selector:function(m,l,b){return function(a,d){var f=l.bubble;f?l=f:!1!==b&&(b=!0);return H(a,l,function(e){var h=e.target;3==h.nodeType&&(h=h.parentNode);for(;!k.matches(h,m,a);)if(h==a||!b||!(h=h.parentNode))return;return d.call(h,e)})}},countCurrentTouches:function(m,l){if(!("touches"in m))return-1;
var b,a,d;for(a=b=0;d=m.touches[b];++b)l.contains(d.target)&&++a;return a},tap:function(m,l){return H(m,"touchstart",function(b){p(m,l,b)})},dbltap:function(m,l){var b,a;return H(m,"touchstart",function(d){b?p(m,function(f){if(b){var e=f.changedTouches[0];Math.abs(e.screenX-b.screenX)<r.tapRadius&&Math.abs(e.screenY-b.screenY)<r.tapRadius&&(a&&clearTimeout(a),b=a=null,l.call(this,f))}},d,!0):p(m,function(f){b=f.changedTouches[0];a=setTimeout(function(){b=a=null},r.dbltapTime)},d)})}};return r})},
"esri/dijit/_AppTemplateFiltersMixin":function(){define(["dojo/_base/declare"],function(){return{rootNodes:{app:{all:{},narrate:{typekeywords:["story"]},collect:{typekeywords:["collect"]},compare:{typekeywords:["compare"]},"3dscene":{typekeywords:["3Dscene"]},analyze:{typekeywords:["summarize"]},present:{typekeywords:["gallery"]},social:{typekeywords:["social"]},local:{typekeywords:["local"]},route:{typekeywords:["route"]},showcase:{typekeywords:["showcase"]}}}}})},"esri/dijit/_RefreshMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/has ../kernel".split(" "),
function(H,k,p,r,m,l){function b(a){"object"!==typeof a&&(a=Error(a));a.grid=this;r.emit(this.domNode,"dgrid-error",{grid:this,error:a,cancelable:!0,bubbles:!0})&&console.error(a)}H=H(null,{_trackError:function(a){"string"===typeof a&&(a=k.hitch(this,a));try{var d=a()}catch(f){b.call(this,f)}return p.when(d,k.hitch(this,function(){r.emit(this.domNode,"refresh",{cancelable:!0,bubbles:!0})}),k.hitch(this,b))}});m("extend-esri")&&k.setObject("dijit._RefreshMixin",H,l);return H})},"esri/dijit/analysis/PluginAnalysisLayers":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/promise/all dojo/has ../../kernel dojo/i18n!../../nls/jsapi".split(" "),
function(H,k,p,r,m,l,b){var a=H(null,{filters:{all:{},categoryBoundaries:{tags:["boundaries","places"]},subCategoryBoundaries:{tags:["boundaries"]},subCategoryPlaces:{tags:["places"]},categoryHexBins:{tags:["hex"]},categoryTransportation:{tags:["transportation"]}},constructor:function(d){k.mixin(this,d);this.i18n=k.mixin({},b.browseLayersDlg);this.filterStrings={all:{title:this.i18n.categoryAll},categoryBoundaries:{title:this.i18n.categoryBoundaries},subCategoryBoundaries:{title:"\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;"+
this.i18n.subCategoryBoundaries},subCategoryPlaces:{title:"\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;"+this.i18n.subCategoryPlaces},categoryHexBins:{title:this.i18n.categoryHexBins},categoryTransportation:{title:this.i18n.categoryTransportation}}},fetchData:function(){this._portal=this.parent._portal;var d;return this._fetchGroups().then(k.hitch(this,function(f){d=p.map(f||[],function(e){if(e)return'group:"'+e.id+'"'});return this._fetchGroupItems(d)}))},_fetchGroup:function(d,f){this._groups=this._groups||
[];return this._groups[d]||this._portal.queryGroups(f,!0).then(k.hitch(this,function(e){0<e.total&&e.results&&(this._groups[d]=e.results);return this._groups[d]||[]}))},_fetchGroupItems:function(d,f){var e=this._isCustom?['-typekeywords:"Multilayer"']:['typekeywords:"Analysis Ready"'];this._portal&&this._portal.user&&this._portal.user.demographics||e.push('-typekeywords:"Requires Credits"');return this.parent._fetchItems({groups:d,query:f,types:['type:"Map Service"','type:"Feature Service"'],typekeywords:e})},
_fetchGroups:function(){return this._fetchEsriAnalysisLayers()},_fetchEsriAnalysisLayers:function(){if(this._portal&&this._portal.analysisLayersGroupQuery){var d=this._portal.analysisLayersGroupQuery;this._isCustomAnalysisQuery()&&(this.filterStrings=this.filters=null)}return this._fetchGroup("esriAnalysisLayers",{q:d,num:100,start:0}).then(k.hitch(this,function(f){f&&0<f.length&&(this.parent.sortAttribute=f[0].sortField,this.parent.sortDescending="asc"!==f[0].sortOrder);return f}))},_isCustomAnalysisQuery:function(){var d=
'title:"Living Atlas Analysis Layers" AND owner:esri',f=!1;this._portal&&this._portal.isPortal&&(d='title:"Living Atlas Analysis Layers" AND owner:esri_livingatlas');this._portal&&this._portal.analysisLayersGroupQuery&&this._portal.analysisLayersGroupQuery!==d&&(f=!0);return this._isCustom=f}});k.mixin(a,{add:function(d,f){d.plugIn||(f=f||{},f.parent=d,d.plugIn=new a(f))},remove:function(d){d.plugIn&&(d.plugIn.destroy(),delete d.plugIn)}});m("extend-esri")&&k.setObject("dijit.analysis.PluginAnalysisLayers",
a,l);return a})},"esri/dijit/SingleFilter":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/has dojo/json dojo/string dojo/number dojo/dom dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/_base/event dojo/Evented dojo/data/ItemFileWriteStore dojo/date/locale dojo/parser dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/TextBox dijit/form/FilteringSelect dijit/form/RadioButton dijit/form/DateTextBox dijit/form/NumberTextBox ../config ../kernel ../lang ../tasks/GenerateRendererTask ../tasks/UniqueValueDefinition ../tasks/GenerateRendererParameters ../layers/FeatureLayer ../layers/GeoRSSLayer ./analysis/ItemTypes dojo/i18n!../nls/jsapi dojo/text!./templates/SingleFilter.html".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x,w,A,z,G,I,K,R,U,ba,ca,da,ja,ea,L,O,S,T,J,N){H=k([B,E,x,w,A,u],{declaredClass:"esri.dijit.SingleFilter",widgetsInTemplate:!0,templateString:N,valueHandlers:[],onFieldChangeEnabled:!0,onOperatorChangeEnabled:!0,onPromptChangeHandler:null,onHintChangeHandler:null,fieldDomains:{},fieldsStore:null,fieldsInfo:{stringFieldsCount:0,numberFieldsCount:0,dateFieldsCount:0},stringOperatorStore:null,dateOperatorStore:null,numberOperatorStore:null,uniqueValuesStore:null,
isEnableInteractiveFilter:!0,uniqueValuesResults:{},partsObj:null,dayInMS:86399E3,allowAllDateTypes:!1,showUnique:!0,postMixInProperties:function(){this.inherited(arguments);this.i18n={};this.i18n=p.mixin(this.i18n,J.filterDlg)},parseExpressionTemplate:function(){var C=function(oa,ha){e.byId(ha).className="attributeValueContainer";"field_dropdown"===oa?e.byId(ha).innerHTML=P:"operator_dropdown"===oa?e.byId(ha).innerHTML=Q:"values_input"===oa?e.byId(ha).innerHTML=Y+fa:console.error("problem with expressionTemplate from localization file")},
P='\x3cselect id\x3d"'+this.id+'.fieldsList" class\x3d"attributeField" data-dojo-type\x3d"dijit/form/FilteringSelect" maxHeight\x3d"150" sortByLabel\x3d"true"\x3e\x3c/select\x3e',Q='\x3cselect id\x3d"'+this.id+'.operatorList" class\x3d"operator" data-dojo-type\x3d"dijit/form/FilteringSelect" maxHeight\x3d"150" sortByLabel\x3d"false"\x3e\x3c/select\x3e',Y='\x3cdiv id\x3d"'+this.id+'.attributeValueContainer"\x3e\x3c/div\x3e',fa='\x3cdiv class\x3d"attributeValueOptions"\x3e\x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e  \x3ctbody\x3e    \x3ctr\x3e      \x3ctd nowrap\x3d"nowrap"\x3e        \x3cinput id\x3d"'+
this.id+'.radioValue" class\x3d"radioValue attributeValueRadio" checked\x3d"checked" name\x3d"'+this.id+'.inputOption" data-dojo-type\x3d"dijit/form/RadioButton" title\x3d"'+this.i18n.valueTooltip+'"/\x3e        \x3clabel class\x3d"labels" title\x3d"'+this.i18n.valueTooltip+'"\x3e'+this.i18n.value+'        \x3c/label\x3e      \x3c/td\x3e      \x3ctd nowrap\x3d"nowrap" class\x3d"esriLeadingPadding05"\x3e        \x3cinput id\x3d"'+this.id+'.radioFields" class\x3d"radioFields attributeValueRadio" name\x3d"'+
this.id+'.inputOption" data-dojo-type\x3d"dijit/form/RadioButton" title\x3d"'+this.i18n.fieldTooltip+'"/\x3e        \x3clabel class\x3d"labels" title\x3d"'+this.i18n.fieldTooltip+'"\x3e'+this.i18n.field+'        \x3c/label\x3e      \x3c/td\x3e      \x3ctd id\x3d"'+this.id+'.radioUniqueColumn" nowrap\x3d"nowrap" class\x3d"esriLeadingPadding05"\x3e        \x3cinput id\x3d"'+this.id+'.radioUnique" class\x3d"radioUnique attributeValueRadio" name\x3d"'+this.id+'.inputOption" data-dojo-type\x3d"dijit/form/RadioButton" title\x3d"'+
this.i18n.uniqueValueTooltip+'"/\x3e        \x3clabel class\x3d"labels" title\x3d"'+this.i18n.uniqueValueTooltip+'"\x3e'+this.i18n.uniqueValues+"        \x3c/label\x3e      \x3c/td\x3e    \x3c/tr\x3e  \x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e",na=this.i18n.expressionTemplate,la=na.indexOf("${"),W=na.substring(0,la).trim();e.byId(this.id+".column1").innerHTML=W.length?"\x3cdiv class\x3d'attributeText'\x3e"+W+"\x3c/div\x3e":"";W=na.indexOf("}",la+1);var aa=na.substring(la+2,W);C(aa,this.id+".column2");
la=na.indexOf("${",la+1);W=na.substring(W+1,la).trim();e.byId(this.id+".column3").innerHTML=W.length?"\x3cdiv class\x3d'attributeText'\x3e"+W+"\x3c/div\x3e":"";W=na.indexOf("}",la+1);aa=na.substring(la+2,W);C(aa,this.id+".column4");la=na.indexOf("${",la+1);W=na.substring(W+1,la).trim();e.byId(this.id+".column5").innerHTML=W.length?"\x3cdiv class\x3d'attributeText'\x3e"+W+"\x3c/div\x3e":"";W=na.indexOf("}",la+1);aa=na.substring(la+2,W);C(aa,this.id+".column6");W=na.substring(W+1,na.length).trim();
e.byId(this.id+".column7").innerHTML=W.length?"\x3cdiv class\x3d'attributeText'\x3e"+W+"\x3c/div\x3e":""},postCreate:function(){this.inherited(arguments);this.parseExpressionTemplate();this.createOperatorStores();this.createFieldsStore(this.fields);this.readCodedValues();D.parse(e.byId(this.id+".exprTable")).then(p.hitch(this,function(C){m.connect(this.getFieldsList(),"onChange",this,"onChangeField");m.connect(this.getOperatorList(),"onChange",this,"onChangeOperator");m.connect(z.byId(this.id+".radioValue"),
"onClick",this,"showValueInput");m.connect(z.byId(this.id+".radioFields"),"onClick",this,"showFields");m.connect(z.byId(this.id+".radioUnique"),"onClick",this,"showUniqueList");this.version&&10.1>this.version&&this.mapLayer.url&&this.showUnique&&h.set(e.byId(this.id+".radioUniqueColumn"),"display","none");m.connect(e.byId(this.id+".deleteExpression"),"onclick",this,"onClickDeleteExpression");m.connect(this.interactiveCheck,"onclick",this,"onInteractiveClick");m.connect(this.interactiveArrow,"onclick",
this,"onClickShowHideInteractive");this.enableInteractiveHandlers();this.isEnableInteractiveFilter||h.set(this._interactiveFilterRow,"display","none");h.set(e.byId(this.id+".radioUniqueColumn"),"display",this.showUnique?"block":"none");this.own(this.watch("showUnique",p.hitch(this,function(P,Q,Y){h.set(e.byId(this.id+".radioUniqueColumn"),"display",Y?"block":"none")})))}))},constructor:function(C,P){this.id=C.id||"";this.owner=C.owner;this.version=C.version;this.part=C.part;this.fields=C.fields;this.mapLayer=
C.mapLayer;!1===C.enableEvents&&(this.onOperatorChangeEnabled=this.onFieldChangeEnabled=!1)},init:function(C){if(!C.part||this.mapLayer&&C.mapLayer&&this.mapLayer.id!==C.mapLayer.id)this.clearAttributeValueDijits(),this.mapLayer=C.mapLayer,this.version=C.version,this.fields=C.fields,this.createOperatorStores(),this.createFieldsStore(this.fields),this.readCodedValues(),this.fillFieldsList(this.fieldsStore),this.onChangeField();C.part&&(this.part=C.part,this.onOperatorChangeEnabled=this.onFieldChangeEnabled=
!1,this.buildEditUIField(this.part,this))},destroy:function(){this.onOperatorChangeEnabled=this.onFieldChangeEnabled=!1;this.clearAttributeValueDijits();r.forEach(z.findWidgets(e.byId(this.id)),function(C){C.destroyRecursive()});this.inherited(arguments)},toJson:function(){var C=null;this.isInteractiveChecked()&&(C={prompt:this.promptText.attr("value"),hint:this.hintText.attr("value")});return{fieldObj:this.getField(),operator:this.getOperator(),valueObj:this.getValue(),interactiveObj:C}},buildFriendlyTextExpr:function(C){var P=
this.i18n.expressionTemplate,Q=function(na,la,W){return d.substitute(P,{field_dropdown:na,operator_dropdown:la,values_input:W})};if(!1===C.valueObj.isValid)return"\x26lt;expression is missing value\x26gt;";var Y="";if("string"===C.fieldObj.shortType)C.operator===this.i18n.stringOperatorIsBlank||C.operator===this.i18n.stringOperatorIsNotBlank?Y=Q(C.fieldObj.label,C.operator,""):"field"===C.valueObj.type?Y=Q(C.fieldObj.label,C.operator,C.valueObj.label):(Y=this.getDecodedValue(C.interactiveObj?C.interactiveObj.value:
C.valueObj.value,C.fieldObj.name),Y=Q(C.fieldObj.label,C.operator,"'"+Y+"'"));else if("number"===C.fieldObj.shortType)if(C.operator===this.i18n.numberOperatorIsBetween||C.operator===this.i18n.numberOperatorIsNotBetween)Y=C.interactiveObj?C.interactiveObj.value2:C.valueObj.value2,Y=Q(C.fieldObj.label,C.operator,f.format(C.interactiveObj?C.interactiveObj.value1:C.valueObj.value1,{pattern:"#####0.##########"})+" "+this.i18n.andBetweenValues+" "+f.format(Y,{pattern:"#####0.##########"}));else if(C.operator===
this.i18n.numberOperatorIsBlank||C.operator===this.i18n.numberOperatorIsNotBlank)Y=Q(C.fieldObj.label,C.operator,"");else if("field"===C.valueObj.type)Y=Q(C.fieldObj.label,C.operator,C.valueObj.label);else{Y=C.interactiveObj?C.interactiveObj.value:C.valueObj.value;var fa=this.getDecodedValue(Y,C.fieldObj.name);Y=Q(C.fieldObj.label,C.operator,Y!==fa?"'"+fa+"'":f.format(Y,{pattern:"#####0.##########"}))}else da.isDefined(C.valueObj.value)&&"field"!==C.valueObj.type&&"string"===typeof C.valueObj.value&&
(C.valueObj.value=new Date(C.valueObj.value)),Y=C.operator===this.i18n.dateOperatorIsBetween||C.operator===this.i18n.dateOperatorIsNotBetween?Q(C.fieldObj.label,C.operator,(C.interactiveObj?this.formatFriendlyDate(C.interactiveObj.value1):this.formatFriendlyDate(C.valueObj.value1))+" "+this.i18n.andBetweenValues+" "+(C.interactiveObj?this.formatFriendlyDate(C.interactiveObj.value2):this.formatFriendlyDate(this.addDay(C.valueObj.value2)))):C.operator===this.i18n.dateOperatorIsBlank||C.operator===this.i18n.dateOperatorIsNotBlank?
Q(C.fieldObj.label,C.operator,""):"field"===C.valueObj.type?Q(C.fieldObj.label,C.operator,C.valueObj.label):Q(C.fieldObj.label,C.operator,C.interactiveObj?this.formatFriendlyDate(C.interactiveObj.value):this.formatFriendlyDate(C.valueObj.value));return Y},builtSingleFilterString:function(C,P){if(da.isDefined(C.valueObj.isValid)&&!C.valueObj.isValid)return{whereClause:null};var Q=C.valueObj.value,Y=C.valueObj.value1,fa=C.valueObj.value2,na=!1;if(C.interactiveObj){if(!C.interactiveObj.prompt||!C.interactiveObj.hint)return{whereClause:null};
da.isDefined(P)&&(na=!0,da.isDefined(C.valueObj.value)&&(Q="{"+P+"}"),da.isDefined(C.valueObj.value1)&&(Y="{"+P+"}"),da.isDefined(C.valueObj.value2)&&(fa="{"+(P+1)+"}"))}var la="",W=C.fieldObj.name;this.mapLayer&&this.mapLayer.url&&-1!==this.mapLayer.url.indexOf("BigDataCatalogServer")&&this.hasWhiteSpace(W)&&(W='"'+W+'"');if("string"===C.fieldObj.shortType)switch(P="",Q&&"field"!==C.valueObj.type&&this.isHostedService(this.mapLayer.url)&&this.containsNonLatinCharacter(Q)&&(P="N"),C.operator){case this.i18n.stringOperatorIs:la=
"field"===C.valueObj.type?W+" \x3d "+Q:W+" \x3d "+P+"'"+Q.replace(/'/g,"''")+"'";break;case this.i18n.stringOperatorIsNot:la="field"===C.valueObj.type?W+" \x3c\x3e "+Q:W+" \x3c\x3e "+P+"'"+Q.replace(/'/g,"''")+"'";break;case this.i18n.stringOperatorStartsWith:la=W+" LIKE "+P+"'"+Q.replace(/'/g,"''")+"%'";break;case this.i18n.stringOperatorEndsWith:la=W+" LIKE "+P+"'%"+Q.replace(/'/g,"''")+"'";break;case this.i18n.stringOperatorContains:la=W+" LIKE "+P+"'%"+Q.replace(/'/g,"''")+"%'";break;case this.i18n.stringOperatorDoesNotContain:la=
W+" NOT LIKE "+P+"'%"+Q.replace(/'/g,"''")+"%'";break;case this.i18n.stringOperatorIsBlank:la=W+" IS NULL";break;case this.i18n.stringOperatorIsNotBlank:la=W+" IS NOT NULL"}else if("number"===C.fieldObj.shortType)switch(C.operator){case this.i18n.numberOperatorIs:la=W+" \x3d "+Q;break;case this.i18n.numberOperatorIsNot:la=W+" \x3c\x3e "+Q;break;case this.i18n.numberOperatorIsAtLeast:la=W+" \x3e\x3d "+Q;break;case this.i18n.numberOperatorIsLessThan:la=W+" \x3c "+Q;break;case this.i18n.numberOperatorIsAtMost:la=
W+" \x3c\x3d "+Q;break;case this.i18n.numberOperatorIsGreaterThan:la=W+" \x3e "+Q;break;case this.i18n.numberOperatorIsBetween:la=W+" BETWEEN "+Y+" AND "+fa;break;case this.i18n.numberOperatorIsNotBetween:la=W+" NOT BETWEEN "+Y+" AND "+fa;break;case this.i18n.numberOperatorIsBlank:la=W+" IS NULL";break;case this.i18n.numberOperatorIsNotBlank:la=W+" IS NOT NULL"}else switch(da.isDefined(Q)&&"field"!==C.valueObj.type&&"string"===typeof Q&&(Q=this.parseFriendlyDate(Q)),C.operator){case this.i18n.dateOperatorIsOn:la=
"field"===C.valueObj.type?W+" \x3d "+Q:na?W+" BETWEEN "+(this.supportsStandardizedQuery?"timestamp ":"")+"'{"+P+"}' AND "+(this.supportsStandardizedQuery?"timestamp ":"")+"'{"+(P+1)+"}'":W+" BETWEEN "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(Q)+"' AND "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(this.addDay(Q))+"'";break;case this.i18n.dateOperatorIsNotOn:la="field"===C.valueObj.type?W+" \x3c\x3e "+Q:na?W+" NOT BETWEEN "+(this.supportsStandardizedQuery?
"timestamp ":"")+"'{"+P+"}' AND "+(this.supportsStandardizedQuery?"timestamp ":"")+"'{"+(P+1)+"}'":W+" NOT BETWEEN "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(Q)+"' AND "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(this.addDay(Q))+"'";break;case this.i18n.dateOperatorIsBefore:la="field"===C.valueObj.type?W+" \x3c "+Q:W+" \x3c "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(Q)+"'";break;case this.i18n.dateOperatorIsAfter:la=
"field"===C.valueObj.type?W+" \x3e "+Q:W+" \x3e "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(this.addDay(Q))+"'";break;case this.i18n.dateOperatorIsBetween:la=na?W+" BETWEEN '"+Y+"' AND '"+fa+"'":W+" BETWEEN "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(Y)+"' AND "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(this.addDay(fa))+"'";break;case this.i18n.dateOperatorIsNotBetween:la=na?W+" NOT BETWEEN '"+Y+"' AND '"+fa+"'":W+" NOT BETWEEN "+
(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(Y)+"' AND "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(this.addDay(fa))+"'";break;case this.i18n.dateOperatorIsBlank:la=W+" IS NULL";break;case this.i18n.dateOperatorIsNotBlank:la=W+" IS NOT NULL"}return{whereClause:la}},showDeleteIcon:function(){h.set(e.byId(this.id+".deleteExpression"),"display","block")},hideDeleteIcon:function(){h.set(e.byId(this.id+".deleteExpression"),"display","none")},createFieldsStore:function(C){if(C&&
C.length){C=p.clone(C);C=C.sort(function(Q,Y){Q.label=Q.alias||Q.name;Y.label=Y.alias||Y.name;return Q.label<Y.label?-1:Q.label>Y.label?1:0});var P=this.isHostedService(this.mapLayer.url);this.supportsStandardizedQuery=10.2<=this.mapLayer.version&&(this.mapLayer.useStandardizedQueries||this.isBigDataLayer(this.mapLayer));C=r.filter(C,function(Q,Y){return"esriFieldTypeString"===Q.type||"esriFieldTypeDouble"===Q.type||"esriFieldTypeSingle"===Q.type||"esriFieldTypeInteger"===Q.type||"esriFieldTypeSmallInteger"===
Q.type||"esriFieldTypeDate"===Q.type&&(this.allowAllDateTypes||P||this.supportsStandardizedQuery)?!0:!1},this);C=r.map(C,function(Q,Y){switch(Q.type){case "esriFieldTypeString":var fa="string";this.fieldsInfo.stringFieldsCount++;break;case "esriFieldTypeDate":fa="date";this.fieldsInfo.dateFieldsCount++;break;default:fa="number",this.fieldsInfo.numberFieldsCount++}return{id:Y,label:Q.label,shortType:fa,alias:Q.alias,editable:Q.editable,name:Q.name,nullable:Q.nullable,type:Q.type}},this);C.length&&
(this.fieldsStore=new t({data:{identifier:"id",label:"label",items:C}}))}},createOperatorStores:function(){var C=[];C.push({name:this.i18n.stringOperatorIs,name_:this.i18n.stringOperatorIs,id:0});C.push({name:this.i18n.stringOperatorIsNot,name_:this.i18n.stringOperatorIsNot,id:1});C.push({name:this.i18n.stringOperatorStartsWith,name_:this.i18n.stringOperatorStartsWith,id:2});C.push({name:this.i18n.stringOperatorEndsWith,name_:this.i18n.stringOperatorEndsWith,id:3});C.push({name:this.i18n.stringOperatorContains,
name_:this.i18n.stringOperatorContains,id:4});C.push({name:this.i18n.stringOperatorDoesNotContain,name_:this.i18n.stringOperatorDoesNotContain,id:5});C.push({name:this.i18n.stringOperatorIsBlank,name_:this.i18n.stringOperatorIsBlank,id:6});C.push({name:this.i18n.stringOperatorIsNotBlank,name_:this.i18n.stringOperatorIsNotBlank,id:7});this.stringOperatorStore=new t({data:{label:"name",identifier:"id",items:C}});C=[];C.push({name:this.i18n.dateOperatorIsOn,id:0});C.push({name:this.i18n.dateOperatorIsNotOn,
id:1});C.push({name:this.i18n.dateOperatorIsBefore,id:2});C.push({name:this.i18n.dateOperatorIsAfter,id:3});C.push({name:this.i18n.dateOperatorIsBetween,id:6});C.push({name:this.i18n.dateOperatorIsNotBetween,id:7});C.push({name:this.i18n.dateOperatorIsBlank,id:8});C.push({name:this.i18n.dateOperatorIsNotBlank,id:9});this.dateOperatorStore=new t({data:{label:"name",identifier:"id",items:C}});C=[];C.push({name:this.i18n.numberOperatorIs,name_:this.i18n.numberOperatorIs,id:0});C.push({name:this.i18n.numberOperatorIsNot,
name_:this.i18n.numberOperatorIsNot,id:1});C.push({name:this.i18n.numberOperatorIsAtLeast,name_:this.i18n.numberOperatorIsAtLeast,id:2});C.push({name:this.i18n.numberOperatorIsLessThan,name_:this.i18n.numberOperatorIsLessThan,id:3});C.push({name:this.i18n.numberOperatorIsAtMost,name_:this.i18n.numberOperatorIsAtMost,id:4});C.push({name:this.i18n.numberOperatorIsGreaterThan,name_:this.i18n.numberOperatorIsGreaterThan,id:5});C.push({name:this.i18n.numberOperatorIsBetween,name_:this.i18n.numberOperatorIsBetween,
id:6});C.push({name:this.i18n.numberOperatorIsNotBetween,name_:this.i18n.numberOperatorIsNotBetween,id:7});C.push({name:this.i18n.numberOperatorIsBlank,name_:this.i18n.numberOperatorIsBlank,id:8});C.push({name:this.i18n.numberOperatorIsNotBlank,name_:this.i18n.numberOperatorIsNotBlank,id:9});this.numberOperatorStore=new t({data:{label:"name",identifier:"id",items:C}})},readCodedValues:function(){r.forEach(this.mapLayer.fields,function(C){C.domain&&C.domain.codedValues&&(this.fieldDomains[C.name]=
C.domain.codedValues)},this)},getDecodedValue:function(C,P){P=this.getCodedValues(P);var Q;if(P)for(Q=0;Q<P.length;Q+=1){var Y=P[Q];if(Y.code===C)return Y.name}return C},getCodedValues:function(C){return this.fieldDomains[C]},getFieldsList:function(){return z.byId(this.id+".fieldsList")},getOperatorList:function(){return z.byId(this.id+".operatorList")},getValueFieldsList:function(){return z.byId(this.id+".valueFields")},getAttrValContNode:function(){return e.byId(this.id+".attributeValueContainer")},
getField:function(){var C=this.getFieldsList();return{name:C.store.getValue(C.item,"name"),label:C.store.getValue(C.item,"label"),shortType:C.store.getValue(C.item,"shortType"),type:C.store.getValue(C.item,"type")}},getOperator:function(){var C=this.getOperatorList();return C.item?C.store.getValue(C.item,"name"):""},getValue:function(){return{}},isInteractiveChecked:function(){return this.interactiveCheck.checked},setInteractiveSection:function(C,P,Q){this.disableInteractiveHandlers();this.interactiveCheck.checked=
C;this.promptText.attr("value",P);this.hintText.attr("value",Q);h.set(this.interactiveSpace,"display","block");this.interactiveArrow.innerHTML="\x26nbsp;\x26#9650;";this.enableInteractiveHandlers()},enableInteractiveHandlers:function(){this.onPromptChangeHandler=m.connect(this.promptText,"onChange",this,"onChangeInteractive");this.onHintchangeHandler=m.connect(this.hintText,"onChange",this,"onChangeInteractive")},disableInteractiveHandlers:function(){m.disconnect(this.onPromptChangeHandler);m.disconnect(this.onHintChangeHandler)},
fillFieldsList:function(C){var P=this.getFieldsList();P.set("labelAttr","label");P.set("searchAttr","label");P.set("store",C);P.set("value",0)},fillOperatorList:function(C,P,Q){var Y=this.getOperatorList();Y.set("labelAttr","name");Y.set("searchAttr","name");Y.set("query",Q?Q:{});Y.set("store",C);if(P){var fa=!1;for(Q=0;20>Q&&(C.fetchItemByIdentity({identity:Q,onItem:p.hitch(this,function(na){na&&na.name[0]===P&&(Y.set("value",na.id[0]),fa=!0)})}),!fa);Q++);}else Y.set("value",0)},createValueString:function(C){var P=
this.getAttrValContNode();this.clearAttributeValueDijits();g.empty(P);if(C){P=new I({id:this.id+".value","class":"attributeValue",maxHeight:150,sortByLabel:!0},g.create("div",{},P));var Q=this.buildCodedValuesStore(C);P.set("store",Q);P.set("value",0);this.valueHandlers.push(m.connect(P,"onChange",this,"onValueChange"))}else P=new G({id:this.id+".value","class":"attributeValue",required:!0,placeHolder:"",intermediateChanges:!0},g.create("div",{},P)),this.valueHandlers.push(m.connect(P,"onChange",
this,"onValueChange"));this.checkDefaultOption();this.getValue=function(){var Y=z.byId(this.id+".value"),fa=!0;C?Y.item?Y=Y.item.code[0]:(Y="",fa=!1):fa=Y=Y.get("value");return{value:Y,isValid:fa}}},createValueDate:function(){var C=this.getAttrValContNode();this.clearAttributeValueDijits();g.empty(C);C=new R({id:this.id+".value","class":"attributeValue",trim:!0,required:!0,placeHolder:"",constraints:{formatLength:"short"}},g.create("div",{},C));this.checkDefaultOption();this.valueHandlers.push(m.connect(C,
"onChange",this,"onValueChange"));this.getValue=function(){var P=z.byId(this.id+".value").get("value");return{value:P,isValid:da.isDefined(P)}}},createValueNumber:function(C){var P=this.getAttrValContNode();this.clearAttributeValueDijits();g.empty(P);if(C){P=new I({id:this.id+".value","class":"attributeValue",maxHeight:150,sortByLabel:!0},g.create("div",{},P));var Q=this.buildCodedValuesStore(C);P.set("store",Q);P.set("value",0);this.valueHandlers.push(m.connect(P,"onChange",this,"onValueChange"))}else P=
new U({id:this.id+".value","class":"attributeValue",required:!0,placeHolder:"",intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},g.create("div",{},P)),this.valueHandlers.push(m.connect(P,"onChange",this,"onValueChange"));this.checkDefaultOption();this.getValue=function(){var Y=z.byId(this.id+".value"),fa=!0;C?Y.item?Y=Y.item.code[0]:(Y="",fa=!1):(Y=Y.get("value"),fa=da.isDefined(Y)&&!isNaN(Y));return{value:Y,isValid:fa}}},createValueBetweenDate:function(){var C=this.getAttrValContNode();
this.clearAttributeValueDijits();g.empty(C);var P=new R({id:this.id+".value1","class":"attributeValue1",trim:!0,required:!0,placeHolder:"",constraints:{formatLength:"short"}},g.create("div",{},C));g.create("span",{innerHTML:this.i18n.andBetweenValues,"class":"attributeBetweenValues"},C);C=new R({id:this.id+".value2","class":"attributeValue2",trim:!0,required:!0,placeHolder:"",constraints:{formatLength:"short"}},g.create("div",{},C));this.checkDefaultOption();this.valueHandlers.push(m.connect(P,"onChange",
this,"onValueChange"));this.valueHandlers.push(m.connect(C,"onChange",this,"onValueChange"));this.getValue=function(){var Q=z.byId(this.id+".value1").get("value"),Y=z.byId(this.id+".value2").get("value");return{value1:Q,value2:Y,isValid:da.isDefined(Q)&&da.isDefined(Y)}}},createValueBetweenNumber:function(){var C=this.getAttrValContNode();this.clearAttributeValueDijits();g.empty(C);var P=new U({id:this.id+".value1","class":"attributeValue1",required:!0,placeHolder:"",intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},
g.create("div",{},C));g.create("span",{innerHTML:this.i18n.andBetweenValues,"class":"attributeBetweenValues"},C);C=new U({id:this.id+".value2","class":"attributeValue2",required:!0,placeHolder:"",intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},g.create("div",{},C));this.checkDefaultOption();this.valueHandlers.push(m.connect(P,"onChange",this,"onValueChange"));this.valueHandlers.push(m.connect(C,"onChange",this,"onValueChange"));this.getValue=function(){var Q=z.byId(this.id+".value1").get("value"),
Y=z.byId(this.id+".value2").get("value");return{value1:Q,value2:Y,isValid:da.isDefined(Q)&&da.isDefined(Y)&&!isNaN(Q)&&!isNaN(Y)&&Q<=Y}}},createValueInTheLastDate:function(){},createValueIsBlank:function(){var C=this.getAttrValContNode();this.clearAttributeValueDijits();g.empty(C);C.innerHTML="\x3cinput id\x3d'"+this.id+".value' class\x3d'attributeValue' type\x3d'text' disabled\x3d'true'/\x3e";this.checkDefaultOption();this.getValue=function(){return{value:null,isValid:!0}}},createValueFields:function(C,
P,Q){var Y=this.getAttrValContNode();this.clearAttributeValueDijits();g.empty(Y);var fa=new I({id:this.id+".valueFields","class":"attributeValue",maxHeight:150,labelAttr:"label",searchAttr:"label",store:C,query:P},g.create("div",{},Y));if(Q){var na=!1;for(Y=0;100>Y&&(C.fetchItemByIdentity({identity:Y,onItem:p.hitch(this,function(la){la&&la.shortType[0]===P.shortType&&la.name[0]!==Q&&(fa.set("value",la.id),na=!0)})}),!na);Y++);}this.valueHandlers.push(m.connect(fa,"onChange",this,"onValueChange"));
this.getValue=function(){var la=z.byId(this.id+".valueFields");return{value:la.store.getValue(la.item,"name"),label:la.store.getValue(la.item,"label"),type:"field",isValid:!0}}},createValueUnique:function(C){var P=this.getAttrValContNode();this.clearAttributeValueDijits();g.empty(P);C=new I({id:this.id+".valueUnique","class":"attributeValue",maxHeight:150,store:C},g.create("div",{},P));C.set("value",0);this.valueHandlers.push(m.connect(C,"onChange",this,"onValueChange"));this.getValue=function(){var Q=
z.byId(this.id+".valueUnique");return{value:Q.store.getValue(Q.item,"value"),isValid:!0}}},setValue:function(C,P){if(P)for(var Q=0;Q<P.length;Q++){if(C===P[Q].code){z.byId(this.id+".value").set("value",Q);break}}else"date"===this.part.fieldObj.shortType?z.byId(this.id+".value").set("value",new Date(C)):("number"===this.part.fieldObj.shortType&&(C=Number(C)),z.byId(this.id+".value").set("value",C))},setValue1:function(C){"date"===this.part.fieldObj.shortType?C=new Date(C):"number"===this.part.fieldObj.shortType&&
(C=Number(C));z.byId(this.id+".value1").set("value",C)},setValue2:function(C){"date"===this.part.fieldObj.shortType?C=new Date(C):"number"===this.part.fieldObj.shortType&&(C=Number(C));z.byId(this.id+".value2").set("value",C)},setValueFieldById:function(C){this.getValueFieldsList().set("value",C)},enableOnFieldChange:function(){this.onFieldChangeEnabled=!0},enableOnOperatorChange:function(){this.onOperatorChangeEnabled=!0},onChangeField:function(C){this.onFieldChangeEnabled&&this._onChangeField(this.getFieldsList(),
this)},onChangeOperator:function(C){this.onOperatorChangeEnabled&&this._onChangeOperator(this.getOperatorList(),this)},onClickDeleteExpression:function(C){this._deleteExpression(this)},_onChangeField:function(C,P,Q){var Y=!!this.mapLayer&&this.isPortalHostedService(this.mapLayer.url);this.isBigDataLayer(this.mapLayer)||Y&&"esriFieldTypeDate"===this.fieldsStore.getValue(C.item,"type")?h.set(e.byId(this.id+".radioUniqueColumn"),"display","none"):h.set(e.byId(this.id+".radioUniqueColumn"),"display",
"");Y=P.getOperatorList();switch(this.fieldsStore.getValue(C.item,"type")){case "esriFieldTypeString":var fa=null;C=this.fieldsStore.getValue(C.item,"name");this.getCodedValues(C)&&(fa=this.i18n.stringOperatorStartsWith,fa+="|"+this.i18n.stringOperatorEndsWith,fa+="|"+this.i18n.stringOperatorContains,fa+="|"+this.i18n.stringOperatorDoesNotContain,fa={name_:new RegExp("^(?!("+fa+")$)")});Y.attr("value")===this.i18n.stringOperatorIs?(P.fillOperatorList(this.stringOperatorStore,this.i18n.stringOperatorIs,
fa),this.onChangeOperator(Y,P,Q)):P.fillOperatorList(this.stringOperatorStore,this.i18n.stringOperatorIs,fa);P.createValueString(this.getCodedValues(C));break;case "esriFieldTypeDate":P.fillOperatorList(this.dateOperatorStore,this.i18n.dateOperatorIsOn);P.createValueDate();break;default:fa=null,C=this.fieldsStore.getValue(C.item,"name"),this.getCodedValues(C)&&(fa=this.i18n.numberOperatorIsBetween,fa+="|"+this.i18n.numberOperatorIsNotBetween,fa+="|"+this.i18n.numberOperatorIsAtLeast,fa+="|"+this.i18n.numberOperatorIsLessThan,
fa+="|"+this.i18n.numberOperatorIsAtMost,fa+="|"+this.i18n.numberOperatorIsGreaterThan,fa={name_:new RegExp("^(?!("+fa+")$)")}),Y.attr("value")===this.i18n.numberOperatorIs?(P.fillOperatorList(this.numberOperatorStore,this.i18n.numberOperatorIs,fa),this.onChangeOperator(Y,P,Q)):P.fillOperatorList(this.numberOperatorStore,this.i18n.numberOperatorIs,fa),P.createValueNumber(this.getCodedValues(C))}"date"===this.fieldsStore.getValue(P.getFieldsList().item,"shortType")?P.disableInteractiveCheck():P.enableInteractiveCheck();
m.publish("filter-expression-change",this)},_onChangeOperator:function(C,P,Q){C=C.item?C.item.name[0]:C.value;Q=this.fieldsStore.getValue(P.getFieldsList().item,"shortType");var Y=this.fieldsStore.getValue(P.getFieldsList().item,"name");P.enableOptions();if("date"!==Q&&"number"!==Q||C!==this.i18n.dateOperatorIsBetween&&C!==this.i18n.numberOperatorIsBetween&&C!==this.i18n.dateOperatorIsNotBetween&&C!==this.i18n.numberOperatorIsNotBetween)if("date"!==Q||C!==this.i18n.dateOperatorInTheLast&&C!==this.i18n.dateOperatorNotInTheLast)if(C===
this.i18n.stringOperatorIsBlank||C===this.i18n.dateOperatorIsBlank||C===this.i18n.numberOperatorIsBlank||C===this.i18n.stringOperatorIsNotBlank||C===this.i18n.dateOperatorIsNotBlank||C===this.i18n.numberOperatorIsNotBlank)P.createValueIsBlank(),P.disableOptions();else switch(Q){case "string":P.createValueString(this.getCodedValues(Y));break;case "date":P.createValueDate();break;default:P.createValueNumber(this.getCodedValues(Y))}else P.disableOptions(),P.createValueInTheLastDate();else P.disableOptions(),
"date"===Q?P.createValueBetweenDate():P.createValueBetweenNumber();m.publish("filter-expression-change",this)},onInteractiveClick:function(C){this.isInteractiveChecked()?(h.set(this.interactiveSpace,"display","block"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9650;"):(h.set(this.interactiveSpace,"display","none"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9660;");m.publish("filter-expression-change",this)},onClickShowHideInteractive:function(C){this.interactiveCheck.disabled||("none"===h.set(this.interactiveSpace,
"display")?(h.set(this.interactiveSpace,"display","block"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9650;"):(h.set(this.interactiveSpace,"display","none"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9660;"))},onChangeInteractive:function(){m.publish("filter-expression-change",this)},showValueInput:function(C){this._showValueInput(z.byNode(C.target),this)},showFields:function(C){this._showFields(z.byNode(C.target),this)},showUniqueList:function(C){this._showUniqueList(z.byNode(C.target),this)},
onValueChange:function(){this.onValueChangeHandler&&clearTimeout(this.onValueChangeHandler);this.onValueChangeHandler=setTimeout(p.hitch(this,function(){this.onValueChangeHandler=null;m.publish("filter-expression-change",this)}),800)},_showValueInput:function(C,P,Q){P.onChangeOperator(C,P,Q);P.enableInteractiveCheck()},_showFields:function(C,P,Q){Q=P.getFieldsList().item;C=this.fieldsStore.getValue(Q,"shortType");Q=this.fieldsStore.getValue(Q,"name");P.createValueFields(this.fieldsStore,{shortType:C,
name:new RegExp("^(?!"+Q+"$)")},Q);P.disableInteractiveCheck()},_showUniqueList:function(C,P,Q){this.uniqueValuesStore&&delete this.uniqueValuesStore;Q=this.fieldsStore.getValue(P.getFieldsList().item,"name");if(10.1<=this.version||!this.mapLayer.url){var Y=null;this.mapLayer.queryServiceUrl?Y=this.mapLayer.queryServiceUrl:this.mapLayer.itemLayers&&r.forEach(this.mapLayer.itemLayers,function(fa){fa.id===this.layerInfo.id&&fa.layerUrl&&(Y=fa.layerUrl)},this);Y||(Y=this.mapLayer.url);if(this.uniqueValuesResults[this.mapLayer.id+
"_"+Q])this.onGenerateRendererResults(P,C,this.uniqueValuesResults[this.mapLayer.id+"_"+Q]);else this.generateRendererUniqueValues(Q,Y,p.hitch(this,"onGenerateRendererResults",P,C),p.hitch(this,function(){this.showValueInput(C,P)}))}else C&&this.showValueInput(C,P)},onGenerateRendererResults:function(C,P,Q){var Y=this.fieldsStore.getValue(C.getFieldsList().item,"name"),fa=this.fieldsStore.getValue(C.getFieldsList().item,"shortType"),na=this.fieldsStore.getValue(C.getFieldsList().item,"type");this.uniqueValuesResults[this.mapLayer.id+
"_"+Y]=Q;var la=null;r.forEach(this.mapLayer.fields,function(W){W.name===Y&&W.domain&&(la=W.domain)});Q=r.filter(Q,function(W,aa){return"string"===fa?"\x3cNull\x3e"!==W&&""!==W.trim():"\x3cNull\x3e"!==W&&""!==W});Q.length?("date"===fa?(Q=r.map(Q,function(W){return new Date(W)}),Q=Q.sort(function(W,aa){W=W.getTime();aa=aa.getTime();return W<aa?-1:W>aa?1:0}),Q=r.map(Q,function(W){return this.formatFriendlyDate(W)},this)):"number"===fa?(Q=r.map(Q,function(W){return"esriFieldTypeDouble"===na||"esriFieldTypeSingle"===
na?parseFloat(W):parseInt(W,10)}),Q=Q.sort(function(W,aa){return W<aa?-1:W>aa?1:0})):Q=Q.sort(function(W,aa){return W<aa?-1:W>aa?1:0}),P=r.map(Q,function(W,aa){var oa=W;"string"===fa&&(oa=""===W?"\x3c"+this.i18n.emptyString+"\x3e":W);if(la&&la.codedValues){for(var ha=0;ha<la.codedValues.length;ha++){var pa=la.codedValues[ha];if(W===pa.code)return{id:aa,name:pa.name||oa,value:W}}return{id:aa,name:""+oa,value:W}}if("esriFieldTypeDouble"===na||"esriFieldTypeSingle"===na)oa=f.format(W,{pattern:"#####0.##########"});
return{id:aa,name:""+oa,value:W}},this),this.uniqueValuesStore=new t({data:{label:"name",identifier:"id",items:P}}),C.createValueUnique(this.uniqueValuesStore)):this.showValueInput(P,C)},generateRendererUniqueValues:function(C,P,Q,Y){C instanceof Array&&(C=C.toString());var fa=new ea;fa.attributeField=C;C=new L;C.classificationDefinition=fa;this.mapLayer instanceof S?P=new ja(this.mapLayer):this.mapLayer instanceof O&&!this.mapLayer.url?P=new ja(this.mapLayer):this.hasDynamicLayers(this.mapLayer)?
(fa=this.mapLayer.layerDefinitions&&this.mapLayer.layerDefinitions[this.mapLayer.id]?this.mapLayer.layerDefinitions[this.mapLayer.id]:null,C.where=fa?fa:null,P=new ja(this.mapLayer.url+"/dynamicLayer",{source:this.layerInfo.source})):(fa=this.mapLayer.getDefinitionExpression(),C.where=fa?fa:null,P=new ja(P));ba.defaults.io.timeout=1E4;P.execute(C,function(na){ba.defaults.io.timeout=6E4;na=r.map(na.infos,function(la){return la.value});Q(na)},p.hitch(this,function(na){ba.defaults.io.timeout=6E4;Y()}))},
hasDynamicLayers:function(C){return C&&C.supportsDynamicLayers?!0:!1},formatDate:function(C){return y.format(C,{datePattern:"yyyy-MM-dd",selector:"date"})+" "+y.format(C,{selector:"time",timePattern:"HH:mm:ss"})},formatFriendlyDate:function(C){return y.format(C,{formatLength:"short",selector:"date"})},parseFriendlyDate:function(C){return y.parse(C,{formatLength:"short",selector:"date"})},parseDate:function(C){var P=y.parse(C,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});P||(P=y.parse(C.replace(" ",
", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||(P=y.parse(C.replace(" "," - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));return P},addDay:function(C){return new Date(C.getTime()+this.dayInMS)},subtractDay:function(C){return new Date(C.getTime()-this.dayInMS)},containsNonLatinCharacter:function(C){for(var P=0;P<C.length;P++)if(255<C.charCodeAt(P))return!0;return!1},hasWhiteSpace:function(C){return/\s/g.test(C)},buildCodedValuesStore:function(C){C=r.map(C,function(P,Q){return{name:P.name,
code:P.code,id:Q}});return new t({data:{label:"name",identifier:"id",items:C}})},clearAttributeValueDijits:function(){this.valueHandlers&&0!==this.valueHandlers.length&&(r.forEach(this.valueHandlers,p.hitch(this,function(C){m.disconnect(C);C=null})),this.valueHandlers=[],z.byId(this.id+".value")?z.byId(this.id+".value").destroy():e.byId(this.id+".value")&&this.getAttrValContNode().removeChild(e.byId(this.id+".value")),z.byId(this.id+".value1")?z.byId(this.id+".value1").destroy():e.byId(this.id+".value1")&&
this.getAttrValContNode().removeChild(e.byId(this.id+".value1")),z.byId(this.id+".value2")?z.byId(this.id+".value2").destroy():e.byId(this.id+".value2")&&this.getAttrValContNode().removeChild(e.byId(this.id+".value2")),z.byId(this.id+".valueFields")&&z.byId(this.id+".valueFields").destroy(),z.byId(this.id+".valueUnique")&&z.byId(this.id+".valueUnique").destroy())},checkDefaultOption:function(){n(".attributeValueOptions .attributeValueRadio",this.domNode).forEach(function(C){z.byNode(C).set("checked",
-1<C.className.indexOf("radioValue"))})},disableOptions:function(){n(".attributeValueOptions .attributeValueRadio",this.domNode).forEach(function(C){z.byNode(C).set("disabled",!0)})},enableOptions:function(){n(".attributeValueOptions .attributeValueRadio",this.domNode).forEach(function(C){z.byNode(C).set("disabled",!1)})},checkFieldOption:function(){z.byId(this.id+".radioFields").set("checked",!0)},disableFieldOption:function(){z.byId(this.id+".radioFields").set("disabled",!0)},disableUniqueOption:function(){z.byId(this.id+
".radioUnique").set("disabled",!0)},enableInteractiveCheck:function(){this.interactiveCheck.disabled=!1},disableInteractiveCheck:function(){this.interactiveCheck.checked=!1;this.interactiveCheck.disabled=!0},isBigDataLayer:function(C){return!!C.url&&-1!==C.url.indexOf("BigDataCatalogServer")&&("featureClass"===C.type||"table"===C.type)},isPortalHostedService:function(C){return C?-1!==C.toLowerCase().indexOf("/hosted/"):!1},isHostedService:function(C){if(!C)return!1;var P=-1!==C.indexOf(".arcgis.com/");
C=-1!==C.indexOf("//services")||-1!==C.indexOf("//tiles")||-1!==C.indexOf("//features");return P&&C},buildEditUIField:function(C,P,Q){this.getFieldItemByName({name:C.fieldObj.name},p.hitch(this,function(Y){P.getFieldsList().set("value",Y.id[0],!1);this.buildEditUIOperator(C,P,Q)}),p.hitch(this,function(){P.getFieldsList().set("value",0);this.buildEditUIOperator(C,P,Q)}))},buildEditUIOperator:function(C,P,Q){switch(C.fieldObj.shortType){case "string":P.fillOperatorList(this.stringOperatorStore,C.operator);
break;case "date":P.fillOperatorList(this.dateOperatorStore,C.operator);break;default:P.fillOperatorList(this.numberOperatorStore,C.operator)}setTimeout(p.hitch(this,function(){this.getOperatorItemByName(P.getOperatorList().store,{name:C.operator},p.hitch(this,function(Y){P.getOperatorList().set("value",Y.id[0],!1);this.buildEditUIValue(C,P,Q)}),p.hitch(this,function(){P.getOperatorList().set("value",0);this.buildEditUIValue(C,P,Q)}))}),100)},buildEditUIValue:function(C,P,Q){this.onOperatorChangeEnabled=
this.onFieldChangeEnabled=!0;var Y=C.operator;this.onChangeOperator(P.getOperatorList(),P);P.enableOptions();setTimeout(p.hitch(this,function(){Y===this.i18n.stringOperatorIsBlank||Y===this.i18n.dateOperatorIsBlank||Y===this.i18n.numberOperatorIsBlank||Y===this.i18n.stringOperatorIsNotBlank||Y===this.i18n.dateOperatorIsNotBlank||Y===this.i18n.numberOperatorIsNotBlank?(P.createValueIsBlank(),P.disableOptions()):"field"===C.valueObj.type?(P.createValueFields(this.fieldsStore,{shortType:C.fieldObj.shortType,
name:new RegExp("^(?!"+C.fieldObj.name+"$)")}),P.checkFieldOption(),this.getFieldItemByName({name:C.valueObj.value},p.hitch(this,function(fa){P.setValueFieldById(fa.id[0])}),p.hitch(this,function(){P.setValueFieldById(0)}))):da.isDefined(C.valueObj.value1)?(P.setValue1(C.valueObj.value1),P.setValue2(C.valueObj.value2)):P.setValue(C.valueObj.value,this.getCodedValues(C.fieldObj.name))}),100)},getFieldItemByName:function(C,P,Q){this.fieldsStore.fetch({query:C,onComplete:p.hitch(this,function(Y){Y&&
Y.length?P(Y[0]):Q()})})},getOperatorItemByName:function(C,P,Q,Y){C.fetch({query:P,onComplete:p.hitch(this,function(fa){fa&&fa.length?Q(fa[0]):Y()})})}});b("extend-esri")&&p.setObject("dijit.SingleFilter",H,ca);return H})},"esri/tasks/GenerateRendererTask":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/number dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../request ../deferredUtils ../urlUtils ../renderers/jsonUtils ./StatisticDefinition ./Task ./QueryTask ./query dojo/has!extend-esri?./GenerateRendererParameters dojo/has!extend-esri?./ClassificationDefinition dojo/has!extend-esri?./ClassBreaksDefinition dojo/has!extend-esri?./UniqueValueDefinition dojo/has!extend-esri?./ColorRamp dojo/has!extend-esri?./AlgorithmicColorRamp dojo/has!extend-esri?./MultipartColorRamp".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v){k=k(n,{declaredClass:"esri.tasks.GenerateRendererTask",_eventMap:{complete:["renderer"]},constructor:function(u,t){!p.isObject(u)||"esri.layers.FeatureLayer"!==u.declaredClass&&"esri.layers.CSVLayer"!==u.declaredClass?(this.url=u,this._url.path+="/generateRenderer"):u.url&&p.isString(u.url)&&"esri.layers.CSVLayer"!==u.declaredClass?(this.url=u.url,this._url=h.urlToObject(this.url),this._url.path+="/generateRenderer"):this._features=u.graphics;this._handler=
p.hitch(this,this._handler);this.source=t&&t.source;this.gdbVersion=t&&t.gdbVersion;this.checkValueRange=t&&t.checkValueRange;this.registerConnectEvents()},_handler:function(u,t,y,D,B){try{if("esri.renderer.ClassBreaksRenderer"===u.declaredClass||"esri.renderer.UniqueValueRenderer"===u.declaredClass)var E=u;else E=c.fromJson(u),"classBreaks"===u.type&&E.setMaxInclusive(!0);if(this.checkValueRange){var x=new q(this.url),w=new v,A=new g;A.statisticType="min";A.onStatisticField=this._field;var z=new g;
z.statisticType="max";z.onStatisticField=this._field;w.outStatistics=[A,z];x.execute(w).then(p.hitch(this,function(G){G=G.features[0].attributes;for(var I in G)if(0===I.toLowerCase().indexOf("min"))var K=G[I];else var R=G[I];E=this._processRenderer(E,this._prefix,this._unitLabel,this._formatLabel,this._precision,K,R);this._successHandler([E],"onComplete",y,B)}))}else E=this._processRenderer(E,this._prefix,this._unitLabel,this._formatLabel,this._precision),this._successHandler([E],"onComplete",y,B)}catch(G){this._errorHandler(G,
D,B)}},_processRenderer:function(u,t,y,D,B,E,x){"esri.renderer.ClassBreaksRenderer"===u.declaredClass?r.forEach(u.infos,function(w,A){0===A&&void 0!==E&&null!==E&&(w.minValue=E);A===u.infos.length-1&&void 0!==x&&null!==x&&(w.classMaxValue=w.maxValue=x);B&&(w.classMaxValue=w.maxValue=Math.round(w.maxValue/B)*B,w.minValue=Math.round(w.minValue/B)*B);D&&(w.label=m.format(w.minValue)+" - "+m.format(w.maxValue));t&&(w.label=t+" "+w.label);y&&(w.label=w.label+" "+y)}):r.forEach(u.infos,function(w,A){0===
A&&void 0!==E&&null!==E&&(w.value=E);A===u.infos.length-1&&void 0!==x&&null!==x&&(w.value=x);D&&(w.label=m.format(w.value));t&&(w.label=t+" "+w.label);y&&(w.label=w.label+" "+y)});return u},execute:function(u,t,y){var D=this._handler,B=this._errorHandler;this._precision=u.precision;this._prefix=u.prefix;this._unitLabel=u.unitLabel;this._formatLabel=u.formatLabel;if(this._features=u.features||this._features){var E=new b;var x=this._features;H(["./generateRenderer"],function(z){var G;"esri.tasks.ClassBreaksDefinition"===
u.classificationDefinition.declaredClass?G=z.createClassBreaksRenderer({features:x,definition:u.classificationDefinition}):"esri.tasks.UniqueValueDefinition"===u.classificationDefinition.declaredClass&&(G=z.createUniqueValueRenderer({features:x,definition:u.classificationDefinition}));G?D(G,null,t,y,E):B(null,y,E)})}else{var w=p.mixin(u.toJson(),{f:"json"});this._field="esri.tasks.ClassBreaksDefinition"===u.classificationDefinition.declaredClass?u.classificationDefinition.classificationField:u.classificationDefinition.attributeField;
if(this.source){var A={source:this.source.toJson()};w.layer=l.toJson(A)}this.gdbVersion&&(w.gdbVersion=this.gdbVersion);E=new b(e._dfdCanceller);E._pendingDfd=f({url:this._url.path,content:w,callbackParamName:"callback",load:function(z,G){D(z,G,t,y,E)},error:function(z){B(z,y,E)}})}return E},onComplete:function(){}});a("extend-esri")&&p.setObject("tasks.GenerateRendererTask",k,d);return k})},"esri/tasks/UniqueValueDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel",
"./ClassificationDefinition"],function(H,k,p,r,m){H=H(m,{declaredClass:"esri.tasks.UniqueValueDefinition",type:"uniqueValueDef",attributeField:null,attributeField2:null,attributeField3:null,fieldDelimiter:null,toJson:function(){var l=this.inherited(arguments);this.uniqueValueFields=[];this.attributeField&&this.uniqueValueFields.push(this.attributeField);this.attributeField2&&this.uniqueValueFields.push(this.attributeField2);this.attributeField3&&this.uniqueValueFields.push(this.attributeField3);k.mixin(l,
{type:this.type,uniqueValueFields:this.uniqueValueFields});this.fieldDelimiter&&k.mixin(l,{fieldDelimiter:this.fieldDelimiter});return l}});p("extend-esri")&&k.setObject("tasks.UniqueValueDefinition",H,r);return H})},"esri/tasks/ClassificationDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(H,k,p,r){H=H(null,{declaredClass:"esri.tasks.ClassificationDefinition",type:null,baseSymbol:null,colorRamp:null,toJson:function(){var m={};this.baseSymbol&&
k.mixin(m,{baseSymbol:this.baseSymbol.toJson()});this.colorRamp&&!k.isString(this.colorRamp)&&k.mixin(m,{colorRamp:this.colorRamp.toJson()});return m}});p("extend-esri")&&k.setObject("tasks.ClassificationDefinition",H,r);return H})},"esri/tasks/GenerateRendererParameters":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(H,k,p,r,m){H=H(null,{declaredClass:"esri.tasks.GenerateRendererParameters",classificationDefinition:null,where:null,precision:null,
prefix:null,unitLabel:null,formatLabel:null,toJson:function(){return{classificationDef:p.toJson(this.classificationDefinition.toJson()),where:this.where}}});r("extend-esri")&&k.setObject("tasks.GenerateRendererParameters",H,m);return H})},"esri/layers/GeoRSSLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../config ../request ../urlUtils ./ServiceGeneratedFeatureCollection".split(" "),function(H,k,p,r,m,l,b,a,d){H=H([d],{declaredClass:"esri.layers.GeoRSSLayer",
serviceUrl:a.getProtocolForWebResource()+"//utility.arcgis.com/sharing/rss",constructor:function(f,e){this._url=a.urlToObject(this.url=f);l.defaults.geoRSSService&&(this.serviceUrl=l.defaults.geoRSSService);this._createLayer()},parse:function(){return this._io=b({url:this.serviceUrl,content:{url:this.url,refresh:this.loaded?!0:void 0,outSR:this._outSR?p.toJson(this._outSR.toJson()):void 0},callbackParamName:"callback"})},_initLayer:function(f){this.inherited(arguments);this.loaded||(this.loaded=!0,
this.onLoad(this))}});r("extend-esri")&&k.setObject("layers.GeoRSSLayer",H,m);return H})},"esri/layers/ServiceGeneratedFeatureCollection":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/webMercatorUtils ../renderers/SimpleRenderer ./layer ./FeatureLayer ../dijit/PopupTemplate".split(" "),function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n){H=H([c],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",
constructor:function(q,v){this.pointSymbol=v&&v.pointSymbol;this.polylineSymbol=v&&v.polylineSymbol;this.polygonSymbol=v&&v.polygonSymbol;this._outSR=v&&(v.outSpatialReference||v.outSR)||new d({wkid:4326});this._options=p.mixin({},v)},parse:function(){console.error("parse function has not been implemented")},getFeatureLayers:function(){var q=[];this._fLayers&&(q=q.concat(this._fLayers));return q},onRefresh:function(){},onOpacityChange:function(){},refresh:function(){this.loaded&&this._map&&!this._io&&
this.visible&&this._createLayer()},_createLayer:function(q){var v=this;this._fireUpdateStart();q=this.parse(q);q.addCallback(function(u){v._io=null;v._initLayer(u)});q.addErrback(function(u){v._io=null;u=p.mixin(Error(),u);u.message="Unable to load resource: "+v.url+" "+(u.message||"");v._fireUpdateEnd(u);v.onError(u)})},_initLayer:function(q){this.loaded&&this._removeInternalLayers();this.name=q.name;this.description=q.description;this.snippet=q.snippet;this.featureInfos=q.featureInfos;this.fullExtent=
this.initialExtent=new f(q.lookAtExtent);this.copyright=q.author||q.copyright;var v;(q=p.getObject("featureCollection.layers",!1,q))&&0<q.length&&(this._fLayers=[],r.forEach(q,function(u,t){var y=p.getObject("featureSet.features",!1,u);y&&0<y.length&&(v=p.mixin({outFields:["*"],infoTemplate:u.popupInfo?new n(u.popupInfo):null,editable:!1},this._options),v.id&&(v.id=v.id+"_"+t),v.webgl=!1,u.layerDefinition.capabilities="Query,Data",u=new g(u,v),u.geometryType&&(this["_"+u.geometryType]=u),this._fLayers.push(u))},
this),0===this._fLayers.length&&delete this._fLayers);this.items=[];this._esriGeometryPoint&&(this.items=this.items.concat(this._esriGeometryPoint.graphics),this.pointSymbol&&(q=new h(this.pointSymbol),this._esriGeometryPoint.setRenderer(q)));this._esriGeometryPolyline&&(this.items=this.items.concat(this._esriGeometryPolyline.graphics),this.polylineSymbol&&(q=new h(this.polylineSymbol),this._esriGeometryPolyline.setRenderer(q)));this._esriGeometryPolygon&&(this.items=this.items.concat(this._esriGeometryPolygon.graphics),
this.polygonSymbol&&(q=new h(this.polygonSymbol),this._esriGeometryPolygon.setRenderer(q)));this._fireUpdateEnd();this.loaded&&(this._addInternalLayers(),this.onRefresh())},_addInternalLayers:function(){var q=this._map;this._fireUpdateStart();var v=q.spatialReference,u=this._outSR;if(v.wkid)var t=v._isWebMercator()&&u._isWebMercator()||v.wkid===u.wkid;else if(v.wkt)t=v.wkt===u.wkt;else{console.log("_setMap - map has invalid spatial reference");return}if(!t)if(v._isWebMercator()&&4326===u.wkid)this._converter=
e.geographicToWebMercator;else if(u._isWebMercator()&&4326===v.wkid)this._converter=e.webMercatorToGeographic;else{console.log("_setMap - unsupported workflow. Spatial reference of the map and layer do not match, and the conversion cannot be done on the client.");return}(v=this._fLayers)&&0<v.length&&r.forEach(v,function(y){if(this._converter){var D=y.graphics,B,E,x=D?D.length:0;for(B=0;B<x;B++)(E=D[B].geometry)&&D[B].setGeometry(this._converter(E))}q.addLayer(y)},this);this.setVisibility(this.visible);
this._fireUpdateEnd()},_removeInternalLayers:function(){var q=this._map;q&&r.forEach(this.getFeatureLayers(),q.removeLayer,q)},setScaleRange:function(q,v){this.inherited(arguments);r.forEach(this.getFeatureLayers(),function(u){u.setScaleRange(q,v)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale},setOpacity:function(q){this.opacity!=q&&(r.forEach(this.getFeatureLayers(),function(v){v.setOpacity(q)}),this.opacity=this._options.opacity=q,this.onOpacityChange(q))},onVisibilityChange:function(q){this._fireUpdateStart();
r.forEach(this.getFeatureLayers(),function(v){v.setVisibility(q)});this._fireUpdateEnd()},_setMap:function(q,v){this.inherited(arguments);this._map=q;var u=this._div=m.create("div",null,v);l.set(u,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return u},_unsetMap:function(q,v){this._io&&this._io.cancel();k.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var u=this._div;u&&(v.removeChild(u),m.destroy(u));this._div=null;this.inherited(arguments)}});
b("extend-esri")&&p.setObject("layers._ServiceGeneratedFeatureCollection",H,a);return H})},"esri/dijit/analysis/ItemTypes":function(){define(["dojo/_base/lang","dojo/has","../../kernel"],function(H,k,p){var r={BIGDATA:"Big Data File Share",CSV:"CSV",XLS:"Microsoft Excel",FS:"Feature Service",MS:"Map Service",IS:"Image Service",FLAYER:"Feature Layer",BDATAFEATURE:"featureClass",TABLE:"Table",BTABLE:"table",FLAYERVIEW:"FeatureLayerView",MVGRID:"Multi-Variable Grid",GPSERVICE:"Geoprocessing Service",
RFT:"Raster function template",BDFSTEMPLATE:"bdfstemplate",DLPK:"Deep Learning Package",FILE:"files",DOC:"documents",IMG:"images",PDF:"pdfs",CSVS:"csvs"};k("extend-esri")&&H.setObject("dijit.analysis.itemTypes",r,p);return r})},"esri/dijit/analysis/FeatureRecordSetLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../../tasks/DataFile","../../kernel"],function(H,k,p,r,m){H=H(r,{declaredClass:"esri.dijit.analysis.FeatureRecordSetLayer",constructor:function(l){l&&k.mixin(this,
l)},toJson:function(){var l={};this.url&&(l.url=this.url);this.filter&&(l.filter=this.filter);this.serviceToken&&(l.serviceToken=this.serviceToken);this.featureSet&&(l.featureSet=this.featureSet);this.layerDefinition&&(l.layerDefinition=this.layerDefinition);this.time&&(l.time=this.time);return l}});p("extend-esri")&&k.setObject("dijit.analysis.FeatureRecordSetLayer",H,m);return H})},"esri/dijit/analysis/PluginLayers":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/Deferred dojo/promise/all dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-style dojo/query dojo/store/Memory dojo/store/Observable dojo/Evented dojo/has ./ItemTypes ../../request ../../kernel ../../lang dgrid/OnDemandGrid dgrid/Selection ./AnalysisRegistry dojo/i18n!../../nls/jsapi".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E){var x=H([g],{infoPanelTemplate:'\x3cdiv\x3e\x3cdiv class\x3d"template-info-showing"\x3e\x3cdiv\x3e\x3cimg width\x3d\'16px\' height\x3d\'16px\' alt\x3d\'\' src\x3d\'${item.iconUrl}\'\x3e\x3c/div\x3e\x3ch4\x3e${item.title}\x3c/h4\x3e\x3cdiv class\x3d"template-info"\x3e\x3cp class\x3d""\x3e${item.snippet}\x3c/p\x3e${item:plugIn._showLayers}\x3cdiv id\x3d"${item.id}_details" class\x3d"quiet-scroll layer-container"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-actions"\x3e${item:plugIn._addLayerToMap}\x3cbutton class\x3d"btn blue btn-main disabled" id\x3d"add-layer"\x3e${i18n.common.addLayerBtnLabel}\x3c/button\x3e\x3cbutton class\x3d"btn btn-cancel" id\x3d"close-panel"\x3e${i18n.common.close}\x3c/button\x3e\x3c/div\x3e\x3cdiv\x3e',
geometryTypes:[B.GeometryTypes.Point,B.GeometryTypes.Point.MultiPoint,B.GeometryTypes.Line,B.GeometryTypes.Polygon],layerTypes:[q.FLAYER,q.BDATAFEATURE,q.BTABLE,q.TABLE],timeTypes:[B.TimeTypes.Instant,B.TimeTypes.Interval],checkGeometryType:!0,checkLayerType:!1,checkTimeFilter:!1,fetchType:['type:"'+q.MS+'"','type:"'+q.FS+'"'],constructor:function(w){k.mixin(this,w);this.filters={all:{},mycontent:{owners:this.self?[this.self.user.username]:[]},esriBoundaryLayers:{owners:["esri_boundaries"]}};this.i18n=
k.mixin({},E.browseLayersDlg);k.mixin(this.i18n,E.browseItems);k.mixin(this.i18n,E.common);this.filterStrings={all:{title:this.self&&this.self.isPortal?this.i18n.items.portalOrg:this.i18n.items.organizationLabel},mycontent:{title:this.i18n.items.contentLabel},esriBoundaryLayers:{title:this.i18n.esriBoundaryLayers}}},fetchData:function(){this._portal=this.parent._portal;this._user=this._portal.getPortalUser();this.filters.mycontent.owner=this._user;this.parent.fetchType&&(this.fetchType=this.parent.fetchType);
return this._fetchItems()},_fetchItems:function(){return this.parent._fetchItems({types:this.fetchType})},_fetchServiceInfo:function(w){var A=new m,z,G={f:"json"};w.url?(-1!==window.location.protocol.indexOf("https:")&&(w.url=w.url.replace("http:","https:")),v({url:w.url,content:G}).then(function(I){A.resolve(I)},k.hitch(this,function(I){z=I.details&&I.details.length?I.details.shift():"";I&&403===I.httpCode&&-1<z.indexOf("SSL Required")?(w.set("url",w.url.replace("http:","https:")),this._fetchServiceInfo(w).then(function(K){A.resolve(K)})):
(w.isLoaded=!0,A.resolve({error:I}))}))):A.resolve(null);return A},_addLayerToMap:function(w){return w.type===q.BIGDATA||w.type===q.CSV||w.type===q.XLS?"":'\x3cdiv class\x3d"esriFloatLeading esriLeadingPadding1 padding-trailer-half js-add-layer-node"\x3e\x3clabel\x3e\x3cinput name\x3d"addlayertomap" class\x3d"js-add-layer-checkbox" type\x3d"checkbox"\x3e\x3cspan class\x3d"esriLeadingPadding1"\x3e'+this.i18n.common.addLayer+"\x3c/span\x3e\x3c/label\x3e\x3c/div\x3e"},_showLayers:function(w){if(w&&-1!==
p.indexOf([q.FS,q.MS,q.IS,q.BIGDATA,q.CSV,q.XLS],w.type)){if(w.type===q.CSV||w.type===q.XLS)w.url=w.itemUrl;this.plugIn._fetchServiceInfo(w).then(k.hitch(this,function(A){var z=[],G={f:"json"};A.layers&&(z=[].concat(z).concat(A.layers));A.tables&&0<A.tables.length&&(z=[].concat(z).concat(A.tables));A.children&&(z=A.children);!w||w.type!==q.CSV&&w.type!==q.XLS&&w.type!==q.IS||(z=[w]);if(!z.length)var I=this.plugIn.i18n.noDataMessages.noItemInfo;this.plugIn._createLayerGrid(r.create("div",null,b.byId(w.id+
"_details")),I);p.forEach(z,function(K,R){w.type===q.BIGDATA?(K.url=w.url+"/"+K.name,K.url=encodeURI(K.url)):K.url=w.type===q.CSV?w.itemUrl:w.type===q.IS?w.url:w.url+"/"+R;-1!==window.location.protocol.indexOf("https:")&&(K.url=K.url.replace("http:","https:"));v({url:K.url,content:G}).then(k.hitch(this,function(U){K=k.mixin(K,U);this.plugIn._store.put(K);this.plugIn._grid.refresh()}),k.hitch(this,function(U){this.plugIn._grid.noDataMessage=this.plugIn.i18n.noDataMessages.noLayerInfo;this.plugIn._grid.refresh()}))},
this)}))}return""},_getLayerHead:function(){return"\x3ctr\x3e\x3cth\x3e\x3c/th\x3e\x3cth\x3eLayer Name\x3c/th\x3e\x3cth\x3e Geometry Type\x3c/th\x3e\x3c/tr\x3e"},_getLayerNode:function(w,A,z){A=w.name;var G='\x3ctr\x3e\x3ctd\x3e\x3cinput type\x3d"checkbox" class\x3d"js-layer-check" name\x3d"layers" value\x3d"'+A+' checked"\x3e\x3c/td\x3e\x3ctd\x3e',I="\x3c/td\x3e\x3ctd\x3e"+w.geometryType+"\x3c/td\x3e\x3c/tr\x3e";return w.itemUrl||w.url?G+'\x3ca class\x3d"'+(z||"")+'"\x3e'+A+"\x3c/a\x3e"+I:G+A+I},
_createLayerGrid:function(w,A){var z=H([y,D]);this._store=c(new h({idProperty:"name"}));this._atleastALayerAvailable=!1;this._grid=new z({store:this._store,query:k.hitch(this,function(G){var I=!0,K=!0,R=!0,U=!0;this.checkGeometryType&&G.type!==q.IS&&(R=-1!==p.indexOf(this.geometryTypes,G.geometryType));this.checkTimeFilter&&(I=-1!==p.indexOf(this.timeTypes,this.getTimeType(G)));this.checkLayerType&&(K=-1!==p.indexOf(this.layerTypes,G.type));"function"===typeof this.customCheckHandler&&(U=this.customCheckHandler(G));
G=G&&R&&I&&K&&U;G||(this._grid.noDataMessage=this.getNoDataMessage({geomCheck:R,timeCheck:I,typeCheck:K,customCheck:U}));!this._atleastALayerAvailable&&G&&(this._atleastALayerAvailable=G);e(".js-add-layer-checkbox",this.parent.infoPanel).forEach(function(ba){a.set(ba,"disabled",!this._atleastALayerAvailable)},this);return G}),selectionMode:"single","class":"esriAnalysisLayersGrid quiet-scroll",noDataMessage:A||this.i18n.noValidLayerMsg,allowSelect:k.hitch(this,function(G){var I;this.checkLayerType&&
G.data&&(I=-1!==p.indexOf(this.layerTypes,G.data.type));I=G.data.geometryType?-1!==p.indexOf(this.geometryTypes,G.data.geometryType)||this.checkLayerType&&I:!0;return G&&G.data&&I}),renderRow:k.hitch(this,this._renderer)},w);this._grid.startup();this._grid.on("dgrid-select,dgrid-deselect",k.hitch(this,function(G){G=G.grid.selection;var I=[];for(K in G)G[K]&&I.push(this._grid.row(K).data);var K={selection:I};e(".panel-actions .btn-main",this.parent.infoPanel).forEach(function(R){d.toggle(R,"disabled",
0===I.length)},this);I[0]&&(this._selectedLayer=I[0]);this.emit("layer-change",K)}))},hasTimeInfo:function(w){return w&&w.timeInfo},getTimeType:function(w){return w?t.isDefined(w.timeInfo)&&t.isDefined(w.timeInfo.startTimeField)&&!t.isDefined(w.timeInfo.endTimeField)?B.TimeTypes.Instant:t.isDefined(w.timeInfo)&&t.isDefined(w.timeInfo.startTimeField)&&t.isDefined(w.timeInfo.endTimeField)?B.TimeTypes.Interval:t.isDefined(w.time)&&t.isDefined(w.time.timeType)?w.time.timeType:!1:!1},getNoDataMessage:function(w){if(w.geomCheck)if(w.timeCheck){if(!w.typeCheck)return this.i18n.noDataMessages.typeCheckFailure;
if(!w.customCheck)return this.customCheckFailureMessage}else return this.i18n.noDataMessages.timeCheckFailure;else return this.i18n.noDataMessages.geomCheckFailure},getDateFields:function(w){return p.filter(w&&w.fields||[],function(A){return A&&"esriFieldTypeDate"===A.type})},_renderer:function(w){w.snippet=w.snippet||"";var A=r.create("div"),z=this._getLabel(w);r.place('\x3cdiv class\x3d"panel panel-white panel-bordered panel-compact border-bottom-clear"\x3e\x3ch5 class\x3d"trailer-0 font-size-0 word-break"\x3e\x3ca\x3e'+
w.name+'\x3c/a\x3e\x3c/h5\x3e\x3cnav class\x3d"inline-block"\x3e\x3ca class\x3d"link-gray font-size--2 esriTrailingPadding1 esriTrailingMargin05"\x3e\x3cspan class\x3d"'+z.icon+'"\x3e\x3c/span\x3e'+z.name+"\x3c/a\x3e"+(w.timeInfo||w.time&&"instant"===w.time.timeType?'\x3ca class\x3d"link-gray font-size--2 esriTrailingPadding1" data-action\x3d"timeSettings" data-layerid\x3d"0"\x3e\x3cspan class\x3d"esri-icon-time-clock"\x3e\x3c/span\x3e'+this.i18n.timeEnabled+"\x3c/a\x3e":'\x3ca class\x3d"esriTrailingPadding1"\x3e\x3c/a\x3e')+
"\x3c/nav\x3e\x3c/div\x3e",A);return A},_getLabel:function(w){var A={icon:"",name:""},z=w.geometryType;z===B.GeometryTypes.Point||z===B.GeometryTypes.MultiPoint?(A.name=this.i18n.points,A.icon="esri-icon-map-pin"):z===B.GeometryTypes.Polygon?(A.name=this.i18n.areas,A.icon="esri-icon-polygon"):z===B.GeometryTypes.Line?(A.name=this.i18n.lines,A.icon="esri-icon-polyline"):w.type===q.IS?(A.name=this.i18n.imageService,A.icon="esri-icon-layers"):(A.name=this.i18n.table,A.icon="esri-icon-table");return A}});
k.mixin(x,{add:function(w,A){w.plugIn||(A=A||{},A.parent=w,A.self=w.self,w.plugIn=new x(A))},remove:function(w){w.plugIn&&(w.plugIn.destroy(),delete w.plugIn)}});n("extend-esri")&&k.setObject("dijit.analysis.PluginLayers",x,u);return x})},"esri/dijit/analysis/AnalysisRegistry":function(){define(["dojo/_base/lang","dojo/has","../../kernel"],function(H,k,p){var r={Modes:{Raster:"raster",Bigdata:"bigdata",Standard:"standard",Feature:"feature"},Tools:{FindCentroids:"FindCentroids",ChooseBestFacilities:"ChooseBestFacilities"},
ProcessInfoTools:{DescribeDataset:{Name:"DescribeDataset",Gax:!0,Std:!1},GeneralizedLinearRegression:{Name:"GeneralizedLinearRegression",Gax:!0,Std:!1},ForestBasedClassificationAndRegression:{Name:"ForestBasedClassificationAndRegression",Gax:!0,Std:!1},GeographicallyWeightedRegression:{Name:"GeographicallyWeightedRegression",Gax:!0,Std:!1},FindSimilarLocations:{Name:"FindSimilarLocations",Gax:!0,Std:!0},FindHotSpots:{Name:"FindHotSpots",Gax:!1,Std:!0},FindOutliers:{Name:"FindOutliers",Gax:!0,Std:!0}},
ToolCategory:{Gax:"GeoAnalyticsTools",Std:"SpatialAnalysisTools"},GeometryTypes:{Polygon:"esriGeometryPolygon",Line:"esriGeometryPolyline",Point:"esriGeometryPoint",MultiPoint:"esriGeometryMultipoint"},PseudoGeometryTypes:{Point:"point",Line:"line",Polygon:"polygon"},TimeTypes:{Instant:"instant",Interval:"interval"},FieldTypes:{ObjectId:"esriFieldTypeOID",String:"esriFieldTypeString",Short:"esriFieldTypeSmallInteger",Integer:"esriFieldTypeInteger",Float:"esriFieldTypeSingle",Double:"esriFieldTypeDouble",
Date:"esriFieldTypeDate"},PseudoFieldTypes:{Number:"number",String:"string",Date:"date"},Shapes:{square:"SQUARE",hexagon:"HEXAGON",transverseHexagon:"TRANSVERSEHEXAGON",triangle:"TRIANGLE",diamond:"DIAMOND"},DistanceMethods:{geodesic:"Geodesic",planar:"Planar"}};k("extend-esri")&&H.setObject("dijit.analysis.AnalysisRegistry",r,p);return r})},"esri/dijit/analysis/PCSList":function(){define(["dojo/_base/lang","dojo/has","../../kernel"],function(H,k,p){var r=[2E3,2001,2002,2003,2004,2005,2006,2007,2008,
2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100,2101,2102,2103,2104,2105,2106,2107,2108,2109,2110,2111,2112,2113,2114,2115,2116,2117,2118,2119,
2120,2121,2122,2123,2124,2125,2126,2127,2128,2129,2130,2131,2132,2133,2134,2135,2136,2137,2138,2139,2140,2141,2142,2143,2144,2145,2146,2147,2148,2149,2150,2151,2152,2153,2154,2155,2157,2158,2159,2160,2161,2162,2163,2164,2165,2166,2167,2168,2169,2170,2172,2173,2174,2175,2176,2177,2178,2179,2180,2181,2182,2183,2184,2185,2186,2187,2188,2189,2190,2191,2192,2193,2195,2196,2197,2198,2200,2201,2202,2203,2204,2205,2206,2207,2208,2209,2210,2211,2212,2213,2214,2215,2216,2217,2219,2220,2222,2223,2224,2225,2226,
2227,2228,2229,2230,2231,2232,2233,2234,2235,2236,2237,2238,2239,2240,2241,2242,2243,2244,2245,2246,2247,2248,2249,2250,2251,2252,2253,2254,2255,2256,2257,2258,2259,2260,2261,2262,2263,2264,2265,2266,2267,2268,2269,2270,2271,2272,2273,2274,2275,2276,2277,2278,2279,2280,2281,2282,2283,2284,2285,2286,2287,2288,2289,2290,2291,2292,2294,2295,2308,2309,2310,2311,2312,2313,2314,2315,2316,2317,2318,2319,2320,2321,2322,2323,2324,2325,2326,2327,2328,2329,2330,2331,2332,2333,2334,2335,2336,2337,2338,2339,2340,
2341,2342,2343,2344,2345,2346,2347,2348,2349,2350,2351,2352,2353,2354,2355,2356,2357,2358,2359,2360,2361,2362,2363,2364,2365,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2384,2385,2386,2387,2388,2389,2390,2391,2392,2393,2394,2395,2396,2397,2398,2399,2400,2401,2402,2403,2404,2405,2406,2407,2408,2409,2410,2411,2412,2413,2414,2415,2416,2417,2418,2419,2420,2421,2422,2423,2424,2425,2426,2427,2428,2429,2430,2431,2432,2433,2434,2435,2436,2437,2438,2439,2440,2441,
2442,2443,2444,2445,2446,2447,2448,2449,2450,2451,2452,2453,2454,2455,2456,2457,2458,2459,2460,2461,2462,2463,2464,2465,2466,2467,2468,2469,2470,2471,2472,2473,2474,2475,2476,2477,2478,2479,2480,2481,2482,2483,2484,2485,2486,2487,2488,2489,2490,2491,2494,2495,2496,2497,2498,2499,2500,2501,2502,2503,2504,2505,2506,2507,2508,2509,2510,2511,2512,2513,2514,2515,2516,2517,2518,2519,2520,2521,2522,2523,2524,2525,2526,2527,2528,2529,2530,2531,2532,2533,2534,2535,2536,2537,2538,2539,2540,2541,2542,2543,2544,
2545,2546,2547,2548,2549,2550,2551,2552,2553,2554,2555,2556,2557,2558,2559,2560,2561,2562,2563,2564,2565,2566,2567,2568,2569,2570,2571,2572,2573,2574,2575,2576,2577,2578,2579,2580,2581,2582,2583,2584,2585,2586,2587,2588,2589,2590,2591,2592,2593,2594,2595,2596,2597,2598,2599,2600,2601,2602,2603,2604,2605,2606,2607,2608,2609,2610,2611,2612,2613,2614,2615,2616,2617,2618,2619,2620,2621,2622,2623,2624,2625,2626,2627,2628,2629,2630,2631,2632,2633,2634,2635,2636,2637,2638,2639,2640,2641,2642,2643,2644,2645,
2646,2647,2648,2649,2650,2651,2652,2653,2654,2655,2656,2657,2658,2659,2660,2661,2662,2663,2664,2665,2666,2667,2668,2669,2670,2671,2672,2673,2674,2675,2676,2677,2678,2679,2680,2681,2682,2683,2684,2685,2686,2687,2688,2689,2690,2691,2692,2693,2694,2695,2696,2697,2698,2699,2700,2701,2702,2703,2704,2705,2706,2707,2708,2709,2710,2711,2712,2713,2714,2715,2716,2717,2718,2719,2720,2721,2722,2723,2724,2725,2726,2727,2728,2729,2730,2731,2732,2733,2734,2735,2736,2737,2738,2739,2740,2741,2742,2743,2744,2745,2746,
2747,2748,2749,2750,2751,2752,2753,2754,2755,2756,2757,2758,2759,2760,2761,2762,2763,2764,2765,2766,2767,2768,2769,2770,2771,2772,2773,2774,2775,2776,2777,2778,2779,2780,2781,2782,2783,2784,2785,2786,2787,2788,2789,2790,2791,2792,2793,2794,2795,2796,2797,2798,2799,2800,2801,2802,2803,2804,2805,2806,2807,2808,2809,2810,2811,2812,2813,2814,2815,2816,2817,2818,2819,2820,2821,2822,2823,2824,2825,2826,2827,2828,2829,2830,2831,2832,2833,2834,2835,2836,2837,2838,2839,2840,2841,2842,2843,2844,2845,2846,2847,
2848,2849,2850,2851,2852,2853,2854,2855,2856,2857,2858,2859,2860,2861,2862,2863,2864,2865,2866,2867,2868,2869,2870,2871,2872,2873,2874,2875,2876,2877,2878,2879,2880,2881,2882,2883,2884,2885,2886,2887,2888,2891,2892,2893,2894,2895,2896,2897,2898,2899,2900,2901,2902,2903,2904,2905,2906,2907,2908,2909,2910,2911,2912,2913,2914,2915,2916,2917,2918,2919,2920,2921,2922,2923,2924,2925,2926,2927,2928,2929,2930,2931,2932,2933,2934,2935,2936,2937,2938,2939,2940,2941,2942,2943,2944,2945,2946,2947,2948,2949,2950,
2951,2952,2953,2954,2955,2956,2957,2958,2959,2960,2961,2962,2964,2965,2966,2967,2968,2969,2970,2971,2972,2973,2975,2976,2977,2978,2979,2980,2981,2982,2983,2984,2985,2986,2987,2988,2989,2990,2991,2992,2993,2994,2995,2996,2997,2998,2999,3E3,3001,3002,3003,3004,3005,3006,3007,3008,3009,3010,3011,3012,3013,3014,3015,3016,3017,3018,3019,3020,3021,3022,3023,3024,3025,3026,3027,3028,3029,3030,3031,3032,3033,3034,3035,3036,3037,3038,3039,3040,3041,3042,3043,3044,3045,3046,3047,3048,3049,3050,3051,3054,3055,
3056,3057,3058,3059,3060,3061,3062,3063,3064,3065,3066,3067,3068,3069,3070,3071,3072,3073,3074,3075,3076,3077,3078,3079,3080,3081,3082,3083,3084,3085,3086,3087,3088,3089,3090,3091,3092,3093,3094,3095,3096,3097,3098,3099,3100,3101,3102,3106,3107,3108,3109,3110,3111,3112,3113,3114,3115,3116,3117,3118,3119,3120,3121,3122,3123,3124,3125,3126,3127,3128,3129,3130,3131,3132,3133,3134,3135,3136,3137,3138,3141,3142,3146,3147,3148,3149,3150,3151,3153,3154,3155,3156,3157,3158,3159,3160,3161,3162,3163,3164,3165,
3166,3167,3168,3169,3170,3171,3172,3174,3175,3176,3177,3178,3179,3180,3181,3182,3183,3184,3185,3186,3187,3188,3189,3190,3191,3192,3193,3194,3195,3196,3197,3198,3199,3200,3201,3202,3203,3294,3295,3296,3297,3298,3299,3300,3301,3302,3303,3304,3305,3306,3307,3308,3309,3310,3311,3312,3313,3314,3315,3316,3317,3318,3319,3320,3321,3322,3323,3324,3325,3326,3327,3328,3329,3330,3331,3332,3333,3334,3335,3336,3337,3338,3339,3340,3341,3342,3343,3344,3345,3346,3347,3348,3349,3350,3351,3352,3353,3354,3355,3356,3357,
3358,3359,3360,3361,3362,3363,3364,3365,3366,3367,3368,3369,3370,3371,3372,3373,3374,3375,3376,3377,3378,3379,3380,3381,3382,3383,3384,3385,3386,3387,3388,3389,3390,3391,3392,3393,3394,3395,3396,3397,3398,3399,3400,3401,3402,3403,3404,3405,3406,3407,3408,3409,3410,3411,3412,3413,3414,3415,3416,3417,3418,3419,3420,3421,3422,3423,3424,3425,3426,3427,3428,3429,3430,3431,3432,3433,3434,3435,3436,3437,3438,3439,3440,3441,3442,3443,3444,3445,3446,3447,3448,3449,3450,3451,3452,3453,3454,3455,3456,3457,3458,
3459,3460,3461,3462,3463,3464,3465,3466,3467,3468,3469,3470,3471,3472,3473,3474,3475,3476,3477,3478,3479,3480,3481,3482,3483,3484,3485,3486,3487,3488,3489,3490,3491,3492,3493,3494,3495,3496,3497,3498,3499,3500,3501,3502,3503,3504,3505,3506,3507,3508,3509,3510,3511,3512,3513,3514,3515,3516,3517,3518,3519,3520,3521,3522,3523,3524,3525,3526,3527,3528,3529,3530,3531,3532,3533,3534,3535,3536,3537,3538,3539,3540,3541,3542,3543,3544,3545,3546,3547,3548,3549,3550,3551,3552,3553,3554,3555,3556,3557,3558,3559,
3560,3561,3562,3563,3564,3565,3566,3567,3568,3569,3570,3571,3572,3573,3574,3575,3576,3577,3578,3579,3580,3581,3582,3583,3584,3585,3586,3587,3588,3589,3590,3591,3592,3593,3594,3595,3596,3597,3598,3599,3600,3601,3602,3603,3604,3605,3606,3607,3608,3609,3610,3611,3612,3613,3614,3615,3616,3617,3618,3619,3620,3621,3622,3623,3624,3625,3626,3627,3628,3629,3630,3631,3632,3633,3634,3635,3636,3637,3638,3639,3640,3641,3642,3643,3644,3645,3646,3647,3648,3649,3650,3651,3652,3653,3654,3655,3656,3657,3658,3659,3660,
3661,3662,3663,3664,3665,3666,3667,3668,3669,3670,3671,3672,3673,3674,3675,3676,3677,3678,3679,3680,3681,3682,3683,3684,3685,3686,3687,3688,3689,3690,3691,3692,3693,3694,3695,3696,3697,3698,3699,3700,3701,3702,3703,3704,3705,3706,3707,3708,3709,3710,3711,3712,3713,3714,3715,3716,3717,3718,3719,3720,3721,3722,3723,3724,3725,3726,3727,3728,3729,3730,3731,3732,3733,3734,3735,3736,3737,3738,3739,3740,3741,3742,3743,3744,3745,3746,3747,3748,3749,3750,3751,3753,3754,3755,3756,3757,3758,3759,3760,3761,3762,
3763,3764,3765,3766,3767,3768,3769,3770,3771,3772,3773,3775,3776,3777,3779,3780,3781,3783,3784,3785,3788,3789,3790,3791,3793,3794,3797,3798,3799,3800,3801,3802,3812,3814,3815,3816,3825,3826,3827,3828,3829,3832,3833,3834,3835,3836,3837,3838,3839,3840,3841,3844,3845,3846,3847,3848,3849,3850,3851,3852,3854,3857,3873,3874,3875,3876,3877,3878,3879,3880,3881,3882,3883,3884,3885,3890,3891,3892,3893,3907,3908,3909,3910,3911,3912,3920,3942,3943,3944,3945,3946,3947,3948,3949,3950,3968,3969,3970,3973,3974,3975,
3976,3978,3979,3986,3987,3988,3989,3991,3992,3994,3995,3996,3997,4026,4037,4038,4048,4049,4050,4051,4056,4057,4058,4059,4060,4061,4062,4063,4071,4082,4083,4087,4088,4093,4094,4095,4096,4217,4390,4391,4392,4393,4394,4395,4396,4397,4398,4399,4400,4401,4402,4403,4404,4405,4406,4407,4408,4409,4410,4411,4412,4413,4414,4415,4417,4418,4419,4420,4421,4422,4423,4424,4425,4426,4427,4428,4429,4430,4431,4432,4433,4434,4437,4438,4439,4455,4456,4457,4462,4467,4471,4474,4484,4485,4486,4487,4488,4489,4491,4492,4493,
4494,4495,4496,4497,4498,4499,4500,4501,4502,4503,4504,4505,4506,4507,4508,4509,4510,4511,4512,4513,4514,4515,4516,4517,4518,4519,4520,4521,4522,4523,4524,4525,4526,4527,4528,4529,4530,4531,4532,4533,4534,4535,4536,4537,4538,4539,4540,4541,4542,4543,4544,4545,4546,4547,4548,4549,4550,4551,4552,4553,4554,4559,4568,4569,4570,4571,4572,4573,4574,4575,4576,4577,4578,4579,4580,4581,4582,4583,4584,4585,4586,4587,4588,4589,4647,4652,4653,4654,4655,4656,4766,4767,4768,4769,4770,4771,4772,4773,4774,4775,4776,
4777,4778,4779,4780,4781,4782,4783,4784,4785,4786,4787,4788,4789,4790,4791,4792,4793,4794,4795,4796,4797,4798,4799,4800,4822,4826,4839,5014,5015,5016,5018,5048,5069,5070,5071,5072,5105,5106,5107,5108,5109,5110,5111,5112,5113,5114,5115,5116,5117,5118,5119,5120,5121,5122,5123,5124,5125,5126,5127,5128,5129,5130,5167,5168,5173,5174,5175,5176,5177,5178,5179,5180,5181,5182,5183,5184,5185,5186,5187,5188,5221,5223,5234,5235,5243,5247,5253,5254,5255,5256,5257,5258,5259,5266,5269,5270,5271,5272,5273,5274,5275,
5292,5293,5294,5295,5296,5297,5298,5299,5300,5301,5302,5303,5304,5305,5306,5307,5308,5309,5310,5311,5316,5320,5321,5325,5329,5330,5331,5337,5343,5344,5345,5346,5347,5348,5349,5355,5356,5357,5361,5362,5367,5382,5383,5387,5388,5389,5396,5456,5457,5459,5460,5461,5462,5463,5469,5472,5479,5480,5481,5482,5490,5513,5514,5518,5519,5520,5523,5530,5531,5532,5533,5534,5535,5536,5537,5538,5539,5550,5551,5552,5559,5562,5563,5564,5565,5566,5567,5568,5569,5570,5571,5572,5573,5574,5575,5576,5577,5578,5579,5580,5581,
5582,5583,5588,5589,5596,5623,5624,5625,5627,5629,5631,5632,5633,5634,5635,5636,5637,5638,5639,5641,5643,5644,5646,5649,5650,5651,5652,5653,5654,5655,5659,5663,5664,5665,5666,5667,5668,5669,5670,5671,5672,5673,5674,5675,5676,5677,5678,5679,5680,5682,5683,5684,5685,5700,5825,5836,5837,5839,5842,5844,5858,5875,5876,5877,5879,5880,5887,5890,5921,5922,5923,5924,5925,5926,5927,5928,5929,5930,5931,5932,5933,5934,5935,5936,5937,5938,5939,5940,6050,6051,6052,6053,6054,6055,6056,6057,6058,6059,6060,6061,6062,
6063,6064,6065,6066,6067,6068,6069,6070,6071,6072,6073,6074,6075,6076,6077,6078,6079,6080,6081,6082,6083,6084,6085,6086,6087,6088,6089,6090,6091,6092,6093,6094,6095,6096,6097,6098,6099,6100,6101,6102,6103,6104,6105,6106,6107,6108,6109,6110,6111,6112,6113,6114,6115,6116,6117,6118,6119,6120,6121,6122,6123,6124,6125,6128,6129,6141,6204,6210,6211,6244,6245,6246,6247,6248,6249,6250,6251,6252,6253,6254,6255,6256,6257,6258,6259,6260,6261,6262,6263,6264,6265,6266,6267,6268,6269,6270,6271,6272,6273,6274,6275,
6307,6312,6316,6328,6329,6330,6331,6332,6333,6334,6335,6336,6337,6338,6339,6340,6341,6342,6343,6344,6345,6346,6347,6348,6350,6351,6352,6353,6354,6355,6356,6362,6366,6367,6368,6369,6370,6371,6372,6381,6382,6383,6384,6385,6386,6387,6391,6393,6394,6395,6396,6397,6398,6399,6400,6401,6402,6403,6404,6405,6406,6407,6408,6409,6410,6411,6412,6413,6414,6415,6416,6417,6418,6419,6420,6421,6422,6423,6424,6425,6426,6427,6428,6429,6430,6431,6432,6433,6434,6435,6436,6437,6438,6439,6440,6441,6442,6443,6444,6445,6446,
6447,6448,6449,6450,6451,6452,6453,6454,6455,6456,6457,6458,6459,6460,6461,6462,6463,6464,6465,6466,6467,6468,6469,6470,6471,6472,6473,6474,6475,6476,6477,6478,6479,6480,6481,6482,6483,6484,6485,6486,6487,6488,6489,6490,6491,6492,6493,6494,6495,6496,6497,6498,6499,6500,6501,6502,6503,6504,6505,6506,6507,6508,6509,6510,6511,6512,6513,6514,6515,6516,6518,6519,6520,6521,6522,6523,6524,6525,6526,6527,6528,6529,6530,6531,6532,6533,6534,6535,6536,6537,6538,6539,6540,6541,6542,6543,6544,6545,6546,6547,6548,
6549,6550,6551,6552,6553,6554,6555,6556,6557,6558,6559,6560,6561,6562,6563,6564,6565,6566,6567,6568,6569,6570,6571,6572,6573,6574,6575,6576,6577,6578,6579,6580,6581,6582,6583,6584,6585,6586,6587,6588,6589,6590,6591,6592,6593,6594,6595,6596,6597,6598,6599,6600,6601,6602,6603,6605,6606,6607,6608,6609,6610,6611,6612,6613,6614,6615,6616,6617,6618,6619,6620,6621,6622,6623,6624,6625,6626,6627,6628,6629,6630,6631,6632,6633,6634,6635,6636,6637,6646,6669,6670,6671,6672,6673,6674,6675,6676,6677,6678,6679,6680,
6681,6682,6683,6684,6685,6686,6687,6688,6689,6690,6691,6692,6703,6707,6708,6709,6720,6721,6722,6723,6732,6733,6734,6735,6736,6737,6738,6784,6785,6786,6787,6788,6789,6790,6791,6792,6793,6794,6795,6796,6797,6798,6799,6800,6801,6802,6803,6804,6805,6806,6807,6808,6809,6810,6811,6812,6813,6814,6815,6816,6817,6818,6819,6820,6821,6822,6823,6824,6825,6826,6827,6828,6829,6830,6831,6832,6833,6834,6835,6836,6837,6838,6839,6840,6841,6842,6843,6844,6845,6846,6847,6848,6849,6850,6851,6852,6853,6854,6855,6856,6857,
6858,6859,6860,6861,6862,6863,6867,6868,6870,6875,6876,6879,6880,6884,6885,6886,6887,6915,6922,6923,6924,6925,6931,6932,6933,6956,6957,6958,6959,6962,6984,6991,7005,7006,7007,7057,7058,7059,7060,7061,7062,7063,7064,7065,7066,7067,7068,7069,7070,7074,7075,7076,7077,7078,7079,7080,7081,7082,7109,7110,7111,7112,7113,7114,7115,7116,7117,7118,7119,7120,7121,7122,7123,7124,7125,7126,7127,7128,7131,7132,7257,7258,7259,7260,7261,7262,7263,7264,7265,7266,7267,7268,7269,7270,7271,7272,7273,7274,7275,7276,7277,
7278,7279,7280,7281,7282,7283,7284,7285,7286,7287,7288,7289,7290,7291,7292,7293,7294,7295,7296,7297,7298,7299,7300,7301,7302,7303,7304,7305,7306,7307,7308,7309,7310,7311,7312,7313,7314,7315,7316,7317,7318,7319,7320,7321,7322,7323,7324,7325,7326,7327,7328,7329,7330,7331,7332,7333,7334,7335,7336,7337,7338,7339,7340,7341,7342,7343,7344,7345,7346,7347,7348,7349,7350,7351,7352,7353,7354,7355,7356,7357,7358,7359,7360,7361,7362,7363,7364,7365,7366,7367,7368,7369,7370,7374,7375,7376,7528,7529,7530,7531,7532,
7533,7534,7535,7536,7537,7538,7539,7540,7541,7542,7543,7544,7545,7546,7547,7548,7549,7550,7551,7552,7553,7554,7555,7556,7557,7558,7559,7560,7561,7562,7563,7564,7565,7566,7567,7568,7569,7570,7571,7572,7573,7574,7575,7576,7577,7578,7579,7580,7581,7582,7583,7584,7585,7586,7587,7588,7589,7590,7591,7592,7593,7594,7595,7596,7597,7598,7599,7600,7601,7602,7603,7604,7605,7606,7607,7608,7609,7610,7611,7612,7613,7614,7615,7616,7617,7618,7619,7620,7621,7622,7623,7624,7625,7626,7627,7628,7629,7630,7631,7632,7633,
7634,7635,7636,7637,7638,7639,7640,7641,7642,7643,7644,7645,7845,7846,7847,7848,7849,7850,7851,7852,7853,7854,7855,7856,7857,7858,7859,20002,20003,20004,20005,20006,20007,20008,20009,20010,20011,20012,20013,20014,20015,20016,20017,20018,20019,20020,20021,20022,20023,20024,20025,20026,20027,20028,20029,20030,20031,20032,20062,20063,20064,20065,20066,20067,20068,20069,20070,20071,20072,20073,20074,20075,20076,20077,20078,20079,20080,20081,20082,20083,20084,20085,20086,20087,20088,20089,20090,20091,
20092,20135,20136,20137,20138,20248,20249,20250,20251,20252,20253,20254,20255,20256,20257,20258,20348,20349,20350,20351,20352,20353,20354,20355,20356,20357,20358,20436,20437,20438,20439,20440,20499,20538,20539,20790,20791,20822,20823,20824,20934,20935,20936,21035,21036,21037,21095,21096,21097,21148,21149,21150,21291,21292,21413,21414,21415,21416,21417,21418,21419,21420,21421,21422,21423,21473,21474,21475,21476,21477,21478,21479,21480,21481,21482,21483,21500,21780,21781,21782,21817,21818,21891,21892,
21893,21894,21896,21897,21898,21899,22032,22033,22091,22092,22171,22172,22173,22174,22175,22176,22177,22181,22182,22183,22184,22185,22186,22187,22191,22192,22193,22194,22195,22196,22197,22234,22235,22236,22332,22391,22392,22521,22522,22523,22524,22525,22700,22770,22780,22832,22991,22992,22993,22994,23028,23029,23030,23031,23032,23033,23034,23035,23036,23037,23038,23090,23095,23239,23240,23433,23700,23830,23831,23832,23833,23834,23835,23836,23837,23838,23839,23840,23841,23842,23843,23844,23845,23846,
23847,23848,23849,23850,23851,23852,23853,23866,23867,23868,23869,23870,23871,23872,23877,23878,23879,23880,23881,23882,23883,23884,23886,23887,23888,23889,23890,23891,23892,23893,23894,23946,23947,23948,24047,24048,24100,24200,24305,24306,24311,24312,24313,24342,24343,24344,24345,24346,24347,24370,24371,24372,24373,24374,24375,24376,24377,24378,24379,24380,24381,24382,24383,24500,24547,24548,24571,24600,24718,24719,24720,24721,24817,24818,24819,24820,24821,24877,24878,24879,24880,24881,24882,24891,
24892,24893,25E3,25231,25391,25392,25393,25394,25395,25828,25829,25830,25831,25832,25833,25834,25835,25836,25837,25838,25884,25932,26191,26192,26193,26194,26195,26237,26331,26332,26391,26392,26393,26432,26591,26592,26632,26692,26701,26702,26703,26704,26705,26706,26707,26708,26709,26710,26711,26712,26713,26714,26715,26716,26717,26718,26719,26720,26721,26722,26729,26730,26731,26732,26733,26734,26735,26736,26737,26738,26739,26740,26741,26742,26743,26744,26745,26746,26747,26748,26749,26750,26751,26752,
26753,26754,26755,26756,26757,26758,26759,26760,26761,26762,26763,26764,26765,26766,26767,26768,26769,26770,26771,26772,26773,26774,26775,26776,26777,26778,26779,26780,26781,26782,26783,26784,26785,26786,26787,26788,26789,26790,26791,26792,26793,26794,26795,26796,26797,26798,26799,26801,26802,26803,26811,26812,26813,26847,26848,26849,26850,26851,26852,26853,26854,26855,26856,26857,26858,26859,26860,26861,26862,26863,26864,26865,26866,26867,26868,26869,26870,26891,26892,26893,26894,26895,26896,26897,
26898,26899,26901,26902,26903,26904,26905,26906,26907,26908,26909,26910,26911,26912,26913,26914,26915,26916,26917,26918,26919,26920,26921,26922,26923,26929,26930,26931,26932,26933,26934,26935,26936,26937,26938,26939,26940,26941,26942,26943,26944,26945,26946,26948,26949,26950,26951,26952,26953,26954,26955,26956,26957,26958,26959,26960,26961,26962,26963,26964,26965,26966,26967,26968,26969,26970,26971,26972,26973,26974,26975,26976,26977,26978,26979,26980,26981,26982,26983,26984,26985,26986,26987,26988,
26989,26990,26991,26992,26993,26994,26995,26996,26997,26998,27037,27038,27039,27040,27120,27200,27205,27206,27207,27208,27209,27210,27211,27212,27213,27214,27215,27216,27217,27218,27219,27220,27221,27222,27223,27224,27225,27226,27227,27228,27229,27230,27231,27232,27258,27259,27260,27291,27292,27391,27392,27393,27394,27395,27396,27397,27398,27429,27492,27493,27500,27561,27562,27563,27564,27571,27572,27573,27574,27581,27582,27583,27584,27591,27592,27593,27594,27700,28191,28192,28193,28232,28348,28349,
28350,28351,28352,28353,28354,28355,28356,28357,28358,28402,28403,28404,28405,28406,28407,28408,28409,28410,28411,28412,28413,28414,28415,28416,28417,28418,28419,28420,28421,28422,28423,28424,28425,28426,28427,28428,28429,28430,28431,28432,28462,28463,28464,28465,28466,28467,28468,28469,28470,28471,28472,28473,28474,28475,28476,28477,28478,28479,28480,28481,28482,28483,28484,28485,28486,28487,28488,28489,28490,28491,28492,28600,28991,28992,29100,29101,29118,29119,29120,29121,29122,29168,29169,29170,
29171,29172,29177,29178,29179,29180,29181,29182,29183,29184,29185,29187,29188,29189,29190,29191,29192,29193,29194,29195,29220,29221,29333,29635,29636,29701,29738,29739,29849,29850,29871,29872,29873,29900,29901,29902,29903,30161,30162,30163,30164,30165,30166,30167,30168,30169,30170,30171,30172,30173,30174,30175,30176,30177,30178,30179,30200,30339,30340,30491,30492,30493,30494,30591,30592,30729,30730,30731,30732,30791,30792,30800,31028,31121,31154,31170,31171,31251,31252,31253,31254,31255,31256,31257,
31258,31259,31265,31266,31267,31268,31275,31276,31277,31278,31279,31281,31282,31283,31284,31285,31286,31287,31288,31289,31290,31291,31292,31293,31294,31295,31296,31297,31370,31461,31462,31463,31464,31465,31466,31467,31468,31469,31491,31492,31493,31494,31495,31528,31529,31600,31700,31838,31839,31900,31901,31917,31918,31919,31920,31921,31922,31965,31966,31967,31968,31969,31970,31971,31972,31973,31974,31975,31976,31977,31978,31979,31980,31981,31982,31983,31984,31985,31986,31987,31988,31989,31990,31991,
31992,31993,31994,31995,31996,31997,31998,31999,32E3,32001,32002,32003,32005,32006,32007,32008,32009,32010,32011,32012,32013,32014,32015,32016,32017,32018,32019,32020,32021,32022,32023,32024,32025,32026,32027,32028,32029,32030,32031,32033,32034,32035,32036,32037,32038,32039,32040,32041,32042,32043,32044,32045,32046,32047,32048,32049,32050,32051,32052,32053,32054,32055,32056,32057,32058,32059,32060,32061,32062,32064,32065,32066,32067,32074,32075,32076,32077,32081,32082,32083,32084,32085,32086,32098,
32099,32100,32104,32107,32108,32109,32110,32111,32112,32113,32114,32115,32116,32117,32118,32119,32120,32121,32122,32123,32124,32125,32126,32127,32128,32129,32130,32133,32134,32135,32136,32137,32138,32139,32140,32141,32142,32143,32144,32145,32146,32147,32148,32149,32150,32151,32152,32153,32154,32155,32156,32157,32158,32161,32164,32165,32166,32167,32180,32181,32182,32183,32184,32185,32186,32187,32188,32189,32190,32191,32192,32193,32194,32195,32196,32197,32198,32199,32201,32202,32203,32204,32205,32206,
32207,32208,32209,32210,32211,32212,32213,32214,32215,32216,32217,32218,32219,32220,32221,32222,32223,32224,32225,32226,32227,32228,32229,32230,32231,32232,32233,32234,32235,32236,32237,32238,32239,32240,32241,32242,32243,32244,32245,32246,32247,32248,32249,32250,32251,32252,32253,32254,32255,32256,32257,32258,32259,32260,32301,32302,32303,32304,32305,32306,32307,32308,32309,32310,32311,32312,32313,32314,32315,32316,32317,32318,32319,32320,32321,32322,32323,32324,32325,32326,32327,32328,32329,32330,
32331,32332,32333,32334,32335,32336,32337,32338,32339,32340,32341,32342,32343,32344,32345,32346,32347,32348,32349,32350,32351,32352,32353,32354,32355,32356,32357,32358,32359,32360,32601,32602,32603,32604,32605,32606,32607,32608,32609,32610,32611,32612,32613,32614,32615,32616,32617,32618,32619,32620,32621,32622,32623,32624,32625,32626,32627,32628,32629,32630,32631,32632,32633,32634,32635,32636,32637,32638,32639,32640,32641,32642,32643,32644,32645,32646,32647,32648,32649,32650,32651,32652,32653,32654,
32655,32656,32657,32658,32659,32660,32661,32662,32664,32665,32666,32667,32701,32702,32703,32704,32705,32706,32707,32708,32709,32710,32711,32712,32713,32714,32715,32716,32717,32718,32719,32720,32721,32722,32723,32724,32725,32726,32727,32728,32729,32730,32731,32732,32733,32734,32735,32736,32737,32738,32739,32740,32741,32742,32743,32744,32745,32746,32747,32748,32749,32750,32751,32752,32753,32754,32755,32756,32757,32758,32759,32760,32761,32766,53001,53002,53003,53004,53008,53009,53010,53011,53012,53013,
53014,53015,53016,53017,53018,53019,53021,53022,53023,53024,53025,53026,53027,53028,53029,53030,53031,53032,53034,53042,53043,53044,53045,53046,53048,53049,53074,53075,53076,53077,53078,53079,53080,54001,54002,54003,54004,54008,54009,54010,54011,54012,54013,54014,54015,54016,54017,54018,54019,54021,54022,54023,54024,54025,54026,54027,54028,54029,54030,54031,54032,54034,54042,54043,54044,54045,54046,54048,54049,54050,54051,54052,54053,54074,54075,54076,54077,54078,54079,54080,65061,65062,65161,65163,
102001,102002,102003,102004,102005,102006,102007,102008,102009,102010,102011,102012,102013,102014,102015,102016,102017,102018,102019,102020,102021,102022,102023,102024,102025,102026,102027,102028,102029,102030,102031,102032,102033,102034,102035,102036,102037,102038,102039,102040,102041,102042,102043,102044,102045,102046,102047,102048,102049,102050,102051,102052,102053,102054,102055,102056,102057,102058,102059,102060,102061,102062,102063,102064,102065,102066,102067,102068,102069,102070,102071,102072,
102073,102074,102075,102076,102077,102078,102079,102080,102081,102082,102083,102084,102085,102086,102087,102088,102089,102090,102091,102092,102093,102094,102095,102096,102097,102098,102099,102100,102101,102102,102103,102104,102105,102106,102107,102108,102109,102110,102111,102112,102113,102114,102115,102116,102117,102118,102119,102120,102121,102122,102123,102124,102125,102126,102127,102128,102129,102130,102131,102132,102133,102134,102135,102136,102137,102138,102139,102140,102141,102142,102143,102144,
102145,102146,102147,102148,102149,102150,102151,102152,102153,102154,102155,102156,102157,102158,102159,102160,102161,102162,102163,102164,102165,102166,102167,102168,102169,102170,102171,102172,102173,102174,102175,102176,102177,102178,102179,102180,102181,102182,102183,102184,102185,102186,102187,102188,102189,102190,102191,102192,102193,102194,102195,102196,102197,102198,102199,102200,102201,102202,102203,102204,102205,102206,102207,102208,102209,102210,102211,102212,102213,102214,102215,102216,
102217,102218,102219,102220,102221,102222,102223,102224,102225,102226,102227,102228,102229,102230,102231,102232,102233,102234,102235,102236,102237,102238,102239,102240,102241,102242,102243,102244,102245,102246,102247,102248,102249,102250,102251,102252,102253,102254,102255,102256,102257,102258,102259,102260,102261,102262,102263,102264,102265,102266,102267,102268,102269,102270,102271,102272,102273,102274,102275,102276,102277,102278,102279,102280,102281,102282,102283,102284,102285,102286,102287,102288,
102289,102290,102291,102292,102293,102294,102295,102296,102297,102298,102299,102300,102301,102302,102303,102304,102305,102306,102307,102308,102309,102310,102311,102312,102313,102314,102315,102316,102317,102318,102319,102320,102321,102322,102323,102324,102325,102326,102327,102328,102329,102330,102331,102332,102333,102334,102335,102336,102337,102338,102339,102340,102341,102342,102343,102344,102345,102346,102347,102348,102349,102350,102351,102352,102353,102354,102355,102356,102357,102358,102359,102360,
102361,102362,102363,102364,102365,102366,102367,102368,102369,102370,102371,102372,102373,102374,102375,102376,102377,102378,102379,102380,102381,102382,102383,102384,102385,102386,102387,102388,102389,102390,102391,102392,102393,102394,102395,102396,102397,102398,102399,102400,102401,102402,102403,102404,102405,102406,102407,102408,102409,102410,102411,102412,102413,102414,102415,102416,102417,102418,102419,102420,102421,102422,102423,102424,102425,102426,102427,102428,102429,102430,102431,102432,
102433,102434,102435,102436,102437,102438,102439,102440,102441,102442,102443,102444,102445,102446,102447,102448,102449,102450,102451,102452,102453,102454,102455,102456,102457,102458,102459,102460,102461,102462,102463,102464,102465,102466,102467,102468,102469,102470,102471,102472,102473,102474,102475,102476,102477,102478,102479,102480,102481,102482,102483,102484,102485,102486,102487,102488,102489,102490,102491,102492,102493,102494,102495,102496,102500,102501,102502,102503,102504,102505,102506,102507,
102508,102509,102510,102511,102512,102513,102514,102515,102516,102517,102518,102519,102520,102521,102522,102523,102524,102525,102526,102527,102528,102529,102530,102531,102532,102533,102534,102535,102536,102537,102538,102539,102540,102541,102542,102543,102544,102545,102546,102547,102548,102549,102550,102551,102552,102553,102554,102555,102556,102557,102558,102559,102560,102561,102570,102571,102572,102573,102574,102575,102576,102577,102578,102579,102580,102581,102582,102583,102584,102585,102586,102587,
102588,102589,102590,102591,102592,102593,102594,102595,102596,102597,102598,102599,102600,102601,102602,102603,102604,102605,102606,102607,102608,102609,102610,102611,102612,102613,102614,102615,102616,102617,102618,102619,102620,102621,102622,102623,102624,102625,102626,102627,102628,102629,102630,102631,102632,102633,102634,102635,102636,102637,102638,102639,102640,102641,102642,102643,102644,102645,102646,102647,102648,102649,102650,102651,102652,102653,102654,102655,102656,102657,102658,102659,
102660,102661,102662,102663,102664,102665,102666,102667,102668,102669,102670,102671,102672,102673,102674,102675,102676,102677,102678,102679,102680,102681,102682,102683,102684,102685,102686,102687,102688,102689,102690,102691,102692,102693,102694,102695,102696,102697,102698,102699,102700,102701,102702,102703,102704,102705,102706,102707,102708,102709,102710,102711,102712,102713,102714,102715,102716,102717,102718,102719,102720,102721,102722,102723,102724,102725,102726,102727,102728,102729,102730,102733,
102734,102735,102736,102737,102738,102739,102740,102741,102742,102743,102744,102745,102746,102747,102748,102749,102750,102751,102752,102753,102754,102755,102756,102757,102758,102761,102762,102763,102764,102765,102766,102767,102768,102769,102770,102771,102772,102773,102774,102775,102776,102777,102778,102779,102780,102781,102782,102783,102784,102785,102786,102787,102788,102789,102790,102791,102792,102793,102794,102795,102796,102797,102798,102962,102963,102965,102966,102967,102968,102969,102970,102971,
102972,102973,102974,102975,102976,102977,102978,102979,102980,102981,102982,102983,102984,102985,102986,102987,102988,102989,102990,102991,102992,102993,102994,102995,102996,102997,102998,102999,103E3,103001,103002,103003,103004,103005,103006,103007,103008,103009,103010,103011,103012,103013,103014,103015,103016,103017,103018,103019,103020,103021,103022,103023,103024,103025,103026,103027,103028,103029,103030,103031,103032,103033,103034,103035,103036,103037,103038,103039,103040,103041,103042,103043,
103044,103045,103046,103047,103048,103049,103050,103051,103052,103053,103054,103055,103056,103057,103058,103059,103060,103061,103062,103063,103064,103065,103066,103067,103068,103069,103070,103071,103072,103073,103074,103075,103076,103077,103078,103079,103080,103081,103082,103083,103084,103085,103086,103087,103088,103089,103090,103091,103092,103093,103094,103095,103096,103097,103098,103099,103100,103101,103102,103103,103104,103105,103106,103107,103108,103109,103110,103111,103112,103113,103114,103115,
103116,103117,103118,103119,103120,103121,103122,103123,103124,103125,103126,103127,103128,103129,103130,103131,103132,103133,103134,103135,103136,103137,103138,103139,103140,103141,103142,103143,103144,103145,103146,103147,103148,103149,103150,103151,103152,103153,103154,103155,103156,103157,103158,103159,103160,103161,103162,103163,103164,103165,103166,103167,103168,103169,103170,103171,103172,103173,103174,103175,103176,103177,103178,103179,103180,103181,103182,103183,103184,103185,103186,103187,
103188,103189,103190,103191,103192,103193,103194,103195,103196,103197,103198,103199,103200,103201,103202,103203,103204,103205,103206,103207,103208,103209,103210,103211,103212,103213,103214,103215,103216,103217,103218,103219,103220,103221,103222,103223,103224,103225,103226,103227,103228,103229,103230,103231,103232,103233,103234,103235,103236,103237,103238,103239,103240,103241,103242,103243,103244,103245,103246,103247,103248,103249,103250,103251,103252,103253,103254,103255,103256,103257,103258,103259,
103260,103261,103262,103263,103264,103265,103266,103267,103268,103269,103270,103271,103272,103273,103274,103275,103276,103277,103278,103279,103280,103281,103282,103283,103284,103285,103286,103287,103288,103289,103290,103291,103292,103293,103294,103295,103296,103297,103298,103299,103300,103301,103302,103303,103304,103305,103306,103307,103308,103309,103310,103311,103312,103313,103314,103315,103316,103317,103318,103319,103320,103321,103322,103323,103324,103325,103326,103327,103328,103329,103330,103331,
103332,103333,103334,103335,103336,103337,103338,103339,103340,103341,103342,103343,103344,103345,103346,103347,103348,103349,103350,103351,103352,103353,103354,103355,103356,103357,103358,103359,103360,103361,103362,103363,103364,103365,103366,103367,103368,103369,103370,103371,103372,103373,103374,103375,103376,103377,103378,103379,103380,103381,103382,103383,103384,103385,103386,103387,103388,103389,103390,103391,103392,103393,103394,103395,103396,103397,103398,103399,103400,103401,103402,103403,
103404,103405,103406,103407,103408,103409,103410,103411,103412,103413,103414,103415,103416,103417,103418,103419,103420,103421,103422,103423,103424,103425,103426,103427,103428,103429,103430,103431,103432,103433,103434,103435,103436,103437,103438,103439,103440,103441,103442,103443,103444,103445,103446,103447,103448,103449,103450,103451,103452,103453,103454,103455,103456,103457,103458,103459,103460,103461,103462,103463,103464,103465,103466,103467,103468,103469,103470,103471,103472,103473,103474,103475,
103476,103477,103478,103479,103480,103481,103482,103483,103484,103485,103486,103487,103488,103489,103490,103491,103492,103493,103494,103495,103496,103497,103498,103499,103500,103501,103502,103503,103504,103505,103506,103507,103508,103509,103510,103511,103512,103513,103514,103515,103516,103517,103518,103519,103520,103521,103522,103523,103524,103525,103526,103527,103528,103529,103530,103531,103532,103533,103534,103535,103536,103537,103538,103539,103540,103541,103542,103543,103544,103545,103546,103547,
103548,103549,103550,103551,103552,103553,103554,103555,103556,103557,103558,103559,103560,103561,103562,103563,103564,103565,103566,103567,103568,103569,103570,103571,103572,103573,103574,103575,103576,103577,103578,103579,103580,103581,103582,103583,103584,103585,103600,103601,103602,103603,103604,103605,103606,103607,103608,103609,103610,103611,103612,103613,103614,103615,103616,103617,103618,103619,103620,103621,103622,103623,103624,103625,103626,103627,103628,103629,103630,103631,103632,103633,
103634,103635,103636,103637,103638,103639,103640,103641,103642,103643,103644,103645,103646,103647,103648,103649,103650,103651,103652,103653,103654,103655,103656,103657,103658,103659,103660,103661,103662,103663,103664,103665,103666,103667,103668,103669,103670,103671,103672,103673,103674,103675,103676,103677,103678,103679,103680,103681,103682,103683,103684,103685,103686,103687,103688,103689,103690,103691,103692,103693,103694,103695,103700,103701,103702,103703,103704,103705,103706,103707,103708,103709,
103710,103711,103712,103713,103714,103715,103716,103717,103718,103719,103720,103721,103722,103723,103724,103725,103726,103727,103728,103729,103730,103731,103732,103733,103734,103735,103736,103737,103738,103739,103740,103741,103742,103743,103744,103745,103746,103747,103748,103749,103750,103751,103752,103753,103754,103755,103756,103757,103758,103759,103760,103761,103762,103763,103764,103765,103766,103767,103768,103769,103770,103771,103772,103773,103774,103775,103776,103777,103778,103779,103780,103781,
103782,103783,103784,103785,103786,103787,103788,103789,103790,103791,103792,103793,103794,103795,103796,103797,103798,103799,103800,103801,103802,103803,103804,103805,103806,103807,103808,103809,103810,103811,103812,103813,103814,103815,103816,103817,103818,103819,103820,103821,103822,103823,103824,103825,103826,103827,103828,103829,103830,103831,103832,103833,103834,103835,103836,103837,103838,103839,103840,103841,103842,103843,103844,103845,103846,103847,103848,103849,103850,103851,103852,103853,
103854,103855,103856,103857,103858,103859,103860,103861,103862,103863,103864,103865,103866,103867,103868,103869,103870,103871,103900,103901,103902,103903,103904,103905,103906,103907,103908,103909,103910,103911,103912,103913,103914,103915,103916,103917,103918,103919,103920,103921,103922,103923,103924,103925,103926,103927,103928,103929,103930,103931,103932,103933,103934,103935,103936,103937,103938,103939,103940,103941,103942,103943,103944,103945,103946,103947,103948,103949,103950,103951,103952,103953,
103954,103955,103956,103957,103958,103959,103960,103961,103962,103963,103964,103965,103966,103967,103968,103969,103970,103971];k("extend-esri")&&H.setObject("dijit.analysis.PCSList",r,p);return r})},"esri/layers/RasterXLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Deferred dojo/sniff dojo/dom-construct dojo/dom-style dojo/on dojox/gfx/matrix dojo/when dojo/DeferredList ../kernel ../config ../lang ../domUtils ../urlUtils ../graphic ../request ../renderers/ClassBreaksRenderer ../renderers/StretchRenderer ../renderers/UniqueValueRenderer ../renderers/ColormapRenderer ../renderers/ShadedReliefRenderer ../geometry/Extent ../SpatialReference ../geometry/Point ./Field ./TimeInfo ./MosaicRule ./DimensionalDefinition ./PixelBlock ./ImageServiceLayerMixin ./rasterLib/raster/rasterFactory ./rasterLib/raster/rasterProjectionHelper ./rasterLib/renderer/rasterRendererHelper ./rasterLib/tile/RasterTileInfo ./rasterLib/tile/RasterTileManager ./rasterLib/tile/RasterHandler ./layer".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x,w,A,z,G,I,K,R,U,ba,ca,da,ja,ea,L,O,S){var T=g.defaults.map.zoomDuration;H=H([S],{declaredClass:"esri.layers.RasterXLayer",managedSuspension:!0,opacity:1,tileMode:!0,useWebGL:!0,drawMode:!0,_eventMap:{"raster-change":!0,"renderer-change":!0},_lastPopup:[],_rasterFieldPrefix:"Raster.",_cachedVariableStats:{},_cachedVariableHistogram:{},constructor:function(J,N){N=N||{};this.tileMode=null!=N.tileMode?N.tileMode:this.tileMode;this.useWebGL=null!=
N.useWebGL?N.useWebGL:this.useWebGL;this.roaming=null!=N.roaming?N.roaming:this.roaming;this.drawMode=null!=N.drawMode?N.drawMode:this.drawMode;this.bandIds=N.bandIds&&0<N.bandIds.length?N.bandIds:null;this.renderer=N.renderer;this._customModules=N.customModules;this.useMapTime=N.useMapTime;if(N.multidimensionalDefinition&&0<N.multidimensionalDefinition.length){var C=new K;C.multidimensionalDefinition=N.multidimensionalDefinition.map(function(P){return P.toJson?P:new R(P)});C.method=K.METHOD_NONE;
this.mosaicRule=C}this.infoTemplate=N.infoTemplate;this.drawMode||(this._contextType=N._contextType||N.drawType);this._supportLegacyPropMethods=!1!==N.legacySupport;this._rasterHandler=new O({customModules:this._customModules});this._workInitPromise=this._rasterHandler.start();this.pixelData=null;this._initialize(J,N);d(this,"load",k.hitch(this,function(){e(this._rasterHandler._connected||this._rasterHandler._connectionPromise,k.hitch(this,function(){this._rasterHandler.setLayer({layerId:this.id,
raster:{rasterInfo:this.raster.rasterInfo,rasterFunction:this.raster.rasterFunction&&this.raster.rasterFunction.toJson()},bandCount:this.raster.rasterInfo.bandCount});this.raster.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this.id,data:this.raster.rasterFunction.toJson(!0)});this._rasterRenderer&&this._rasterHandler.setRasterRenderer({layerId:this.id,data:this._rasterRenderer.toJson(!0)})}))}));this._animatePan2d=k.hitch(this,this._animatePan2d)},setOpacity:function(J){this.opacity!==
J&&(this.opacity=J,this.onOpacityChange(J))},onOpacityChange:function(){},onRendererChange:function(){},refresh:function(){if(this.loaded&&this._map)if(!this._canDraw()||10>l("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(J,N,C,P){this._canDraw()&&(this.useWebGL||(C?this._context.clearRect(J,N,C,P):this._context.clearRect(0,0,this._map.width,this._map.height)))},getContext:function(){return this._context},
onResume:function(){this.inherited(arguments);this._toggleTime();q.show(this._div);if("css-transforms"===this._map.navigationMode){var J=this._map.__visibleDelta;this._left=this._tdx=J.x;this._top=this._tdy=J.y;a.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(k.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._fireUpdateEnd();this._toggleTime();
q.hide(this._div);clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.useWebGL&&this._glSetting&&(this._glSetting.hasNewTexture=!1);var J=this.tileMode?this.tileManager.originalPixelData:this.originalPixelData;if(this.tileMode?J&&(J.src||J.texture):J)if(this.tileMode)if(this.useWebGL)this._updateAllTilesOnce(J);else{this.tileManager.tiles.forEach(function(C){C&&(C.update=null,C.completed=!1,C.processedPixelBlock=null,C.renderedPixelBlock=null)});J.processedPixelBlock=
null;var N=this.raster.rasterFunction?this.raster.rasterFunction.read(J):{extent:J.extent,pixelBlock:J.src[this.tileManager.identifiers[0]]&&J.src[this.tileManager.identifiers[0]].pixelBlock};J.renderedPixelBlock=null;J=this._rasterRenderer?this._rasterRenderer.draw(N):N;this._drawOneFrame(J)}else this._supportLegacyPropMethods&&this.pixelFilter?this._setPixelData(this.originalPixelData):(J.processedPixelBlock=null,N=this.raster.rasterFunction?this.raster.rasterFunction.read(J):{extent:J.extent,pixelBlock:J.src?
J.src[this.tileManager.identifiers[0]]&&J.src[this.tileManager.identifiers[0]].pixelBlock:J.pixelBlock},J.renderedPixelBlock=null,J=this._rasterRenderer?this._rasterRenderer.draw(N):N,this._drawOneFrame(J))},getCurrentResolution:function(){var J=this._map.extent;return new z((J.xmax-J.xmin)/this._map.width,(J.ymax-J.ymin)/this._map.height,J.spatialReference)},getCustomRasterFields:function(J){var N=J?J.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix,C={name:this._rasterFieldPrefix+"ServicePixelValue",
alias:"Pixel Value",domain:null,editable:!1,length:50,type:10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString"};J=this.fields?k.clone(this.fields):[];J.push(C);(C=this.rasterAttributeTable&&this.rasterAttributeTable.fields)&&0<C.length&&(C=r.filter(C,function(P){return"esriFieldTypeOID"!==P.type&&"value"!==P.name.toLowerCase()}),C=r.map(C,function(P){var Q=k.clone(P);Q.name=N+P.name;return Q}),J=J.concat(C));return J},setRenderer:function(J,N){if(this.loaded&&J){if(J.declaredClass&&-1<
J.declaredClass.indexOf("esri.layers.rasterLib")){this._rasterRenderer=J;this._rasterRenderer.bind({layer:this});var C=this.bandIds=J.bandIndex;this.raster&&this.raster.setFetchParameters({bandIds:C});this._params&&(this._params.bandIds=C&&0<C.length?C.join(","):null);this.renderer=this._getCommonRenderer(J)}else C=k.clone(J.toJson?J.toJson():J),"rasterStretch"===C.type&&(C.bandIndex=this.bandIds,C.bandIndex&&1<C.bandIndex.length||!C.bandIndex&&this.raster&&1<this.raster.rasterInfo.bandCount)&&(C.type=
"rgb"),this._rasterRenderer=ja.create(C),this.renderer=J.declaredClass?J:this._getCommonRenderer(this._rasterRenderer),this._rasterRenderer.bind({layer:this});if(this._map){if(this.loaded&&this._rasterHandler._connected){var P=this._rasterHandler.setRasterRenderer({layerId:this.id,data:this._rasterRenderer.toJson(!0)});this._updateTilingEffects()}N||(P?P.then(k.hitch(this,function(){this.redraw()})):this.redraw());this.onRendererChange()}}},setBandIds:function(J,N){this.bandIds=J;this.raster&&this.raster.setFetchParameters({bandIds:J});
this._params&&(this._params.bandIds=J&&0<J.length?J.join(","):null);this.setRenderer(this.renderer,N)},_setTime:function(J){J=J?J.toJson():null;this._params&&(this._params.time=J);this.raster.setFetchParameters({time:J});this.tileManager&&this.tileManager.tiles&&this.tileManager.resetTiles()},setInfoTemplate:function(J){this.infoTemplate=J;this._updateInfoTemplateFields(this.fields)},setMultiDimensionalDefinition:function(J,N){var C=J&&J.multidimensionalDefinition;if(C&&this.loaded){var P=C&&C[0].variableName;
""===P&&(P=this._multidimensionalInfo.variables[0].name,C.forEach(function(Y){Y.variableName=P}));if("ImageService"===this.raster.sourceType){var Q=this.raster._getAllDimensionDefinition(C,P);Q.defChanged&&(J.multidimensionalDefinition=Q.definition,this.setMosaicRule(J,!0))}this.raster.setFetchParameters({multidimensionalDefinition:C});this.tileManager&&this.tileManager.tiles&&this.tileManager.resetTiles();P&&this._updateRasterInfo(P);N||this.refresh()}},_updateRasterInfo:function(J){var N=this.raster.rasterInfo,
C=this.getHistograms({variableName:J});J=this.getStatistics(J);(new h([C,J])).then(k.hitch(this,function(P){P[0][0]&&(N.histograms=P[0][1].histograms);P[1][0]&&(N.statistics=P[1][1]);this.refresh()}))},_updateInfoTemplateFields:function(J){if(J&&!(1>J.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&!(1>this.infoTemplate.info.fieldInfos.length)){var N,C;var P=this.infoTemplate.info.fieldInfos;for(N=0;N<J.length;N++){var Q=J[N];for(C=0;C<P.length;C++)if(P[C].fieldName.toLowerCase()===
Q.name.toLowerCase()&&P[C].fieldName!==Q.name){P[C].fieldName=Q.name;break}}}},getPixelData:function(J){return this.tileMode?J?this.tileManager&&this.tileManager.originalPixelData&&this.tileManager.originalPixelData.src&&this.tileManager.originalPixelData.src[this.tileManager.identifiers[0]]:null:this.inherited(arguments)},fetchPopupFromTiles:function(J){var N=new m;this.identify(J.geometry).then(function(C){var P=C.pixelValue;this.hasStdTime()&&P&&P.length&&null!=P[0]&&(P=P.map(function(fa){return this.getStdTimeValue(fa)}.bind(this)).join(", "));
if(P){C={ObjectId:0,"Raster.ServicePixelValue":P};var Q=this.rasterAttributeTable&&this.rasterAttributeTable.features;if(Q&&0<Q.length&&(Q=r.filter(Q,function(fa){if(fa&&fa.attributes)return fa.attributes.hasOwnProperty("Value")?fa.attributes.Value==P:fa.attributes.VALUE==P}),0<Q.length&&(Q=k.clone(Q[0]))))for(var Y in Q.attributes)Q.attributes.hasOwnProperty(Y)&&(C[this._rasterFieldPrefix+Y]=Q.attributes[Y]);Y=new u(new w(this.projectedFullExtent||this.fullExtent),null,C);Y.setInfoTemplate(this.infoTemplate);
Y._layer=this;this._lastPopup=[Y];N.resolve([Y])}else this._lastPopup=[],N.resolve()}.bind(this),function(C){this._lastPopup=[];N.resolve(C)});return N},getPopupFromTiles:function(){return this._lastPopup},identify:function(J,N){return this.raster?this.raster.identify(J):(J=new m,J.reject("layer must be initialized to identify"),J.promise)},_getCommonRenderer:function(J){switch(J.rendererName){case "RGB":case "Stretch":return new D(J.toCommonRendererJson());case "UniqueValue":return new B(J.toCommonRendererJson());
case "ClassBreaks":return new y(J.toCommonRendererJson());case "Colormap":return new E(J.toCommonRendererJson());case "ShadedRelief":return new x(J.toCommonRendererJson())}},_getProjectedFullExtent:function(J){return this.raster.getProjectedFullExtent(J).then(k.hitch(this,function(N){this.projectedFullExtent=N}))},_initialize:function(J,N){N=N||{};this._supportLegacyPropMethods&&this.constructor._onMap&&(this.constructor._onMap["rendering-change"]={method:"onRenderingChange"},this.constructor._onMap["mosaic-rule-change"]=
{method:"onMosaicRuleChange"},this.constructor._onMap["spatial-reference-change"]={method:"onSpatialReferenceChange"});this.raster={};var C=N.raster?N.raster.url:J;C&&-1<C.toLowerCase().indexOf("/imageserver")&&this._supportLegacyPropMethods&&this._addLegacySupport(C,N);var P=k.hitch(this,function(){this.loaded=!0;this.mosaicRule&&this.mosaicRule.multidimensionalDefinition&&0<this.mosaicRule.multidimensionalDefinition.length&&this.setMultiDimensionalDefinition(this.mosaicRule,!0);this.raster._setRasterHandler(this._rasterHandler);
this.onLoad(this);var Q=this._loadCallback;Q&&(delete this._loadCallback,Q(this))});(J?ca.create(k.mixin({url:J},N)):N.raster&&N.raster.open()).then(k.hitch(this,function(Q){if(Q){this.raster=Q;var Y=this._getSourceImageServiceRaster();this.url||(this.url=Y&&Y.url);this.url&&(this._url=v.urlToObject(J));var fa=N.minScale,na=N.maxScale,la=Q.tileInfo&&"Raster"===Q.tileInfo.tileType;null==na&&(na=la&&N.zoomFactor?Q.tileInfo.lods[Q.tileInfo.lods.length-1].scale/N.zoomFactor:this.maxScale);null==fa&&(fa=
la&&N.zoomFactor?Q.tileInfo.lods[0].scale*N.zoomFactor:this.minScale);Y&&"ImageService"===Y.sourceType&&this._supportLegacyPropMethods&&this._addGeneralProperties(J,N);this.initialExtent=this.fullExtent=this.extent=this.raster.rasterInfo.extent;this.spatialReference=this.extent.spatialReference;this.timeInfo=this.raster.rasterInfo.timeInfo?new I(this.raster.rasterInfo.timeInfo):null;this.rasterAttributeTable=this.raster.rasterInfo.vat;this._multidimensionalInfo=this.raster.rasterInfo.multidimensionalInfo;
this.rasterAttributeTable&&(this._rasterAttributeTableFields=this.rasterAttributeTable.fields);this.mosaicRule&&this.raster.setFetchParameters({multidimensionalDefinition:this.mosaicRule.multidimensionalDefinition});this._multidimensionalInfo&&(this._getDefaultMultidimensionalDefinition(this._multidimensionalInfo,!0,!0),this.mosaicRule||(this.mosaicRule=this.defaultMosaicRule,this.raster.setFetchParameters({multidimensionalDefinition:this._defaultMultidimensionalDefinition})),this.raster.defaultMultidimensionalDefinition=
this._defaultMultidimensionalDefinition);null==fa||this._hasMin||this.setMinScale(fa);null==na||this._hasMax||this.setMaxScale(na);this._workInitPromise?this._workInitPromise.then(P,P):P()}else console.error("cannot create rasterx layer as the raster data source cannot be opened")}),this._errorHandler)},_getSourceImageServiceRaster:function(){var J=this.raster&&"Function"===this.raster.sourceType?1===this.raster.getMemberRasters().length?this.raster.getMemberRasters()[0]:null:this.raster;if(J&&"ImageService"===
J.sourceType)return J},_addLegacySupport:function(J,N){this._url=v.urlToObject(J);N=N||{};this.format=(J=N.imageServiceParameters)&&J.format;this.compressionTolerance=J&&J.compressionTolerance?J.compressionTolerance:.01;this.interpolation=J?J.interpolation:null;this.compressionQuality=J?J.compressionQuality:null;this.bandIds=J&&J.bandIds||N&&N.bandIds||null;this.mosaicRule||(this.mosaicRule=J?J.mosaicRule:null);this.renderingRule||(this.renderingRule=J?J.renderingRule:null);this.useMapDimensionValue=
N.hasOwnProperty("useMapDimensionValue")?!!N.useMapDimensionValue:!0;this.hasImageFilter=N.hasImageFilter;this.activeMapDimensions=N.activeMapDimensions;this._params=k.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},J?J.toJson():{});this.pixelFilter=N.pixelFilter;this.originalPixelData=this.pixelData=null;this._queryVisibleRastersHandler=k.hitch(this,this._queryVisibleRastersHandler);
this._useRenderingRuleAttributeTable=!1;this._rasterFunctionTemplateInfos={};this._customRenderingRuleId={};this._setDefaultFilter=function(){};var C={setInterpolation:"interpolation",setCompressionQuality:"compressionQuality",setCompressionTolerance:"compressionTolerance",setBandIds:"bandIds",setDefaultBandIds:"bandIds",setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setImageFormat:"format"},P,Q=new ba;Object.keys(C).forEach(k.hitch(this,function(Y){this[Y]=k.hitch(this,function(fa,na){P=
{};P[C[Y]]=fa;this.raster&&(this.raster.setFetchParameters(P),Q[Y].bind(this)(fa,na))})}));this.setDisableClientCaching=function(Y){Q.setDisableClientCaching.bind(this)(Y);var fa=this._getSourceImageServiceRaster();fa?fa.disableClientCaching=Y:null}.bind(this);this.setDefinitionExpression=Q.setDefinitionExpression.bind(this);this.setUseMapTime=Q.setUseMapTime.bind(this);this._toggleTime=Q._toggleTime.bind(this);this._onTimeExtentChangeHandler=Q._onTimeExtentChangeHandler.bind(this);this.setPixelFilter=
Q.setPixelFilter.bind(this);this.getHistograms=Q.getHistograms.bind(this);this.getRasterFunctionInfos=Q.getRasterFunctionInfos.bind(this);this.getKeyProperties=Q.getKeyProperties.bind(this);this.getRasterAttributeTable=Q.getRasterAttributeTable.bind(this);this.getRenderingRuleServiceInfo=Q.getRenderingRuleServiceInfo.bind(this);this._getRenderingRuleId=Q._getRenderingRuleId.bind(this);this._isRenderingRuleAProcessingTemplate=Q._isRenderingRuleAProcessingTemplate.bind(this);this.handleSpatialReferenceChange=
Q.handleSpatialReferenceChange.bind(this);this.onRenderingChange=this.onRenderingChange||function(){};this.onSpatialReferenceChange=this.onSpatialReferenceChange||function(){};this.onMosaicRuleChange=this.onMosaicRuleChange||function(Y){};this.setRasterRenderer=this.setRenderer;this.getMultidimensionalInfo=Q.getMultidimensionalInfo.bind(this);this.getColormap=Q.getColormap.bind(this);this.getRenderingRuleColormap=Q.getRenderingRuleColormap.bind(this);this.getDefaultMultidimensionalDefinition=Q.getDefaultMultidimensionalDefinition.bind(this);
this._getDefaultMultidimensionalDefinition=Q._getDefaultMultidimensionalDefinition.bind(this);this._getDefaultDimensionValue=Q._getDefaultDimensionValue.bind(this);this.getStatistics=Q.getStatistics.bind(this)},_addGeneralProperties:function(){var J=this._getSourceImageServiceRaster();if(J){var N=["minScale","maxScale","tileInfo"];Object.keys(J.serviceInfo).forEach(function(Q){null==this[Q]&&-1===N.indexOf(Q)&&(this[Q]=J.serviceInfo[Q])}.bind(this));this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=
parseFloat(this.pixelSizeY);this.bands=J.rasterInfo.statistics;var C,P=[];this.fields=this.fields||[];for(C=0;C<this.fields.length;C++)P.push(new G(this.fields[C]));this.fields=P;this.version=this.currentVersion;this.defaultMosaicRule=J.serviceInfo.defaultMosaicRule}},setDefaultRenderer:function(){if(this.loaded&&this._canvas&&!this.pixelFilter){var J=ja.createDefaultRenderer(this);if(null!=J){var N=this.mosaicRule&&this.mosaicRule.multidimensionalDefinition&&0<this.mosaicRule.multidimensionalDefinition.length;
if(this._multidimensionalInfo&&N&&"Stretch"===J.rendererName){var C=this.mosaicRule.multidimensionalDefinition[0].variableName;(N=this._multidimensionalInfo.variables.filter(function(P){return P.name===C})[0])&&N.histograms&&N.histograms.length&&(J.histograms=N.histograms,6===J.stretchType&&(J.dra=!1));N&&N.statistics&&N.statistics.length&&(J.statistics=N.statistics.map(function(P){return[P.min,P.max,P.mean,P.stddev||P.standardDeviation]}),6!==J.stretchType&&(J.dra=!1))}this.setRenderer(J,!0)}}},
setDefaultInterpolation:function(){if(this.loaded&&this._canvas){var J=this.raster.serviceInfo&&this.raster.serviceInfo.defaultResamplingMethod;if(J)switch(J.toLowerCase()){case "bilinear":this.interpolation="RSP_BilinearInterpolation";break;case "cubic":this.interpolation="RSP_CubicConvolution";break;case "majority":this.interpolation="RSP_Majority";break;case "nearest":this.interpolation="RSP_NearestNeighbor"}else{J=this.raster.dataType&&this.raster.dataType.toLowerCase();var N=!!this.raster.rasterInfo.colormap;
this.raster.rasterInfo.vat||N||"thematic"===J||"StdTime"===J?"RSP_NearestNeighbor":"RSP_BilinearInterpolation"}}},_toggleTime:function(){},_updateTilingEffects:function(){(this._hasTilingEffects=this._rasterRenderer&&this._rasterRenderer.hasTilingEffects()||this.raster&&this.raster.rasterFunction&&this.raster.rasterFunction.hasTilingEffects())&&this._map&&this.tileMode&&this.useWebGL&&this.tileManager&&(this._hasTilingEffects=!1)},_setMap:function(J,N){this.inherited(arguments);J.spatialReference&&
(J.spatialReference.ics||J.spatialReference.icsId)&&(this.roaming=this.useWebGL=this.tileMode=!1);if(this.tileMode){this.virtualTileInfo=new ea(null,{refTileInfo:J.tileInfo,spatialReference:J.spatialReference,extent:this.raster.rasterInfo.extent});var C=this.raster.tileInfo&&(-1<["Elevation","Raster"].indexOf(this.raster.tileInfo.tileType)||3===this.raster.rasterInfo.bandCount&&"U8"===this.raster.rasterInfo.pixelType)?this.raster.tileInfo:this.virtualTileInfo;this._tileParams=this._tileParams||{};
this._tileParams.size=C.cols+","+C.rows;this.tileManager=new L({tileInfo:C,layer:this,mapSR:J.spatialReference})}this._dragOrigin={x:0,y:0};C=this._div=b.create("div",null,N);var P={width:J.width+"px",height:J.height+"px",position:"absolute"};"css-transforms"===J.navigationMode?this.roaming&&this.tileMode&&this.useWebGL||(P[c._css.names.transform]=c._css.translate(J.__visibleDelta.x,J.__visibleDelta.y),this._left=J.__visibleDelta.x,this._top=J.__visibleDelta.y):this._left=this._top=0;a.set(C,P);this._canvas=
b.create("canvas",{width:J.width+"px",height:J.height+"px",style:"position: absolute;"},C);n.isDefined(this.opacity)&&a.set(C,"opacity",this.opacity);this._contextType?(this._context=this._canvas.getContext(this._contextType,null),this.useWebGL=this._context instanceof WebGLRenderingContext):this.useWebGL?(this._context=this._canvas.getContext("webgl",null)||this._canvas.getContext("experimental-webgl",null),this.drawMode=!1):(this._context=this._canvas.getContext("2d"),this.drawMode=!0);this._context||
console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this.useWebGL&&(J.acquireWebGLContext(this),this._glSetting={gl:this._context,branchCount:this.raster.rasterFunction?this.raster.rasterFunction.branchCount:0,pingpong:null,branches:null,drawMesh:this._drawMesh,programUniforms:{}});this.raster.rasterFunction&&(this._updateTilingEffects(),this.raster.setProcessingContext({layer:this}));this.setRenderer(this.renderer,!0);this._rasterRenderer||this.setDefaultRenderer();
this.interpolation||this.setDefaultInterpolation();this._mapWidth=J.width;this._mapHeight=J.height;this._connects=[];this._connects.push(p.connect(J,"onPan",this,this._panHandler));this._connects.push(p.connect(J,"onPanEnd",this,this._panEndHandler));"css-transforms"===J.navigationMode?this._connects.push(p.connect(J,"onScale",this,this._onScaleHandler)):(this._connects.push(p.connect(J,"onZoom",this,this._onZoomHandler)),this._connects.push(p.connect(J,"onZoomEnd",this,this._onZoomEndHandler)));
this._connects.push(p.connect(J,"onResize",this,this._onResizeHandler));this._connects.push(p.connect(J,"onExtentChange",this,this._extentChangeHandler));this._connects.push(p.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(p.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:J.width,height:J.height};this.evaluateSuspension();if(this.suspended&&!J.loaded)var Q=p.connect(J,"onLoad",this,function(){p.disconnect(Q);
Q=null;this.evaluateSuspension()});return C},_unsetMap:function(J,N){this.useWebGL&&J.releaseWebGLContext(this);r.forEach(this._connects,p.disconnect,this);var C=this._div;C&&(N.removeChild(C),b.destroy(C));this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(J){"CancelError"!==J.name&&(this.clear(),
this.onError(J))},_clonePixelData:function(J){if(null===J||J.texture)return J;var N={};J.extent&&(N.extent=k.clone(J.extent));var C=J.pixelBlock;null!=C&&(N.pixelBlock=C.clone());N.texture=J.texture;return N},_setPixelData:function(J){if(J){J=this._clonePixelData(J);this.pixelFilter&&(this.pixelFilter.filter?(this.pixelFilter.renderTexture=!0,this.pixelFilter.filter(J)):this.pixelFilter(J));this.pixelData=J;if(this._rasterReadPromise&&this._rasterReadPromise.isCanceled())return;this._drawPixelData()}this._rasterReadPromise=
null},_requestData:function(J,N,C){this._rasterReadPromise&&this._rasterReadPromise.cancel();J=k.clone(J)._normalize(!0);this._rasterReadPromise=this.raster.read({extent:J,width:this._map.width,height:this._map.height});this._rasterReadPromise.then(k.hitch(this,function(P){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=P&&P.srcData?{extent:P.extent,src:P.srcData}:P,this.useWebGL&&this._glSetting&&(this._glSetting.hasNewTexture=!0),this._setPixelData(P))}),k.hitch(this,
this._requestDataErrorHandler));return this._rasterReadPromise},_drawPixelData:function(J){a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top)),a.set(this._canvas,c._css.names.transform,
c._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});this.useWebGL&&this._rasterRenderer&&this._rasterRenderer.draw(this.pixelData);if(this._canDraw()&&this.drawMode&&this.drawMode&&(J=J||this.pixelData)&&J.pixelBlock){var N=this.pixelFilter?this.pixelData:this._rasterRenderer?this._rasterRenderer.draw(J):J;J=N.pixelBlock;var C=this._context,P=C.createImageData(J.width,J.height);P.data.set(J.getAsRGBA());N=N.extent;var Q=this._map.extent,Y=this.getCurrentResolution(),fa=0,na=0;Math.abs(N.xmin-
Q.xmin)>Y.x&&(fa=Math.round((N.xmin-Q.xmin)/Y.x));Math.abs(Q.ymax-N.ymax)>Y.y&&(na=Math.round((Q.ymax-N.ymax)/Y.y));"css-transforms"===this._map.navigationMode?(this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top)),a.set(this._canvas,c._css.names.transform,c._css.translate(-this._left,-this._top))):(a.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),a.set(this._canvas,
{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};this.tileMode?this.clear(fa,na,J.width,J.height):this.clear();C.putImageData(P,fa,na,0,0,J.width,J.height);this._fireUpdateEnd()}},hasStdTime:function(){if(!this.hasMultidimensions||"StdTime"!==this.raster.dataType)return!1;var J=this.mosaicRule&&this.mosaicRule.multidimensionalDefinition,N=J&&J.length?J[0].variableName:this._defaultMultidimensionalDefinition[0].variableName;return this.raster.rasterInfo.multidimensionalInfo.variables.some(function(C){if(C.name===
N)return C.dimensions.some(function(P){return"StdTime"===P.name})})},getStdTimeValue:function(J){return(new Date(864E5*(J-25569))).toString()},_animatePan2d:function(){this._oldDelta&&this._delta.x===this._oldDelta.x&&this._delta.y===this._oldDelta.y||(this.tileManager.updateTile(this.tileManager.originalPixelData,!0),this._oldDelta={x:this._delta.x,y:this._delta.y});this._roamingAnimation&&this.tileMode&&this.useWebGL&&(this._roamingAnimation=requestAnimationFrame(this._animatePan2d))},_cancelAnimation:function(){this._animation&&
(cancelAnimationFrame(this._animation),this._animation=null)},_updateAllTilesOnce:function(J,N){return this.tileManager.updateTile(J,!0).then(k.hitch(this,function(C){(this._hasTilingEffects||this.useWebGL||N)&&this._drawOneFrame(C)}))},_drawOneFrame:function(J,N){if(!(this.suspended||!this._map||this.tileMode&&!this._drawTile||(this.tileMode&&this.useWebGL&&this.tileManager.originalPixelData.isEmpty&&this._context.clear(this._context.COLOR_BUFFER_BIT),this.tileMode&&this.useWebGL&&this.tileManager.xformSetting&&
this.tileManager.xformSetting.requireProjection&&!this.tileManager.xformSetting.gridConfig))){if(!this._resetCss||this._levelChange)this._levelChange=!1,this._resetDrawing();if(J&&(J.renderedPixelBlock||J.pixelBlock)&&this._canDraw()&&this.drawMode){N=J.extent;var C=this._map.extent;if(!this._isExtentOutSide(N,C)){var P=J.pixelBlock||J.renderedPixelBlock,Q=this._context,Y=Q.createImageData(P.width,P.height);Y.data.set((J.renderedPixelBlock||J.pixelBlock).getAsRGBA());J=this.getCurrentResolution();
var fa=0,na=0;Math.abs(N.xmin-C.xmin)>J.x&&(fa=Math.round((N.xmin-C.xmin)/J.x));Math.abs(C.ymax-N.ymax)>J.y&&(na=Math.round((C.ymax-N.ymax)/J.y));Q.putImageData(Y,fa,na,0,0,P.width,P.height)}}else this._fireUpdateEnd()}},_isExtentOutSide:function(J,N){return J.xmax<=N.xmin||J.xmin>=N.xmax||J.ymax<=N.ymin||J.ymin>=N.ymax},_resetDrawing:function(){this._resetCss=!0;if(!this.useWebGL)if(this._multiply||this._startRect.width!==this._map.width||this._startRect.height!==this._map.height)this.clear();else{var J=
this._context.getImageData(0,0,this._map.width,this._map.height);this.clear();this._context.putImageData(J,this._startRect.left,this._startRect.top)}this._dragOrigin={x:0,y:0};this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});"css-transforms"===this._map.navigationMode?(this.roaming&&this.tileMode&&this.useWebGL&&(this._delta=null),this._tdx=this._left,this._tdy=this._top,
this._multiply=null,a.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top)),a.set(this._canvas,c._css.names.transform,c._css.translate(-this._left,-this._top))):(a.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}))},_drawAllFrames:function(){if(!this.suspended&&this._map&&(!this.tileMode||this._drawTile))if(this._resetCss){var J=this._frames,
N=0,C;for(C=0;C<J.length;C++)if(J[C].completed)N++;else if(J[C].tileData.renderedPixelBlock){J[C].completed=!0;var P=J[C].tileData;break}else if(J[C].tileData._fetched&&!J[C].tileData.src){J[C].completed=!0;break}else if(J[C].tileData.update&&J[C].tileData.update.isFulfilled()&&!J[C].tileData.renderedPixelBlock){J[C].completed=!0;break}else J[C].tileData.fetch&&(!0===J[C].tileData.fetch||J[C].tileData.fetch.isCanceled()||J[C].tileData.fetch.isRejected())?(J[C].completed=!0,N++):this._isExtentOutSide(J[C].tileData.extent,
this._map.extent)&&(J[C].completed=!0,N++);if(P){N++;var Q=P.extent,Y=this._map.extent,fa=this.getCurrentResolution(),na=C=0;Math.abs(Q.xmin-Y.xmin)>fa.x&&(C=Math.round((Q.xmin-Y.xmin)/fa.x));Math.abs(Y.ymax-Q.ymax)>fa.y&&(na=Math.round((Y.ymax-Q.ymax)/fa.y));P.renderedPixelBlock?(Q=P.renderedPixelBlock,Y=this._context.createImageData(Q.width,Q.height),Y.data.set(P.renderedPixelBlock.getAsRGBA()),this._context.putImageData(Y,C,na,0,0,Q.width,Q.height)):this.clear(C,na,P.width,P.height)}N===J.length?
(this._animation=null,this._fireUpdateEnd()):this._animation=requestAnimationFrame(k.hitch(this,this._drawAllFrames))}else this._resetDrawing(),this._animation=requestAnimationFrame(k.hitch(this,this._drawAllFrames))},_fetchTiles:function(J,N){if(!this.suspended&&this.loaded){this._cancelAnimation();var C=this.tileManager,P=!(C.xformSetting.requireProjection&&C.xformSetting.requirePE)||da.load();e(P,k.hitch(this,function(){C.updateExtent(J,this.getCurrentResolution());this._resetCss=!1;C.fetchTiles(N);
N&&(this._hasTilingEffects||this.useWebGL?this.useWebGL&&0<C.tiles.length?(C.fillupTiles(),C._validateRawPixelBlocks(C.originalPixelData)?this._updateAllTilesOnce(C.originalPixelData):C.originalPixelData&&C.originalPixelData.src&&C.tiles.some(function(Q){return Q.updateCompleted})&&this._context.clear(this._context.COLOR_BUFFER_BIT),C.tiles.forEach(k.hitch(this,function(Q){Q.update&&!Q.updateCompleted&&Q.update.then(function(Y){Q.updateCompleted||(Q.updateCompleted=!0);(this._hasTilingEffects||this.useWebGL)&&
this._drawOneFrame(Y)}.bind(this))}))):this._hasTilingEffects&&e(C.fetchAllCompleted.isResolved()||C.fetchAllCompleted,k.hitch(this,function(){this._updateAllTilesOnce(C.originalPixelData)})):(this._frames=C.tiles.map(function(Q){return{completed:!1,tileData:Q}}),this._drawAllFrames()))}))}},_redrawTiles:function(){this._fetchTiles(this._map.extent,!0)},_panHandler:function(J,N){this._drawTile=!1;"css-transforms"===this._map.navigationMode?this.roaming&&this.tileMode&&this.useWebGL?(this._delta=N,
!this._roamingAnimation&&this.tileMode&&(this._roamingAnimation=requestAnimationFrame(this._animatePan2d))):(this._left=this._map.__visibleDelta.x+N.x,this._top=this._map.__visibleDelta.y+N.y,a.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top))):a.set(this._div,{left:this._startRect.left+N.x+"px",top:this._startRect.top+N.y+"px"});this.tileMode&&this._fetchTiles(J)},_panEndHandler:function(J,N){N&&(this._startRect.left+=N.x,this._startRect.top+=N.y);this.oldData=null;this._roamingAnimation&&
(cancelAnimationFrame(this._roamingAnimation),this._oldDelta=this._roamingAnimation=null)},_onScaleHandler:function(J,N){var C={},P=c._css.names;a.set(this._canvas,P.transition,N?"none":P.transformName+" "+T+"ms ease");this._matrix=J;J=this._multiply?f.multiply(J,this._multiply):J;if(this._tdx||this._tdy)J=f.multiply(J,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});C[P.transform]=c._css.matrix(J);a.set(this._canvas,C)},_onZoomHandler:function(J,N,C){var P=this._startRect;J=P.width*N;N*=P.height;
var Q=P.left-(J-P.width)*(C.x-P.left)/P.width;C=P.top-(N-P.height)*(C.y-P.top)/P.height;a.set(this._canvas,{left:Q+"px",top:C+"px",width:J+"px",height:N+"px"});this._endRect={left:Q,top:C,width:J,height:N}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(J,N,C){a.set(this._div,{width:N+"px",height:C+"px"});a.set(this._canvas,{width:N+"px",height:C+"px"});this._startRect.width=this._canvas.width=N;this._startRect.height=this._canvas.height=C;this.useWebGL&&
this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null)},_extentChangeHandler:function(J,N,C,P){if(this.loaded&&!this.suspended&&(!N||0!==N.x||0!==N.y||C)){this._drawTile=!0;"css-transforms"===this._map.navigationMode&&(N&&(this._dragOrigin.x+=N.x,this._dragOrigin.y+=N.y),this._left=this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,this.roaming&&this.tileMode&&this.useWebGL||C||a.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top)),C&&(a.set(this._canvas,
c._css.names.transition,"none"),this._multiply=this._multiply?f.multiply(this._matrix,this._multiply):this._matrix,this._levelChange=!0));this._fireUpdateStart();var Q=this._map;N=this.raster.rasterFunction?this.raster.getMemberRasters().map(function(fa){return fa._rasterId}):[this.raster._rasterId];var Y={};this.tileMode?((this.roaming||this.useWebGL)&&this.tileMode||(N.forEach(function(fa,na){Y[fa]={extent:Q.extent,pixelBlock:new U({width:Q.width,height:Q.height,pixels:[],pixelType:"",mask:null,
statistics:[]})}}),this.tileManager.originalPixelData={extent:Q.extent,src:Y}),this.projectedFullExtent?this._fetchTiles(J,!0):this._getProjectedFullExtent(Q.spatialReference).then(k.hitch(this,function(){this._fetchTiles(J,!0)}))):this._requestData(Q.extent,Q.width,Q.height)}},_visibilityChangeHandler:function(J){J?q.show(this._div):q.hide(this._div)},_opacityChangeHandler:function(J){a.set(this._div,"opacity",J)}});l("extend-esri")&&k.setObject("layers.RasterXLayer",H,c);return H})},"esri/layers/rasterLib/raster/rasterFactory":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/sniff dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../urlUtils ./ImageServiceRaster ./TileServiceRaster ./TileRaster ./FunctionRaster".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v){H={customDrivers:[],create:function(u){if(u){if(u.url){var t=c.urlToObject(u.url);var y=t.path;var D=t.query}t=u.serviceInfo;var B=u.rasterFxArgs||{},E=new r,x=p.hitch(this,function(G){console.error(G);this._trycustomDrivers(p.mixin({url:y},u),0,E)});if(y)if(-1===y.toLowerCase().indexOf("imageserver")&&-1===y.toLowerCase().indexOf("mapserver")){var w=new q(p.mixin({},u,{url:y}));u.rasterFx&&(w=new v({rasterFx:u.rasterFx,rasterFxArgs:p.mixin({},B,{raster:w})}));
var A=w}else{A=new r;t=t||this._getServiceInfo(y,D);var z=p.hitch(this,function(G){G.bandCount?w=new g(p.mixin({},{serviceInfo:G},D,u,{url:y})):G.tileInfo&&(w=new n(p.mixin({},{serviceInfo:G},D,this._options,{url:y})));u.rasterFx&&(w=new v({rasterFx:u.rasterFx,rasterFxArgs:p.mixin({},B,{raster:w})}));A.resolve(w)});a(t,z,x)}else A=w=new v({rasterFx:u.rasterFx,rasterFxArgs:p.mixin({},B,{raster:w})});a(A,p.hitch(this,function(G){G?G.open().then(p.hitch(this,function(I){E.resolve(G)}),x):x(Error("There is no raster to open"))}),
x);return E.promise}},register:function(u){this.customDrivers=this.customDrivers||[];0<this.customDrivers.filter(function(t){return t.sourceType===u.prototype.sourceType}).length||this.customDrivers.push(u)},_trycustomDrivers:function(u,t,y){y=y||new r;var D=this.customDrivers[t];if(D){var B=new D(u);B.open().then(p.hitch(this,function(E){y.resolve(B)}),p.hitch(this,function(E){this._trycustomDrivers(u,t+1,y)}))}else y.reject("cannot load layer "+(u&&u.url||""));return y.promise},_getServiceInfo:function(u,
t){t=t||{};var y=t.bandIds;t=t.renderingRule;var D=new r(h._dfdCanceller),B={f:"json"};y&&(B.bandIds=y);t&&(B.renderingRule=t.toJson?JSON.stringify(t.toJson()):JSON.stringify(t));D._pendingDfd=e({url:u,content:B,handleAs:"json",callbackParamName:"callback"});D._pendingDfd.then(function(E){D.callback(E)},function(E){D.errback(E)});return D.promise}};b("extend-esri")&&p.setObject("layers.rasterLib.raster.rasterFactory",H,d);return H})},"esri/layers/rasterLib/raster/ImageServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../WKIDUnitConversion ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ./RasterInfo ./BasicRaster ../../rasterFormats/rasterCodec ../tile/RasterTileInfo".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x,w,A){H=k([x],{declaredClass:"esri.layers.rasterLib.raster.ImageServiceRaster",sourceType:"ImageService",constructor:function(z){z&&(this._imageServiceParams=z.imageServiceParameters,this._commonReqParams=z._commonReqParams,this._imageServiceParams||(this._imageServiceParams={interpolation:z.interpolation,pixelType:z.pixelType,format:z.format||"lerc",compressionQuality:z.compressionQuality,bandIds:z.bandIds,noDataInterpretation:z.noDataInterpretation,
adjustAspectRatio:z.adjustAspectRatio,mosaicRule:z.mosaicRule,renderingRule:z.interpolation}))},open:function(){var z=new r;if(this.serviceInfo&&this.rasterInfo)return this.loaded=!0,this._findCredential(),this.setFetchParameters(this._imageServiceParams),z.resolve(this),z.promise;var G=this.serviceInfo||this._generateServiceInfo(this._imageServiceParams&&this._imageServiceParams.renderingRule),I=p.hitch(this,function(R){this._fixServiceInfo(R);this.serviceInfo=R;this._findCredential();var U=this._parseRasterInfo(R),
ba={};R.defaultMosaicMethod?(ba.method=R.defaultMosaicMethod,ba.operation=R.mosaicOperator,ba.sortField=R.sortField,ba.sortValue=R.sortValue):ba.method=y.METHOD_NONE;this.serviceInfo.defaultMosaicRule=new y(ba);this.serviceInfo.defaultMosaicRule.ascending=!0;R=this._getColormap(this);ba=this._getHistograms(this);var ca=this._getRasterAttributeTable(this),da=this._getKeyProperties(this),ja=this._getMultidimensionalInfo(),ea=this._getSlices();(new d([R,ba,ca,da,ja,ea])).then(p.hitch(this,function(L){L[0][0]&&
(U.colormap=L[0][1]);L[1][0]&&(U.histograms=L[1][1]);L[2][0]&&(U.vat=L[2][1]);L[3][0]&&(U.keyProperties=L[3][1]);L[4][0]&&(U.multidimensionalInfo=L[4][1]);this._slices=L[5][0]?L[5][1]:null;U.keyProperties&&U.keyProperties.DataType&&(this.dataType=U.keyProperties.DataType);this.loaded=!0;this.rasterInfo=U;this.setFetchParameters(this._imageServiceParams);z.resolve(this)}))}),K=p.hitch(this,function(R){this.loaded=!0;z.reject(R)});f(G,I,K);return z.promise},setFetchParameters:function(z,G){if(G)this.imageServiceParams=
z;else{var I=this.imageServiceParams;I&&z?Object.keys(z).forEach(function(K){I[K]=z[K]}):this.imageServiceParams=z}this._constructGetImageParams();this._getRasterIdentifier(!0)},read:function(z){if(z.pixelBlock||z.texture){var G=new r;G.resolve(z);return G.promise}if(!1===z.virtual&&this.tileInfo&&!this.tileInfo.virtual)return this.readTile(z);if(this._slices){var I=this._getSliceId();if(null==I)return G=new r,G.resolve(z),G.promise}var K=z.extent,R=K.spatialReference.wkid||b.toJson(K.spatialReference.toJson(!1)),
U=z.timeExtent?z.timeExtent.toJson().join(","):null;G=this.url+"/exportImage";var ba={};this._slices&&(ba.sliceid=I);this.disableClientCaching&&(ba._ts=(new Date).getTime());I=p.mixin({},this._commonReqParams,{bbox:K.xmin+","+K.ymin+","+K.xmax+","+K.ymax,imageSR:R,bboxSR:R,size:z.width+","+z.height,time:U},ba);return this._requestPixels({url:G,payload:I,decodeParams:{width:z.width,height:z.height,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:!1},tileOptions:z})},readTile:function(z){var G=
this.tileBoundary&&this.tileBoundary[z.level];if(G&&(G.minRow>z.row||G.maxRow<z.row||G.minCol>z.col||G.maxCol<z.col)){var I=new r;I.resolve(z);return I.promise}if(this._slices&&(I=this._getSliceId(),null==I))return I=new r,I.resolve(z),I.promise;G=this.url+"/tile/"+z.level+"/"+z.row+"/"+z.col;var K={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,useWasm:!0,isPoint:"elevation"===z.tileType.toLowerCase()?!0:!1};I=this._slices?"sliceid\x3d"+
I+"\x26":"";I=this.disableClientCaching?"_ts\x3d "+(new Date).getTime():I.replace(/&$/,"");return this._requestPixels({url:G+(0<I.length?"?"+I:""),payload:{},decodeParams:K,tileOptions:z})},toJson:function(){return{url:this.url,tileInfo:this.tileInfo,rasterInfo:this.rasterInfo,serviceInfo:this.serviceInfo,sourceType:this.sourceType,_commonReqParams:this._commonReqParams,_rasterId:this._rasterId}},_getSliceId:function(){var z=p.clone(this._imageServiceParams.multidimensionalDefinition),G=p.clone(this._imageServiceParams.time);
if(null==this._slices||null==G&&(null==z||0===z.length))return 0;var I=z||this.defaultMultidimensionalDefinition,K=I[0].variableName;I=this._getAllDimensionDefinition(I,K).definition;z=null;if(null==I||0===I.length)return null;if(G&&this.serviceInfo.timeInfo){if(null==G[1]||G[1]===G[0])var R=G[0];else{var U=this.serviceInfo.timeInfo.startTimeField;R=this.rasterInfo.multidimensionalInfo.variables.find(function(da){return da.name===K}).dimensions.find(function(da){return da.name===U}).values.filter(function(da){return Array.isArray(da)?
Math.max(da[0],G[0])<Math.min(da[1],G[1]):da>=G[0]&&da<=G[1]}).sort(function(da,ja){da=Array.isArray(da)?da[1]:da;ja=Array.isArray(ja)?da[1]:ja;return Math.abs(G[1]-da)-Math.abs(G[1]-ja)})[0]||[G[1]]}I.some(function(da){if(da.dimensionName===U)return da.values[0]=R,!0;if(!da.dimensionName)return da.dimensionName=U,da.isSlice=!0,da.values=[R],!0})||I.push({variableName:K,dimensionName:U,isSlice:!0,values:[R]})}for(var ba=0;ba<this._slices.length;ba++){var ca=this._slices[ba].multidimensionalDefinition;
if(ca.length===I.length&&!ca.some(function(da){var ja=I.filter(function(L){return da.variableName===L.variableName&&L.dimensionName===da.dimensionName})[0];if(!ja)return!0;var ea=Array.isArray(da.values[0])?da.values[0][0]:da.values[0];ja=Array.isArray(ja.values[0])?ja.values[0][0]:ja.values[0];return ea!==ja})){z=ba;break}}return z},_getAllDimensionDefinition:function(z,G){var I=z.map(function(R){return R.dimensionName}),K=!1;this.rasterInfo.multidimensionalInfo.variables.forEach(function(R){R.name!==
G||R.dimensions.length===z.length&&I[0]||(R.dimensions.forEach(function(U){0>I.indexOf(U.name)&&(I[0]?z.push({variableName:G,dimensionName:U.name,values:[U.values[0]]}):(z[0].dimensionName=U.name,z[0].values=[U.values[0]],U[0]=U.name))}),K=!0)},this);return{defChanged:K,definition:z}},_generateServiceInfo:function(z){var G=this.url,I=new r(u._dfdCanceller);I._pendingDfd=c({url:G,content:{f:"json",renderingRule:z?b.toJson(z.toJson()):null},handleAs:"json",callbackParamName:"callback"});I._pendingDfd.then(function(K){I.callback(K)},
function(K){I.errback(K)});return I},_fixServiceInfo:function(z){var G=z.spatialReference.wkid;z.tileInfo&&0===z.extent.xmin&&360===z.extent.xmax&&G&&null==v[G]&&(z.tileInfo.applyGCS360Transform=!0)},_parseRasterInfo:function(z){var G=new E;G.bandCount=z.bandCount;G.extent=new g(z.fullExtent);G.spatialReference=z.spatialReference;G.pixelType=z.pixelType;G.width=Math.floor((z.fullExtent.xmax-z.fullExtent.xmin)/z.pixelSizeX+.5);G.height=Math.floor((z.fullExtent.ymax-z.fullExtent.ymin)/z.pixelSizeY+
.5);G.cellSize=new n({x:z.pixelSizeX,y:z.pixelSizeY,spatialReference:z.spatialReference});var I;if(z.minValues&&0<z.minValues.length&&z.maxValues&&z.stdvValues&&z.meanValues){var K=[];for(I=0;I<z.minValues.length;I++)K.push({min:z.minValues[I],max:z.maxValues[I],mean:z.meanValues[I],stddev:z.stdvValues[I]});z.bandCount!==K.length&&(K=null)}this.dataType=z.serviceDataType?z.serviceDataType.replace("esriImageServiceDataType",""):"Generic";G.statistics=K;z.objectIdField&&z.fields&&(G.catalogInfo={objectIdField:z.objectIdField,
fields:z.fields});G.timeInfo=z.timeInfo;if(z.tileInfo){this.tileInfo=new A(z.tileInfo);this.tileInfo.tileType=z.cacheType||"Map";G.tileInfo=this.tileInfo;var R=G.extent,U=this.tileInfo.origin,ba=this.tileInfo.cols,ca=this.tileInfo.rows;this.tileBoundary=this.tileInfo.lods.map(function(da){return{minCol:Math.floor((R.xmin-U.x+.1*da.resolution)/ba/da.resolution),maxCol:Math.floor((R.xmax-U.x-.1*da.resolution)/ba/da.resolution),minRow:Math.floor((U.y-R.ymax+.1*da.resolution)/ca/da.resolution),maxRow:Math.floor((U.y-
R.ymin-.1*da.resolution)/ca/da.resolution)}})}return G},_getColormap:function(z){z=this.url+"/colormap";var G=new r(u._dfdCanceller),I={f:"json"},K=this.serviceInfo.hasColormap||this.rasterInfo&&this.rasterInfo.hasColormap;10<this.serviceInfo.currentVersion&&K?(G._pendingDfd=c({url:z,content:I,handleAs:"json",callbackParamName:"callback"}),G._pendingDfd.then(function(R){G.callback(R.colormap)},function(R){G.errback(R)})):G.callback(null);return G},_getHistograms:function(z){var G=this.url+"/histograms",
I=new r(u._dfdCanceller),K={f:"json"},R=this.serviceInfo.hasHistograms||this.rasterInfo&&this.rasterInfo.hasHistograms;z&&z.renderingRule&&(K.renderingRule=b.toJson(z.renderingRule.toJson()),R=!0);10<this.serviceInfo.currentVersion&&R?(I._pendingDfd=c({url:G,content:K,handleAs:"json",callbackParamName:"callback"}),I._pendingDfd.then(function(U){I.callback(U.histograms)},function(U){I.errback(U)})):I.callback(null);return I},_getRasterAttributeTable:function(z){var G=this.url+"/rasterAttributeTable",
I=new r(u._dfdCanceller),K={f:"json"},R=this.serviceInfo.hasRasterAttributeTable;z&&z.renderingRule&&(K.renderingRule=b.toJson(z.renderingRule.toJson()),R=!0);10<this.serviceInfo.currentVersion&&R?(I._pendingDfd=c({url:G,content:K,handleAs:"json",callbackParamName:"callback"}),I._pendingDfd.then(function(U){I.callback(U)},function(U){I.errback(U)})):I.callback(null);return I},_getKeyProperties:function(z){var G=this.url+"/keyProperties",I=new r(u._dfdCanceller),K={f:"json"};z&&z.renderingRule&&(K.renderingRule=
b.toJson(z.renderingRule.toJson()));10<this.serviceInfo.currentVersion?(I._pendingDfd=c({url:G,content:K,handleAs:"json",callbackParamName:"callback"}),I._pendingDfd.then(function(R){I.callback(R)},function(R){I.errback(R)})):I.callback(null);return I},_getMultidimensionalInfo:function(){var z=this.url+"/multidimensionalInfo",G=new r(u._dfdCanceller);10.3<=this.serviceInfo.currentVersion&&this.serviceInfo.hasMultidimensions?(G._pendingDfd=c({url:z,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),
G._pendingDfd.then(p.hitch(this,function(I){G.callback(I.multidimensionalInfo)}),function(I){G.errback(I)})):G.callback(null);return G},_getSlices:function(){var z=this.url+"/slices",G=new r(u._dfdCanceller);this.serviceInfo.hasMultidimensions?(G._pendingDfd=c({url:z,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),G._pendingDfd.then(p.hitch(this,function(I){G.callback(I.slices)}),function(I){G.errback(I)})):G.callback(null);return G},_initializationFailed:function(){},_constructGetImageParams:function(){var z=
this.imageServiceParams||{},G=p.mixin({},this._query,{f:"image",interpolation:z.interpolation,pixelType:z.pixelType,format:z.format||"lerc",compressionQuality:z.compressionQuality,bandIds:z.bandIds?z.bandIds.join(","):null,noData:null!=z.noData?z.noData.join(","):null,noDataInterpretation:z.noDataInterpretation,adjustAspectRatio:null==z.adjustAspectRatio?null:z.adjustAspectRatio,mosaicRule:z.mosaicRule?b.toJson(z.mosaicRule.toJson()):null,renderingRule:z.renderingRule?b.toJson(z.renderingRule.toJson()):
null,token:this.credential&&this.credential.token||null});"lerc"===G.format.toLowerCase()?(G.compressionTolerance=z.compressionTolerance,10.5<=this.serviceInfo.currentVersion&&(G.lercVersion=z.lercVersion||2)):"tiff"===G.format.toLowerCase()?G.compression=z.compression:-1<["jpg","jpeg","jpg","jpgpng"].indexOf(G.format.toLowerCase())&&(G.compression=z.compression);this._commonReqParams=G},_getRasterIdentifier:function(z){if(this._rasterId)return this._rasterId;z=this.url.replace("http:","").replace("https:",
"");var G=[],I=this.imageServiceParams||{};G.push(z);G.push(I.interpolation);G.push(I.pixelType);G.push(I.compressionQuality);G.push(I.bandIds?I.bandIds.join(","):"");G.push(I.mosaicRule?b.toJson(I.mosaicRule.toJson()):"");G.push(I.renderingRule?b.toJson(I.renderingRule.toJson()):"");z=G.join("|");return this._rasterId=this._computeSignature(z)},_wrapExtent:function(z){var G=z.spatialReference._getInfo();if(G){var I=G.valid[0];G=G.valid[1];if(z.xmin<I-this.resolution.x||z.xmax>G+this.resolution.y){var K=
new g((z.xmin-I)%(G-I),z.ymin,(z.xmax-G)%(G-I),z.ymax,z.spatialReference);K.xmax<K.xmin&&(K=null)}}return K||z}});a("extend-esri")&&p.setObject("layers.rasterLib.raster.ImageServiceRaster",H,e);return H})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang".split(" "),function(H,k,p,r,m,l){H=H(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,
interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,renderer:null,noData:null,compressionTolerance:null,adjustAspectRatio:null,lercVersion:null,toJson:function(b){var a=this.bbox||this.extent;b=(a=a&&b&&a._normalize(!0))?a.spatialReference.wkid||p.toJson(a.spatialReference.toJson()):null;var d=this.imageSpatialReference;a={bbox:a?a.xmin+","+a.ymin+","+a.xmax+","+a.ymax:null,bboxSR:b,size:null!==this.width&&null!==this.height?this.width+","+this.height:
null,imageSR:d?d.wkid||p.toJson(d.toJson()):b,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?p.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?p.toJson(this.renderingRule.toJson()):null,renderer:this.renderer?p.toJson(this.renderer.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation,compressionTolerance:this.compressionTolerance,
adjustAspectRatio:this.adjustAspectRatio,lercVersion:this.lercVersion};b=this.timeExtent;a.time=b?b.toJson().join(","):null;return l.filter(a,function(f){if(null!==f&&void 0!==f)return!0})}});k.mixin(H,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});r("extend-esri")&&k.setObject("layers.ImageServiceParameters",
H,m);return H})},"esri/layers/rasterLib/raster/RasterInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../../SpatialReference","../tile/RasterTileInfo"],function(H,k,p,r,m){return H(null,{declaredClass:"esri.layers.rasterLib.raster.RasterInfo",bandCount:null,pixelType:null,extent:null,spatialReference:null,width:null,height:null,colormap:null,attributeTable:null,multiDimensionalInfo:null,statistics:null,histograms:null,catalogInfo:null,keyProperties:null,
cellSize:null,format:null,compression:null,compressionQuality:null,packetSize:null,geodataXform:null,constructor:function(l){k.mixin(this,l);this.extent=this.extent?this.extent.toJson?this.extent:new p(this.extent):null;this.spatialReference=this.spatialReference?this.spatialReference.toJson?this.spatialReference:new r(this.spatialReference):null;this.tileInfo=this.tileInfo?this.tileInfo.toJson?this.tileInfo:new m(this.tileInfo):null},toJson:function(){return{bandCount:this.bandCount,pixelType:this.pixelType,
extent:this.extent&&this.extent.toJson?this.extent.toJson():this.extent,spatialReference:this.spatialReference&&this.spatialReference.toJson?this.spatialReference.toJson():this.spatialReference,width:this.width,height:this.height,colormap:this.colormap?k.clone(this.colormap):null,attributeTable:this.attributeTable?k.clone(this.attributeTable):null,multiDimensionalInfo:this.multiDimensionalInfo?k.clone(this.multiDimensionalInfo):null,statistics:this.statistics?k.clone(this.statistics):null,histograms:this.histograms?
k.clone(this.histograms):null,catalogInfo:this.catalogInfo?k.clone(this.catalogInfo):null,keyProperties:this.keyProperties?k.clone(this.keyProperties):null,cellSize:this.cellSize&&this.cellSize.toJson?this.cellSize.toJson():this.cellSize,tileInfo:this.tileInfo&&this.tileInfo.toJson?this.tileInfo.toJson():this.tileInfo,format:this.format,compression:this.compression,compressionQuality:this.compressionQuality,packetSize:this.packetSize,geodataXform:this.geodataXform?k.clone(this.geodataXform):null}},
clone:function(){return new this.constructor(this.toJson())}})})},"esri/layers/rasterLib/tile/RasterTileInfo":function(){define("dojo/_base/declare dojo/_base/lang ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../../lang ../../TileInfo".split(" "),function(H,k,p,r,m,l,b){return H([b],{declaredClass:"esri.layers.rasterLib.tile.RasterTileInfo",rows:512,cols:512,compressionQuality:95,lercError:.01,spatialReference:null,origin:null,virtual:!0,tileType:"Raster",constructor:function(a,
d){if(a||d){var f=d&&d.refTileInfo;a?this.virtual=!1:(this.virtual=!0,k.mixin(this,{rows:d.rows||this.rows,cols:d.cols||this.cols,compressionQuality:d.compressionQuality||95,lercError:d.compressionTolerance||.01,spatialReference:d.spatialReference,origin:d.origin}),this.width=this.cols,this.height=this.rows,this.origin||(f?this.origin=f.origin:d.spatialReference.isWebMercator()||d.extent&&360<=Math.max(Math.abs(d.extent.xmin),Math.abs(d.extent.xmax))?this.origin={x:-2.0037508342787E7,y:2.0037508342787E7}:
-1<[4326,4269].indexOf(d.spatialReference.wkid)||360>Math.max(Math.abs(d.extent.xmin),Math.abs(d.extent.xmax))?this.origin={x:-180,y:90}:this.origin={x:d.extent.xmin,y:d.extent.ymax}))}},toJson:function(){var a=b.prototype.toJson.apply(this);a.tileType=this.tileType;a.virtual=this.virtual;a.lercError=this.lercError;return a},clone:function(){return new this.prototype(this.toJson())}})})},"esri/layers/rasterLib/raster/BasicRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterHandler ./rasterProjectionHelper ./RasterInfo".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x,w){return k([h],{url:null,dataType:null,rasterInfo:null,tileInfo:null,serviceInfo:null,loaded:null,constructor:function(A){if(A){var z=A.url;z&&(z=u.urlToObject(z),this.url=z.path,this._query=z.query);this.dataType=A.dataType;this.serviceInfo=A.serviceInfo;this.rasterInfo=A.rasterInfo;this.tileInfo=A.tileInfo;this.serviceInfo=A.serviceInfo}},open:function(){},read:function(A){},identify:function(A){var z=new r,G=this.rasterInfo.extent;if(x.requirePE(G.spatialReference,
A.spatialReference))x.load().then(p.hitch(this,function(){I=x.project(A,G.spatialReference);z.resolve(I)}),function(){z.reject(Error("cannot project into this spatial reference"))});else{var I=x.project(A,G.spatialReference);z.resolve(I)}return z.then(p.hitch(this,function(K){var R=this.tileInfo,U=R.origin,ba=R.lods[R.lods.length-1],ca=(K.x-U.x)/R.cols/ba.resolution;K=(U.y-K.y)/R.rows/ba.resolution;var da=Math.round((K-Math.floor(K))*R.rows)*R.cols+Math.round((ca-Math.floor(ca))*R.cols);U=new g(U.x+
ba.resolution*R.cols*ca,U.y-ba.resolution*R.rows*(K+1),U.x+ba.resolution*R.cols*(ca+1),U.y-ba.resolution*R.rows*K,G.spatialReference);var ja=this.getMemberRasters?this.getMemberRasters()[0]:this;return ja.read({level:ba.level,row:Math.floor(K),col:Math.floor(ca),extent:U,width:R.cols,height:R.rows,virtual:ja.tileInfo.virtual,tileType:ja.tileInfo.tileType}).then(function(ea){return(ea=ea&&ea.pixelBlock)&&ea.pixels&&0<ea.pixels.length&&(!ea.mask||ea.mask[da])?{pixelValue:ea.pixels.map(function(L){return L[da]})}:
{pixelValue:null}})}))},getProjectedFullExtent:function(A,z){var G=new r;if(this.projectedFullExtent&&!z)return G.resolve(this.projectedFullExtent),G.promise;var I=this.rasterInfo.extent;if(x.requirePE(this.rasterInfo.extent.spatialReference,A))x.load().then(p.hitch(this,function(){K=x.project(I,A);this.projectedFullExtent=K=new g(K.toJson());G.resolve(K)}),function(){G.reject(Error("cannot project into this spatial reference"))});else{var K=x.project(I,A);this.projectedFullExtent=K=new g(K.toJson());
G.resolve(K)}return G.promise},setFetchParameters:function(A,z){},_setRasterHandler:function(A){this._rasterHandler=A;this.getMemberRasters&&this.getMemberRasters().forEach(p.hitch(this,function(z){z._rasterHandler=A}))},_findCredential:function(){this.url&&((this._credential=e.id&&e.id.findCredential(this.url))&&this._credential.ssl||this.serviceInfo&&this.serviceInfo._ssl)&&(this.url=this.url.replace(/^http:/i,"https:"))},_initWorker:function(){this._rasterHandler=new E;this._rasterHandler.start().then(function(){this._rasterHandlerInitialized=
!0}.bind(this))},_requestPixels:function(A){var z=A.url,G=A.payload,I=A.decodeParams,K=A.tileOptions,R=new r(v._dfdCanceller);this._rasterHandler||this._initWorker();var U=this._rasterHandler,ba={};z={url:z,handleAs:"arraybuffer",content:G};A.headers&&(z.headers=A.headers);R._pendingDfd=c(z).then(p.hitch(this,function(ca){(U&&this._rasterHandlerInitialized?U.decode({encodedData:ca,decodeParams:I}):B.decode(ca,I)).then(function(da){ba.pixelBlock=new D(da);ba.extent=K.extent;ba.level=K.level;ba.row=
K.row;ba.col=K.col;ba.width=K.width;ba.height=K.height;v._resDfd(R,[ba])},function(da){v._resDfd(R,[da],!0)})}),function(ca){v._resDfd(R,[ca],!0)});return R},_computeSignature:function(A){if("string"===typeof A){for(var z=new Uint8Array(A.length),G=0;G<A.length;G++)z[G]=A.charCodeAt(G);A=z}G=z=65535;for(var I=A.length,K=Math.floor(I/2),R=0;K;){var U=359<=K?359:K;K-=U;do z+=A[R++]<<8,G+=z+=A[R++];while(--U);z=(z&65535)+(z>>>16);G=(G&65535)+(G>>>16)}I&1&&(G+=z+=A[R]<<8);return((G&65535)+(G>>>16)<<16|
(z&65535)+(z>>>16))>>>0}})})},"esri/layers/rasterFormats/rasterCodec":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred ../PixelBlock ./LercCodec ./Lerc2Codec ./Lerc ./JpgPlus ./Png ./Raw ./TiffDecoder".split(" "),function(H,k,p,r,m,l,b,a,d,f,e,h){return{validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),supportedFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_isPlatformLittleEndian:function(){var c=new ArrayBuffer(4),g=new Uint8Array(c);
(new Uint32Array(c))[0]=1;return 1===g[0]}(),decode:function(c,g){if(void 0===g||null===g)throw"missing decode options";var n;g.format&&(n=g.format.toUpperCase());"BSQ"!==n&&"BIP"!==n&&(n=this._getFormat(c));var q=g.decodeFunc;if(void 0===q||null===q)q=this._getFormatDecoderDfd(n,g.useWasm);return q(c,g)},_getFormatDecoderDfd:function(c,g){if(g&&("LERC"===c||"LERC2"===c))return this._decodeLercWasm.bind(this);var n=null;switch(c){case "LERC":n=this._decodeLerc;break;case "LERC2":n=this._decodeLerc2;
break;case "JPEG":n=this._decodeJpeg;break;case "PNG":n=this._decodePng;break;case "BSQ":n=this._decodeBsq;break;case "BIP":n=this._decodeBip;break;case "TIFF":n=this._decodeTiff;break;default:n=function(q,v){throw"The raster format is not supported";}}n=p.hitch(this,n);return function(q,v){var u=new r;v.isPoint&&v.width&&(v.width++,v.height++);q=n(q,v);v.isPoint&&v.width&&(this._interpolatePointGrid(q),v.width--,v.height--);u.resolve(q);return u}.bind(this)},_getFormat:function(c){c=new Uint8Array(c,
0,10);var g="";if(255===c[0]&&216===c[1])g="JPEG";else if(137===c[0]&&80===c[1]&&78===c[2]&&71===c[3])g="PNG";else if(67===c[0]&&110===c[1]&&116===c[2]&&90===c[3]&&73===c[4]&&109===c[5]&&97===c[6]&&103===c[7]&&101===c[8]&&32===c[9])g="LERC";else if(76===c[0]&&101===c[1]&&114===c[2]&&99===c[3]&&50===c[4]&&32===c[5])g="LERC2";else if(-1<String.fromCharCode.apply(null,c).toLowerCase().indexOf("error"))g="ERROR";else if(73===c[0]&&73===c[1]&&42===c[2]&&0===c[3]||77===c[0]&&77===c[1]&&0===c[2]&&42===c[3])g=
"TIFF";return g},_validateDecodeParams:function(c){if(!c.height||Math.floor(c.height)!==c.height)throw"Height not provided.";if(!c.width||Math.floor(c.width)!==c.width)throw"Width not provided.";},_decodeJpeg:function(c,g){if(!d)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(g);c=(new d).decode(c);if(!this._verifyResult(c,g))throw"The decoded image dimensions are incorrect.";g=new m({width:c.width,height:c.height,pixels:c.pixels,pixelType:"U8",mask:c.mask,statistics:null});
g.calculateStatistics();return g},_decodePng:function(c,g){if(!f)throw"The png decoder module is not loaded.";this._validateDecodeParams(g);c=new Uint8Array(c);var n=new f(c);c=new Uint8Array(g.width*g.height*4);n.copyToImageData(c,n.decodePixels());var q=n=0;q=new Uint8Array(g.width*g.height);for(n=0;n<g.width*g.height;n++)q[n]=c[4*n+3];var v=new m({width:g.width,height:g.height,pixels:[],pixelType:"U8",mask:q,statistics:[]});for(n=0;3>n;n++){var u=new Uint8Array(g.width*g.height);for(q=0;q<g.width*
g.height;q++)u[q]=c[4*q+n];v.addData({pixels:u})}v.calculateStatistics();return v},_decodeBsq:function(c,g){if(!e)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(g);var n=g.noDataValue;g.pixelType=this._getpixelTypeAndNoData(g.pixelType);c=e.decodeBSQ(c,{bandCount:g.planes,width:g.width,height:g.height,pixelType:g.pixelType,noDataValue:n});g=new m({width:g.width,height:g.height,pixels:c.pixels,pixelType:g.pixelType,mask:c.maskData,statistics:null});g.calculateStatistics();
return g},_decodeBip:function(c,g){this._validateDecodeParams(g);var n=g.noDataValue;g.pixelType=this._getpixelTypeAndNoData(g.pixelType);c=e.decodeBIP(c,{bandCount:g.planes,width:g.width,height:g.height,pixelType:g.pixelType,noDataValue:n});g=new m({width:g.width,height:g.height,pixels:c.pixels,pixelType:g.pixelType,mask:c.maskData,statistics:null});g.calculateStatistics();return g},_decodeTiff:function(c,g){this._validateDecodeParams(g);g.pixelType=this._getpixelTypeAndNoData(g.pixelType);c=h.decode(c);
c=new m({width:c.width,height:c.height,pixels:c.pixels,pixelType:c.pixelType,mask:c.maskData,statistics:null});c.calculateStatistics();return c},_decodeLerc:function(c,g){if(!this._isPlatformLittleEndian)throw"lerc decoder is not supported on big endian platform";this._validateDecodeParams(g);var n=g.noDataValue;g.pixelType=this._getpixelTypeAndNoData(g.pixelType);for(var q=0,v,u=0,t,y=c.byteLength-10;u<y;){var D=l.decode(c,{inputOffset:u,encodedMaskData:v,returnMask:0===q?!0:!1,returnEncodedMask:0===
q?!0:!1,returnFileInfo:!0,pixelType:g.pixelType,noDataValue:n});u=D.fileInfo.eofOffset;0===q&&(v=D.encodedMaskData,t=new m({width:g.width,height:g.height,pixels:[],pixelType:g.pixelType,mask:D.maskData,statistics:[]}));q++;if(!this._verifyResult(D,g))throw"The decoded image dimensions are incorrect";t.addData({pixels:D.pixelData,statistics:{minValue:D.minValue,maxValue:D.maxValue,noDataValue:D.noDataValue}})}return t},_decodeLerc2:function(c,g){if(!this._isPlatformLittleEndian)throw"lerc2 decoder is not supported on big endian platform";
this._validateDecodeParams(g);g.pixelType=this._getpixelTypeAndNoData(g.pixelType);for(var n=0,q,v,u,t=0,y,D=c.byteLength-10,B=[],E,x=0;t<D;){v=b.decode(c,{inputOffset:t,maskData:q,returnFileInfo:!0});t=v.fileInfo.eofOffset;q=v.maskData;0===n&&(u=v.fileInfo.numValidPixel,y=new m({width:g.width,height:g.height,pixels:[],dimCount:v.dimCount||1,pixelType:v.fileInfo.pixelType,mask:q,statistics:[]}));v.fileInfo.mask&&0<v.fileInfo.mask.numBytes&&x++;q&&B.push(q);n++;if(!this._verifyResult(v,g))throw"The decoded image dimensions are incorrect";
y.addData({pixels:v.pixelData,statistics:{minValue:v.minValue,maxValue:v.maxValue,noDataValue:v.noDataValue,dimStats:v.dimStats}})}if(1<x){g=y.width*y.height;y.bandMasks=B;q=new Uint8Array(g);q.set(B[0]);for(u=1;u<B.length;u++)for(E=B[u],c=0;c<g;c++)q[c]&=E[c];for(c=u=0;c<g;c++)u+=E[c];y.mask=q}y.validPixelCount=u;return y},_decodeLercWasm:function(c,g){if(!this._isPlatformLittleEndian)throw"lerc decoder is not supported on big endian platform";this._validateDecodeParams(g);var n=new r;a.load().then(function(){var q=
a.decode(c,{inputOffset:0,noDataValue:g.noDataValue,pixelType:g.pixelType&&g.pixelType.toUpperCase()});q=new m({width:q.width,height:q.height,pixelType:q.pixelType.toUpperCase(),pixels:q.pixels,mask:q.mask,statistics:q.statistics,validPixelCount:q.validPixelCount});g.isPoint&&g.width&&(this._interpolatePointGrid(q),g.width--,g.height--);n.resolve(q)}.bind(this),function(){n.reject("Cannot load lerc wasm decoder")});return n},_interpolatePointGrid:function(c,g){var n=c.pixels;if(n&&0!==n.length){var q=
n.length,v=c.width,u=c.mask,t=v-1,y=c.height-1,D=[],B,E;if(0===(null==g?1:g)){for(g=0;g<q;g++){var x=n[g];var w=new x.constructor(t*y);for(B=0;B<y;B++){var A=B*v;for(E=0;E<t;E++)w[B*t+E]=x[A+E]}D.push(w)}if(u){var z=new Uint8Array(t*y);for(B=0;B<y;B++)for(A=B*v,E=0;E<t;E++)z[B*t+E]=u[A+E]}}else{for(g=0;g<q;g++){x=n[g];w=new x.constructor(t*y);for(B=0;B<y;B++)for(A=B*v,E=0;E<t;E++)w[B*t+E]=(x[A+E]+x[A+E+1]+x[A+v+E]+x[A+v+E+1])/4;D.push(w)}if(u)for(z=new Uint8Array(t*y),B=0;B<y;B++)for(A=B*v,E=0;E<
t;E++)z[B*t+E]=Math.min.apply(null,[u[A+E],u[A+E+1],u[A+v+E],u[A+v+E+1]])}c.width=t;c.height=y;c.mask=z;c.pixels=D;return c}},_getpixelTypeAndNoData:function(c){return"U1"===c||"U2"===c||"U4"===c||"U8"===c?"U8":c},_verifyResult:function(c,g){return c.height!==g.height||c.width!==g.width?!1:!0}}})},"esri/layers/rasterFormats/Lerc":function(){var H=this&&this.__createBinding||(Object.create?function(m,l,b,a){void 0===a&&(a=b);Object.defineProperty(m,a,{enumerable:!0,get:function(){return l[b]}})}:function(m,
l,b,a){void 0===a&&(a=b);m[a]=l[b]}),k=this&&this.__setModuleDefault||(Object.create?function(m,l){Object.defineProperty(m,"default",{enumerable:!0,value:l})}:function(m,l){m["default"]=l}),p=this&&this.__importStar||function(m){if(m&&m.__esModule)return m;var l={};if(null!=m)for(var b in m)"default"!==b&&Object.prototype.hasOwnProperty.call(m,b)&&H(l,m,b);k(l,m);return l},r=this&&this.__read||function(m,l){var b="function"===typeof Symbol&&m[Symbol.iterator];if(!b)return m;m=b.call(m);var a,d=[];
try{for(;(void 0===l||0<l--)&&!(a=m.next()).done;)d.push(a.value)}catch(e){var f={error:e}}finally{try{a&&!a.done&&(b=m["return"])&&b.call(m)}finally{if(f)throw f.error;}}return d};define(["require","exports"],function(m,l){function b(h){var c=h._malloc,g=h._free,n=h._lerc_getBlobInfo,q=h._lerc_getDataRanges,v=h._lerc_decode_4D,u,t=Object.values(h.asm).find(function(D){return D&&"buffer"in D&&D.buffer===h.HEAPU8.buffer}),y=function(D){D=D.map(function(w){return(w>>3<<3)+16});var B=D.reduce(function(w,
A){return w+A}),E=c(B);u=new Uint8Array(t.buffer);B=D[0];D[0]=E;for(E=1;E<D.length;E++){var x=D[E];D[E]=D[E-1]+B;B=x}return D};e.getBlobInfo=function(D){var B,E=new Uint8Array(48),x=new Uint8Array(24),w=r(y([D.length,E.length,x.length]),3),A=w[0],z=w[1];w=w[2];u.set(D,A);u.set(E,z);u.set(x,w);if(B=n(A,D.length,z,w,12,3))throw g(A),"lerc-getBlobInfo: error code is ".concat(B);u=new Uint8Array(t.buffer);E.set(u.slice(z,z+E.length));x.set(u.slice(w,w+x.length));E=new Uint32Array(E.buffer);w=new Float64Array(x.buffer);
z=r(E,11);x=z[2];E=z[5];var G=z[10];z={version:z[0],dimCount:x,width:z[3],height:z[4],validPixelCount:z[6],bandCount:E,blobSize:z[7],maskCount:z[8],dataType:z[1],minValue:w[0],maxValue:w[1],maxZerror:w[2],statistics:[],bandCountWithNoData:G};if(G)return z;if(1===x&&1===E)return g(A),z.statistics.push({minValue:w[0],maxValue:w[1]}),z;var I=x*E*8,K=new Uint8Array(I),R=new Uint8Array(I);w=A;G=0;var U=!1;if(u.byteLength<A+2*I){g(A);U=!0;B=r(y([D.length,I,I]),3);w=B[0];G=B[1];var ba=B[2];u.set(D,w)}else B=
r(y([I,I]),2),G=B[0],ba=B[1];u.set(K,G);u.set(R,ba);if(B=q(A,D.length,x,E,G,ba))throw g(w),U||g(G),"lerc-getDataRanges: error code is ".concat(B);u=new Uint8Array(t.buffer);K.set(u.slice(G,G+I));R.set(u.slice(ba,ba+I));D=new Float64Array(K.buffer);A=new Float64Array(R.buffer);B=z.statistics;for(R=0;R<E;R++)if(1<x){I=D.slice(R*x,(R+1)*x);K=A.slice(R*x,(R+1)*x);ba=Math.min.apply(null,I);var ca=Math.max.apply(null,K);B.push({minValue:ba,maxValue:ca,dimStats:{minValues:I,maxValues:K}})}else B.push({minValue:D[R],
maxValue:A[R]});g(w);U||g(G);return z};e.decode=function(D,B){var E=B.maskCount,x=B.dimCount,w=B.bandCount,A=B.width,z=B.height,G=B.dataType,I=B.bandCountWithNoData,K=a[G],R=A*z;B=new Uint8Array(R*w);var U=R*x*w*K.size;K=new Uint8Array(U);var ba=new Uint8Array(w),ca=8*w,da=new Uint8Array(ca),ja=r(y([D.length,B.length,K.length,ba.length,da.length]),5),ea=ja[0],L=ja[1],O=ja[2],S=ja[3];ja=ja[4];u.set(D,ea);u.set(B,L);u.set(K,O);u.set(ba,S);u.set(da,ja);if(D=v(ea,D.length,E,L,x,A,z,w,G,O,S,ja))throw g(ea),
"lerc-decode: error code is ".concat(D);u=new Uint8Array(t.buffer);K.set(u.slice(O,O+U));B.set(u.slice(L,L+R));D=null;if(I)for(ba.set(u.slice(S,S+w)),da.set(u.slice(ja,ja+ca)),D=[],w=0;w<ba.length;w++)D.push(ba[w]?da[w]:null);g(ea);return{data:K,maskData:B,noDataValues:D}}}Object.defineProperty(l,"__esModule",{value:!0});l.getBlobInfo=l.decode=l.isLoaded=l.load=void 0;var a=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,128]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",
size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-3.4027999387901484E38,3.4027999387901484E38]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-1.7976931348623157E308,1.7976931348623157E308]}],d=null,f=!1;l.load=function(){return d?d:d=(new Promise(function(h,c){m(["./lerc-wasm"],
h,c)})).then(p).then(function(h){h=h.default;return h({locateFile:function(c){return m.toUrl("./"+c)}})}).then(function(h){b(h);f=!0})};l.isLoaded=function(){return f};var e={getBlobInfo:null,decode:null};l.decode=function(h,c){var g;void 0===c&&(c={});var n=null!==(g=c.inputOffset)&&void 0!==g?g:0;g=h instanceof Uint8Array?h.subarray(n):new Uint8Array(h,n);h=e.getBlobInfo(g);var q=e.decode(g,h),v=q.maskData;g=h.width;n=h.height;var u=h.bandCount,t=h.dimCount,y=h.maskCount,D=h.statistics,B=a[h.dataType],
E=new B.ctor(q.data.buffer);q=[];for(var x=[],w=g*n,A=w*t,z=0;z<u;z++){var G=E.subarray(z*A,(z+1)*A);if(c.returnPixelInterleavedDims)q.push(G);else{var I=w,K=t;if(!(2>K)){for(var R=new B.ctor(I*K),U=0,ba=0;U<I;U++)for(var ca=0,da=U;ca<K;ca++,da+=I)R[da]=G[ba++];G=R}q.push(G)}x.push(v.subarray(z*A,(z+1)*A))}v=0===y?null:1===y?x[0]:new Uint8Array(w);if(1<y)for(v.set(x[0]),z=1;z<x.length;z++)for(E=x[z],A=0;A<w;A++)v[A]&=E[A];z=c.noDataValue;z=null!=z&&B.range[0]<=z&&B.range[1]>=z;if(0<y&&z)for(I=c.noDataValue,
z=0;z<u;z++)for(G=q[z],E=x[z]||v,A=0;A<w;A++)0===E[A]&&(G[A]=I);return{width:g,height:n,bandCount:u,pixelType:c.pixelType&&0===h.version?c.pixelType:B.pixelType,dimCount:t,statistics:D,pixels:q,mask:v,bandMasks:y===u&&1<u?x:null}};l.getBlobInfo=function(h,c){var g,n;void 0===c&&(c={});h=h instanceof Uint8Array?h.subarray(null!==(g=c.inputOffset)&&void 0!==g?g:0):new Uint8Array(h,null!==(n=c.inputOffset)&&void 0!==n?n:0);return e.getBlobInfo(h)}})},"esri/layers/rasterFormats/JpgPlus":function(){define(["dojo/_base/declare",
"./Zlib","./Jpg"],function(H,k,p){return H(null,{constructor:function(){},decode:function(r){var m=new Uint8Array(r);r=new p;r.parse(m);var l=r.numComponents,b=r.getData(r.width,r.height,!0),a=r.width*r.height,d=r.eof,f=0,e=0,h=0;if(d<m.length-1){e=(new k(m.subarray(d))).getBytes();var c=new Uint8Array(a);for(f=m=0;f<e.length;f++)for(h=7;0<=h;h--)c[m++]=e[f]>>h&1}m=[];if(1===l)m=[b,b,b];else{for(f=0;3>f;f++)l=new Uint8Array(a),m.push(l);for(e=h=0;e<a;e++)for(f=0;3>f;f++)m[f][e]=b[h++]}return{width:r.width,
height:r.height,pixels:m,mask:c}}})})},"esri/layers/rasterFormats/Zlib":function(){define([],function(){var H=function(){function k(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}k.prototype={ensureBuffer:function(p){var r=this.buffer,m=r?r.byteLength:0;if(p<m)return r;for(var l=512;l<p;)l<<=1;p=new Uint8Array(l);for(l=0;l<m;++l)p[l]=r[l];return this.buffer=p},getByte:function(){for(var p=this.pos;this.bufferLength<=p;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},
getBytes:function(p){var r=this.pos;if(p){this.ensureBuffer(r+p);for(p=r+p;!this.eof&&this.bufferLength<p;)this.readBlock();var m=this.bufferLength;p>m&&(p=m)}else{for(;!this.eof;)this.readBlock();p=this.bufferLength}this.pos=p;return this.buffer.subarray(r,p)},lookChar:function(){for(var p=this.pos;this.bufferLength<=p;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var p=this.pos;this.bufferLength<=p;){if(this.eof)return null;
this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(p,r,m){for(var l=p+r;this.bufferLength<=l&&!this.eof;)this.readBlock();return new Stream(this.buffer,p,r,m)},skip:function(p){p||(p=1);this.pos+=p},reset:function(){this.pos=0}};return k}();return function(){function k(d){throw Error(d);}function p(d){var f=0,e=d[f++],h=d[f++];-1!=e&&-1!=h||k("Invalid header in flate stream");8!=(e&15)&&k("Unknown compression method in flate stream");0!=((e<<8)+h)%31&&k("Bad FCHECK in flate stream");
h&32&&k("FDICT bit set in flate stream");this.bytes=d;this.bytesPos=f;this.codeBuf=this.codeSize=0;H.call(this)}if(!self||!self.Uint32Array)return null;var r=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),m=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),l=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,
393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),b=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,
524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,
524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,
524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,
524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,
524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,
524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,
524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];p.prototype=Object.create(H.prototype);p.prototype.getBits=function(d){for(var f=
this.codeSize,e=this.codeBuf,h=this.bytes,c=this.bytesPos,g;f<d;)"undefined"==typeof(g=h[c++])&&k("Bad encoding in flate stream"),e|=g<<f,f+=8;this.codeBuf=e>>d;this.codeSize=f-=d;this.bytesPos=c;return e&(1<<d)-1};p.prototype.getCode=function(d){var f=d[0],e=d[1];d=this.codeSize;for(var h=this.codeBuf,c=this.bytes,g=this.bytesPos;d<e;){var n;"undefined"==typeof(n=c[g++])&&k("Bad encoding in flate stream");h|=n<<d;d+=8}e=f[h&(1<<e)-1];f=e>>16;e&=65535;(0==d||d<f||0==f)&&k("Bad encoding in flate stream");
this.codeBuf=h>>f;this.codeSize=d-f;this.bytesPos=g;return e};p.prototype.generateHuffmanTable=function(d){for(var f=d.length,e=0,h=0;h<f;++h)d[h]>e&&(e=d[h]);for(var c=1<<e,g=new Uint32Array(c),n=1,q=0,v=2;n<=e;++n,q<<=1,v<<=1)for(var u=0;u<f;++u)if(d[u]==n){var t=0,y=q;for(h=0;h<n;++h)t=t<<1|y&1,y>>=1;for(h=t;h<c;h+=v)g[h]=n<<16|u;++q}return[g,e]};p.prototype.readBlock=function(){function d(t,y,D,B,E){for(t=t.getBits(D)+B;0<t--;)y[q++]=E}var f=this.getBits(3);f&1&&(this.eof=!0);f>>=1;if(0==f){var e=
this.bytes,h=this.bytesPos,c;"undefined"==typeof(c=e[h++])&&k("Bad block header in flate stream");var g=c;"undefined"==typeof(c=e[h++])&&k("Bad block header in flate stream");g|=c<<8;"undefined"==typeof(c=e[h++])&&k("Bad block header in flate stream");f=c;"undefined"==typeof(c=e[h++])&&k("Bad block header in flate stream");(f|c<<8)!=(~g&65535)&&k("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;c=this.bufferLength;f=this.ensureBuffer(c+g);this.bufferLength=g=c+g;for(var n=
c;n<g;++n){if("undefined"==typeof(c=e[h++])){this.eof=!0;break}f[n]=c}this.bytesPos=h}else{if(1==f)h=b,c=a;else if(2==f){f=this.getBits(5)+257;c=this.getBits(5)+1;e=this.getBits(4)+4;h=Array(r.length);for(var q=0;q<e;)h[r[q++]]=this.getBits(3);h=this.generateHuffmanTable(h);q=e=0;c=f+c;for(g=Array(c);q<c;)n=this.getCode(h),16==n?d(this,g,2,3,e):17==n?d(this,g,3,3,e=0):18==n?d(this,g,7,11,e=0):g[q++]=e=n;h=this.generateHuffmanTable(g.slice(0,f));c=this.generateHuffmanTable(g.slice(f,c))}else k("Unknown block type in flate stream");
g=(f=this.buffer)?f.length:0;for(n=this.bufferLength;;){var v=this.getCode(h);if(256>v)n+1>=g&&(f=this.ensureBuffer(n+1),g=f.length),f[n++]=v;else{if(256==v){this.bufferLength=n;break}v-=257;v=m[v];var u=v>>16;0<u&&(u=this.getBits(u));e=(v&65535)+u;v=this.getCode(c);v=l[v];u=v>>16;0<u&&(u=this.getBits(u));v=(v&65535)+u;n+e>=g&&(f=this.ensureBuffer(n+e),g=f.length);for(u=0;u<e;++u,++n)f[n]=f[n-v]}}}};return p}()})},"esri/layers/rasterFormats/Jpg":function(){define([],function(){var H=function(){function k(p){this.message=
"JPEG error: "+p}k.prototype=Error();k.prototype.name="JpegError";return k.constructor=k}();return function(){function k(){this.decodeTransform=null;this.colorTransform=-1}function p(a,d){for(var f=0,e=[],h,c,g=16;0<g&&!a[g-1];)g--;e.push({children:[],index:0});var n=e[0],q;for(h=0;h<g;h++){for(c=0;c<a[h];c++){n=e.pop();for(n.children[n.index]=d[f];0<n.index;)n=e.pop();n.index++;for(e.push(n);e.length<=h;)e.push(q={children:[],index:0}),n.children[n.index]=q.children,n=q;f++}h+1<g&&(e.push(q={children:[],
index:0}),n.children[n.index]=q.children,n=q)}return e[0].children}function r(a,d,f,e,h,c,g,n,q){function v(){if(0<I)return I--,G>>I&1;G=a[d++];if(255===G){var N=a[d++];if(N)throw new H("unexpected marker "+(G<<8|N).toString(16));}I=7;return G>>>7}function u(N){for(;;){N=N[v()];if("number"===typeof N)return N;if("object"!==typeof N)throw new H("invalid huffman sequence");}}function t(N){for(var C=0;0<N;)C=C<<1|v(),N--;return C}function y(N){if(1===N)return 1===v()?1:-1;var C=t(N);return C>=1<<N-1?
C:C+(-1<<N)+1}function D(N,C){var P=u(N.huffmanTableDC);P=0===P?0:y(P);N.blockData[C]=N.pred+=P;for(P=1;64>P;){var Q=u(N.huffmanTableAC),Y=Q&15;Q>>=4;if(0===Y){if(15>Q)break;P+=16}else P+=Q,N.blockData[C+b[P]]=y(Y),P++}}function B(N,C){var P=u(N.huffmanTableDC);P=0===P?0:y(P)<<q;N.blockData[C]=N.pred+=P}function E(N,C){N.blockData[C]|=v()<<q}function x(N,C){if(0<K)K--;else for(var P=c;P<=g;){var Q=u(N.huffmanTableAC),Y=Q&15;Q>>=4;if(0===Y){if(15>Q){K=t(Q)+(1<<Q)-1;break}P+=16}else P+=Q,N.blockData[C+
b[P]]=y(Y)*(1<<q),P++}}function w(N,C){for(var P=c,Q=0,Y;P<=g;){Y=b[P];switch(R){case 0:Q=u(N.huffmanTableAC);Y=Q&15;Q>>=4;if(0===Y)15>Q?(K=t(Q)+(1<<Q),R=4):(Q=16,R=1);else{if(1!==Y)throw new H("invalid ACn encoding");U=y(Y);R=Q?2:3}continue;case 1:case 2:N.blockData[C+Y]?N.blockData[C+Y]+=v()<<q:(Q--,0===Q&&(R=2===R?3:0));break;case 3:N.blockData[C+Y]?N.blockData[C+Y]+=v()<<q:(N.blockData[C+Y]=U<<q,R=0);break;case 4:N.blockData[C+Y]&&(N.blockData[C+Y]+=v()<<q)}P++}4===R&&(K--,0===K&&(R=0))}var A=
f.mcusPerLine,z=d,G=0,I=0,K=0,R=0,U,ba=e.length,ca,da,ja,ea;n=f.progressive?0===c?0===n?B:E:0===n?x:w:D;var L=0;f=1===ba?e[0].blocksPerLine*e[0].blocksPerColumn:A*f.mcusPerColumn;for(var O,S;L<f;){var T=h?Math.min(f-L,h):f;for(ca=0;ca<ba;ca++)e[ca].pred=0;K=0;if(1===ba){var J=e[0];for(ea=0;ea<T;ea++)n(J,64*((J.blocksPerLine+1)*(L/J.blocksPerLine|0)+L%J.blocksPerLine)),L++}else for(ea=0;ea<T;ea++){for(ca=0;ca<ba;ca++)for(J=e[ca],O=J.h,S=J.v,da=0;da<S;da++)for(ja=0;ja<O;ja++)n(J,64*((J.blocksPerLine+
1)*((L/A|0)*J.v+da)+(L%A*J.h+ja)));L++}I=0;(J=l(a,d))&&J.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+J.invalid),d=J.offset);J=J&&J.marker;if(!J||65280>=J)throw new H("marker was not found");if(65488<=J&&65495>=J)d+=2;else break}(J=l(a,d))&&J.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+J.invalid),d=J.offset);return d-z}function m(a,d){a=d.blocksPerLine;for(var f=d.blocksPerColumn,e=new Int16Array(64),h=0;h<f;h++)for(var c=0;c<a;c++){var g=
void 0,n=void 0,q=void 0,v=void 0,u=void 0,t=void 0,y=void 0,D=void 0,B=u=t=v=n=g=void 0,E=void 0,x=void 0,w=void 0,A=64*((d.blocksPerLine+1)*h+c),z=e,G=d.quantizationTable,I=d.blockData;if(!G)throw new H("missing required Quantization Table.");for(var K=0;64>K;K+=8)g=I[A+K],D=I[A+K+1],y=I[A+K+2],t=I[A+K+3],u=I[A+K+4],v=I[A+K+5],q=I[A+K+6],n=I[A+K+7],g*=G[K],0===(D|y|t|u|v|q|n)?(g=5793*g+512>>10,z[K]=g,z[K+1]=g,z[K+2]=g,z[K+3]=g,z[K+4]=g,z[K+5]=g,z[K+6]=g,z[K+7]=g):(D*=G[K+1],y*=G[K+2],t*=G[K+3],
u*=G[K+4],v*=G[K+5],q*=G[K+6],n*=G[K+7],w=5793*g+128>>8,x=5793*u+128>>8,E=y,B=q,u=2896*(D-n)+128>>8,n=2896*(D+n)+128>>8,t<<=4,v<<=4,w=w+x+1>>1,x=w-x,g=3784*E+1567*B+128>>8,E=1567*E-3784*B+128>>8,B=g,u=u+v+1>>1,v=u-v,n=n+t+1>>1,t=n-t,w=w+B+1>>1,B=w-B,x=x+E+1>>1,E=x-E,g=2276*u+3406*n+2048>>12,u=3406*u-2276*n+2048>>12,n=g,g=799*t+4017*v+2048>>12,t=4017*t-799*v+2048>>12,v=g,z[K]=w+n,z[K+7]=w-n,z[K+1]=x+v,z[K+6]=x-v,z[K+2]=E+t,z[K+5]=E-t,z[K+3]=B+u,z[K+4]=B-u);for(G=0;8>G;++G)g=z[G],D=z[G+8],y=z[G+16],
t=z[G+24],u=z[G+32],v=z[G+40],q=z[G+48],n=z[G+56],0===(D|y|t|u|v|q|n)?(g=5793*g+8192>>14,g=-2040>g?0:2024<=g?255:g+2056>>4,I[A+G]=g,I[A+G+8]=g,I[A+G+16]=g,I[A+G+24]=g,I[A+G+32]=g,I[A+G+40]=g,I[A+G+48]=g,I[A+G+56]=g):(w=5793*g+2048>>12,x=5793*u+2048>>12,E=y,B=q,u=2896*(D-n)+2048>>12,n=2896*(D+n)+2048>>12,w=(w+x+1>>1)+4112,x=w-x,g=3784*E+1567*B+2048>>12,E=1567*E-3784*B+2048>>12,B=g,u=u+v+1>>1,v=u-v,n=n+t+1>>1,t=n-t,w=w+B+1>>1,B=w-B,x=x+E+1>>1,E=x-E,g=2276*u+3406*n+2048>>12,u=3406*u-2276*n+2048>>12,
n=g,g=799*t+4017*v+2048>>12,t=4017*t-799*v+2048>>12,v=g,g=w+n,n=w-n,D=x+v,q=x-v,y=E+t,v=E-t,t=B+u,u=B-u,g=16>g?0:4080<=g?255:g>>4,D=16>D?0:4080<=D?255:D>>4,y=16>y?0:4080<=y?255:y>>4,t=16>t?0:4080<=t?255:t>>4,u=16>u?0:4080<=u?255:u>>4,v=16>v?0:4080<=v?255:v>>4,q=16>q?0:4080<=q?255:q>>4,n=16>n?0:4080<=n?255:n>>4,I[A+G]=g,I[A+G+8]=D,I[A+G+16]=y,I[A+G+24]=t,I[A+G+32]=u,I[A+G+40]=v,I[A+G+48]=q,I[A+G+56]=n)}return d.blockData}function l(a,d,f){var e=a.length-1;f=f<d?f:d;if(d>=e)return null;var h=a[d]<<
8|a[d+1];if(65472<=h&&65534>=h)return{invalid:null,marker:h,offset:d};for(d=a[f]<<8|a[f+1];!(65472<=d&&65534>=d);){if(++f>=e)return null;d=a[f]<<8|a[f+1]}return{invalid:h.toString(16),marker:d,offset:f}}if(!self||!self.Uint8ClampedArray)return null;var b=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);k.prototype={parse:function(a){function d(){var G=
a[h]<<8|a[h+1];h+=2;return G}function f(){var G=d();G=h+G-2;var I=l(a,G,h);I&&I.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+I.invalid),G=I.offset);G=a.subarray(h,G);h+=G.length;return G}function e(G){for(var I=Math.ceil(G.samplesPerLine/8/G.maxH),K=Math.ceil(G.scanLines/8/G.maxV),R=0;R<G.components.length;R++){z=G.components[R];var U=Math.ceil(Math.ceil(G.samplesPerLine/8)*z.h/G.maxH),ba=Math.ceil(Math.ceil(G.scanLines/8)*z.v/G.maxV);z.blockData=new Int16Array(64*K*
z.v*(I*z.h+1));z.blocksPerLine=U;z.blocksPerColumn=ba}G.mcusPerLine=I;G.mcusPerColumn=K}var h=0,c=null,g=null,n=[],q=[],v=[],u=d();if(65496!==u)throw new H("SOI not found");for(u=d();65497!==u;){switch(u){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var t=f();65504===u&&74===t[0]&&70===t[1]&&73===t[2]&&70===t[3]&&0===t[4]&&(c={version:{major:t[5],minor:t[6]},
densityUnits:t[7],xDensity:t[8]<<8|t[9],yDensity:t[10]<<8|t[11],thumbWidth:t[12],thumbHeight:t[13],thumbData:t.subarray(14,14+3*t[12]*t[13])});65518===u&&65===t[0]&&100===t[1]&&111===t[2]&&98===t[3]&&101===t[4]&&(g={version:t[5]<<8|t[6],flags0:t[7]<<8|t[8],flags1:t[9]<<8|t[10],transformCode:t[11]});break;case 65499:u=d()+h-2;for(var y;h<u;){var D=a[h++],B=new Uint16Array(64);if(0===D>>4)for(t=0;64>t;t++)y=b[t],B[y]=a[h++];else if(1===D>>4)for(t=0;64>t;t++)y=b[t],B[y]=d();else throw new H("DQT - invalid table spec");
n[D&15]=B}break;case 65472:case 65473:case 65474:if(E)throw new H("Only single frame JPEGs supported");d();var E={};E.extended=65473===u;E.progressive=65474===u;E.precision=a[h++];E.scanLines=d();E.samplesPerLine=d();E.components=[];E.componentIds={};t=a[h++];for(u=B=D=0;u<t;u++){y=a[h];var x=a[h+1]>>4;var w=a[h+1]&15;D<x&&(D=x);B<w&&(B=w);x=E.components.push({h:x,v:w,quantizationId:a[h+2],quantizationTable:null});E.componentIds[y]=x-1;h+=3}E.maxH=D;E.maxV=B;e(E);break;case 65476:y=d();for(u=2;u<
y;){D=a[h++];B=new Uint8Array(16);for(t=x=0;16>t;t++,h++)x+=B[t]=a[h];w=new Uint8Array(x);for(t=0;t<x;t++,h++)w[t]=a[h];u+=17+x;(0===D>>4?v:q)[D&15]=p(B,w)}break;case 65501:d();var A=d();break;case 65498:d();y=a[h++];t=[];for(u=0;u<y;u++){D=E.componentIds[a[h++]];var z=E.components[D];D=a[h++];z.huffmanTableDC=v[D>>4];z.huffmanTableAC=q[D&15];t.push(z)}u=a[h++];y=a[h++];D=a[h++];u=r(a,h,E,t,A,u,y,D>>4,D&15);h+=u;break;case 65535:255!==a[h]&&h--;break;default:if(255===a[h-3]&&192<=a[h-2]&&254>=a[h-
2])h-=3;else throw new H("unknown marker "+u.toString(16));}u=d()}this.width=E.samplesPerLine;this.height=E.scanLines;this.jfif=c;this.eof=h;this.adobe=g;this.components=[];for(u=0;u<E.components.length;u++){z=E.components[u];if(c=n[z.quantizationId])z.quantizationTable=c;this.components.push({output:m(E,z),scaleX:z.h/E.maxH,scaleY:z.v/E.maxV,blocksPerLine:z.blocksPerLine,blocksPerColumn:z.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(a,d){var f=this.width/
a,e=this.height/d,h,c,g=0,n=this.components.length,q=a*d*n,v=new Uint8ClampedArray(q),u=new Uint32Array(a);for(c=0;c<n;c++){var t=this.components[c];var y=t.scaleX*f;var D=t.scaleY*e;g=c;var B=t.output;var E=t.blocksPerLine+1<<3;for(h=0;h<a;h++)t=0|h*y,u[h]=(t&4294967288)<<3|t&7;for(y=0;y<d;y++)for(t=0|y*D,t=E*(t&4294967288)|(t&7)<<3,h=0;h<a;h++)v[g]=B[t+u[h]],g+=n}if(d=this.decodeTransform)for(c=0;c<q;)for(a=t=0;t<n;t++,c++,a+=2)v[c]=(v[c]*d[a]>>8)+d[a+1];return v},_isColorConversionNeeded:function(){return this.adobe?
!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(a){for(var d,f,e,h=0,c=a.length;h<c;h+=3)d=a[h],f=a[h+1],e=a[h+2],a[h]=d-179.456+1.402*e,a[h+1]=d+135.459-.344*f-.714*e,a[h+2]=d-226.816+1.772*f;return a},_convertYcckToRgb:function(a){for(var d,f,e,h,c=0,g=0,n=a.length;g<n;g+=4)d=a[g],f=a[g+1],e=a[g+2],h=a[g+3],a[c++]=-122.67195406894+f*(-6.60635669420364E-5*f+4.37130475926232E-4*e-5.4080610064599E-5*d+4.8449797120281E-4*
h-.154362151871126)+e*(-9.57964378445773E-4*e+8.17076911346625E-4*d-.00477271405408747*h+1.53380253221734)+d*(9.61250184130688E-4*d-.00266257332283933*h+.48357088451265)+h*(-3.36197177618394E-4*h+.484791561490776),a[c++]=107.268039397724+f*(2.19927104525741E-5*f-6.40992018297945E-4*e+6.59397001245577E-4*d+4.26105652938837E-4*h-.176491792462875)+e*(-7.78269941513683E-4*e+.00130872261408275*d+7.70482631801132E-4*h-.151051492775562)+d*(.00126935368114843*d-.00265090189010898*h+.25802910206845)+h*(-3.18913117588328E-4*
h-.213742400323665),a[c++]=-20.810012546947+f*(-5.70115196973677E-4*f-2.63409051004589E-5*e+.0020741088115012*d-.00288260236853442*h+.814272968359295)+e*(-1.53496057440975E-5*e-1.32689043961446E-4*d+5.60833691242812E-4*h-.195152027534049)+d*(.00174418132927582*d-.00255243321439347*h+.116935020465145)+h*(-3.43531996510555E-4*h+.24165260232407);return a},_convertYcckToCmyk:function(a){for(var d,f,e,h=0,c=a.length;h<c;h+=4)d=a[h],f=a[h+1],e=a[h+2],a[h]=434.456-d-1.402*e,a[h+1]=119.541-d+.344*f+.714*
e,a[h+2]=481.816-d-1.772*f;return a},_convertCmykToRgb:function(a){for(var d,f,e,h,c=0,g=1/255,n=0,q=a.length;n<q;n+=4)d=a[n]*g,f=a[n+1]*g,e=a[n+2]*g,h=a[n+3]*g,a[c++]=255+d*(-4.387332384609988*d+54.48615194189176*f+18.82290502165302*e+212.25662451639585*h-285.2331026137004)+f*(1.7149763477362134*f-5.6096736904047315*e-17.873870861415444*h-5.497006427196366)+e*(-2.5217340131683033*e-21.248923337353073*h+17.5119270841813)-h*(21.86122147463605*h+189.48180835922747),a[c++]=255+d*(8.841041422036149*d+
60.118027045597366*f+6.871425592049007*e+31.159100130055922*h-79.2970844816548)+f*(-15.310361306967817*f+17.575251261109482*e+131.35250912493976*h-190.9453302588951)+e*(4.444339102852739*e+9.8632861493405*h-24.86741582555878)-h*(20.737325471181034*h+187.80453709719578),a[c++]=255+d*(.8842522430003296*d+8.078677503112928*f+30.89978309703729*e-.23883238689178934*h-14.183576799673286)+f*(10.49593273432072*f+63.02378494754052*e+50.606957656360734*h-112.23884253719248)+e*(.03296041114873217*e+115.60384449646641*
h-193.58209356861505)-h*(22.33816807309886*h+180.12613974708367);return a},getData:function(a,d,f){if(4<this.numComponents)throw new H("Unsupported color mode");a=this._getLinearizedBlockData(a,d);if(1===this.numComponents&&f){f=a.length;d=new Uint8ClampedArray(3*f);for(var e=0,h=0;h<f;h++){var c=a[h];d[e++]=c;d[e++]=c;d[e++]=c}return d}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(a);if(4===this.numComponents){if(this._isColorConversionNeeded())return f?
this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(f)return this._convertCmykToRgb(a)}return a}};return k}()})},"esri/layers/rasterFormats/Png":function(){define(["./Zlib"],function(H){return function(){function k(r){var m,l;this.data=r;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(l=null;;){var b=this.readUInt32();var a=r=void 0;r=[];for(a=0;4>a;++a)r.push(String.fromCharCode(this.data[this.pos++]));r=r.join("");switch(r){case "IHDR":this.width=
this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(b);break;case "fcTL":l&&this.animation.frames.push(l);this.pos+=4;l={width:this.readUInt32(),height:this.readUInt32(),
xOffset:this.readUInt32(),yOffset:this.readUInt32()};r=this.readUInt16();b=this.readUInt16()||100;l.delay=1E3*r/b;l.disposeOp=this.data[this.pos++];l.blendOp=this.data[this.pos++];l.data=[];break;case "IDAT":case "fdAT":"fdAT"===r&&(this.pos+=4,b-=4);r=(null!=l?l.data:void 0)||this.imgData;for(a=0;0<=b?a<b:a>b;0<=b?++a:--a)r.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(b);b=255-this.transparency.indexed.length;
if(0<b)for(r=0;0<=b?r<b:r>b;0<=b?++r:--r)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(b)[0];break;case 2:this.transparency.rgb=this.read(b)}break;case "tEXt":a=this.read(b);b=a.indexOf(0);r=String.fromCharCode.apply(String,a.slice(0,b));this.text[r]=String.fromCharCode.apply(String,a.slice(b+1));break;case "IEND":l&&this.animation.frames.push(l);a:{switch(this.colorType){case 0:case 3:case 4:l=1;break a;case 2:case 6:l=3;break a}l=void 0}this.colors=l;this.hasAlphaChannel=
4===(m=this.colorType)||6===m;m=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*m;a:{switch(this.colors){case 1:m="DeviceGray";break a;case 3:m="DeviceRGB";break a}m=void 0}this.colorSpace=m;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=b}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}}k.load=function(r,m,l){"function"===typeof m&&(l=m);var b=new XMLHttpRequest;b.open("GET",r,!0);b.responseType="arraybuffer";b.onload=
function(){var a=new Uint8Array(b.response||b.mozResponseArrayBuffer);a=new k(a);"function"===typeof(null!=m?m.getContext:void 0)&&a.render(m);return"function"===typeof l?l(a):void 0};return b.send(null)};k.prototype.read=function(r){var m;var l=[];for(m=0;0<=r?m<r:m>r;0<=r?++m:--m)l.push(this.data[this.pos++]);return l};k.prototype.readUInt32=function(){var r=this.data[this.pos++]<<24;var m=this.data[this.pos++]<<16;var l=this.data[this.pos++]<<8;var b=this.data[this.pos++];return r|m|l|b};k.prototype.readUInt16=
function(){var r=this.data[this.pos++]<<8;var m=this.data[this.pos++];return r|m};k.prototype.decodePixels=function(r){var m,l,b,a,d,f,e,h;null==r&&(r=this.imgData);if(0===r.length)return new Uint8Array(0);r=new H(r);r=r.getBytes();var c=this.pixelBitlength/8;var g=c*this.width;var n=new Uint8Array(g*this.height);var q=r.length;for(l=a=d=0;a<q;){switch(r[a++]){case 0:for(b=m=0;m<g;b=m+=1)n[l++]=r[a++];break;case 1:for(b=f=0;f<g;b=f+=1){m=r[a++];var v=b<c?0:n[l-c];n[l++]=(m+v)%256}break;case 2:for(b=
v=0;v<g;b=v+=1){m=r[a++];var u=(b-b%c)/c;f=d&&n[(d-1)*g+u*c+b%c];n[l++]=(f+m)%256}break;case 3:for(b=h=0;h<g;b=h+=1)m=r[a++],u=(b-b%c)/c,v=b<c?0:n[l-c],f=d&&n[(d-1)*g+u*c+b%c],n[l++]=(m+Math.floor((v+f)/2))%256;break;case 4:for(b=h=0;h<g;b=h+=1){m=r[a++];u=(b-b%c)/c;v=b<c?0:n[l-c];0===d?f=e=0:(f=n[(d-1)*g+u*c+b%c],e=u&&n[(d-1)*g+(u-1)*c+b%c]);var t=v+f-e;b=Math.abs(t-v);u=Math.abs(t-f);t=Math.abs(t-e);v=b<=u&&b<=t?v:u<=t?f:e;n[l++]=(m+v)%256}break;default:throw Error("Invalid filter algorithm: "+
r[a-1]);}d++}return n};k.prototype.decodePalette=function(){var r,m,l,b,a;var d=this.palette;var f=this.transparency.indexed||[];var e=new Uint8Array((f.length||0)+d.length);var h=l=r=m=0;for(b=d.length;l<b;h=l+=3)e[m++]=d[h],e[m++]=d[h+1],e[m++]=d[h+2],e[m++]=null!=(a=f[r++])?a:255;return e};k.prototype.copyToImageData=function(r,m){var l,b;var a=this.colors;var d=null;var f=this.hasAlphaChannel;this.palette.length&&(d=null!=(l=this._decodedPalette)?l:this._decodedPalette=this.decodePalette(),a=
4,f=!0);r=r.data||r;var e=r.length;var h=d||m;l=b=0;if(1===a)for(;l<e;)a=d?4*m[l/4]:b,b=h[a++],r[l++]=b,r[l++]=b,r[l++]=b,r[l++]=f?h[a++]:this.transparency.grayscale&&this.transparency.grayscale===b?0:255,b=a;else for(;l<e;)a=d?4*m[l/4]:b,r[l++]=h[a++],r[l++]=h[a++],r[l++]=h[a++],r[l++]=f?h[a++]:this.transparency.rgb&&this.transparency.rgb[1]===h[a-3]&&this.transparency.rgb[3]===h[a-2]&&this.transparency.rgb[5]===h[a-1]?0:255,b=a};k.prototype.decode=function(){var r=new Uint8Array(this.width*this.height*
4);this.copyToImageData(r,this.decodePixels());return r};var p=function(r){(void 0).clearRect(0,0,r.width,r.height);(void 0).putImageData(r,0,0);r=new Image;r.src=(void 0).toDataURL();return r};k.prototype.decodeFrames=function(r){var m,l;if(this.animation){var b=this.animation.frames;var a=[];var d=m=0;for(l=b.length;m<l;d=++m){d=b[d];var f=r.createImageData(d.width,d.height);var e=this.decodePixels(new Uint8Array(d.data));this.copyToImageData(f,e);d.imageData=f;a.push(d.image=p(f))}return a}};k.prototype.renderFrame=
function(r,m){var l=this.animation.frames;var b=l[m];l=l[m-1];0===m&&r.clearRect(0,0,this.width,this.height);1===(null!=l?l.disposeOp:void 0)?r.clearRect(l.xOffset,l.yOffset,l.width,l.height):2===(null!=l?l.disposeOp:void 0)&&r.putImageData(l.imageData,l.xOffset,l.yOffset);0===b.blendOp&&r.clearRect(b.xOffset,b.yOffset,b.width,b.height);return r.drawImage(b.image,b.xOffset,b.yOffset)};k.prototype.animate=function(r){var m,l=this;var b=0;var a=this.animation;var d=a.numFrames;var f=a.frames;var e=
a.numPlays;return(m=function(){var h=b++%d;var c=f[h];l.renderFrame(r,h);if(1<d&&b/d<e)return l.animation._timeout=setTimeout(m,c.delay)})()};k.prototype.stopAnimation=function(){var r;return clearTimeout(null!=(r=this.animation)?r._timeout:void 0)};k.prototype.render=function(r){r._png&&r._png.stopAnimation();r._png=this;r.width=this.width;r.height=this.height;r=r.getContext("2d");if(this.animation)return this.decodeFrames(r),this.animate(r);var m=r.createImageData(this.width,this.height);this.copyToImageData(m,
this.decodePixels());return r.putImageData(m,0,0)};return k}()})},"esri/layers/rasterFormats/Raw":function(){define([],function(){return{decodeBIP:function(H,k){var p=k.pixelType,r=k.bandCount,m=[],l=k.width*k.height,b=this.getBandCount(H,k);r=r||b;var a=H.byteLength-H.byteLength%(l*this._getPixelLength(p)),d=new p(H,0,l*b),f,e,h;for(f=0;f<r;f++){var c=new p(l);for(e=0;e<l;e++)c[e]=d[e*b+f];m.push(c)}a<H.byteLength-1&&(h=this._decodeMask(H.slice(a),k));return{pixels:m,maskData:h}},decodeBSQ:function(H,
k){var p=k.pixelType,r=k.bandCount;if(void 0===r||null===r)r=this.getBandCount(H,k);var m=[],l=k.width*k.height,b=l*r,a=H.byteLength-H.byteLength%(l*this._getPixelLength(p));p=new p(H,0,b);var d;for(b=0;b<r;b++)m.push(p.subarray(b*l,(b+1)*l));a<H.byteLength-1&&(d=this._decodeMask(H.slice(a),k));return{pixels:m,maskData:d}},getBandCount:function(H,k){return Math.floor(H.byteLength/(k.width*k.height*this._getPixelLength(k.pixelType)))},_getPixelLength:function(H){var k=1;switch(H){case Uint8Array:case Int8Array:case Uint8ClampedArray:k=
1;break;case Uint16Array:case Int16Array:k=2;break;case Uint32Array:case Int32Array:case Float32Array:k=4;break;case Float64Array:k=8}return k},_decodeMask:function(H,k){var p=k.width*k.height;if(8*H.byteLength<p)return null;H=new Uint8Array(H,0,Math.ceil(p/8));k=new Uint8Array(k.width*k.height);var r=0,m=0,l=0,b=0;for(l=0;l<H.length-1;l++)for(m=H[l],b=7;0<=b;b--)k[r++]=m>>b&1;for(b=7;r<p-1;)m=H[H.length-1],k[r++]=m>>b&1,b--;return k}}})},"esri/layers/rasterFormats/TiffDecoder":function(){define(["./Jpg",
"./Zlib"],function(H,k){var p=function(){var b=new ArrayBuffer(4),a=new Uint8Array(b);b=new Uint32Array(b);a[0]=1;a[1]=2;a[2]=3;a[3]=4;return 67305985===b[0]},r=function(){var b=[];b[254]="NEWSUBFILETYPE";b[255]="SUBFILETYPE";b[256]="IMAGEWIDTH";b[257]="IMAGELENGTH";b[258]="BITSPERSAMPLE";b[259]="COMPRESSION";b[262]="PHOTOMETRICINTERPRETATION";b[263]="THRESHHOLDING";b[264]="CELLWIDTH";b[265]="CELLLENGTH";b[266]="FILLORDER";b[269]="DOCUMENTNAME";b[270]="IMAGEDESCRIPTION";b[271]="MAKE";b[272]="MODEL";
b[273]="STRIPOFFSETS";b[274]="ORIENTATION";b[277]="SAMPLESPERPIXEL";b[278]="ROWSPERSTRIP";b[279]="STRIPBYTECOUNTS";b[280]="MINSAMPLEVALUE";b[281]="MAXSAMPLEVALUE";b[282]="XRESOLUTION";b[283]="YRESOLUTION";b[284]="PLANARCONFIGURATION";b[285]="PAGENAME";b[286]="XPOSITION";b[287]="YPOSITION";b[288]="FREEOFFSETS";b[289]="FREEBYTECOUNTS";b[290]="GRAYRESPONSEUNIT";b[291]="GRAYRESPONSECURVE";b[292]="T4OPTIONS";b[293]="T6OPTIONS";b[296]="RESOLUTIONUNIT";b[297]="PAGENUMBER";b[300]="COLORRESPONSEUNIT";b[301]=
"TRANSFERFUNCTION";b[305]="SOFTWARE";b[306]="DATETIME";b[315]="ARTIST";b[316]="HOSTCOMPUTER";b[317]="PREDICTOR";b[318]="WHITEPOINT";b[319]="PRIMARYCHROMATICITIES";b[320]="COLORMAP";b[321]="HALFTONEHINTS";b[322]="TILEWIDTH";b[323]="TILELENGTH";b[324]="TILEOFFSETS";b[325]="TILEBYTECOUNTS";b[326]="BADFAXLINES";b[327]="CLEANFAXDATA";b[328]="CONSECUTIVEBADFAXLINES";b[330]="SUBIFD";b[332]="INKSET";b[333]="INKNAMES";b[334]="NUMBEROFINKS";b[336]="DOTRANGE";b[337]="TARGETPRINTER";b[338]="EXTRASAMPLES";b[339]=
"SAMPLEFORMAT";b[340]="SMINSAMPLEVALUE";b[341]="SMAXSAMPLEVALUE";b[342]="TRANSFERRANGE";b[347]="JPEGTABLES";b[512]="JPEGPROC";b[513]="JPEGIFOFFSET";b[514]="JPEGIFBYTECOUNT";b[515]="JPEGRESTARTINTERVAL";b[517]="JPEGLOSSLESSPREDICTORS";b[518]="JPEGPOINTTRANSFORM";b[519]="JPEGQTABLES";b[520]="JPEGDCTABLES";b[521]="JPEGACTABLES";b[529]="YCBCRCOEFFICIENTS";b[530]="YCBCRSUBSAMPLING";b[531]="YCBCRPOSITIONING";b[532]="REFERENCEBLACKWHITE";b[33550]="GEOPIXELSCALE";b[33922]="GEOTIEPOINTS";b[33432]="COPYRIGHT";
b[42112]="GDAL_METADATA";b[42113]="GDAL_NODATA";b[50844]="RPCCOEFFICIENT";b[34735]="GEOKEYDIRECTORY";b[34736]="GEODOUBLEPARAMS";b[34737]="GEOASCIIPARAMS";return b}(),m=[0,1,1,2,4,8,1,1,2,4,8,4,8],l=function(b,a){var d="UNKNOWN";3===b?d="F32":1===b?8>=a?d="U8":16>=a?d="U16":32>=a&&(d="U32"):2===b&&(8>=a?d="S8":16>=a?d="S16":32>=a&&(d="S32"));return d};return{decode:function(b){var a=new DataView(b,0,8),d=a.getUint16(0,!1);if(18761===d)var f=!0;else if(19789===d)f=!1;else throw"unexpected endianess byte";
if(42!==a.getUint16(2,f))throw"unexpected tiff identifier";var e=a.getUint32(4,f);var h=f;var c,g;var n=e;for(var q=[];n;){var v=(new DataView(b,n,2)).getUint16(0,h);var u=n+2;n=(new DataView(b,u+12*v,4)).getUint32(0,h);var t={};for(c=0;c<v;c++){var y=new DataView(b,u,12);var D=y.getUint16(0,h);var B=y.getUint16(2,h);var E=y.getUint32(4,h);var x=y.getUint32(8,h);u+=12;if(!(7===B||12<B)){var w=g={fieldTag:D,fieldType:B,fieldValueCount:E,fieldValueOffset:x},A=void 0,z=void 0,G=b,I=h,K=[],R=g.fieldType,
U=g.fieldValueCount,ba=g.fieldValueOffset,ca=ba,da=m[R],ja=8*da,ea=U*da,L=U*m[R]*8;if(32>=L)if(I||(ba>>>=32-L),1===U)K=[ba];else for(A=0;A<U;A++)K.push(ba<<ja*A>>>32-ja);else for(ca=ba;ca<ba+ea;ca+=da){switch(R){case 1:z=(new DataView(G,ca,1)).getUint8(0);break;case 2:z=(new DataView(G,ca,1)).getUint8(0);break;case 3:z=(new DataView(G,ca,2)).getUint16(0,I);break;case 4:z=(new DataView(G,ca,4)).getUint32(0,I);break;case 5:z=(new DataView(G,ca,4)).getUint32(0,I)/(new DataView(G,ca+4,4)).getUint32(0,
I);break;case 6:z=(new DataView(G,ca,1)).getInt8(0);break;case 8:z=(new DataView(G,ca,2)).getInt16(0,I);break;case 9:z=(new DataView(G,ca,4)).getInt32(0,I);break;case 10:z=(new DataView(G,ca,4)).getInt32(0,I)/(new DataView(G,ca+4,4)).getInt32(0,I);break;case 11:z=(new DataView(G,ca,4)).getFloat32(0,I);break;case 12:z=(new DataView(G,ca,8)).getFloat64(0,I);break;case 7:z=null;break;default:z=null}K.push(z)}if(2===R){var O="",S=K;K=[];for(A=0;A<S.length;A++)0===S[A]&&""!==O?(K.push(O),O=""):O+=String.fromCharCode(S[A]);
""===O&&0!==K.length||K.push(O)}w.fieldValues=K;var T=t,J=r[D];void 0===J&&(J="unknown"+D);T[J]={type:B,values:g.fieldValues}}}q.push(t)}if(0===q.length)throw"no valid image file directory";var N,C=q[0],P=void 0===C.GDAL_NODATA||null===C.GDAL_NODATA?null:parseFloat(C.GDAL_NODATA.values[0]);if(C.TILEOFFSETS){var Q=p()===h,Y=C.TILEOFFSETS?C.TILEOFFSETS.values:void 0;if(void 0===Y)var fa=void 0;else{var na=C.TILEBYTECOUNTS.values,la=C.TILEWIDTH.values[0],W=C.TILELENGTH.values[0],aa=C.IMAGEWIDTH.values[0],
oa=C.IMAGELENGTH.values[0],ha=aa*oa,pa=C.BITSPERSAMPLE.values[0],F=C.SAMPLESPERPIXEL.values[0],M=C.SAMPLEFORMAT?C.SAMPLEFORMAT.values[0]:1,Z=l(M,pa);if(1!==(C.PLANARCONFIGURATION?C.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var X=C.COMPRESSION?C.COMPRESSION.values[0]:1;if(1!==X&&6!==X&&8!==X&&32946!==X)throw console.log("this compression is not supported at this moment"),"this compression is not supported at this moment";
if(3<M)fa=void 0;else{if(3===M){var ka=new Float32Array(ha*F);var V=Float32Array}else 1===M?8>=pa?(ka=new Uint8Array(ha*F),V=Uint8Array):16>=pa?(ka=new Uint16Array(ha*F),V=Uint16Array):32>=pa&&(ka=new Uint32Array(ha*F),V=Uint32Array):2===M&&(8>=pa?(ka=new Int8Array(ha*F),V=Int8Array):16>=pa?(ka=new Int16Array(ha*F),V=Int16Array):32>=pa&&(ka=new Int32Array(ha*F),V=Int32Array));var ia,ma,ra,sa,Ba,wa=Math.ceil(aa/la);if(0===pa%8)for(ia=0;ia<Y.length;ia++){var ta=Math.floor(ia/wa)*W;var va=ia%wa*la;var qa=
(ta*aa+va)*F;if("U8"===Z||"S8"===Z||Q)if(8===X||32946===X){var ua=new Uint8Array(b,Y[ia],na[ia]);var za=new k(ua);var Oa=za.getBytes();var Ea=new ArrayBuffer(Oa.length);ua=new Uint8Array(Ea);ua.set(Oa);ua.length!==la*W*F*pa/8&&console.log("tile byte counts is different than expected")}else if(6===X){ua=new Uint8Array(b,Y[ia],na[ia]);var Aa=new H;Aa.parse(ua);var Wa=Aa.getData(Aa.width,Aa.height);Ea=new ArrayBuffer(Wa.length);ua=new Uint8Array(Ea);ua.set(Wa)}else 1===X&&(na[ia]!==la*W*F*pa/8&&console.log("tile byte counts is different than expected"),
Ea=b.slice(Y[ia],Y[ia]+na[ia]));else{if(8===X||32946===X){ua=new Uint8Array(b,Y[ia],na[ia]);za=new k(ua);ua=za.getBytes();Ea=new ArrayBuffer(ua.length);var Pa=new Uint8Array(Ea);ua.length!==la*W*F*pa/8&&console.log("tile byte counts is different than expected")}else 1===X&&(na[ia]!==la*W*F*pa/8&&console.log("tile byte counts is different than expected"),Ea=new ArrayBuffer(na[ia]),ua=new Uint8Array(b,Y[ia],na[ia]),Pa=new Uint8Array(Ea));switch(Z){case "U16":case "S16":for(ra=0;ra<ua.length;ra+=2)Pa[ra]=
ua[ra+1],Pa[ra+1]=ua[ra];break;case "U32":case "S32":case "F32":for(ra=0;ra<ua.length;ra+=4)Pa[ra]=ua[ra+3],Pa[ra+1]=ua[ra+2],Pa[ra+2]=ua[ra+1],Pa[ra+3]=ua[ra]}}var hb=new V(Ea);var ab=0;var bb=qa;var ib=Math.min(la,aa-va);var jb=Math.min(W,oa-ta);for(sa=0;sa<jb;sa++)for(bb=qa+sa*aa*F,ab=sa*la*F,Ba=0;Ba<ib*F;Ba++,bb++,ab++)ka[bb]=hb[ab]}var Xa={width:aa,height:oa,pixelType:Z};if(1===F)Xa.pixels=[ka];else for(Xa.pixels=[],ia=0;ia<F;ia++){var db=new V(ha);for(ma=0;ma<ha;ma++)db[ma]=ka[ma*F+ia];Xa.pixels.push(db)}fa=
Xa}}}else if(C.STRIPOFFSETS){var kb=p()===h,Ja=C.STRIPOFFSETS?C.STRIPOFFSETS.values:void 0;if(void 0===Ja)fa=void 0;else{var Ka=C.STRIPBYTECOUNTS.values,Ra=C.ROWSPERSTRIP.values,La=C.IMAGEWIDTH.values[0],Sa=C.IMAGELENGTH.values[0],Ma=La*Sa,Fa=C.BITSPERSAMPLE.values[0],Da=C.SAMPLESPERPIXEL.values[0],Ta=C.SAMPLEFORMAT?C.SAMPLEFORMAT.values[0]:1,Ya=l(Ta,Fa);if(1!==(C.PLANARCONFIGURATION?C.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";
var Ga=C.COMPRESSION?C.COMPRESSION.values[0]:1;if(1!==Ga&&6!==Ga&&8!==Ga&&32946!==Ga)throw console.log("compressed tiff is not supported at this moment"),"compressed tiff is not supported at this moment";if(3<Ta)fa=void 0;else{if(3===Ta){var Ha=new Float32Array(Ma*Da);var Na=Float32Array}else 1===Ta?8>=Fa?(Ha=new Uint8Array(Ma*Da),Na=Uint8Array):16>=Fa?(Ha=new Uint16Array(Ma*Da),Na=Uint16Array):32>=Fa&&(Ha=new Uint32Array(Ma*Da),Na=Uint32Array):2===Ta&&(8>=Fa?(Ha=new Int8Array(Ma*Da),Na=Int8Array):
16>=Fa?(Ha=new Int16Array(Ma*Da),Na=Int16Array):32>=Fa&&(Ha=new Int32Array(La*Sa*Da),Na=Int32Array));var xa,Ua,Ca,Va=Ra;if(0===Fa%8)for(xa=0;xa<Ja.length;xa++){var lb=xa*Ra*La*Da;Va=(xa+1)*Ra>Sa?Sa-xa*Ra:Ra;if("U8"===Ya||"S8"===Ya||kb)if(8===Ga||32946===Ga){var ya=new Uint8Array(b,Ja[xa],Ka[xa]);var cb=new k(ya);var eb=cb.getBytes();var Ia=new ArrayBuffer(eb.length);ya=new Uint8Array(Ia);ya.set(eb);ya.length!==Va*La*Da*Fa/8&&console.log("strip byte counts is different than expected")}else if(6===
Ga){ya=new Uint8Array(b,Ja[xa],Ka[xa]);var Za=new H;Za.parse(ya);var fb=Za.getData(Za.width,Za.height);Ia=new ArrayBuffer(fb.length);ya=new Uint8Array(Ia);ya.set(fb)}else 1===Ga&&(Ka[xa]!==Va*La*Da*Fa/8&&console.log("strip byte counts is different than expected"),Ia=b.slice(Ja[xa],Ja[xa]+Ka[xa]));else{if(6===Ga||8===Ga||32946===Ga){ya=new Uint8Array(b,Ja[xa],Ka[xa]);cb=new k(ya);ya=cb.getBytes();Ia=new ArrayBuffer(ya.length);var Qa=new Uint8Array(Ia);ya.length!==Va*La*Da*Fa/8&&console.log("strip byte counts is different than expected")}else 1===
Ga&&(Ka[xa]!==Va*La*Da*Fa/8&&console.log("strip byte counts is different than expected"),Ia=new ArrayBuffer(Ka[xa]),ya=new Uint8Array(b,Ja[xa],Ka[xa]),Qa=new Uint8Array(Ia));switch(Ya){case "U16":case "S16":for(Ca=0;Ca<ya.length;Ca+=2)Qa[Ca]=ya[Ca+1],Qa[Ca+1]=ya[Ca];break;case "U32":case "S32":case "F32":for(Ca=0;Ca<ya.length;Ca+=4)Qa[Ca]=ya[Ca+3],Qa[Ca+1]=ya[Ca+2],Qa[Ca+2]=ya[Ca+1],Qa[Ca+3]=ya[Ca]}}var mb=new Na(Ia);Ha.set(mb,lb)}var $a={width:La,height:Sa,pixelType:Ya};if(1===Da)$a.pixels=[Ha];
else for($a.pixels=[],xa=0;xa<Da;xa++){var gb=new Na(Ma);for(Ua=0;Ua<Ma;Ua++)gb[Ua]=Ha[Ua*Da+xa];$a.pixels.push(gb)}fa=$a}}}if(null!==P){fa.maskData=new Uint8Array(fa.width*fa.height);if(1E24<Math.abs(P))for(N=0;N<fa.width*fa.height;N++)fa.maskData[N]=1E-6>Math.abs((fa.pixels[0][N]-P)/P)?0:1;else for(N=0;N<fa.width*fa.height;N++)fa.maskData[N]=fa.pixels[0][N]===P?0:1;fa.noDataValue=P}return fa}}})},"esri/layers/rasterLib/tile/RasterHandler":function(){define("require exports module dojo/Deferred dojo/promise/all ../../PixelBlock ../../vectorTiles/core/workers ../../vectorTiles/core/promiseUtils ../../vectorTiles/core/requireUtils ../../vectorTiles/request ../../rasterLib/function/rasterFunctionHelper ../../rasterLib/renderer/rasterRendererHelper".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h){function c(g){var n=new r;m(g).then(function(q){n.resolve()});return n.promise}return function(){function g(n){this.customModules=n&&n.customModules}g.prototype.destroy=function(){this.stop();this.customModules=this.rasterLayer=null};g.prototype.start=function(){this.stop();var n=new r,q=0,v=this.customModules?this.customModules.length+1:1,u=d.getAbsMid("esri/layers/rasterLib/tile/RasterWorker",H,p),t=b.open(u,{client:this}).then(function(y){this._connection=y;q++;
q===v&&(this._connected=!0,n.resolve())}.bind(this));this._openDL=[t];this.customModules&&this.customModules.forEach(function(y){t=b.open(y,{client:this}).then(function(D){q++;q===v&&(this._connected=!0,n.resolve())});this._openDL.push(t);console.log(y)}.bind(this));return this._connectionPromise=n.promise};g.prototype.stop=function(){this._openDL?this._openDL.forEach(function(n){n.isFulfilled()||n.cancel()}.bind(this)):this._connectionPromise&&!this._connectionPromise.isFulfilled()&&this._connectionPromise.cancel();
this._connection&&(this._connection.close(),this._connection=null)};g.prototype.decode=function(n){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var q={id:null};return this._connection.invoke("decode",n,[],q).then(function(v){v.targetWorker=q;return v})};g.prototype.process=function(n){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var q={id:null};n.layerId=this.rasterLayer.layerId;var v=new r;
this._connection.invoke("process",n,[],q).then(function(u){u.targetWorker=q;u.src?Object.keys(u.src).forEach(function(t){u.src[t].pixelBlock=new l(u.src[t].pixelBlock)}):u.src=null;u.pixelBlock&&(u.pixelBlock=new l(u.pixelBlock));v.resolve(u)});return v.promise};g.prototype.render=function(n){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var q={id:null};n.layerId=this.rasterLayer.layerId;return this._connection.invoke("render",n,[],q).then(function(v){v.targetWorker=
q;v.pixelBlock=v.pixelBlock?new l(v.pixelBlock):null;return v})};g.prototype.setLayer=function(n){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));this.rasterLayer=n;n=this._connection.broadcast("setLayer",n,[],{id:null});return c(n)};g.prototype.setRasterFunction=function(n){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));n=this._connection.broadcast("setRasterFunction",n,[],{id:null});return c(n)};
g.prototype.setRasterRenderer=function(n){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));n=this._connection.broadcast("setRasterRenderer",n,[],{id:null});return c(n)};return g}()})},"esri/layers/vectorTiles/core/workers":function(){define(["require","exports","./workers/workers"],function(H,k,p){Object.defineProperty(k,"__esModule",{value:!0});for(var r in p)k.hasOwnProperty(r)||(k[r]=p[r])})},"esri/layers/vectorTiles/core/workers/workers":function(){define("require exports dojo/sniff dojo/promise/all ../Logger ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),
function(H,k,p,r,m,l,b,a,d){function f(){if(q)return q;for(var v=e+h,u=[],t=function(D){var B=d.create(D).then(function(E){return n[D]=E});u.push(B)},y=0;y<v;y++)t(y);return q=r(u).then(function(){})}Object.defineProperty(k,"__esModule",{value:!0});k.Connection=b;k.RemoteClient=a;(b=navigator.hardwareConcurrency)||(b=p("safari")&&p("mac")||p("trident")?8:2);var e=p("esri-workers-debug")?1:Math.max(1,Math.ceil(b/2)),h=p("esri-workers-debug")?1:Math.max(1,Math.floor(b/2)),c=m.getLogger("esri.core.workers"),
g=0,n=[];k.initialize=function(){f()};k.open=function(v,u,t){void 0===u&&(u={});if(Array.isArray(v))return new k.Connection(v.map(function(B){return new k.RemoteClient(B,u.client)}));if("string"!==typeof v){c.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var y=v;v=u;u={client:y,strategy:t?"dedicated":"distributed"}}var D=u.strategy||"distributed";return"local"===D?l.create(function(B){H([v],function(E){B(k.RemoteClient.connect(E))})}).then(function(B){return new k.Connection([new k.RemoteClient(B,
u.client)])}):f().then(function(){if("dedicated"===D){var B=e+g++;g%=h;return n[B].open(v).then(function(E){return new k.Connection([new k.RemoteClient(E,u.client)])})}return l.all(n.map(function(E){return E.open(v)})).then(function(E){return new k.Connection(E.map(function(x){return new k.RemoteClient(x,u.client)}))})})};k.terminate=function(){for(var v=0;v<n.length;v++)n[v]&&n[v].terminate();n.length=0};var q})},"esri/layers/vectorTiles/core/Logger":function(){define(["require","exports","dojo/has"],
function(H,k,p){var r={info:0,warn:1,error:2};H=function(){function m(l){void 0===l&&(l={});this.module=l.module||"";this.writer=l.writer||null;this.level=l.level||null;null!=l.enabled&&(this.enabled=!!l.enabled);m._loggers[this.module]=this;l=this.module.lastIndexOf(".");-1!==l&&(this.parent=m.getLogger(this.module.slice(0,l)))}m.prototype.log=function(l){for(var b=[],a=1;a<arguments.length;a++)b[a-1]=arguments[a];this._isEnabled()&&this._matchLevel(l)&&(a=this._inheritedWriter())&&a.apply(void 0,
[l,this.module].concat(b))};m.prototype.error=function(){for(var l=[],b=0;b<arguments.length;b++)l[b]=arguments[b];this.log.apply(this,["error"].concat(l))};m.prototype.warn=function(){for(var l=[],b=0;b<arguments.length;b++)l[b]=arguments[b];this.log.apply(this,["warn"].concat(l))};m.prototype.info=function(){for(var l=[],b=0;b<arguments.length;b++)l[b]=arguments[b];this.log.apply(this,["info"].concat(l))};m.prototype.getLogger=function(l){return m.getLogger(this.module+"."+l)};m.getLogger=function(l){var b=
m._loggers[l];b||(b=new m({module:l}));return b};m.prototype._parentWithMember=function(l,b){for(var a=this;a&&null==a[l];)a=a.parent;return a?a[l]:b};m.prototype._inheritedWriter=function(){return this._parentWithMember("writer",this._consoleWriter)};m.prototype._consoleWriter=function(l,b){for(var a=[],d=2;d<arguments.length;d++)a[d-2]=arguments[d];console[l].apply(console,["["+b+"]"].concat(a))};m.prototype._matchLevel=function(l){return r[this._parentWithMember("level","error")]<=r[l]};m.prototype._isEnabled=
function(){return this._parentWithMember("enabled",!0)};m._loggers={};return m}();k=H.getLogger("esri");p("dojo-debug-messages")?k.level="info":k.level="warn";return H})},"esri/layers/vectorTiles/core/promiseUtils":function(){define("require exports dojo/Deferred dojo/when dojo/promise/all ./Error".split(" "),function(H,k,p,r,m,l){function b(a){if(a){if("function"!==typeof a.forEach){var d=Object.keys(a),f=d.map(function(g){return a[g]});return b(f).then(function(g){var n={};d.forEach(function(q,
v){return n[q]=g[v]});return n})}var e=new p,h=[],c=a.length;0===c&&e.resolve(h);a.forEach(function(g){var n={promise:g};h.push(n);g.then(function(q){n.value=q}).catch(function(q){n.error=q}).then(function(){--c;0===c&&e.resolve(h)})});return e.promise}}Object.defineProperty(k,"__esModule",{value:!0});k.all=function(a){return m(a)};k.filter=function(a,d){var f=a.slice();return m(a.map(function(e,h){return d(e,h)})).then(function(e){return f.filter(function(h,c){return e[c]})})};k.eachAlways=b;k.create=
function(a,d){var f=new p(d);a(function(e){void 0===e&&(e=null);return r(e).then(f.resolve)},f.reject);return f.promise};k.reject=function(a){var d=new p;d.reject(a);return d.promise};k.resolve=function(a){void 0===a&&(a=null);var d=new p;d.resolve(a);return d.promise};k.after=function(a,d){void 0===d&&(d=null);var f=0,e=new p(function(){f&&(clearTimeout(f),f=0)});f=setTimeout(function(){e.resolve(d)},a);return e.promise};k.timeout=function(a,d,f){var e=0,h=new p(a.cancel);a.then(function(c){h.isFulfilled()||
(h.resolve(c),e&&(clearTimeout(e),e=0))});a.catch(function(c){h.isFulfilled()||(h.reject(c),e&&(clearTimeout(e),e=0))});e=setTimeout(function(){var c=f||new l("promiseUtils:timeout","The wrapped promise did not resolve within "+d+" ms");h.reject(c)},d);return h.promise};k.wrapCallback=function(a){var d=!1,f=new p(function(){return d=!0});a(function(e){d||f.resolve(e)});return f.promise};k.isThenable=function(a){return a&&"function"===typeof a.then};k.when=function(a){return r(a)}})},"esri/layers/vectorTiles/core/Error":function(){define(["require",
"exports","./tsSupport/extendsHelper","./lang","./Message"],function(H,k,p,r,m){H=function(l){function b(a,d,f){var e=l.call(this,a,d,f)||this;return e instanceof b?e:new b(a,d,f)}p(b,l);b.prototype.toJSON=function(){return{name:this.name,message:this.message,details:r.clone(this.details),dojoType:this.dojoType}};b.fromJSON=function(a){var d=new b(a.name,a.message,a.details);null!=a.dojoType&&(d.dojoType=a.dojoType);return d};return b}(m);H.prototype.type="error";return H})},"esri/layers/vectorTiles/core/tsSupport/extendsHelper":function(){define([],
function(){return function(){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,p){k.__proto__=p}||function(k,p){for(var r in p)p.hasOwnProperty(r)&&(k[r]=p[r])};return function(k,p){function r(){this.constructor=k}H(k,p);k.prototype=null===p?Object.create(p):(r.prototype=p.prototype,new r)}}()})},"esri/layers/vectorTiles/core/lang":function(){define("dojo/_base/kernel dojo/_base/lang dojo/date dojo/number dojo/date/locale dojo/i18n!../nls/common".split(" "),function(H,k,p,r,
m,l){function b(g){return void 0!==g&&null!==g}function a(g){return b(g)?g:""}function d(g,n,q){var v=q.match(/([^\(]+)(\([^\)]+\))?/i),u=k.trim(v[1]);q=n[g];v=JSON.parse((v[2]?k.trim(v[2]):"{}").replace(/^\(/,"{").replace(/\)$/,"}").replace(/([{,])\s*([0-9a-zA-Z_]+)\s*:/gi,'$1"$2":').replace(/"\s*:\s*'/gi,'":"').replace(/'\s*(,|\})/gi,'"$1'));var t=v.utcOffset;if(-1===h.indexOf(u))u=k.getObject(u),k.isFunction(u)&&(q=u(q,g,n,v));else if("number"===typeof q||"string"===typeof q&&q&&!isNaN(Number(q)))switch(q=
Number(q),u){case "NumberFormat":g=k.mixin({},v);n=parseFloat(g.places);if(isNaN(n)||0>n)g.places=Infinity;return r.format(q,g);case "DateString":q=new Date(q);if(v.local||v.systemLocale)return v.systemLocale?q.toLocaleDateString()+(v.hideTime?"":" "+q.toLocaleTimeString()):q.toDateString()+(v.hideTime?"":" "+q.toTimeString());q=q.toUTCString();v.hideTime&&(q=q.replace(/\s+\d\d:\d\d:\d\d\s+(utc|gmt)/i,""));return q;case "DateFormat":return q=new Date(q),b(t)&&(q=p.add(q,"minute",q.getTimezoneOffset()-
t)),m.format(q,v)}return a(q)}function f(g,n){var q;if(n)for(q in g)g.hasOwnProperty(q)&&(void 0===g[q]?delete g[q]:g[q]instanceof Object&&f(g[q],!0));else for(q in g)g.hasOwnProperty(q)&&void 0===g[q]&&delete g[q];return g}function e(g){if(!g||"object"!=typeof g||k.isFunction(g))return g;if(g instanceof Int8Array||g instanceof Uint8Array||g instanceof Uint8ClampedArray||g instanceof Int16Array||g instanceof Int32Array||g instanceof Uint16Array||g instanceof Uint32Array||g instanceof Float32Array||
g instanceof Float64Array||g instanceof Date)return new g.constructor(g);if(g instanceof ArrayBuffer)return g.slice(0,g.byteLength);if("function"===typeof g.clone)g=g.clone();else if("function"===typeof g.map&&"function"===typeof g.forEach)g=g.map(e);else if("function"===typeof g.notifyChange&&"function"===typeof g.watch)g=g.clone();else{var n={},q,v={};for(q in g){var u=g[q];var t=!(q in v)||v[q]!==u;if(!(q in n)||n[q]!==u&&t)n[q]=e?e(u):u}g=n}return g}var h=["NumberFormat","DateString","DateFormat"],
c=/<\/?[^>]+>/g;return{equals:function(g,n){return g===n||"number"===typeof g&&isNaN(g)&&"number"===typeof n&&isNaN(n)||k.isFunction((g||{}).getTime)&&k.isFunction((n||{}).getTime)&&g.getTime()==n.getTime()||k.isFunction((g||{}).equals)&&g.equals(n)||k.isFunction((n||{}).equals)&&n.equals(g)||!1},mixin:k.mixin,valueOf:function(g,n){for(var q in g)if(g[q]==n)return q;return null},stripTags:function(g){if(g){var n=typeof g;if("string"===n)g=g.replace(c,"");else if("object"===n)for(var q in g)(n=g[q])&&
"string"===typeof n&&(n=n.replace(c,"")),g[q]=n}return g},substitute:function(g,n,q){if(b(q))if(k.isObject(q)){var v=q.first;var u=q.dateFormat;var t=q.numberFormat}else v=q;if(n&&"{*}"!==n)return k.replace(n,k.hitch({obj:g},function(D,B){D=B.split(":");return 1<D.length?(B=D[0],D.shift(),d(B,this.obj,D.join(":"))):u&&-1!==(u.properties||[]).indexOf(B)?d(B,this.obj,u.formatter||"DateString"):t&&-1!==(t.properties||[]).indexOf(B)?d(B,this.obj,t.formatter||"NumberFormat"):a(this.obj[B])}));n=[];var y;
n.push('\x3ctable class\x3d"esri-widget__table" summary\x3d"'+l.fieldsSummary+'"\x3e\x3ctbody\x3e');for(y in g)if(q=g[y],u&&-1!==(u.properties||[]).indexOf(y)?q=d(y,g,u.formatter||"DateString"):t&&-1!==(t.properties||[]).indexOf(y)&&(q=d(y,g,t.formatter||"NumberFormat")),n.push("\x3ctr\x3e\x3cth\x3e"+y+"\x3c/th\x3e\x3ctd\x3e"+a(q)+"\x3c/td\x3e\x3c/tr\x3e"),v)break;n.push("\x3c/tbody\x3e\x3c/table\x3e");return n.join("")},filter:function(g,n,q){n=[k.isString(g)?g.split(""):g,q||H.global,k.isString(n)?
new Function("item","index","array",n):n];q={};var v;g=n[0];for(v in g)n[2].call(n[v],g[v],v,g)&&(q[v]=g[v]);return q},startsWith:function(g,n,q){q=q||0;return g.indexOf(n,q)===q},endsWith:function(g,n,q){if("number"!==typeof q||!isFinite(q)||Math.floor(q)!==q||q>g.length)q=g.length;q-=n.length;g=g.indexOf(n,q);return-1!==g&&g===q},isDefined:b,fixJson:f,clone:e}})},"esri/layers/vectorTiles/core/Message":function(){define(["require","exports","dojo/string"],function(H,k,p){return function(){function r(m,
l,b){this instanceof r&&(this.name=m,this.message=l&&p.substitute(l,b,function(a){return null==a?"":a})||"",this.details=b)}r.prototype.toString=function(){return"["+this.name+"]: "+this.message};return r}()})},"esri/layers/vectorTiles/core/workers/Connection":function(){define(["require","exports","../promiseUtils"],function(H,k,p){return function(){function r(m){this._clientIdx=0;this._clients=m}r.prototype.broadcast=function(m,l,b){for(var a=[],d=0,f=this._clients;d<f.length;d++)a.push(f[d].invoke(m,
l,b));return a};r.prototype.close=function(){for(var m=0,l=this._clients;m<l.length;m++)l[m].close();this._clients=[]};r.prototype.invoke=function(m,l,b,a){var d=a&&a.client;if(!this._clients||!this._clients.length)return p.reject(Error("Connection closed"));null!=d&&-1!==this._clients.indexOf(d)||this._clients.some(function(f){return f.isBusy()?!1:(d=f,!0)})||(this._clientIdx=(this._clientIdx+1)%this._clients.length,d=this._clients[this._clientIdx]);m=d.invoke(m,l,b);a&&(a.client=d);return m};r.prototype.openPorts=
function(){return p.all(this._clients.map(function(m){return m.openPort()}))};return r}()})},"esri/layers/vectorTiles/core/workers/RemoteClient":function(){define("require exports dojo/Deferred ../Error ../promiseUtils ./utils".split(" "),function(H,k,p,r,m,l){function b(g,n){g["delete"](n)}var a=l.MessageType.CLOSE,d=l.MessageType.CANCEL,f=l.MessageType.INVOKE,e=l.MessageType.RESPONSE,h=l.MessageType.OPEN_PORT,c=function(){function g(n){this._timer=null;this._cancelledJobIds=new Set;this._invokeMessages=
[];this._invoke=n;this._timer=null;this._process=this._process.bind(this)}g.prototype.push=function(n){n.type===l.MessageType.CANCEL?this._cancelledJobIds.add(n.jobId):(this._invokeMessages.push(n),null===this._timer&&(this._timer=setTimeout(this._process,0)))};g.prototype.clear=function(){this._invokeMessages.length=0;this._cancelledJobIds.clear();this._timer=null};g.prototype._process=function(){this._timer=null;for(var n=0,q=this._invokeMessages;n<q.length;n++){var v=q[n];this._cancelledJobIds.has(v.jobId)||
this._invoke(v)}this._cancelledJobIds.clear();this._invokeMessages.length=0};return g}();return function(){function g(n,q,v){this._outJobs=new Map;this._inJobs=new Map;this._queue=new c(this._onInvoke.bind(this));this._onMessage=this._onMessage.bind(this);this._client=q;this._port=n;this._port.addEventListener("message",this._onMessage);this._port.start();this._channel=v}g.connect=function(n){var q=new MessageChannel;n="function"===typeof n?new n:"default"in n&&"function"===typeof n.default?new n.default:
n;n.remoteClient=new g(q.port1,n,q);return q.port2};g.prototype.close=function(){this._post({type:a});this._close()};g.prototype.isBusy=function(){return 0<this._outJobs.size};g.prototype.invoke=function(n,q,v){var u=this;if(!this._port)return m.reject(new r("remote-client:port-closed","Can't invoke(), port is closed"));var t=l.newJobId(),y=new p(function(){b(u._outJobs,t);u._post({type:d,jobId:t})});this._outJobs.set(t,y);this._post({type:f,jobId:t,methodName:n},q,v);return y.promise};g.prototype.openPort=
function(){var n=this,q=l.newJobId(),v=new p(function(){b(n._outJobs,q);n._post({type:d,jobId:q})});this._outJobs.set(q,v);this._post({type:h,jobId:q});return v.promise};g.prototype._close=function(){this._channel&&(this._channel=null);this._port.removeEventListener("message",this._onMessage);this._port.close();this._outJobs.forEach(function(n){n.cancel()});this._inJobs.clear();this._outJobs.clear();this._queue.clear();this._port=this._client=null};g.prototype._onMessage=function(n){if(n=l.receiveMessage(n))switch(n.type){case e:this._onResponse(n);
break;case f:this._queue.push(n);break;case d:this._onCancel(n);break;case a:this._close();break;case h:this._onOpenPort(n)}};g.prototype._onCancel=function(n){var q=this._inJobs,v=n.jobId,u=q.get(v);this._queue.push(n);u&&(b(q,v),u.cancel())};g.prototype._onInvoke=function(n){var q=this,v=n.methodName,u=n.jobId;n=n.data;var t=this._inJobs,y=this._client,D=y[v];try{if(!D&&v&&-1!==v.indexOf("."))for(var B=v.split("."),E=0;E<B.length-1;E++)y=y[B[E]],D=y[B[E+1]];if("function"!==typeof D)throw new TypeError(v+
" is not a function");var x=D.call(y,n,this)}catch(w){this._post({type:e,jobId:u,error:l.toInvokeError(w)});return}m.isThenable(x)?(t.set(u,x),x.then(function(w){t.has(u)&&(b(t,u),q._post({type:e,jobId:u},w))}).catch(function(w){t.has(u)&&(b(t,u),w&&"cancel"===w.dojoType||q._post({type:e,jobId:u,error:l.toInvokeError(w||{message:"Error encountered at method "+v})}))})):this._post({type:e,jobId:u},x)};g.prototype._onOpenPort=function(n){var q=new MessageChannel;new g(q.port1,this._client);this._post({type:e,
jobId:n.jobId},q.port2,[q.port2])};g.prototype._onResponse=function(n){var q=n.jobId,v=n.error;n=n.data;var u=this._outJobs;if(u.has(q)){var t=u.get(q);b(u,q);v?t.reject(r.fromJSON(JSON.parse(v))):t.resolve(n)}};g.prototype._post=function(n,q,v){return l.postMessage(this._port,n,q,v)};return g}()})},"esri/layers/vectorTiles/core/workers/utils":function(){define(["require","exports","dojo/has"],function(H,k,p){function r(l){return l&&"object"===typeof l&&("result"in l||"transferList"in l)}Object.defineProperty(k,
"__esModule",{value:!0});(function(l){l[l.HANDSHAKE=0]="HANDSHAKE";l[l.CONFIGURE=1]="CONFIGURE";l[l.CONFIGURED=2]="CONFIGURED";l[l.OPEN=3]="OPEN";l[l.OPENED=4]="OPENED";l[l.RESPONSE=5]="RESPONSE";l[l.INVOKE=6]="INVOKE";l[l.CANCEL=7]="CANCEL";l[l.CLOSE=8]="CLOSE";l[l.OPEN_PORT=9]="OPEN_PORT"})(k.MessageType||(k.MessageType={}));var m=0;k.newJobId=function(){return m++};k.isTranferableResult=r;k.toInvokeError=function(l){return l?l.toJSON?JSON.stringify(l):JSON.stringify({name:l.name,message:l.message,
details:l.details,stack:l.stack}):null};k.postMessage=function(l,b,a,d){2===arguments.length||void 0===a&&void 0===d?l.postMessage(b):(p("esri-workers-supports-transfer-arraybuffer")||(d?(d=d.filter(function(f){return!(f instanceof ArrayBuffer)}),d.length||(d=null)):r(a)&&a.transferList&&(a.transferList=a.transferList.filter(function(f){return!(f instanceof ArrayBuffer)}),a.transferList.length||(a.transferList=null))),d?(b.data=a,l.postMessage(b,d)):r(a)?(b.data=a.result,a.transferList?l.postMessage(b,
a.transferList):l.postMessage(b)):(b.data=a,l.postMessage(b)))};k.receiveMessage=function(l){return l?(l=l.data)?"string"===typeof l?JSON.parse(l):l:null:null}})},"esri/layers/vectorTiles/core/workers/WorkerOwner":function(){define("require exports dojo/Deferred ../../kernel ../Error ../Logger ../promiseUtils ./utils ./workerFactory".split(" "),function(H,k,p,r,m,l,b,a,d){var f=l.getLogger("esri.core.workers"),e=a.MessageType.CANCEL,h=a.MessageType.INVOKE,c=a.MessageType.OPEN,g=a.MessageType.OPENED,
n=a.MessageType.RESPONSE;return function(){function q(v,u){this._outJobs=new Map;this._inJobs=new Map;this.worker=v;this.id=u;v.addEventListener("message",this._onMessage.bind(this));v.addEventListener("error",function(t){t.preventDefault();f.error(t)})}q.create=function(v){return d.createWorker().then(function(u){return new q(u,v)})};q.prototype.terminate=function(){this.worker.terminate()};q.prototype.open=function(v){var u=this,t=a.newJobId(),y=new p(function(D){u._outJobs["delete"](t);u._post({type:e,
jobId:t})});this._outJobs.set(t,y);this._post({type:c,jobId:t,modulePath:v});return y.promise};q.prototype._onMessage=function(v){if(v=a.receiveMessage(v))switch(v.type){case g:case n:this._onResponse(v);break;case e:this._onCancel(v);break;case h:this._onInvoke(v)}};q.prototype._onCancel=function(v){(v=this._inJobs.get(v.jobId))&&v.cancel()};q.prototype._onInvoke=function(v){var u=this,t=v.methodName,y=v.jobId;v=v.data;var D=this._inJobs,B=r.workerMessages[t];try{if("function"!==typeof B)throw new TypeError(t+
" is not a function");var E=B.call(null,v)}catch(x){this._post({type:n,jobId:y,error:a.toInvokeError(x)});return}b.isThenable(E)?(D.set(y,E),E.then(function(x){D["delete"](y);u._post({type:n,jobId:y},x)}).catch(function(x){D["delete"](y);x||(x={message:"Error encountered at method"+t});x.dojoType&&"cancel"===x.dojoType||u._post({type:n,jobId:y,error:a.toInvokeError(x)})})):this._post({type:n,jobId:y},E)};q.prototype._onResponse=function(v){var u=v.jobId,t=v.error;v=v.data;var y=this._outJobs.get(u);
y&&(this._outJobs["delete"](u),t?y.reject(m.fromJSON(JSON.parse(t))):y.resolve(v))};q.prototype._post=function(v,u,t){return a.postMessage(this.worker,v,u,t)};return q}()})},"esri/layers/vectorTiles/core/workers/workerFactory":function(){define("require exports ../tsSupport/assignHelper dojo/_base/kernel ../../config ../../request ../Logger ../promiseUtils ../sniff ../urlUtils ./loaderConfig ./utils ./WorkerFallback".split(" "),function(H,k,p,r,m,l,b,a,d,f,e,h,c){function g(B){return a.create(function(E){function x(A){if(A=
h.receiveMessage(A))switch(A.type){case D:A=B;var z=m.workers.loaderUrl||e.DEFAULT_LOADER_URL;if(null!=m["default"]){var G=p({},m);delete G["default"];G=JSON.parse(JSON.stringify(G))}else G=JSON.parse(JSON.stringify(m));var I=m.workers.loaderConfig;I=e.default({baseUrl:I.baseUrl,locale:r.locale,has:p({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-cors":1,"esri-secure-context":d("esri-secure-context"),"esri-workers-supports-transfer-arraybuffer":d("esri-workers-supports-transfer-arraybuffer"),
"events-keypress-typed":0,"host-webworker":1},I.has),map:p({},I.map),paths:p({},I.paths),packages:I.packages||[]});A.postMessage({type:y,configure:{esriConfig:G,loaderUrl:z,loaderConfig:I}});break;case t:B.removeEventListener("message",x),B.removeEventListener("error",w),E(B)}}function w(A){A.preventDefault();B.removeEventListener("message",x);B.removeEventListener("error",w);v.warn("Failed to create Worker. Fallback to execute module in main thread",A);B=new c;B.addEventListener("message",x);B.addEventListener("error",
w)}B.addEventListener("message",x);B.addEventListener("error",w)})}Object.defineProperty(k,"__esModule",{value:!0});var n=f.normalize(H.toUrl("./worker.js")),q=!f.hasSameOrigin(n,location.href),v=b.getLogger("esri.core.workers"),u=null,t=h.MessageType.CONFIGURED,y=h.MessageType.CONFIGURE,D=h.MessageType.HANDSHAKE;k.createWorker=function(){if(!d("esri-workers"))return g(new c);if(!q){var B=void 0;try{B=new Worker(n)}catch(E){v.warn("Failed to create Worker. Fallback to execute module in main thread",
event),B=new c}return g(B)}u||(u=l(n,{responseType:"text"}));return u.then(function(E){return new Worker(URL.createObjectURL(new Blob([E.data],{type:"text/javascript"})))}).catch(function(E){v.warn("Failed to create Worker. Fallback to execute module in main thread",E);return new c}).then(function(E){return g(E)})}})},"esri/layers/vectorTiles/core/tsSupport/assignHelper":function(){define([],function(){return Object.assign||function(H){for(var k,p=1,r=arguments.length;p<r;p++){k=arguments[p];for(var m in k)Object.prototype.hasOwnProperty.call(k,
m)&&(H[m]=k[m])}return H}})},"esri/layers/vectorTiles/config":function(){define(["require","exports","esri/config"],function(H,k,p){Object.defineProperty(p,"workers",{get:function(){return p.defaults.workers},set:function(r){return p.defaults.workers=r}});return p})},"esri/layers/vectorTiles/request":function(){define(["require","exports","esri/request","dojo/_base/lang","dojo/Deferred"],function(H,k,p,r,m){return function(l,b){l=r.mixin({},{url:l,failOk:!0},b);"array-buffer"===b.responseType?(l.handleAs=
"arraybuffer",delete l.responseType):b.responseType&&(l.handleAs=b.responseType,delete l.responseType);null!==b.query&&(l.content=l.query,delete l.query);if(b.hasOwnProperty("allowImageDataAccess")){var a={allowImageDataAccess:b.allowImageDataAccess};delete l.allowImageDataAccess}var d=new m(function(){f.isFulfilled()||f.cancel()});var f=p(l,a).then(function(e){d.resolve({data:e})}).catch(function(e){e&&null!=e.httpCode&&(e.details=e.details||{},e.details.httpStatus=e.httpCode);d.reject(e)});return d.promise}})},
"esri/layers/vectorTiles/core/sniff":function(){define(["require","exports","dojo/sniff","./global","../views/webgl/context-util"],function(H,k,p,r,m){function l(){var f={available:!1,version:0,majorPerformanceCaveat:!1,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1},e=document.createElement("canvas");if(!e)return f;var h=m.createContext(e,{failIfMajorPerformanceCaveat:!0},"webgl");!h&&(h=m.createContext(e,{},"webgl"))&&
(f.majorPerformanceCaveat=!0);if(!h)return f;e=h.getParameter(h.VERSION);if(!e)return f;if(e=e.match(/^WebGL\s+([\d.]*)/))f.version=parseFloat(e[1]),f.available=.94<=f.version,e=h.getShaderPrecisionFormat(h.FRAGMENT_SHADER,h.HIGH_FLOAT),f.supportsHighPrecisionFragment=e&&0<e.precision,f.supportsVertexShaderSamplers=0<h.getParameter(h.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f.supportsElementIndexUint=null!==h.getExtension("OES_element_index_uint"),f.supportsStandardDerivatives=null!==h.getExtension("OES_standard_derivatives");
return f}function b(){var f={available:!1,version:0},e=document.createElement("canvas");if(!e)return f;e=m.createContext(e,{},"webgl2");if(!e)return f;f.available=!0;e=e.getParameter(e.VERSION);if(!e)return f;if(e=e.match(/^WebGL\s+([\d.]*)/))f.version=parseFloat(e[1]);return f}(function(){var f=navigator.userAgent,e=f.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i);f=f.match(/iPhone/i);e&&p.add("esri-mobile",e);f&&p.add("esri-iPhone",f);p.add("esri-phonegap",!!r.cordova);
p.add("esri-cors",p("esri-phonegap")||"XMLHttpRequest"in r&&"withCredentials"in new XMLHttpRequest);p.add("esri-geolocation",function(){return!!navigator.geolocation});p.add("esri-canvas-svg-support",function(){return!(p("trident")||p("ie"))});p.add("esri-secure-context",function(){if("isSecureContext"in r)return r.isSecureContext;if(r.location&&r.location.origin)return 0===r.location.origin.indexOf("https:")});p.add("esri-wasm","WebAssembly"in r);p("host-webworker")||(p.add("esri-workers","Worker"in
r),p.add("esri-script-sandbox",function(){return"MessageChannel"in r&&"HTMLIFrameElement"in r&&"sandbox"in HTMLIFrameElement.prototype}),p.add("esri-url-encodes-apostrophe",function(){var h=r.document.createElement("a");h.href="?'";return-1<h.href.indexOf("?%27")}),a||(a=l()),p.add("esri-webgl",a.available),p.add("esri-webgl-high-precision-fragment",a.supportsHighPrecisionFragment),p.add("esri-webgl-vertex-shader-samplers",a.supportsVertexShaderSamplers),p.add("esri-webgl-element-index-uint",a.supportsElementIndexUint),
p.add("esri-webgl-standard-derivatives",a.supportsStandardDerivatives),p.add("esri-webgl-major-performance-caveat",a.majorPerformanceCaveat),p.add("esri-featurelayer-webgl-labeling",!0),d||(d=b()),p.add("esri-webgl2",d.available))})();var a=null,d=null;return p})},"esri/layers/vectorTiles/core/global":function(){define(["require","exports"],function(H,k){return function(){if("undefined"!==typeof global)return global;if("undefined"!==typeof window)return window;if("undefined"!==typeof self)return self}()})},
"esri/layers/vectorTiles/views/webgl/context-util":function(){define(["require","exports"],function(H,k){function p(b,a,d){void 0===a&&(a={});switch(d){case "webgl":var f=["webgl","experimental-webgl","webkit-3d","moz-webgl"];break;case "webgl2":f=["webgl2"];break;default:f=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}d=null;for(var e=0;e<f.length;e++){var h=f[e];try{d=b.getContext(h,a)}catch(c){}if(d)break}return d}function r(b,a){(b=b.parentNode)&&(b.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
a+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}Object.defineProperty(k,"__esModule",{value:!0});k.createContextOrErrorHTML=function(b,a,d){void 0===a&&(a={});if(!window.WebGLRenderingContext)return r(b,m),null;a=p(b,a,d);return a?a:(r(b,l),null)};k.createContext=p;var m='This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e',l='It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'})},
"esri/layers/vectorTiles/core/urlUtils":function(){define(["require","exports","esri/urlUtils","dojo/_base/url"],function(H,k,p,r){function m(y){return p.normalize(y)}function l(y){return"data:"===y.slice(0,5)}function b(y){return a(y)||u.test(y)}function a(y){return y&&"/"===y[0]&&"/"===y[1]}function d(y){return p.urlToObject(y)}function f(y){if("string"===typeof y)return new r(h(y));y.scheme||(y.scheme=k.appUrl.scheme);return y}function e(y){if(l(y))return null;var D=y.indexOf("://");if(-1===D&&
a(y))D=2;else if(-1!==D)D+=3;else return null;D=y.indexOf("/",D);return-1===D?y:y.slice(0,D)}function h(y,D,B){void 0===D&&(D=k.appBaseUrl);if(a(y))return B&&B.preserveProtocolRelative?y:"http"===k.appUrl.scheme&&k.appUrl.authority===e(y).slice(2)?"http:"+y:"https:"+y;if(u.test(y))return y;"/"===y[0]&&(B=D.indexOf("//"),B=D.indexOf("/",B+2),D=-1===B?D:D.slice(0,B));return g(D,y)}function c(y,D,B){void 0===B&&(B=!1);y=f(y);D=f(D);return B||y.scheme===D.scheme?y.host.toLowerCase()===D.host.toLowerCase()&&
y.port===D.port:!1}function g(){for(var y=[],D=0;D<arguments.length;D++)y[D]=arguments[D];if(y&&y.length){D=[];if(b(y[0])){var B=y[0],E=B.indexOf("//");D.push(B.slice(0,E+1));v.test(y[0])&&(D[0]+="/");y[0]=B.slice(E+2)}else"/"===y[0][0]&&D.push("");y=y.reduce(function(x,w){return w?x.concat(w.split("/")):x},[]);for(B=0;B<y.length;B++)E=y[B],".."===E&&0<D.length?D.pop():!E||"."===E&&0!==D.length||D.push(E);return D.join("/")}}function n(y,D,B){if(!(D&&B&&y&&b(y)))return y;var E=y.indexOf("//"),x=y.indexOf("/",
E+2),w=y.indexOf(":",E+2);x=Math.min(0>x?y.length:x,0>w?y.length:w);if(y.slice(E+2,x).toLowerCase()!==D.toLowerCase())return y;D=y.slice(0,E+2);y=y.slice(x);return""+D+B+y}function q(y,D,B){void 0===D&&(D=k.appBaseUrl);if(!b(y))return y;var E=m(y),x=E.toLowerCase();D=m(D).toLowerCase().replace(/\/+$/,"");if((B=B?m(B).toLowerCase().replace(/\/+$/,""):null)&&0!==D.indexOf(B))return y;for(var w=function(G,I,K){K=G.indexOf(I,K);return-1===K?G.length:K},A=w(x,"/",x.indexOf("//")+2),z=-1;x.slice(0,A+1)===
D.slice(0,A)+"/";){z=A+1;if(A===x.length)break;A=w(x,"/",A+1)}if(-1===z||B&&z<B.length)return y;y=E.slice(z);E=D.slice(z-1).replace(/[^/]+/g,"").length;if(0<E)for(x=0;x<E;x++)y="../"+y;else y="./"+y;return y}Object.defineProperty(k,"__esModule",{value:!0});k.normalize=m;k.canUseXhr=function(y){return p.canUseXhr(y)};k.removeTrailingSlash=function(y){return y.replace(/\/+$/,"")};H=Function("return this")();k.appUrl=new r(H.location);k.appBaseUrl=function(){var y=k.appUrl.path;y=y.substring(0,y.lastIndexOf(y.split("/")[y.split("/").length-
1]));return k.appUrl.scheme+"://"+k.appUrl.host+(null!=k.appUrl.port?":"+k.appUrl.port:"")+y}();var v=/^\s*file:/i,u=/^\s*[a-z][a-z0-9-+.]*:[^0-9]/i;k.isDataProtocol=l;k.isAbsolute=b;k.isProtocolRelative=a;k.urlToObject=d;k.getOrigin=e;k.makeAbsolute=h;k.hasSameOrigin=c;k.join=g;k.removeFile=function(y){var D=0;if(b(y)){var B=y.indexOf("//");-1!==B&&(D=B+2)}B=y.lastIndexOf("/");return B<D?y:y.slice(0,B+1)};k.addProxy=function(y){return p.addProxy(y)};k.makeData=function(y){return y.isBase64?"data:"+
y.mediaType+";base64,"+y.data:"data:"+y.mediaType+","+y.data};var t=/^data:(.*?)(;base64)?,(.*)$/;k.dataComponents=function(y){return(y=y.match(t))?{mediaType:y[1],isBase64:!!y[2],data:y[3]}:null};k.changeDomain=n;k.read=function(y,D){var B=D&&D.url&&D.url.path;y&&B&&(y=h(y,B,{preserveProtocolRelative:!0}));(D=D&&D.portal)&&!D.isPortal&&D.urlKey&&D.customBaseUrl?(B=D.urlKey+"."+D.customBaseUrl,D=c(k.appUrl,k.appUrl.scheme+"://"+B)?n(y,D.portalHostname,B):n(y,B,D.portalHostname)):D=y;return D};k.write=
function(y,D){if(!y)return y;!b(y)&&D&&D.blockedRelativeUrls&&D.blockedRelativeUrls.push(y);var B=h(y);if(D){var E=D.verifyItemRelativeUrls&&D.verifyItemRelativeUrls.rootPath||D.url&&D.url.path;E&&(B=q(B,E,E),B!==y&&D.verifyItemRelativeUrls&&D.verifyItemRelativeUrls.writtenUrls.push(B))}y=B;B=(D=D&&D.portal)&&!D.isPortal&&D.urlKey&&D.customBaseUrl?n(y,D.urlKey+"."+D.customBaseUrl,D.portalHostname):y;return B};k.makeRelative=q;k.removeQueryParameters=function(y){y=d(y);Object.keys(y.query||{});return y.path}})},
"esri/layers/vectorTiles/core/workers/loaderConfig":function(){define(["require","exports","../tsSupport/assignHelper","dojo/has","../urlUtils"],function(H,k,p,r,m){Object.defineProperty(k,"__esModule",{value:!0});k.DEFAULT_LOADER_URL=m.makeAbsolute(m.removeQueryParameters(H.toUrl("./worker-init.js")));k.DEFAULT_CONFIG={baseUrl:function(){var l=m.removeQueryParameters(H.toUrl("dojo/x.js"));return m.makeAbsolute(l.slice(0,l.length-5))}(),packages:[{name:"esri"},{name:"dojo"},{name:"dojox"},{name:"dstore"},
{name:"moment",main:"moment"},{name:"@dojo"},{name:"cldrjs",main:"dist/cldr"},{name:"globalize",main:"dist/globalize"},{name:"maquette",main:"dist/maquette.umd"},{name:"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"},{name:"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"tslib",main:"tslib"}],map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}}};k.default=
function(l){var b={async:l.async,isDebug:l.isDebug,locale:l.locale,baseUrl:l.baseUrl,has:p({},l.has),map:p({},l.map),packages:l.packages&&l.packages.concat()||[],paths:p({},l.paths)};l.hasOwnProperty("async")||(b.async=!0);l.hasOwnProperty("isDebug")||(b.isDebug=!1);l.baseUrl||(b.baseUrl=k.DEFAULT_CONFIG.baseUrl);k.DEFAULT_CONFIG.packages.forEach(function(e){a:{for(var h=b.packages,c=0;c<h.length;c++)if(h[c].name===e.name)break a;e=p({},e);c=m.removeQueryParameters(H.toUrl(e.name+"/x.js"));c=c.slice(0,
c.length-5);e.location=m.makeAbsolute(c);h.push(e)}});l=b.map=b.map||{};for(var a=0,d=Object.keys(k.DEFAULT_CONFIG.map);a<d.length;a++){var f=d[a];l[f]||(l[f]=k.DEFAULT_CONFIG.map[f])}return b}})},"esri/layers/vectorTiles/core/workers/WorkerFallback":function(){define(["require","exports","dojo/has","../global","./utils"],function(H,k,p,r,m){var l=function(){return function(){var d=this,f=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(e){d[e]=
function(){for(var h=[],c=0;c<arguments.length;c++)h[c]=arguments[c];return f[e].apply(f,h)}})}}(),b=r.MutationObserver||r.WebKitMutationObserver,a=function(){if(r.process&&r.process.nextTick)var d=function(h){r.process.nextTick(h)};else if(r.Promise)d=function(h){r.Promise.resolve().then(h)};else if(b){var f=[],e=document.createElement("div");(new b(function(){for(;0<f.length;)f.shift()()})).observe(e,{attributes:!0});d=function(h){f.push(h);e.setAttribute("queueStatus","1")}}return d}();return function(){function d(){this._dispatcher=
new l;this._isInitialized=!1;this._workerPostMessage({type:m.MessageType.HANDSHAKE})}d.prototype.terminate=function(){};Object.defineProperty(d.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(f){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=f)&&this.addEventListener("message",f)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(f){this._onerrorHandler&&
this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=f)&&this.addEventListener("error",f)},enumerable:!0,configurable:!0});d.prototype.postMessage=function(f,e){var h=this;a(function(){h._workerMessageHandler(new MessageEvent("message",{data:f}))})};d.prototype.dispatchEvent=function(f){return this._dispatcher.dispatchEvent(f)};d.prototype.addEventListener=function(f,e,h){this._dispatcher.addEventListener(f,e,h)};d.prototype.removeEventListener=function(f,e,h){this._dispatcher.removeEventListener(f,
e,h)};d.prototype._workerPostMessage=function(f,e){var h=this;a(function(){h.dispatchEvent(new MessageEvent("message",{data:f}))})};d.prototype._workerMessageHandler=function(f){var e=this;if(f=m.receiveMessage(f)){var h=f.jobId;switch(f.type){case m.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:m.MessageType.CONFIGURED});break;case m.MessageType.OPEN:f=f.modulePath,p("esri-webpack")?H(["esri/core/workers/RemoteClient","esri/views/vectorTiles/WorkerTileHandler","esri/views/2d/layers/features/Pipeline",
"esri/views/3d/layers/PointCloudWorker","esri/views/3d/layers/SceneLayerWorker","esri/layers/graphics/sources/support/CSVSourceWorker","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker",f],function(c,g,n,q,v,u,t,y){switch(y){case "esri/views/vectorTiles/WorkerTileHandler":break;case "esri/views/2d/layers/features/Pipeline":g=n;break;case "esri/views/3d/layers/PointCloudWorker":g=q;break;case "esri/views/3d/layers/SceneLayerWorker":g=v;break;case "esri/layers/graphics/sources/support/CSVSourceWorker":g=
u;break;case "esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":g=t;break;default:g=y}c=c.connect(g);e._workerPostMessage({type:m.MessageType.OPENED,jobId:h,data:c})}):H(["./RemoteClient",f],function(c,g){c=c.connect(g);e._workerPostMessage({type:m.MessageType.OPENED,jobId:h,data:c})})}}};return d}()})},"esri/layers/vectorTiles/core/requireUtils":function(){define(["require","exports","dojo/Deferred"],function(H,k,p){function r(m,l){if(Array.isArray(l)){var b=new p;m(l,function(){for(var a=
[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.resolve(a)});return b.promise}return r(m,[l]).then(function(a){return a[0]})}Object.defineProperty(k,"__esModule",{value:!0});k.when=r;k.getAbsMid=function(m,l,b){return l.toAbsMid?l.toAbsMid(m):b.id.replace(/\/[^\/]*$/gi,"/")+m}})},"esri/layers/rasterLib/function/rasterFunctionHelper":function(){define(["dojo/_base/declare","dojo/_base/lang","./rasterFunctionRegistry"],function(H,k,p){return{create:function(r,m){if(r){var l=r.renderTexture,b=Object.keys(r);
if(r.read&&!m)return r;r.read&&m&&(r=r.toJson());-1<b.indexOf("name")&&b.indexOf(!1)?(r=k.mixin({},r),m=this._parseV2(r,m)):(r="esri.layers.RasterFunction"===r.declaredClass?r.toJson():k.mixin({},r),m=this._parseV1(r,m));m.branchCount=m.updateBranchStructure();m.renderTexture||(m.renderTexture=!!l);return m}},_parseV1:function(r,m){var l=r.rasterFunction,b=r.rasterFunctionArguments,a=r.renderTexture||r.rasterFunctionArguments.renderTexture||!1,d,f,e,h,c,g,n;(h=b.raster||b.Raster)&&h.rasterFunction&&
(d=this._parseV1(h,m));(h=b.raster2||b.Raster2)&&h.rasterFunction&&(f=this._parseV1(h,m));(h=b.rasters||b.Rasters)&&0<h.length&&(e=h.map(k.hitch(this,function(q){return q&&q.rasterFunction?this._parseV1(q,m):q})));(h=b.dem||b.DEM)&&(h.functionName||h.rasterFunction)&&(c=this._parseV1(h,m));(h=b.fillRaster||b.FillRaster)&&(h.functionName||h.rasterFunction)&&(g=this._parseV1(h,m));h=p.functions[l];if(!h)return console.error("Function is not currently supported: "+l),null;l=new h(b);l.variableName&&
(h=b[l.variableName])&&(h.functionName||h.rasterFunction)&&(n=this._parseV1(h,m));r.outputPixelType&&(l.pixelType=r.outputPixelType);"$$"===d?l.functionArguments.raster=m&&m.raster:null!=d?l.functionArguments.raster=d:l.functionArguments.raster||(l.functionArguments.raster=m&&m.raster);null!=f&&(l.functionArguments.raster2=f);null!=e&&(l.functionArguments.rasters=e.map(function(q){"$$"===q&&(q=m&&m.raster);return q}));null!=c&&(l.functionArguments.dem=c);null!=g&&(l.functionArguments.fillRaster=g);
null!=n&&(l.functionArguments[l.variableName]=n);l.renderTexture=a;return l},_parseV2:function(r,m){if(!r)return null;r=k.clone(r);this._bindV2Args(r,m);var l={};this._convertTov1(r,l);return this._parseV1(l,m)},_bindV2Args:function(r,m){(r||m)&&Object.keys(r).forEach(function(l){r[l]["function"]&&r[l].arguments?this._bindV2Args(r[l].arguments,m):null!=m[r[l].name]&&(r[l].value=m[r[l].name])}.bind(this))},_convertV2Types:function(r){if(!r)return null;"ArgumentArray"===r.type?r.elements&&"RasterStatistics"===
r.elements[0].type&&(r=r.elements):r instanceof Array&&0===r.length&&(r=null);return r},_convertTov1:function(r,m){if((r||m)&&r["function"]){var l=r["function"],b=r.arguments;m.rasterFunction=l.type.replace("Function","");m.outputPixelType="UNKNOWN"===l.pixelType?"Unknown":l.pixelType;m.rasterFunctionArguments={};var a;Object.keys(b).forEach(function(d){b[d]["function"]&&b[d].arguments?(m.rasterFunctionArguments[d]={},this._convertTov1(b[d],m.rasterFunctionArguments[d])):(a=b[d].value,m.rasterFunctionArguments[d]=
"object"!==typeof a||a.functionArguments?a:this._convertV2Types(a))}.bind(this))}}}})},"esri/layers/rasterLib/function/rasterFunctionRegistry":function(){define("dojo/_base/declare dojo/_base/lang ../../rasterLib/function/AspectFunction ../../rasterLib/function/BandArithmeticFunction ../../rasterLib/function/ColormapFunction ../../rasterLib/function/CompositeBandFunction ../../rasterLib/function/ContrastBrightnessFunction ../../rasterLib/function/ConvolutionFunction ../../rasterLib/function/ExtractBandFunction ../../rasterLib/function/HillshadeFunction ../../rasterLib/function/LocalFunction ../../rasterLib/function/MaskFunction ../../rasterLib/function/NDVIFunction ../../rasterLib/function/SlopeFunction ../../rasterLib/function/StretchFunction ../../rasterLib/function/RemapFunction ../../rasterLib/function/IdentityFunction ../../rasterLib/function/ResampleFunction".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u){return function(){function t(E){E.prototype.supportWebGL&&(D[E.prototype.functionName]=E);E.prototype.support2D&&(y[E.prototype.functionName]=E);B[E.prototype.functionName]=E}var y={},D={},B={};t(p);t(r);t(m);t(l);t(b);t(a);t(d);t(f);t(e);t(h);t(c);t(g);t(n);t(q);t(v);t(u);return{cpu:y,gpu:D,functions:B,register:t,getFunction:function(E){return B[E]},support:function(E,x){return!!("gpu"===x?D:"cpu"===x?y:B)[E]}}}()})},"esri/layers/rasterLib/function/AspectFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),
function(H,k,p,r,m,l,b,a){return H([p,b],{declaredClass:"esri.layers.rasterLib.function.AspectFunction",functionName:"Aspect",supportWebGL:!0,support2D:!0,constructor:function(d){this.functionArguments=this.mixinIgnoreCase({raster:null},d)},bind:function(){var d=this.getSourceRasterInfo();if(!d.raster)return Error("The raster input to aspect function is invalid.");this.rasterInfo=k.mixin(d.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:[{min:0,max:360}],histograms:null});
this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(d){this._performance.start();d=a.aspect(d.raster);this._addPerformanceMetric(this._performance.elapsed());return d},readGL:function(d){this._performance.start();this._initializeProgram({fragment:l.aspect,fragmentName:"Aspect"});var f=this._setupTextureData(d.raster),e=this.bindFrameBuffer(),h=this.gl,c=h.drawingBufferWidth;h=h.drawingBufferHeight;var g=f.extent;
this._setUniforms({u_resolution:d&&d.raster&&d.raster.pixelBlock?[1/d.raster.pixelBlock.width,1/d.raster.pixelBlock.height]:[1/c,1/h],u_cellSize:[(g.xmax-g.xmin)/c,(g.ymax-g.ymin)/h]});this._bindTexture(f.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:f.extent,texture:e.texture}}})})},"esri/layers/rasterLib/function/RasterFunctionX":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/config ../raster/RasterInfo ../../../geometry/Extent ../../PixelBlock".split(" "),
function(H,k,p,r,m,l){return H(null,{functionName:null,functionArguments:null,pixelType:"Unknown",rasterInfo:null,constructor:function(b){b&&(this.pixelType=b.outputPixelType||b.OutputPixelType||this.pixelType,this.renderTexture=b.renderTexture,this._initFunction())},mixinIgnoreCase:function(b,a){var d=Object.keys(b),f=Object.keys(a),e,h,c=d.length;for(e=0;e<f.length;e++){var g=a[f[e]];if(null!=g)for(h=0;h<c;h++)if(d[h].toLowerCase()===f[e].toLowerCase()){b[d[h]]=g;break}}return b},bind:function(b){},
setProcessingContext:function(b){if(!b)throw"cannot bind to layer without options";this.useWebGL=!!b.useWebGL;this._tileMode=!!b.tileMode;this._glSetting=b.glSetting;this._rawRasterInfo=b.rawRasterInfo;this._xformSetting=b.xformSetting||this._xformSetting;if(!this.useWebGL||this._glSetting&&this._glSetting.gl){this.gl=this.useWebGL?this._glSetting.gl:null;this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null);var a=this.functionArguments.raster,d=this.functionArguments.raster2,
f=this.functionArguments.dem,e=this.functionArguments.fillRaster,h=this.functionArguments.rasters;a&&a.functionArguments&&a.setProcessingContext(b);d&&d.functionArguments&&d.setProcessingContext(b);f&&f.functionArguments&&f.setProcessingContext(b);e&&e.functionArguments&&e.setProcessingContext(b);if(h)for(a=0;a<h.length;a++)h[a]&&h[a].functionArguments&&h[a].setProcessingContext(b);this.bind()}},updateBranchStructure:function(){var b=0,a=this.functionArguments;a.raster&&a.raster.read&&a.raster.functionArguments&&
(b+=a.raster.updateBranchStructure());a.raster2&&a.raster2.read&&a.raster2.functionArguments&&(b+=a.raster2.updateBranchStructure(),a.raster2.isBranch=!0,a.raster&&a.raster.read&&(a.raster.isBranch=!0));a.rasters&&(b=a.rasters.length,a.rasters.forEach(function(d){d.read&&d.functionArguments&&(d.isBranch=!0)}));a.dem&&a.dem.read&&a.dem.functionArguments&&(b+=a.dem.updateBranchStructure());return 1===b?0:b},read:function(b){b=this.processRasterArgument(b);return this.useWebGL?this.readGL(b):this.read2D(b)},
hasTilingEffects:function(){return!1},read2D:function(){},readGL:function(){},getSourceRasterInfo:function(){var b,a={};if(this.functionArguments.raster2)a.functionArguments.raster=this._bindRaster(this.functionArguments.raster),a.functionArguments.raster2=this._bindRaster(this.functionArguments.raster2);else if(this.functionArguments.rasters)for(a.rasters=[],b=0;b<this.functionArguments.rasters.length;b++)a.rasters[b]=this._bindRaster(this.functionArguments.rasters[b]);else a.raster=this._bindRaster(this.functionArguments.raster);
return this.sourceRasterInfo=a},processRasterArgument:function(b){var a=this.bind();if(!0!==a)throw a;var d={};if(this.functionArguments.raster2)d.raster=this._readRaster(this.functionArguments.raster,b),d.raster2=this._readRaster(this.functionArguments.raster2,b);else if(this.functionArguments.rasters)for(d.rasters=[],a=0;a<this.functionArguments.rasters.length;a++)d.rasters[a]=this._readRaster(this.functionArguments.rasters[a],b);else d.raster=this._readRaster(this.functionArguments.raster,b);return d},
toJson:function(){var b=this.functionArguments,a=b.raster,d=b.raster2;b=b.rasters;a=a?a.toJson?a.toJson():a:null;d=d?d.toJson?d.toJson():d:null;var f;b&&0<b.length&&(f=b.map(function(e){return e.toJson?e.toJson():e}));b=k.mixin({},this.functionArguments);b.raster=a;b.raster2=d;b.rasters=f;b=this._fixRasterFunctionJson(b);return{rasterFunction:this.functionName,rasterFunctionArguments:b,outputPixelType:this.pixelType}},_initFunction:function(b){},_getIntegerRange:function(b){switch(b){case "U8":var a=
[0,255];break;case "U16":a=[0,65535];break;case "U32":a=[0,4294967295];break;case "S8":a=[-128,127];break;case "S16":a=[-32768,32767];break;case "S32":a=[-2147483648,2147483647]}return a},_calculatePixelType:function(b,a){return b&&"unknown"!==b.toLowerCase()?b:a},_clonePixelData:function(b){if(null==b)return b;var a={};b.extent&&(a.extent=new m(b.extent.xmin,b.extent.ymin,b.extent.xmax,b.extent.ymax,b.extent.spatialReference));b=b.pixelBlock;if(null==b)return a;a.pixelBlock=b.clone?b.clone():l.prototype.clone(b);
return a},_readRaster:function(b,a){if(null==b||"$$"===b)var d=this._clonePixelData(a.src[Object.keys(a.src)[0]]);else b&&b.rasterInfo&&!b.functionArguments?d=this._clonePixelData(a.src[b._rasterId]):isNaN(b)?b.read&&(d=b.functionArguments?b.read(a):this._clonePixelData(a)):(d=a.src?a.src[Object.keys(a.src)[0]]:a,a=d.pixelBlock,a=new Float32Array(a.width*a.height),a.fill(parseFloat(b)),d=this._clonePixelData(d),d.pixelBlock.pixels=[a],d.isConstant=!0);return d},_bindRaster:function(b){if(b&&"$$"!==
b)isNaN(b)?b.rasterInfo?a=b.rasterInfo:b.bind&&b.bind()&&(a=b.rasterInfo):a={};else var a=this._rawRasterInfo;a&&(a=a.clone?a.clone():new r(a),a.bandCount=a.bandCount||3);return a},_getOutputBand:function(b,a){switch(b){case "U8":b=new Uint8Array(a);break;case "U16":b=new Uint16Array(a);break;case "U32":b=new Uint32Array(a);break;case "S8":b=new Int8Array(a);break;case "S16":b=new Int16Array(a);break;case "S32":b=new Int32Array(a);break;case "U32":b=new Uint32Array(a);break;case "F32":b=new Float32Array(a);
break;case "F64":b=new Float64Array(a);break;default:b=new Float32Array(a)}return b},_clampBand:function(b,a,d){if(("F64"===a||"F32"===a)&&!d)return b;var f,e=this._getIntegerRange(a),h=b.length;if(e)for(d=e[1],e=e[0],a=this._getOutputBand(a,h),f=0;f<h;f++){var c=b[f];a[f]=c>d?d:c<e?e:c}else a=b;return a},_performance:{start:function(){return this._start=self.performance&&self.performance.now()||new Date}.bind(this),elapsed:function(){return(self.performance&&self.performance.now()||new Date)-this._start}.bind(this)},
_addPerformanceMetric:function(b){p.isDebug&&(self.rasterFunctionPerformance||(self.rasterFunctionPerformance=[]),self.rasterFunctionPerformance.push(b),50<self.rasterFunctionPerformance.length&&self.rasterFunctionPerformance.shift())},_fixRasterFunctionJson:function(b){for(var a in b)b.hasOwnProperty(a)&&(null==b[a]?delete b[a]:b[a]instanceof Object&&!b[a].sourceType&&this._fixRasterFunctionJson(b[a],!0));return b}})})},"esri/layers/rasterLib/function/pixelShaders":function(){define(["dojo/_base/declare",
"dojo/_base/lang","./pixelShaderScripts"],function(H,k,p){H={shaderType:"fragment",getShader:function(r,m){var l=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(l,m);r.compileShader(l);r.getShaderParameter(l,r.COMPILE_STATUS)||(l=null);return l}};k.mixin(H,p);return H})},"esri/layers/rasterLib/function/pixelShaderScripts":function(){define([],function(){return{aspect:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nfloat pi \x3d 3.141592653589793238;\nfloat dz_dx \x3d 0.0;\nfloat dz_dy \x3d 0.0;\nvec4 va, vb, vc,vd,ve,vf,vg,vh,vi;\nvec2 axy \x3d vec2(-1.0,-1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s)\n{\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t)\n{\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e1.0-u_resolution.s)\n{\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0- u_resolution.t)\n{\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0-u_resolution.s)\x3e\x3dv_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0-u_resolution.t)\x3e\x3dv_texCoord.t)\n{\nva \x3d texture2D(u_image, v_texCoord + u_resolution* axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution* bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution* cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution* dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution* vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution* fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution* gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution* hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution* ixy);\n}\ndz_dx \x3d (vc+2.0*vf+vi - va - 2.0*vd - vg).r/(8.0*u_cellSize[0]);\ndz_dy \x3d -(vg+2.0*vh+vi - va - 2.0*vb - vc).r/(8.0*u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat aspect_rad \x3d 0.0;\nif (dz_dx \x3d\x3d 0.0)\n{\nif (dz_dy \x3e 0.0)\naspect_rad \x3d 0.5 * pi;\nelse if (dz_dy \x3c 0.0)\naspect_rad \x3d 1.5 * pi;\nelse\nalpha \x3d 0.0;//undefined make it nodata\n}\nelse\n{\naspect_rad \x3d 0.5*pi + atan(dz_dy, -dz_dx);\nif (aspect_rad \x3c 0.0)\naspect_rad \x3d 2.0*pi + aspect_rad;\n}\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, alpha);\n}",
bandArithmetic:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_nir;\nuniform int u_bandId_red;\nuniform bool u_scaled;\nuniform int u_bandCount;\nuniform int u_method;\nuniform float u_constants[6];\nvec4 calculateNDVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n} else {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nvec4 calculateSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat savi_denom \x3d nir + red + u_constants[0];\nfloat savi;\nif (savi_denom \x3d\x3d 0.0) {\nsavi \x3d 0.0;\n} else {\nsavi \x3d (nir - red) / savi_denom * (1.0 + u_constants[0]);\n}\nreturn vec4(savi, savi, savi, currentPixel.a);\n}\nvec4 calculateMSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat msavi \x3d 0.5 * (2.0 * (nir + 1.0) - sqrt(pow((2.0 * nir + 1.0), 2.0) - 8.0 * (nir - red)));\nreturn vec4(msavi, msavi, msavi, currentPixel.a);\n}\nvec4 calculateTSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat s \x3d u_constants[0];\nfloat a \x3d u_constants[1];\nfloat x \x3d u_constants[2];\nfloat tsavi_denom \x3d a * nir + red - a * s + x * (1.0 + s * s);\nfloat tsavi;\nif (tsavi_denom \x3d\x3d 0.0) {\ntsavi \x3d 0.0;\n} else {\ntsavi \x3d s * (nir - s * red - a) / tsavi_denom;\n}\nreturn vec4(tsavi, tsavi, tsavi, currentPixel.a);\n}\nvec4 calculatePVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat a \x3d u_constants[0];\nfloat b \x3d u_constants[1];\nfloat pvi \x3d (nir - a * red - b) / sqrt(1.0 + a * 2.0);\nreturn vec4(pvi, pvi, pvi, currentPixel.a);\n}\nvec4 calculateGEMI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat gemi;\nif (red \x3d\x3d 1.0) {\ngemi \x3d 0.0;\n} else {\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) / (nir + red + 0.5);\nfloat gemi \x3d eta * (1.0 - 0.25*eta) - (red - 0.125) / (1.0 - red);\n}\nreturn vec4(gemi, gemi, gemi, currentPixel.a);\n}\nvec4 calculateVARI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(currentPixel.r);\nfloat green \x3d float(currentPixel.g);\nfloat blue \x3d float(currentPixel.b);\nfloat vari \x3d (green - red) /(green + red - blue);\nreturn vec4(vari, vari, vari, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 pv;\nif (u_method \x3c 4) {\nif (u_method \x3d\x3d 1) {\npv \x3d calculateNDVI();\n} else if (u_method \x3d\x3d 2) {\npv \x3d calculateSAVI();\n} else if (u_method \x3d\x3d 3) {\npv \x3d calculateTSAVI();\n} else if (u_method \x3d\x3d 4) {\npv \x3d calculateMSAVI();\n}\n} else {\nif (u_method \x3d\x3d 5) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 6) {\npv \x3d calculatePVI();\n} else if (u_method \x3d\x3d 7) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 9) {\npv \x3d calculateVARI();\n}\n}\ngl_FragColor \x3d pv;\n}",
colormap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nvec4 colorize() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat clrIndex \x3d currentPixel.r - u_indexedColormapOffset;\nvec4 result;\nif (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d colorize();\n}",
compositeBand:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 composite() {\nvec4 p0, p1, p2;\np0 \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nif (u_rasterCount \x3d\x3d 1){\nresult \x3d p0;\n}\nelse if (u_rasterCount \x3d\x3d 2){\np1 \x3d texture2D(u_image1, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,0.0,min(p0.a,p1.a));\n}\nelse if (u_rasterCount \x3d\x3d 3){\np1 \x3d texture2D(u_image1, v_texCoord);\np2 \x3d texture2D(u_image2, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,p2.r,min(min(p0.a,p1.a),p2.a));\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d composite();\n}",
constant:"precision mediump float;\nuniform vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}",contrastBrightness:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nuniform float u_scaleFactor;\nvec4 adjustContrastBrightness() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0; //binary contrast with extra mid tone at 0.5\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a); //no contrast\n}\nreturn vec4(v.r / u_scaleFactor, v.g / u_scaleFactor, v.b / u_scaleFactor, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d adjustContrastBrightness();\n}",
convolution:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform float u_kernel[25];\nuniform int u_kernelSize;\nvec4 convolve33(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nvec2 xy11 \x3d vec2(-1.0, -1.0);\nvec2 xy12 \x3d vec2(0.0, -1.0);\nvec2 xy13 \x3d vec2(1.0, -1.0);\nvec2 xy21 \x3d vec2(-1.0, 0.0);\nvec2 xy23 \x3d vec2(1.0, 0.0);\nvec2 xy31 \x3d vec2(-1.0, 1.0);\nvec2 xy32 \x3d vec2(0.0, 1.0);\nvec2 xy33 \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\nxy11[0] \x3d 1.0;\nxy21[0] \x3d 1.0;\nxy31[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\nxy11[1] \x3d 1.0;\nxy12[1] \x3d 1.0;\nxy13[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxy13[0] \x3d -1.0;\nxy23[0] \x3d -1.0;\nxy33[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nxy31[1] \x3d -1.0;\nxy32[1] \x3d -1.0;\nxy33[1] \x3d -1.0;\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * xy11) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * xy12) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * xy13) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * xy21) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(0, 0)) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * xy23) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * xy31) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * xy32) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * xy33) * u_kernel[8];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nvec4 convolve55(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nfloat xdif[5];//https://www.opengl.org/wiki/Data_Type_(GLSL) array constructor ES3.0\nfloat ydif[5];\nfloat a \x3d -2.0;\nfor (int i\x3d0; i\x3c5; i++){\nxdif[i] \x3d a;\nydif[i] \x3d a;\na++;\n}\nif (v_texCoord.s \x3c u_resolution.s *2.0) { //2 pixel\nxdif[0] \x3d 2.0;\nif (v_texCoord.s \x3c u_resolution.s) { //1 pixel\nxdif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.s \x3e 1.0 - u_resolution.s *2.0) {\nxdif[0] \x3d -2.0;\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxdif[1] \x3d -1.0;\n}\n}\nif (v_texCoord.t \x3c u_resolution.t *2.0) {\nydif[0] \x3d 2.0;\nif (v_texCoord.t \x3c u_resolution.t) {\nydif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.t \x3e 1.0 - u_resolution.t*2.0) {\nydif[0] \x3d -2.0;\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nydif[1] \x3d -1.0;\n}\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[0])) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[0])) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[0])) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[0])) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[0])) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[1])) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[1])) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[1])) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[1])) * u_kernel[8] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[1])) * u_kernel[9] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[2])) * u_kernel[10] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[2])) * u_kernel[11] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[2])) * u_kernel[12] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[2])) * u_kernel[13] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[2])) * u_kernel[14] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[3])) * u_kernel[15] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[3])) * u_kernel[16] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[3])) * u_kernel[17] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[3])) * u_kernel[18] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[3])) * u_kernel[19] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[4])) * u_kernel[20] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[4])) * u_kernel[21] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[4])) * u_kernel[22] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[4])) * u_kernel[23] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[4])) * u_kernel[24];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_kernelSize \x3d\x3d 9){\ngl_FragColor \x3d convolve33();\n}\nelse {\ngl_FragColor \x3d convolve55();\n}\n}",
extractBand:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandIDs[3];\nuniform bool u_alterBand;\nvec4 extractBand() {\nvec4 p \x3d texture2D(u_image, v_texCoord);\nif (!u_alterBand){\nreturn p;\n}\nfloat r, g, b;\nif (u_bandIDs[0] \x3d\x3d0){\nr \x3d p.r;\n}\nelse if (u_bandIDs[0] \x3d\x3d1){\nr \x3d p.g;\n}\nelse if (u_bandIDs[0] \x3d\x3d2){\nr \x3d p.b;\n}\nif (u_bandIDs[1] \x3d\x3d0){\ng \x3d p.r;\n}\nelse if (u_bandIDs[1] \x3d\x3d1){\ng \x3d p.g;\n}\nelse if (u_bandIDs[1] \x3d\x3d2){\ng \x3d p.b;\n}\nif (u_bandIDs[2] \x3d\x3d0){\nb \x3d p.r;\n}\nelse if (u_bandIDs[2] \x3d\x3d1){\nb \x3d p.g;\n}\nelse if (u_bandIDs[2] \x3d\x3d2){\nb \x3d p.b;\n}\nreturn vec4(r, g, b, p.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d extractBand();\n}",
hillshade:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform int u_slopeType;\nuniform int u_hillshadeType;\nuniform int u_lightSourceCount;\nuniform float u_sinZcosA;\nuniform float u_sinZsinA;\nuniform float u_cosZ;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform float u_xFactor;\nuniform float u_yFactor;\nuniform bool u_scaled;\nuniform float u_minValue;\nuniform float u_maxValue;\nuniform bool u_applyColorramp;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvec3 rgb2hsv(vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\nfloat clrIndex \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb \x3d texture2D(u_image1, vec2(clrIndex, 0.0));\nvec3 hsv \x3d rgb2hsv(rgb.xyz);\nhsv.z \x3d hillshade;\nreturn vec4(hsv2rgb(hsv) * alpha, alpha);\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 va, vb, vc, vd, ve, vf, vg, vh, vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_xFactor;\nfloat dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_yFactor; //flip\nfloat s2 \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinA * dzy - u_sinZcosA * dzx;\nfloat z \x3d (u_cosZ + cosDelta) / s2;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n}\nelse if (u_hillshadeType \x3d\x3d 1){\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / s2;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d u_lightSourceCount-1) break;\n}\n}\nif (u_applyColorramp) {\nvec4 result \x3d overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);\nif (u_scaled) {\nresult \x3d vec4(result.rgb * 255.0, result.a);\n}\ngl_FragColor \x3d result;\n} else {\nif (u_scaled) {\nhillshade \x3d hillshade * 255.0;\nif (hillshade\x3e 255.0) {\nhillshade \x3d 255.0;\n}\n}\ngl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n}\n}",
identity:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandCount;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d  texture2D(u_image, v_texCoord);\ngl_FragColor \x3d vec4( currentPixel.rgb, currentPixel.a); //encode_float(currentPixel.r);\n}",
local:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 polyfill;\nvec4 localOp1() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nvec4 replaceme1;\nreturn result;\n}\nvec4 localOp2() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 result;\nvec4 replaceme2;\nreturn result;\n}\nvec4 localOp3() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 c \x3d texture2D(u_image2, v_texCoord);\nvec4 result;\nvec4 replaceme3;\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d localOp1();\n}",
local0:"precision mediump float;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_operation;\nuniform int u_constant[3];\nuniform vec4 gamma;\nfloat localOperate1(float a, float b, float c){\nfloat result;\nif (u_operation \x3d\x3d 1){\nresult \x3d a + b;\n}\nelse if (u_operation \x3d\x3d 2){\nresult \x3d a - b;\n}\nelse if (u_operation \x3d\x3d3){\nresult \x3d a * b;\n}\nelse if (u_operation \x3d\x3d4){\nresult \x3d sqrt(a);\n}\nelse if (u_operation \x3d\x3d5){\nresult \x3d pow(a, b);\n}\nelse if (u_operation \x3d\x3d6){\nresult \x3d acos(a);\n}\nelse if (u_operation \x3d\x3d7){\nresult \x3d asin(a);\n}\nelse if (u_operation \x3d\x3d8){\nresult \x3d atan(a);\n}\nelse if (u_operation \x3d\x3d9){\nresult \x3d 999.0; //atanh not available\n}\nelse if (u_operation \x3d\x3d10){\nresult \x3d abs(a);\n}\nelse if (u_operation \x3d\x3d13){\nresult \x3d 999.0; //bitwise not available\n}\nelse if (u_operation \x3d\x3d17){\nresult \x3d a !\x3d 0.0 \x26\x26 b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d18){\nresult \x3d a \x3d\x3d0.0? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d19){\nresult \x3d a !\x3d 0.0 || b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d20){\nresult \x3d a !\x3d 0.0 ^^ b !\x3d0.0; //exclusive or\n}\nelse if (u_operation \x3d\x3d21){\nresult \x3d cos(a);\n}\nelse if (u_operation \x3d\x3d23){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d24){\nresult \x3d a \x3d\x3d b ? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d25){\nresult \x3d exp(a);\n}\nelse if (u_operation \x3d\x3d26){\nresult \x3d pow(10.0, a);\n}\nelse if (u_operation \x3d\x3d27){\nresult \x3d exp2(a);\n}\nelse if (u_operation \x3d\x3d28){\nresult \x3d a \x3e b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d29){\nresult \x3d  a \x3e\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d30){\nresult \x3d floor(a); //int\n}\nelse if (u_operation \x3d\x3d31){\nresult \x3d a \x3d\x3d0? 1.0:0.0; //null pass mask\n}\nelse if (u_operation \x3d\x3d32){\nresult \x3d a; //float\n}\nelse if (u_operation \x3d\x3d33){\nresult \x3d a \x3c b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d34){\nresult \x3d a \x3c\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d35){\nresult \x3d log(a);\n}\nelse if (u_operation \x3d\x3d36){\nresult \x3d log2(a) / log2(10.0);\n}\nelse if (u_operation \x3d\x3d37){\nresult \x3d log2(a);\n}\nelse if (u_operation \x3d\x3d44){\nresult \x3d mod(a, b);\n}\nelse if (u_operation \x3d\x3d45){\nresult \x3d -a;\n}\nelse if (u_operation \x3d\x3d46){\nresult \x3d a !\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d48){\nresult \x3d ceil(a);\n}\nelse if (u_operation \x3d\x3d49){\nresult \x3d floor(a);\n}\nelse if (u_operation \x3d\x3d51){\nresult \x3d sin(a);\n}\nelse if (u_operation \x3d\x3d53){\nresult \x3d a * a;\n}\nelse if (u_operation \x3d\x3d56){\nresult \x3d tan(a);\n}\nelse if (u_operation \x3d\x3d57){\nresult \x3d 999.0; //tanh not available\n}\nelse if (u_operation \x3d\x3d59){\nresult \x3d 999.0; //acosh not available\n}\nelse if (u_operation \x3d\x3d60){\nresult \x3d 999.0; //asinh not available\n}\nelse if (u_operation \x3d\x3d61){\nresult \x3d atan(a, b);\n}\nelse if (u_operation \x3d\x3d64){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d65){\nresult \x3d floor(a/b);\n}\nelse if (u_operation \x3d\x3d76){\nresult \x3d a !\x3d0? b:c;\n}\n}\nvoid main() {\nvec4 currentPixel0 \x3d  texture2D(u_image0, v_texCoord);\nfloat graya, reda, greena, bluea;\nif (u_bandCount \x3d\x3d 1) {\ngraya \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngl_FragColor \x3d vec4(graya, graya, graya, currentPixel.a);\n}\nelse if (u_bandCount \x3d\x3d 3) {\nreda \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngreena \x3d stretchOneaue(float(currentPixel.g), u_minCutOff[1], u_maxCutOff[1], u_minOutput[1], u_maxOutput[1], u_factor[1]);\nbluea \x3d stretchOneaue(float(currentPixel.b), u_minCutOff[2], u_maxCutOff[2], u_minOutput[2], u_maxOutput[2], u_factor[2]);\ngl_FragColor \x3d vec4(reda, greena, bluea, currentPixel.a);\n}\n}",
mask:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_includedRanges[6];\nuniform bool u_includedRanges_specified;\nuniform float u_noDataValues[6];\nuniform bool u_noDataValues_specified;\nuniform int u_noDataInterpretation;\nuniform int u_bandCount;\nvec4 mask() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nvec4 processedPixel \x3d currentPixel;\nif (u_includedRanges_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n} else if (u_bandCount \x3d\x3d 3) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1] \x26\x26 currentPixel.g \x3e u_includedRanges[2] \x26\x26 currentPixel.g \x3c u_includedRanges[3] \x26\x26 currentPixel.b \x3e u_includedRanges[4] \x26\x26 currentPixel.b \x3c u_includedRanges[5])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n}\n}\nif (u_noDataValues_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (processedPixel.r \x3d\x3d u_noDataValues[0])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n} else if (u_bandCount \x3d\x3d 3) {\nif (u_noDataInterpretation \x3d\x3d1 \x26\x26 processedPixel.r \x3d\x3d u_noDataValues[0] \x26\x26 processedPixel.g \x3d\x3d u_noDataValues[1] \x26\x26 processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse if (processedPixel.r \x3d\x3d u_noDataValues[0] || processedPixel.g \x3d\x3d u_noDataValues[1] || processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n}\n}\nreturn processedPixel;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d mask();\n}",
ndvi:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_red;\nuniform int u_bandId_nir;\nuniform bool u_scaled;\nuniform int u_bandCount;\nvec4 calculateNDVI(){\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n}\nelse {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateNDVI();\n}",
remap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform float u_breaks[16];\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getRemapIndex(float pixelValue) {\nif (pixelValue \x3c u_breaks[0] || pixelValue \x3e u_breaks[15]) {\nreturn -1.0;\n}\nfor (int i \x3d 0; i \x3c 16; i++) {\nif (pixelValue \x3c u_breaks[i]) {\nreturn float(i - 1);\n}\n}\nif (pixelValue \x3d\x3d u_breaks[15]) {\nreturn 15.0;\n}\nreturn 0.0;\n}\nvec4 colorize(float pv) {\nfloat clrIndex \x3d pv - u_indexedColormapOffset;\nvec4 result;\nif (clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nif (currentPixel.a \x3d\x3d 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat remappedIndex \x3d getRemapIndex(currentPixel.r);\nif (remappedIndex \x3c 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\ngl_FragColor \x3d colorize(remappedIndex);\n}",
resample:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resamplingRatio;\nuniform int u_resamplingType;\nuniform vec2 u_anchor;\nuniform vec2 u_resolution;\nvec4 resample(){\nvec2 pos_nn, pos_ul, pos_ur, pos_ll, pos_lr, pos_offset;\nfloat weight,weight_total, weight_ul, weight_ur, weight_ll, weight_lr;\nvec4 vp;  //v_texCoord is canvas space 0-1\nvec2 originalResolution \x3d vec2(u_resolution.s*u_resamplingRatio.s, u_resolution.t*u_resamplingRatio.t);\nvec2 pos \x3d vec2(u_anchor.s+(v_texCoord.s-u_anchor.s),(u_anchor.t+(v_texCoord.t-u_anchor.t)));\nif (u_resamplingType \x3d\x3d 0)\n{//shift and scaling, y \x3d ax+b so x \x3d (y-b)/a\npos_nn \x3d vec2(floor(pos.s/originalResolution.s+0.5)*originalResolution.s,floor(pos.t/originalResolution.t+0.5)*originalResolution.t);\nif (pos_nn.s \x3c0.0 || pos_nn.s \x3e 1.0 || pos_nn.t \x3c0.0 || pos_nn.t \x3e 1.0){\nvp \x3d vec4(1.0, 0.0, 0.0, 1.0);//vec4(0.0, 1.0, 0.0, vp.a);\n}\nelse {\nvp \x3d texture2D(u_image, vec2(pos_nn.s, pos_nn.t));\n}\n}\nelse if (u_resamplingType \x3d\x3d 1)\n{//shift and scaling, 4 neighbors y \x3d ax+b so x \x3d (y-b)/a\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t);\npos_ur \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t);\npos_ll \x3d vec2(pos_ul.s, pos_ul.t+originalResolution.t);\npos_lr \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t+originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nweight_lr \x3d sqrt(pow(pos_offset.s,2.0) + pow(pos_offset.t,2.0));\nweight_ul \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(originalResolution.t- pos_offset.t,2.0));\nweight_ur \x3d sqrt(pow( pos_offset.s,2.0)+ 1.0- pow(originalResolution.t - pos_offset.t,2.0));\nweight_ll \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(pos_offset.t,2.0));\nvp \x3d (texture2D(u_image, pos_ul) * weight_ul + texture2D(u_image, pos_ur) * weight_ur + texture2D(u_image, pos_ll) * weight_ll + texture2D(u_image, pos_lr) * weight_lr)/(weight_ul+weight_ur+weight_ll+weight_lr);\n}\nelse if (u_resamplingType \x3d\x3d 2)\n{//shift and scaling, 16 neighbors\nweight_total \x3d 0.0;\nvp \x3d vec4(0.0,0.0,0.0,0.0);\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s-originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t-originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nfor (int i\x3d0; i\x3c4; i++){//row\nfor (int j\x3d0; j\x3c4; j++){//col\nweight \x3d sqrt(pow(pos_offset.s-float(j),2.0)+ pow(pos_offset.t-float(i),2.0));\nvp +\x3dtexture2D(u_image, vec2(pos_ul.s+float(i)*originalResolution.s,pos_ul.t+float(j)*originalResolution.t)) * weight;\nweight_total +\x3d weight;\n}\n}\nvp \x3d vp/weight_total;\n}\nreturn vp;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d resample();\n}",
slope:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nuniform float u_zfactor;\nuniform float u_altitude;\nuniform float u_azimuth;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nvec4 calculateSlope() {\nfloat pi \x3d 3.141592653589793238;\nfloat dzx \x3d 0.0;\nfloat dzy \x3d 0.0;\nvec4 va,  vb,  vc,  vd,  ve,  vf,  vg,  vh,  vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0 - u_resolution.s) \x3e\x3d v_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0 - u_resolution.t) \x3e\x3d v_texCoord.t) {\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\n}\ndzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r / (8.0 * u_cellSize[0]);\ndzy \x3d -(vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r / (8.0 * u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat slope \x3d atan(u_zfactor * sqrt(dzx * dzx + dzy * dzy)) * 57.2957795;\nreturn vec4(slope, slope, slope, alpha);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateSlope();\n}",
stretch:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_bandCount;\nuniform vec2 u_sourceDim;\nuniform vec2 u_targetDim;\nuniform int u_state;\nuniform bool u_minMaxTexture;\nuniform bool u_useGamma;\nuniform float u_gamma[4];\nuniform float u_gammaCorrection[4];\nuniform bool u_scaled;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nif (u_bandCount \x3d\x3d 1) {\nfloat alpha \x3d vp_ul.a * vp_ur.a * vp_ll.a * vp_lr.a;\nvec4 vp_nn \x3d texture2D(u_image, coords);\nreturn alpha \x3d\x3d 0.0 ? vp_nn : vec4(vp.rgb, alpha);\n}\nreturn vp;\n}\nvec4 findMin(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r),min(p1.g, p2.g),min(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(max(p1.r, p2.r),max(p1.g, p2.g),max(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMinMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r), max(p1.g, p2.g), 0.0, p1.a);\n}\n}\nvec4 minMax(int state) {\nvec2 pixelFract \x3d fract(v_texCoord * u_sourceDim);\nfloat xshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.s; //take left pixel if \x3e 0.5\nfloat yshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.t; //take bottom pixel if \x3e 0.5\nif (u_sourceDim.s \x3d\x3d 1.0) {\nxshift \x3d 0.0;\n}\nif (u_sourceDim.t \x3d\x3d 1.0) {\nyshift \x3d 0.0;\n}\nvec4 p1 \x3d texture2D(u_image, v_texCoord);\nvec4 p2 \x3d texture2D(u_image, v_texCoord + vec2(xshift, 0.0));\nvec4 p3 \x3d texture2D(u_image, v_texCoord + vec2(0.0, yshift));\nvec4 p4 \x3d texture2D(u_image, v_texCoord + vec2(xshift, yshift));\nvec4 pval;\nif (state \x3d\x3d 2) {\npval \x3d findMinMax(findMinMax(p1, p2), findMinMax(p3, p4));\n} else if (state \x3d\x3d 1) {\npval \x3d findMax(findMax(p1, p2), findMax(p3, p4));\n} else if (state \x3d\x3d 0) {\npval \x3d findMin(findMin(p1, p2), findMin(p3, p4));\n}\nreturn pval;\n}\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool scaled) {\nfloat stretchedVal;\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n} else if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nfloat stretchOneValueGamma(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection, bool scaled) {\nfloat stretchedVal;\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d floor(tempf * outRange * pow(relativeVal, 1.0 / gamma)) + minOutput;\n}\nelse if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_state \x3d\x3d 100) {\nvec4 currentPixel \x3d getPixelValue(v_texCoord);\nfloat grayVal,\nredVal,\ngreenVal,\nblueVal;\nfloat min0,\nmax0,\nmin1,\nmax1,\nmin2,\nmax2,\nfactor0,\nfactor1,\nfactor2;\nvec4 minV, maxV;\nif (u_minMaxTexture) {\nif (u_bandCount \x3d\x3d 1) {\nminV \x3d texture2D(u_image1, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d minV.g;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\n} else {\nminV \x3d texture2D(u_image1, v_texCoord);\nmaxV \x3d texture2D(u_image2, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d maxV.r;\nmin1 \x3d minV.g;\nmax1 \x3d maxV.g;\nmin2 \x3d minV.b;\nmax2 \x3d maxV.b;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\nfactor1 \x3d (u_maxOutput[1] - u_minOutput[1]) / (max1 - min1);\nfactor2 \x3d (u_maxOutput[2] - u_minOutput[2]) / (max2 - min2);\n}\n} else {\nmin0 \x3d u_minCutOff[0];\nmax0 \x3d u_maxCutOff[0];\nmin1 \x3d u_minCutOff[1];\nmax1 \x3d u_maxCutOff[1];\nmin2 \x3d u_minCutOff[2];\nmax2 \x3d u_maxCutOff[2];\nfactor0 \x3d u_factor[0];\nfactor1 \x3d u_factor[1];\nfactor2 \x3d u_factor[2];\n}\nif (u_useGamma){\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngreenVal \x3d stretchOneValueGamma(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_gamma[1], u_gammaCorrection[1], u_scaled);\nblueVal \x3d stretchOneValueGamma(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_gamma[1], u_gammaCorrection[2], u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\nelse {\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngreenVal \x3d stretchOneValue(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_scaled);\nblueVal \x3d stretchOneValue(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\n} else {\nvec4 currentPixel \x3d minMax(u_state);\ngl_FragColor \x3d currentPixel;\n}\n}"}})},
"esri/layers/rasterLib/function/RasterFunctionWebGLMixin":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ./pixelShaders ./vertexShaders ./webglHelper ./convolutionKernel".split(" "),function(H,k,p,r,m,l,b){return H(null,{gl:null,rgbaFloatData:null,originalTexture:null,lastTexture:null,renderTexture:!1,constructor:function(a){this._isProgramInitialized=!1;this.gl=a&&a.gl;a&&a.renderTexture&&(this.renderTexture=a.renderTexture);this._xformSetting=a&&a._xformSetting||{requireProjection:!1,
meshSize:[20,20]}},bindFrameBuffer:function(){var a=this.gl;this._setupPingPongTextures();this._setupBranchingTextures();var d=this._glSetting;this.isBranch?(d.branchIndex=(d.branchIndex+1)%d.branchCount,d=d.branches[d.branchIndex]):(d.pingpongIndex=(d.pingpongIndex+1)%d.pingpong.length,d=d.pingpong[d.pingpongIndex]);a.bindFramebuffer(a.FRAMEBUFFER,d.frameBuffer);a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight);return d},_initializeProgram:function(a){if(this.gl)try{var d=this.gl;d.viewport(0,
0,d.drawingBufferWidth,d.drawingBufferHeight);var f=this._glSetting.programUniforms,e="local"===this.functionName?"local"+this.functionArguments.operation:this.functionName,h=f[e];if(h)this._uniforms=h.uniforms,this.rasterProgram=h.program;else{var c=(this._useMesh=this._tileMode&&this._xformSetting.requireProjection)?m.mesh:m.basic,g=m.getShader(d,a.vertex||c),n=r.getShader(d,a.fragment),q=this._loadProgram(g,n),v={rasterProgram:l.getUniforms(d,q)};f[e]={uniforms:v,program:q};this.rasterProgram=
q;this._uniforms=v}d.useProgram(this.rasterProgram);var u=d.getAttribLocation(this.rasterProgram,"a_texCoord"),t=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,t);var y=l.createMesh(this._xformSetting.meshSize);d.bufferData(d.ARRAY_BUFFER,y,d.STATIC_DRAW);d.enableVertexAttribArray(u);d.vertexAttribPointer(u,2,d.FLOAT,!1,0,0);d.disable(d.DEPTH_TEST);d.blendFunc(d.SRC_ALPHA,d.ZERO);d.disable(d.BLEND);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1);this._shaderInfo=
{fragment:a.fragmentName}}catch(D){console.error("webgl exception: "+D.message)}else console.error("WebGL is required.")},_setUniform:function(a,d,f){null!=d&&(f&&!this._uniforms[f]&&(this._uniforms[f]=l.getUniforms(this.gl,this[f])),f=f?this._uniforms[f]:this._uniforms.rasterProgram,(a=f[a]||f[a+"[0]"])&&l.setUniform(this.gl,a,d))},_setUniforms:function(a,d){var f=Object.keys(a),e,h=f.length;for(e=0;e<h;e++)this._setUniform(f[e],a[f[e]],d);this.rawInput?this._setUniform("u_flipY",!0,d):this._setUniform("u_flipY",
!1,d);this._tileMode?(this.rawInput?(a=this._xformSetting.offset,f=this._xformSetting.scale):(a=[0,0],f=[1,1]),this._setUniform("u_xformOffset",a,d),this._setUniform("u_xformScale",f,d),this._xformSetting.requireProjection&&(this.rawInput?(this._setupXformTexture(),this._setUniform("u_projection",!0,d),this._setUniform("u_transformGridSize",this._xformSetting.gridConfig.size,d),this._setUniform("u_transformSpacing",this._xformSetting.gridConfig.spacing,d),this._setUniform("u_targetImageSize",new Float32Array([this.gl.drawingBufferWidth,
this.gl.drawingBufferHeight]),d)):this._setUniform("u_projection",!1,d))):(a=[0,0],f=[1,1],this._setUniform("u_xformOffset",a,d),this._setUniform("u_xformScale",f,d));this.rawInput&&this._rawResolution&&("RSP_BilinearInterpolation"===this.interpolation||"RSP_CubicConvolution"===this.interpolation)?(this._setUniform("u_resampling",1),this._setUniform("u_rawResolution",this._rawResolution)):this._setUniform("u_resampling",0)},_setupTextureData:function(a,d){if(a.texture)return a;a.raster&&a.raster.pixelBlock&&
(a=a.raster);this.rawInput=!0;var f=d&&d.notOriginal,e=d&&d.bandIDs;d&&d.reCreate?d=!1:(d=this._tileMode?!this._xformSetting.hasNewTexture:!this._glSetting.hasNewTexture)&&this._originalBandIDs&&(d=e?this._originalBandIDs.join("")===e.join(""):!1);0<this._glSetting.branchCount&&(d=!1);if(d&&this.originalTexture)return{extent:a.extent,texture:this.originalTexture};d=this._createTexture();f||(this.originalTexture=d,this._originalBandIDs=e);f=this.gl;var h=a.pixelBlock;this._rawResolution=h?[1/a.pixelBlock.width,
1/a.pixelBlock.height]:[1/this.gl.drawingBufferWidth,1/this.gl.drawingBufferHeight];var c=0;e&&0<e.length&&h&&(c=Math.max.apply(null,e),h.pixels.length>c&&e&&(h.pixels=e.map(function(n){return h.pixels[n]}),h.statistics&&(h.statistics=e.map(function(n){return h.statistics[n]}))));e=h.width;c=h.height;f.getExtension("OES_texture_float");var g=h.getAsRGBAFloat();f.texImage2D(f.TEXTURE_2D,0,f.RGBA,e,c,0,f.RGBA,f.FLOAT,g);return{extent:a.extent,texture:d}},_setupPingPongTextures:function(){var a=this._glSetting;
if(!a||!a.pingpong){a.pingpong=[];var d=l.createBufferTexture(this.gl,!1);a.pingpong.push(d);d=l.createBufferTexture(this.gl,!1);a.pingpong.push(d);a.pingpongIndex=1}},_setupBranchingTextures:function(){var a=this._glSetting;if(!a||!a.branches){a.branches=[];var d=0,f=a.branchCount;if(0<f){for(d=0;d<f;d++){var e=l.createBufferTexture(this.gl,!1);a.branches.push(e)}a.branchIndex=f-1}}},_setupXformTexture:function(a){for(var d=this._createTexture(),f=this.gl,e=4*this._xformSetting.gridConfig.size[0],
h=this._xformSetting.gridConfig.size[1],c=new Float32Array(e*h*4),g=0,n=0;n<this._xformSetting.gridConfig.coefficients.length;n++)c[g++]=this._xformSetting.gridConfig.coefficients[n],2===n%3&&(c[g++]=1);f.getExtension("OES_texture_float");f.texImage2D(f.TEXTURE_2D,0,f.RGBA,e,h,0,f.RGBA,f.FLOAT,c);this._bindTexture(d,"u_transformGrid",a)},_createTexture:function(a){return l.createTexture(this.gl,a)},_bindTexture:function(a,d,f){d=d||"u_image";f=this._uniforms[f||"rasterProgram"];var e=this._getTextureIndex(d);
if(-1!==e){var h=this.gl;h.uniform1i(f[d].location,e);h.activeTexture(h.TEXTURE0+e);h.bindTexture(h.TEXTURE_2D,a)}},_getTextureIndex:function(a,d){d=this._uniforms[d||"rasterProgram"];if(!d||!d[a]||d[a].info.type!==this.gl.SAMPLER_2D)return-1;if("u_transformGrid"===a)return 0;a="u_image"===a?0:parseInt(a.replace("u_image",""));return this._xformSetting.requireProjection?a+1:a},_drawGL:function(a){var d=this.gl;this.renderTexture?(d.enable(d.BLEND),d.bindFramebuffer(d.FRAMEBUFFER,null)):d.disable(d.BLEND);
a||d.viewport(0,0,d.drawingBufferWidth,d.drawingBufferHeight);a=this._xformSetting.meshSize||[1,1];d.drawArrays(d.TRIANGLES,0,a[0]*a[1]*6);this._drawMesh()},_drawMesh:function(){if(this.renderTexture&&this._glSetting.drawMesh){this.meshProgram=this.meshProgram||this._setupMeshProgram();var a=this.gl;a.useProgram(this.meshProgram);a.bindFramebuffer(a.FRAMEBUFFER,null);var d=a.getAttribLocation(this.meshProgram,"a_texCoord"),f=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,f);f=this._xformSetting.meshSize||
[1,1];var e=l.createMesh(f,!0);a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);a.enableVertexAttribArray(d);a.vertexAttribPointer(d,2,a.FLOAT,!1,0,0);a.disable(a.DEPTH_TEST);a.blendFunc(a.ONE,a.ZERO);this._setUniforms({u_color:[0,0,1,1],u_drawMeshLines:!0},"meshProgram");a.drawArrays(a.LINES,0,f[0]*f[1]*10)}},_setupMeshProgram:function(){var a=m.getShader(this.gl,m.mesh),d=r.getShader(this.gl,r.constant);return this._loadProgram(a,d)},_loadProgram:function(a,d){return l.loadProgram(this.gl,a,d)},_getShaderScript:function(a,
d){d=document.getElementById(d);if(!d)return null;a="";for(d=d.firstChild;d;)3==d.nodeType&&(a+=d.textContent),d=d.nextSibling;return a}})})},"esri/layers/rasterLib/function/vertexShaders":function(){define(["dojo/_base/declare","dojo/_base/lang","./vertexShaderScripts"],function(H,k,p){H={shaderType:"vertex",getShader:function(r,m){var l=r.createShader(r.VERTEX_SHADER);r.shaderSource(l,m);r.compileShader(l);r.getShaderParameter(l,r.COMPILE_STATUS)||(l=null);return l}};k.mixin(H,p);return H})},"esri/layers/rasterLib/function/vertexShaderScripts":function(){define([],
function(){return{basic:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform bool u_flipY;\nvoid main() {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}",histogram:"attribute float a_pixelIndex;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nuniform vec2 u_sourceDim;\nuniform vec2 u_halfPixel;\nuniform vec4 u_bandSelection;\nuniform vec4 u_mins;\nuniform vec4 u_factors;\nuniform float u_size;\nuniform int u_bandCount;\nuniform bool u_minMaxTexture;\nvoid main() {\nfloat row \x3d a_pixelIndex/u_sourceDim.s;\nvec2 coord \x3d vec2(fract(row), floor(row)/u_sourceDim.t);\nvec4 pv \x3d texture2D(u_image, coord + u_halfPixel);\nvec4 minVal, maxVal, pvm;\nif (u_minMaxTexture){\nif (u_bandCount \x3d\x3d1){ //min \x3d red, max \x3d green\nvec4 minmax \x3d texture2D(u_image1, vec2(0.5,0.5));\nminVal \x3d vec4(minmax.r, minmax.r, minmax.r, 0.0);\nmaxVal \x3d vec4(minmax.g, minmax.g, minmax.g, 0.0);\n}\nelse if (u_bandCount \x3d\x3d3){ //min \x3d red, max \x3d green\nminVal \x3d texture2D(u_image1, vec2(0.5,0.5));\nmaxVal \x3d texture2D(u_image2, vec2(0.5,0.5));\n}\nvec4 factors \x3d u_size/(maxVal-minVal+vec4(0.0,0.0,0.0,1.0)) * u_factors;\npvm \x3d (pv - minVal) * factors;\n}\nelse {\npvm \x3d (pv - u_mins) * u_factors;\n}\nfloat histVal \x3d min(floor(pvm.r+pvm.g+pvm.b), u_size-1.0);\nhistVal \x3d pv.a \x3d\x3d 1.0? histVal: u_size;\ngl_Position \x3d vec4((histVal+0.1) / (u_size+1.0) * 2.0 - 1.0, 0.5, 0, 1);\ngl_PointSize \x3d 1.0;\n}",
mesh:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform bool u_drawMeshLines;\nuniform bool u_flipY;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nuniform vec2 u_srcImageSize;\nuniform bool u_projection;\nvec2 projectPixelLocation(vec2 coords) {\nvec2 index_image \x3d floor(coords * u_targetImageSize);\nvec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\nif (pos.s \x3c\x3d pos.t) {\nvec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;// + halfPixel;\n}\nvoid main() {\nif (u_projection) {\nv_texCoord \x3d projectPixelLocation(a_texCoord);\n} else {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\n}\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\nif (u_drawMeshLines){\nvec2 adjustedPos \x3d (v_texCoord - u_xformOffset) / u_xformScale;\ngl_Position \x3d vec4( adjustedPos * 2.0 - 1.0, 0.0, 1.0);\n}\nelse {\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}\n}"}})},
"esri/layers/rasterLib/function/webglHelper":function(){define([],function(){var H={getUniforms:function(k,p){var r=k.getProgramParameter(p,k.ACTIVE_UNIFORMS),m,l,b={};for(m=0;m<r;m++)(l=k.getActiveUniform(p,m))&&(b[l.name]={location:k.getUniformLocation(p,l.name),info:l});return b},setUniform:function(k,p,r){var m=p.info,l=p.location,b=m.type;if(null==r)console.log("uniform "+p.info.name+" has null or undefined value");else switch(b){case k.FLOAT:1<m.size?0===r.length?console.log("uniform "+p.info.name+
" has length 0"):k.uniform1fv(l,r):k.uniform1f(l,r);break;case k.FLOAT_VEC2:if(0===r.length){console.log("uniform "+p.info.name+" has length 0");break}k.uniform2fv(l,r);break;case k.FLOAT_VEC3:if(0===r.length){console.log("uniform "+p.info.name+" has length 0");break}k.uniform3fv(l,r);break;case k.FLOAT_VEC4:if(0===r.length){console.log("uniform "+p.info.name+" has length 0");break}k.uniform4fv(l,r);break;case k.INT:case k.BOOL:1<m.size?0===r.length?console.log("uniform "+p.info.name+" has length 0"):
k.uniform1iv(l,r):k.uniform1i(l,r);break;case k.INT_VEC2:case k.BOOL_VEC2:if(0===r.length){console.log("uniform "+p.info.name+" has length 0");break}k.uniform2iv(l,r);break;case k.INT_VEC3:case k.BOOL_VEC3:if(0===r.length){console.log("uniform "+p.info.name+" has length 0");break}k.uniform3iv(l,r);break;case k.INT_VEC4:case k.BOOL_VEC4:0===r.length?console.log("uniform "+p.info.name+" has length 0"):k.uniform4iv(l,r)}},createTexture:function(k,p){var r=k.createTexture();k.bindTexture(k.TEXTURE_2D,
r);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,p?k.LINEAR:k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,p?k.LINEAR:k.NEAREST);return r},createBufferTexture:function(k,p,r){p=H.createTexture(k,p);k.getExtension("OES_texture_float");r=r||[k.drawingBufferWidth,k.drawingBufferHeight];k.texImage2D(k.TEXTURE_2D,0,k.RGBA,r[0],r[1],0,k.RGBA,k.FLOAT,null);r=k.createFramebuffer();
k.bindFramebuffer(k.FRAMEBUFFER,r);k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,p,0);return{texture:p,frameBuffer:r}},getShader:function(k,p,r){r=r?k.createShader(k.VERTEX_SHADER):k.createShader(k.FRAGMENT_SHADER);k.shaderSource(r,p);k.compileShader(r);k.getShaderParameter(r,k.COMPILE_STATUS)||(console.log(k.getShaderInfoLog(r)),r=null);return r},loadProgram:function(k,p,r){var m=k.createProgram();k.attachShader(m,p);k.attachShader(m,r);k.linkProgram(m);k.getProgramParameter(m,
k.LINK_STATUS)||(console.warn("failed to load webgl program: "+k.getProgramInfoLog(m)),k.deleteProgram(m),m=null);return m},createMesh:function(k,p){if(!k||1===k[0]&&1===k[1])return new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);var r=k&&p?new Float32Array(k[0]*k[1]*20):new Float32Array(k[0]*k[1]*12);var m=.9998/k[1],l=.9998/k[0],b,a,d=0;for(b=0;b<k[1];b++)for(a=0;a<k[0];a++){var f=1E-4+m*b;var e=1E-4+l*a;k&&!p?(r[d++]=f,r[d++]=e,r[d++]=f+m,r[d++]=e,r[d++]=f,r[d++]=e+l,r[d++]=f,r[d++]=e+l,r[d++]=f+m,
r[d++]=e,r[d++]=f+m,r[d++]=e+l):(r[d++]=f,r[d++]=e,r[d++]=f,r[d++]=e+l,r[d++]=f,r[d++]=e+l,r[d++]=f+m,r[d++]=e+l,r[d++]=f+m,r[d++]=e+l,r[d++]=f+m,r[d++]=e,r[d++]=f,r[d++]=e,r[d++]=f+m,r[d++]=e,r[d++]=f,r[d++]=e+l,r[d++]=f+m,r[d++]=e)}return r}};return H})},"esri/layers/rasterLib/function/convolutionKernel":function(){define([],function(){var H={Default:[0,0,0,0,1,0,0,0,0],LineDetectionHorizontal:[-1,-1,-1,2,2,2,-1,-1,-1],LineDetectionVertical:[-1,2,-1,-1,2,-1,-1,2,-1],LineDetectionLeftDiagonal:[2,
-1,-1,-1,2,-1,-1,-1,2],LineDetectionRightDiagonal:[-1,-1,2,-1,2,-1,2,-1,-1],GradientNorth:[-1,-2,-1,0,0,0,1,2,1],GradientWest:[-1,0,1,-2,0,2,-1,0,1],GradientEast:[1,0,-1,2,0,-2,1,0,-1],GradientSouth:[1,2,1,0,0,0,-1,-2,-1],GradientNorthEast:[0,-1,-2,1,0,-1,2,1,0],GradientNorthWest:[-2,-1,0,-1,0,1,0,1,2],SmoothArithmeticMean:[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111],Smoothing3x3:[.0625,.125,.0625,.125,.25,.125,.0625,
.125,.0625],Smoothing5x5:[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,1,1,1,1,1],Sharpening3x3:[-1,-1,-1,-1,9,-1,-1,-1,-1],Sharpening5x5:[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1],Laplacian3x3:[0,-1,0,-1,4,-1,0,-1,0],Laplacian5x5:[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0],SobelHorizontal:[-1,-2,-1,0,0,0,1,2,1],SobelVertical:[-1,0,1,-2,0,2,-1,0,1],Sharpen:[0,-.25,0,-.25,2,-.25,0,-.25,0],Sharpen2:[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25],PointSpread:[-.627,
.352,-.627,.352,2.923,.352,-.627,.352,-.627],getKernel:function(k){switch(k){case 0:return H.LineDetectionHorizontal;case 1:return H.LineDetectionVertical;case 2:return H.LineDetectionLeftDiagonal;case 3:return H.LineDetectionRightDiagonal;case 4:return H.GradientNorth;case 5:return H.GradientWest;case 6:return H.GradientEast;case 7:return H.GradientSouth;case 8:return H.GradientNorthEast;case 9:return H.GradientNorthWest;case 10:return H.SmoothArithmeticMean;case 11:return H.Smoothing3x3;case 12:return H.Smoothing5x5;
case 13:return H.Sharpening3x3;case 14:return H.Sharpening5x5;case 15:return H.Laplacian3x3;case 16:return H.Laplacian5x5;case 17:return H.SobelHorizontal;case 18:return H.SobelVertical;case 19:return H.Sharpen;case 20:return H.Sharpen2;case 21:return H.PointSpread;default:return H.Default}}};return H})},"esri/layers/rasterLib/function/surfaceUtils":function(){define(["dojo/_base/lang"],function(H){return{hillshade:function(k,p){if(null!==k&&null!==k.pixelBlock&&null!==k.pixelBlock.pixels){var r=
this._clonePixelBlock(k.pixelBlock),m=p.altitude,l=p.azimuth,b=p.zFactor,a=p.psPower,d=p.psFactor,f=p.hillshadeType,e=p.slopeType,h=p.isGCS;1===f&&(b*=2);p=r.width;var c=r.height,g=r.pixels[0],n=r.mask,q=new Uint8Array(p*c);n&&q.set(n);var v=new Uint8Array(p*c),u=(k.extent.xmax-k.extent.xmin)/p,t=(k.extent.ymax-k.extent.ymin)/c,y=b/(8*u),D=b/(8*t);.001<b&&h&&(y/=111E3,D/=111E3);3===e&&(h?(y=111E3*u,D=111E3*t,y=(b+Math.pow(y,a)*d)/(8*y),D=(b+Math.pow(D,a)*d)/(8*D)):(y=(b+Math.pow(u,a)*d)/(8*u),D=(b+
Math.pow(t,a)*d)/(8*t)));h=(90-m)*Math.PI/180;m=Math.cos(h);var B=(360-l+90)*Math.PI/180;l=Math.sin(h)*Math.cos(B);h=Math.sin(h)*Math.sin(B);b=[];a=[];d=[];u=[315,270,225,360,180,0];var E=[60,60,60,60,60,90];e=[3,5,3,2,1,4];var x=e.reduce(function(ba,ca){return ba+ca});t=e.map(function(ba){return ba/x});if(1===f){var w=u.length;for(e=0;e<w;e++)m=E[e],l=u[e],h=(90-m)*Math.PI/180,m=Math.cos(h),B=(360-l+90)*Math.PI/180,l=Math.sin(h)*Math.cos(B),h=Math.sin(h)*Math.sin(B),b.push(m),a.push(l),d.push(h)}var A=
0;for(e=1;e<c-1;e++)for(E=e*p,u=1;u<p-1;u++)if(n&&!n[E+u])v[E+u]=0;else{B=0;if(n&&(B=n[E-p+u-1]+n[E-p+u]+n[E-p+u+1]+n[E+u-1]+n[E+u+1]+n[E+p+u-1]+n[E+p+u]+n[E+p+u+1],7>B)){v[E+u]=0;q[E+u]=0;continue}if(7===B){var z=n[E-p+u-1]?g[E-p+u-1]:g[E+u];var G=n[E-p+u]?g[E-p+u]:g[E+u];var I=n[E-p+u+1]?g[E-p+u+1]:g[E+u];B=n[E+u-1]?g[E+u-1]:g[E+u];var K=n[E+u+1]?g[E+u+1]:g[E+u];A=n[E+p+u-1]?g[E+p+u-1]:g[E+u];var R=n[E+p+u]?g[E+p+u]:g[E+u];var U=n[E+p+u+1]?g[E+p+u+1]:g[E+u]}else z=g[E-p+u-1],G=g[E-p+u],I=g[E-p+
u+1],B=g[E+u-1],K=g[E+u+1],A=g[E+p+u-1],R=g[E+p+u],U=g[E+p+u+1];B=(I+K+K+U-(z+B+B+A))*y;G=(A+R+R+U-(z+G+G+I))*D;I=Math.sqrt(1+B*B+G*G);A=0;if(0===f)R=h*G-l*B,R=255*(m+R)/I,0>R&&(R=0),A=R;else if(1===f)for(z=0;z<w;z++)R=d[z]*G-a[z]*B,R=255*(b[z]+R)/I,0>R&&(R=0),A+=R*t[z];v[E+u]=A}for(e=0;e<c;e++)v[e*p]=v[e*p+1],v[(e+1)*p-1]=v[(e+1)*p-2];for(e=1;e<p-1;e++)v[e]=v[e+p],v[e+(c-1)*p]=v[e+(c-2)*p];r.pixelType="U8";r.pixels=[v];r.statistics=[{minValue:0,maxValue:255}];n&&(r.mask=q);return{extent:k.extent,
pixelBlock:r}}},slope:function(k,p){if(null!==k&&null!==k.pixelBlock&&null!==k.pixelBlock.pixels){var r=this._clonePixelBlock(k.pixelBlock),m=p.zFactor,l=p.psPower,b=p.psFactor,a=p.slopeType,d=p.isGCS;p=r.width;var f=r.height,e=r.pixels[0],h=r.mask,c=new Uint8Array(p*f);h&&c.set(h);var g=new Float32Array(p*f),n=(k.extent.xmax-k.extent.xmin)/p,q=(k.extent.ymax-k.extent.ymin)/f,v=m/(8*n),u=m/(8*q);1E-4>Math.abs(m-1)&&d&&(v/=111E3,u/=111E3);3===a&&(d?(v=111E3*n,u=111E3*q,v=(m+Math.pow(v,l)*b)/(8*v),
u=(m+Math.pow(u,l)*b)/(8*u)):(v=(m+Math.pow(n,l)*b)/(8*n),u=(m+Math.pow(q,l)*b)/(8*q)));for(m=1;m<f-1;m++)for(b=m*p,l=1;l<p-1;l++)if(h&&!h[b+l])g[b+l]=0;else{q=0;if(h&&(q=h[b-p+l-1]+h[b-p+l]+h[b-p+l+1]+h[b+l-1]+h[b+l+1]+h[b+p+l-1]+h[b+p+l]+h[b+p+l+1],7>q)){g[b+l]=0;c[b+l]=0;continue}if(7===q){q=h[b-p+l-1]?e[b-p+l-1]:e[b+l];d=h[b-p+l]?e[b-p+l]:e[b+l];n=h[b-p+l+1]?e[b-p+l+1]:e[b+l];var t=h[b+l-1]?e[b+l-1]:e[b+l];var y=h[b+l+1]?e[b+l+1]:e[b+l];var D=h[b+p+l-1]?e[b+p+l-1]:e[b+l];var B=h[b+p+l]?e[b+p+
l]:e[b+l];var E=h[b+p+l+1]?e[b+p+l+1]:e[b+l]}else q=e[b-p+l-1],d=e[b-p+l],n=e[b-p+l+1],t=e[b+l-1],y=e[b+l+1],D=e[b+p+l-1],B=e[b+p+l],E=e[b+p+l+1];t=(n+y+y+E-(q+t+t+D))*v;q=(D+B+B+E-(q+d+d+n))*u;q=Math.sqrt(t*t+q*q);g[b+l]=1===a||3===a?57.2957795*Math.atan(q):100*q}for(m=0;m<f;m++)g[m*p]=g[m*p+1],g[(m+1)*p-1]=g[(m+1)*p-2];for(m=1;m<p-1;m++)g[m]=g[m+p],g[m+(f-1)*p]=g[m+(f-2)*p];r.pixelType="F32";r.pixels=[g];r.statistics=[{minValue:0,maxValue:255}];h&&(r.mask=c);return{extent:k.extent,pixelBlock:r}}},
aspect:function(k){if(null!==k&&null!==k.pixelBlock&&null!==k.pixelBlock.pixels){var p=this._clonePixelBlock(k.pixelBlock),r=p.width,m=p.height,l=p.pixels[0],b=p.mask,a=new Uint8Array(r*m);b&&a.set(b);var d=new Float32Array(r*m),f=1/((k.extent.xmax-k.extent.xmin)/r),e=1/((k.extent.ymax-k.extent.ymin)/m),h,c;for(h=1;h<m-1;h++){var g=h*r;for(c=1;c<r-1;c++)if(b&&!b[g+c])d[g+c]=0;else{var n=0;if(b&&(n=b[g-r+c-1]+b[g-r+c]+b[g-r+c+1]+b[g+c-1]+b[g+c+1]+b[g+r+c-1]+b[g+r+c]+b[g+r+c+1],7>n)){d[g+c]=0;a[g+c]=
0;continue}if(7===n){n=b[g-r+c-1]?l[g-r+c-1]:l[g+c];var q=b[g-r+c]?l[g-r+c]:l[g+c];var v=b[g-r+c+1]?l[g-r+c+1]:l[g+c];var u=b[g+c-1]?l[g+c-1]:l[g+c];var t=b[g+c+1]?l[g+c+1]:l[g+c];var y=b[g+r+c-1]?l[g+r+c-1]:l[g+c];var D=b[g+r+c]?l[g+r+c]:l[g+c];var B=b[g+r+c+1]?l[g+r+c+1]:l[g+c]}else n=l[g-r+c-1],q=l[g-r+c],v=l[g-r+c+1],u=l[g+c-1],t=l[g+c+1],y=l[g+r+c-1],D=l[g+r+c],B=l[g+r+c+1];u=(v+t+t+B-(n+u+u+y))*f;n=(y+D+D+B-(n+q+q+v))*e;0===u&&0===n?n=-1:(n=90-57.29578*Math.atan2(n,-u),0>n&&(n+=360),360===n?
n=0:360<n&&(n%=360));d[g+c]=n}}for(h=0;h<m;h++)d[h*r]=d[h*r+1],d[(h+1)*r-1]=d[(h+1)*r-2];for(h=1;h<r-1;h++)d[h]=d[h+r],d[h+(m-1)*r]=d[h+(m-2)*r];p.pixelType="F32";p.pixels=[d];p.statistics={minValue:0,maxValue:360};b&&(p.mask=a);return{extent:k.extent,pixelBlock:p}}},_clonePixelBlock:function(k){return k.clone?k.clone():H.clone(k)}}})},"esri/layers/rasterLib/function/BandArithmeticFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),
function(H,k,p,r,m,l,b){return H([p,l],{declaredClass:"esri.layers.rasterLib.function.BandArithmeticFunction",functionName:"BandArithmetic",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({method:1,bandIndexes:"",raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to band arithmetic function is invalid.");this.rasterInfo=k.mixin(a.raster,{bandCount:8===this.functionArguments.method?a.raster.bandCount:
1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var d=b.calculate(a.pixelBlock,{bandIndexes:this.functionArguments.bandIndexes,method:this.functionArguments.method});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(d.pixelType=this.pixelType);
return{extent:a.extent,pixelBlock:d}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.bandArithmetic,fragmentName:"bandArithmetic"});var d=this.functionArguments.bandIndexes.trim().split(" ").map(function(c){return parseInt(c,10)});this._infraredBandID=d[0]-1;this._visibleBandID=d[1]-1;this._alterBand=2<Math.max(this._infraredBandID,this._visibleBandID)?!0:!1;a=this._setupTextureData(a.raster,this._alterBand&&2==d.length?{bandIDs:[this._infraredBandID,this._visibleBandID,
this._infraredBandID]}:{bandIDs:[d[0]-1,d[1]-1,d[2]-1]});var f=this.bindFrameBuffer(),e=this.functionArguments.method,h=2<d.length?d.slice(2):null;this._alterBand?this._setUniforms({u_method:e,u_bandId_nir:0,u_bandId_red:1,u_constants:h}):this._setUniforms({u_method:e,u_bandId_nir:d[0]-1,u_bandId_red:d[1]-1,u_constants:h});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:f.texture}}})})},"esri/layers/rasterLib/function/rasterIndex":function(){define(["dojo/_base/lang"],
function(H){return{calculate:function(k,p){if(k&&k.pixels&&k.pixels.length){var r=p&&p.bandIndexes;p=p&&p.method;var m=r.trim().split(" ").map(function(a){return parseInt(a,10)}).filter(function(a){return null!=a});k=this._clonePixelBlock(k);var l=k.pixels,b=k.mask;switch(p){case 1:l=this._calculateNDVI(b,l[m[0]-1],l[m[1]-1]);break;case 2:l=this._calculateSAVI(b,l[m[0]-1],l[m[1]-1],m[2]);break;case 3:l=this._calculateTSAVI(b,l[m[0]-1],l[m[1]-1],m[2],m[3],m[4]);break;case 4:l=this._calculateMSAVI(b,
l[m[0]-1],l[m[1]-1]);break;case 5:l=this._calculateGEMI(b,l[m[0]-1],l[m[1]-1]);break;case 6:l=this._calculatePVI(b,l[m[0]-1],l[m[1]-1],m[2],m[3]);break;case 7:l=this._calculateGVITM(b,l[m[0]-1],l[m[1]-1],l[m[2]-1],l[m[3]-1],l[m[4]-1],l[m[5]-1]);break;case 8:l=this._calculateSultan(b,l[m[0]-1],l[m[1]-1],l[m[2]-1],l[m[3]-1],l[m[4]-1],l[m[5]-1]);break;case 9:l=this._calculateVARI(b,l[m[0]-1],l[m[1]-1],l[m[2]-1]);break;case 0:l=this._calculateUserDefined(b,l,r)}k.pixels=l;k.pixelType="F32";k.calculateStatistics();
return k}},_clonePixelBlock:function(k){return k.clone?k.clone():H.clone(k)},_parseUserDefined:function(k,p){k=k.replace(" ","");0===k.indexOf("-")&&(k="0"+k);0===k.indexOf("+")&&(k=k.slice(1,k.length));k=k.split("");var r=[],m=[],l="+-*/()".split(""),b,a="";for(b=0;b<k.length;b++){var d=k[b];l.some(function(f){return f===d})?(""!==a&&m.push(parseFloat(a)),r.push(d),a=""):"b"===d.toLowerCase()?(b++,a=d.concat(k[b]),m.push(p[parseInt(a[1],10)-1]),a=""):(a=a.concat(d),b===k.length-1&&m.push(parseFloat(a)))}return{ops:r,
nums:m}},_op:function(k,p,r,m){if(r.constructor===Number&&m.constructor===Number)return r+m;var l;if(r.constructor===Number){var b=m.length;var a=r;r=new Float32Array(b);for(l=0;l<b;l++)r[l]=a}else if(b=r.length,m.constructor===Number)for(a=m,m=new Float32Array(b),l=0;l<b;l++)m[l]=a;a=new Float32Array(b);if(null==k)if("+"===p)for(l=0;l<b;l++)a[l]=r[l]+m[l];else if("-"===p)for(l=0;l<b;l++)a[l]=r[l]-m[l];else if("*"===p)for(l=0;l<b;l++)a[l]=r[l]*m[l];else{if("/"===p)for(l=0;l<b;l++)a[l]=r[l]/m[l]}else if("+"===
p)for(l=0;l<b;l++)k[l]&&(a[l]=r[l]+m[l]);else if("-"===p)for(l=0;l<b;l++)k[l]&&(a[l]=r[l]-m[l]);else if("*"===p)for(l=0;l<b;l++)k[l]&&(a[l]=r[l]*m[l]);else if("/"===p)for(l=0;l<b;l++)k[l]&&(a[l]=r[l]/m[l]);return a},_shrinkOp:function(k,p){k.splice(p,1);var r=p=0,m=0;do{for(p=m=r=0;p<k.length;p++)if("("===k[p])r=p;else if(")"===k[p]){m=p;break}m===r+1&&k.splice(r,2)}while(m===r+1);return k},_getPriorityOpIndex:function(k,p){if(1===k.length)return{opIndex:0,numIndex:0};var r=p=0,m=0,l=-1,b=0;for(p=
0;p<k.length;p++)if("("===k[p])r=p;else if(")"===k[p]){m=p;break}var a=0===m?k:k.slice(r+1,m);for(p=0;p<a.length;p++)if("*"===a[p]||"/"===a[p]){l=p;break}if(!(-1<l))for(p=0;p<a.length;p++)if("+"===a[p]||"-"===a[p]){l=p;break}0<m&&(l+=r+1);for(p=0;p<l;p++)"("===k[p]&&b++;return{opIndex:l,numIndex:l-b}},_calculateUserDefined:function(k,p,r){p=this._parseUserDefined(r,p);r=p.ops;for(var m=p.nums,l,b,a;0<r.length&&(p=this._getPriorityOpIndex(r,m),l=r[p.opIndex],b=m[p.numIndex],a=m[p.numIndex+1],l=this._op(k,
l,b,a),1!==r.length);)r=this._shrinkOp(r,p.opIndex),m.splice(p.numIndex,2,l);return[l]},_calculateNDVI:function(k,p,r){var m=r.length,l=new Float32Array(m),b;if(null==k)for(b=0;b<m;b++){var a=r[b];var d=p[b];l[b]=(d-a)/(d+a)}else for(b=0;b<m;b++)k[b]&&(a=r[b],d=p[b],l[b]=(d-a)/(d+a));return[l]},_calculateSAVI:function(k,p,r,m){var l=r.length,b=new Float32Array(l),a;if(null==k)for(a=0;a<l;a++){var d=r[a];var f=p[a];b[a]=(f-d)/(f+d+m)*(1+m)}else for(a=0;a<l;a++)k[a]&&(d=r[a],f=p[a],b[a]=(f-d)/(f+d+
m)*(1+m));return[b]},_calculateTSAVI:function(k,p,r,m,l,b){var a=r.length,d=new Float32Array(a),f=-l*m+b*(1+m*m);if(null==k)for(b=0;b<a;b++){var e=r[b];var h=p[b];d[b]=m*(h-m*e-l)/(l*h+e+f)}else for(b=0;b<a;b++)k[b]&&(e=r[b],h=p[b],d[b]=m*(h-m*e-l)/(l*h+e+f));return[d]},_calculateMSAVI:function(k,p,r){var m=r.length,l=new Float32Array(m),b;if(null==k)for(b=0;b<m;b++){var a=r[b];var d=p[b];l[b]=.5*(2*(d+1)-Math.sqrt(Math.pow(2*d+1,2)-8*(d-a)))}else for(b=0;b<m;b++)k[b]&&(l[b]=.5*(2*(d+1)-Math.sqrt(Math.pow(2*
d+1,2)-8*(d-a))));return[l]},_calculateGEMI:function(k,p,r){var m=r.length,l=new Float32Array(m),b;if(null==k)for(b=0;b<m;b++){var a=r[b];var d=p[b];d=(2*(d*d-a*a)+1.5*d+.5*a)/(d+a+.5);l[b]=d*(1-.25*d)-(a-.125)/(1-a)}else for(b=0;b<m;b++)k[b]&&(a=r[b],d=p[b],d=(2*(d*d-a*a)+1.5*d+.5*a)/(d+a+.5),l[b]=d*(1-.25*d)-(a-.125)/(1-a));return[l]},_calculatePVI:function(k,p,r,m,l){var b=r.length,a=new Float32Array(b),d,f=Math.sqrt(1+m*m);if(null==k)for(d=0;d<b;d++){var e=r[d];var h=p[d];a[d]=(h-m*e-l)/f}else for(d=
0;d<b;d++)k[d]&&(e=r[d],h=p[d],a[d]=(h-m*e-l)/f);return[a]},_calculateGVITM:function(k,p,r,m,l,b,a){var d=p.length,f=new Float32Array(d),e;if(null==k)for(e=0;e<d;e++)f[e]=-.2848*p[e]-.2435*r[e]-.5436*m[e]+.7243*l[e]+.084*b[e]-1.18*a[e];else for(e=0;e<d;e++)k[e]&&(f[e]=-.2848*p[e]-.2435*r[e]-.5436*m[e]+.7243*l[e]+.084*b[e]-1.18*a[e]);return[f]},_calculateSultan:function(k,p,r,m,l,b,a){r=p.length;var d=new Float32Array(r),f=new Float32Array(r),e=new Float32Array(r),h;if(null==k)for(h=0;h<r;h++)d[h]=
b[h]/a[h]*100,f[h]=b[h]/p[h]*100,e[h]=m[h]/l[h]*(b[h]/l[h])*100;else for(h=0;h<r;h++)k[h]&&(d[h]=b[h]/a[h]*100,f[h]=b[h]/p[h]*100,e[h]=m[h]/l[h]*(b[h]/l[h])*100);return[d,f,e]},_calculateVARI:function(k,p,r,m){var l=p.length,b=new Float32Array(l),a;if(null==k)for(a=0;a<l;a++){var d=p[a];var f=r[a];var e=m[a];b[a]=(f-d)/(f+d-e)}else for(a=0;a<l;a++)if(k[a])for(a=0;a<l;a++)d=p[a],f=r[a],e=m[a],b[a]=(f-d)/(f+d-e);return[b]}}})},"esri/layers/rasterLib/function/ColormapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(H,k,p,r,m,l,b){return H([r,l],{declaredClass:"esri.layers.rasterLib.function.ColormapFunction",functionName:"Colormap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({colormap:null,colorRampName:null,colorRamp:null,colorMapName:null,raster:null},a);this.invert=a&&a.invert;a=a.colormap||a.Colormap;if(a){if(a.features||a[0].attributes){a=a.features||a;var d=Object.keys(a[0].attributes);var f=d.filter(function(q){return"alpha"===
q.toLowerCase()})[0];var e=d.filter(function(q){return"value"===q.toLowerCase()})[0];var h=d.filter(function(q){return"red"===q.toLowerCase()})[0];var c=d.filter(function(q){return"green"===q.toLowerCase()})[0];var g=d.filter(function(q){return"blue"===q.toLowerCase()})[0];if(!(e&&h&&c&&g))throw"invalid colormap";a=a.map(function(q){return f?[q.attributes[e],q.attributes[h],q.attributes[c],q.attributes[g],q.attributes[f]]:[q.attributes[e],q.attributes[h],q.attributes[c],q.attributes[g]]});var n=1.1>
Math.max.apply(null,a.map(function(q){return q[1]}));d=f&&1.1>Math.max.apply(null,a.map(function(q){return q[4]}));if(n)for(n=0;n<a.length;n++)a[n][1]=Math.round(255*a[n][1]),a[n][2]=Math.round(255*a[n][2]),a[n][3]=Math.round(255*a[n][3]),d&&(a[n][4]=Math.round(255*a[n][4]))}this.functionArguments.colormap=this._sortClr(a)}this._initialize()},bind:function(a){this._initialize();a=this.getSourceRasterInfo(a);if(!a.raster||"F32"===a.raster.pixelType)return Error("The raster input to colormap function is invalid. It must be integer type.");
this.rasterInfo=k.mixin(a.raster,{bandCount:3,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){return this._colorize(a.raster)},readGL:function(a){return this._colorizeGL(a.raster)},_colorize:function(a){this._performance.start();var d=b.colorize(a.pixelBlock,{indexedColormap:this._indexedColormap,indexedColormapOffset:this._indexedColormapOffset,
indexed2DColormap:this._indexed2DColormap,alphaSpecified:this._alphaSpecified});this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,pixelBlock:d}},_binarySearchClr:function(a,d){for(var f=0,e=a.length-1,h=0,c=0;f<e;)if(h=Math.floor((f+e)/2),c=a[h],c[0]<d)f=h;else if(c[0]>d)e=h;else return c.slice(1);return null},_sortClr:function(a,d){var f,e=[];for(f=0;f<a.length;f++)e.push(a[f]);for(f=0;f<e.length-1;f++){var h=e[f];for(a=f+1;a<e.length;a++)h[0]>e[a][0]&&(h=e[a],e[a]=e[f],
e[f]=h)}if(d)for(f=0;f<e.length/2;f++)h=e[f],e[e.length-1-f]=e[f],e[f]=h;return e},_invertColorRamp:function(a){if(!a)return a;var d={type:a.type};"random"===a.type?d=a:"multipart"===a.type?d.colorRamps=a.colorRamps.map(function(f){return{fromColor:f.toColor,toColor:f.fromColor}}).reverse():(d.fromColor=a.toColor,d.toColor=a.fromColor);return d},_initialize:function(){this._indexedColormapOffset=0;if(this.functionArguments.colormap){var a=b.buildIndexedColormap(this.functionArguments.colormap);this._alphaSpecified=
a&&a.alphaSpecified;this._indexedColormap=a&&a.indexedColormap;this._indexedColormapOffset=a&&a.offset;this._indexedColormap||(this._indexed2DColormap=this._getIndexed2DColormap())}else this.functionArguments.colorRamp?this._indexedColormap="multipart"===this.functionArguments.colorRamp.type?this.invert?p.createMultiPartColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):p.createMultiPartColorRamp(this.functionArguments.colorRamp):this.invert?p.createAlgorithmicColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):
p.createAlgorithmicColorRamp(this.functionArguments.colorRamp):this.functionArguments.colormapName&&"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=p.createRandomColorRamp())},_getIndexed2DColormap:function(){var a=this.functionArguments.colormap;if(!a)return null;var d=0;0>a[0][0]&&(d=a[0][0]);var f=[],e=5===a[0].length,h;for(h=0;h<a.length;h++)f[a[h][0]-d]=e?a[h].slice(1):a[h].slice(1).concat([255]);return f},_colorizeGL:function(a){this._performance.start();
this._initializeProgram({fragment:m.colormap,fragmentName:"Colormap"});var d=this._indexedColormap,f=this._indexedColormapOffset;this._clrTexture||(this._clrTexture=this._setupColormapTexture(d));var e=this._clrTexture,h=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:f,u_indexedColormapMaxIndex:d.length/4-1});this._bindTexture(e,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:h.texture}},_setupColormapTexture:function(a){var d=
this._createTexture(),f=this.gl,e=a.length/4,h=new Float32Array(a.length),c,g=this.renderTexture?255:1;for(c=0;c<a.length;c++)h[c]=a[c]/g;f.getExtension("OES_texture_float");f.texImage2D(f.TEXTURE_2D,0,f.RGBA,e,1,0,f.RGBA,f.FLOAT,h);return d}})})},"esri/renderers/colorRampGenerator":function(){define(["dojo/_base/declare","dojo/_base/lang","../renderers/colorUtils"],function(H,k,p){return{createAlgorithmicColorRamp:function(r,m){if(!r)return null;var l=r.fromColor,b=r.toColor;if(!l||!b)return null;
void 0===l.r&&3<=l.length&&(l={r:l[0],g:l[1],b:l[2]});void 0===b.r&&3<=b.length&&(b={r:b[0],g:b[1],b:b[2]});var a=r.size||256;r=r.algorithm||"cie-lab";if(1===a)var d=[l.r,l.g,l.b,255];else if(2===a)d=[l.r,l.g,l.b,255,b.r,b.g,l.b,255];else if(-1<r.toLowerCase().indexOf("hsv")){d=p.toHSV(l);b=p.toHSV(b);a=a||256;var f=0===d.s,e=0===b.s;l=d.h;r=b.h;f&&!e?l=d.h=r:e&&!f&&(r=b.h=l);f=Math.abs(r-l);180>f?r=(r-l)/(a-1):(f=360-f,r=l>r?f/(a-1):-f/(a-1));f=(b.s-d.s)/(a-1);e=(b.v-d.v)/(a-1);var h=d.s;d=d.v;var c,
g=new Uint8Array(4*a);for(c=0;c<a-1;c++){var n=p.toRGB({h:l,s:h,v:d});g[4*c]=n.r;g[4*c+1]=n.g;g[4*c+2]=n.b;g[4*c+3]=255;l+=r;h+=f;d+=e;360<l?l-=360:0>l&&(l+=360)}n=p.toRGB(b);g[4*(a-1)]=n.r;g[4*(a-1)+1]=n.g;g[4*(a-1)+2]=n.b;g[4*(a-1)+3]=255;d=g}else if(-1<r.toLowerCase().indexOf("lch")){h=p.toLCH(l);b=p.toLCH(b);a=a||256;d=(b.l-h.l)/(a-1);l=(b.c-h.c)/(a-1);r=(b.h-h.h)/(a-1);f=h.l;e=h.c;h=h.h;g=new Uint8Array(4*a);for(c=0;c<a-1;c++)n=p.toRGB({l:f,c:e,h:h}),g[4*c]=n.r,g[4*c+1]=n.g,g[4*c+2]=n.b,g[4*
c+3]=255,f+=d,e+=l,h+=r;n=p.toRGB(b);g[4*(a-1)]=n.r;g[4*(a-1)+1]=n.g;g[4*(a-1)+2]=n.b;g[4*(a-1)+3]=255;d=g}else if(-1<r.toLowerCase().indexOf("lab")){h=p.toLAB(l);b=p.toLAB(b);a=a||256;d=(b.l-h.l)/(a-1);l=(b.a-h.a)/(a-1);r=(b.b-h.b)/(a-1);f=h.l;e=h.a;h=h.b;g=new Uint8Array(4*a);for(c=0;c<a-1;c++)n=p.toRGB({l:f,a:e,b:h}),g[4*c]=n.r,g[4*c+1]=n.g,g[4*c+2]=n.b,g[4*c+3]=255,f+=d,e+=l,h+=r;n=p.toRGB(b);g[4*(a-1)]=n.r;g[4*(a-1)+1]=n.g;g[4*(a-1)+2]=n.b;g[4*(a-1)+3]=255;d=g}if(m&&!1===m.flattened)for(m=d,
d=[],b=0;b<d/4;b++)d[b]=m.slice(4*b,4*b+4);return d},createMultiPartColorRamp:function(r,m){if(!r)return null;m=m&&k.clone(m)||{flattened:!0};var l=r.colorRamps;if(!l||0===l.length)return null;var b=r.size||256;r=Math.max(Math.floor(b/l.length),1);var a=Math.max(r,b-(l.length-1)*r),d=!1!==m.flattened;m.flattened=!0;b=(l.length-1)*r+a;var f=new Uint8Array(4*b);for(b=0;b<l.length;b++){var e={fromColor:l[b].fromColor,toColor:l[b].toColor,size:b===l.length-1?a:r};f instanceof Array?f.concat(this.createAlgorithmicColorRamp(e,
m)):f.set(this.createAlgorithmicColorRamp(e,m),r*b*4)}if(!d)for(m=f,f=[],b=0;b<f/4;b++)f[b]=m.slice(4*b,4*b+4);return f},createRandomColorRamp:function(r){r=r||{};var m=r.size||256,l=!1===r.flattened;var b=l?new Uint8Array(4*m):[];for(r=0;r<m;r++)l?(b[4*r]=Math.round(255*Math.random()),b[4*r+1]=Math.round(255*Math.random()),b[4*r+2]=Math.round(255*Math.random()),b[4*r+3]=255):b[r]=[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()),255];return b}}})},"esri/layers/rasterLib/function/rasterUtils":function(){define(["dojo/_base/lang"],
function(H){return{mask:function(k,p){if(k&&k.pixels&&k.pixels.length){k=this._clonePixelBlock(k);var r=p.includedRanges,m=p.noDataInterpretation;p=p.noDataValues;if(null===r&&null===p)return k;var l=k.pixels,b=k.mask,a=k.width*k.height,d=l.length,f;if(null!==p&&p.length!==d)throw"expect "+d+" elements in noDataValues";if(null!==r&&r.length!==2*d)throw"expect "+2*d+" elements in IncludeRanges";if(null==b){b=new Uint8Array(a);for(f=0;f<a;f++)b[f]=1;k.mask=b}if(0===m)for(m=0;m<d;m++){var e=l[m];var h=
null===r?null:r[2*m];var c=null===r?null:r[2*m+1];var g=null===p?null:parseFloat(p[m]);if(null===h||null===c)for(f=0;f<a;f++){if(b[f]){var n=e[f];n===g&&(b[f]=0)}}else if(null===g)for(f=0;f<a;f++)b[f]&&(n=e[f],n<h||n>c)&&(b[f]=0);else for(f=0;f<a;f++)b[f]&&(n=e[f],n<h||n>c||n===g)&&(b[f]=0)}else{var q=new Uint8Array(a);for(f=0;f<a;f++)q[f]=b[f];for(m=0;m<d;m++)if(e=l[m],h=null===r?null:r[2*m],c=null===r?null:r[2*m+1],g=null===p?null:parseFloat(p[m]),null===h||null===c)for(f=0;f<a;f++)q[f]&&(n=e[f],
n!==g&&(q=0));else if(null===g)for(f=0;f<a;f++)q[f]&&(n=e[f],n<=h&&n<=c&&(q=0));else for(f=0;f<a;f++)q[f]&&(n=e[f],n<=h&&n<=c&&n!==g&&(q=0));for(f=0;f<a;f++)b[f]&&q[f]&&(b[f]=0)}return k}},calculateStatisticsHistograms:function(k,p){k=this._clonePixelBlock(k);p=k.pixelType;var r=k.pixels,m=k.mask,l=r.length,b,a,d=[],f;for(b=0;b<l;b++){var e={min:-.5,max:255.5,size:256,counts:new Uint32Array(256)};var h=e.counts;var c=r[b];if("U8"===p)if(m)for(a=0;a<k.width*k.height;a++)m[a]&&h[c[a]]++;else for(a=
0;a<k.width*k.height;a++)h[c[a]]++;else{var g=k.statistics[b].minValue;var n=k.statistics[b].maxValue;e.min=g;e.max=n;n=(n-g)/256;var q=new Uint32Array(257);if(m)for(a=0;a<k.width*k.height;a++)m[a]&&q[Math.floor((c[a]-g)/n)]++;else for(a=0;a<k.width*k.height;a++)q[Math.floor((c[a]-g)/n)]++;for(a=0;255>a;a++)h[a]=q[a];h[255]=q[255]+q[256]}d.push(e);g=k.statistics[b].minValue;n=k.statistics[b].maxValue;for(a=q=f=c=0;a<e.size;a++)c+=h[a],f+=a*h[a];f/=c;for(a=0;a<e.size;a++)q+=h[a]*Math.pow(a-f,2);h=
Math.sqrt(q/(c-1));a=(f+.5)*(e.max-e.min)/e.size+e.min;e=h*(e.max-e.min)/e.size;k.statistics[b]={min:g,minValue:g,max:n,maxValue:n,mean:a,stddev:e}}k.histograms=d;return k},buildIndexedColormap:function(k,p){if(!k)return null;var r=0;0>k[0][0]&&(r=k[0][0]);var m=Math.max(256,k[k.length-1][0]-r);if(65536<m)return null;var l=new Uint8Array(4*m),b=[],a=0,d=5===k[0].length;if(p)for(b=k[a],p=b[0]-r;p<m;p++)l[4*p]=b[1],l[4*p+1]=b[2],l[4*p+2]=b[3],l[4*p+3]=d?b[4]:255,p===b[0]-r&&(b=a===k.length-1?b:k[++a]);
else for(p=0;p<k.length;p++)b=k[p],a=4*(b[0]-r),l[a]=b[1],l[a+1]=b[2],l[a+2]=b[3],l[a+3]=d?b[4]:255;return{indexedColormap:l,offset:r,alphaSpecified:d}},colorize:function(k,p){if(null!==k&&null!==k.pixels){k=this._clonePixelBlock(k);var r=k.pixels,m=k.width*k.height,l=k.mask,b=p.indexedColormap,a=p.indexedColormapOffset,d=b&&b.length-1,f=p.indexed2DColormap;p=p.alphaSpecified;if(3<=r.length)throw"colormap only works on single band image";var e=r[0],h=new Uint8Array(e.length),c=new Uint8Array(e.length),
g=new Uint8Array(e.length),n=0;if(b)if(l)for(r=0;r<m;r++)l[r]&&(n=4*(e[r]-a),n<a||n>d?l[r]=0:(h[r]=b[n],c[r]=b[n+1],g[r]=b[n+2],l[r]=b[n+3]));else{l=new Uint8Array(m);for(r=0;r<m;r++)n=4*(e[r]-a),n<a||n>d?l[r]=0:(h[r]=b[n],c[r]=b[n+1],g[r]=b[n+2],l[r]=b[n+3]);k.mask=l}else if(l)for(r=0;r<m;r++)l[r]&&(b=f[e[r]],h[r]=b[0],c[r]=b[1],g[r]=b[2],l[r]=b[3]);else{l=new Uint8Array(m);for(r=0;r<m;r++)b=f[e[r]],h[r]=b[0],c[r]=b[1],g[r]=b[2],l[r]=b[3];k.mask=l}k.pixels=[h,c,g];k.statistics=null;k.pixelType="U8";
k.maskIsAlpha=p;return k}},convolute:function(k,p){k=this._clonePixelBlock(k);var r=k.pixels,m=k.width,l=k.height,b=m*l,a=r.length,d,f,e,h,c=[],g=[],n=p.normalizedKernel,q=p.kernelRows,v=p.kernelCols;for(p=0;p<a;p++){var u=r[p];var t=new Float32Array(b);t.set(u);for(e=1;e<l-1;e++){var y=e*m;for(h=1;h<m-1;h++){for(d=g=0;d<q;d++)for(f=0;f<v;f++)g+=u[y+h+(d-1)*m+f-1]*n[d*v+f];t[y+h]=g}}c.push(t)}k.pixels=c;return k},contrastBrightnessStretch:function(k,p){if(null!==k&&null!==k.pixels){k=this._clonePixelBlock(k);
var r=k.pixels,m=k.mask,l=k.width*k.height,b=r.length;var a=p&&p.contrastOffset;p=p&&p.brightnessOffset;if("U8"!==k.pixelType)throw"the contrast and brightness function only supports 8 bit unsigned integer data";var d=this._createContrastBrightnessLUT(a,p);if(null==m)for(a=0;a<l;a++)for(p=0;p<b;p++)r[p][a]=d[r[p][a]];else for(a=0;a<l;a++)if(m[a])for(p=0;p<b;p++)r[p][a]=d[r[p][a]];k.pixelType="U8";return k}},isNull:function(k,p){if(null!==k&&null!==k.pixels){k=this._clonePixelBlock(k);p=k.mask;var r=
k.pixels[0],m=r.length,l;if(p){for(l=0;l<m;l++)r[l]=p[l]?0:1;k.mask=null}else if(r.fill)r.fill(0);else for(l=0;l<m;l++)r[l]=0;return k}},setNull:function(k){if(null!==p&&null!==p.pixels){var p=this._clonePixelBlock(k);k=p.mask;var r=p.pixels[0],m=r.length,l;k=k||new Uint8Array(m);for(l=0;l<m;l++)k[l]=r[l]?0:1;p.mask=k;return p}},local:function(k,p){if(!p)return k[0];var r=p.rasterCountNeeded;p=p.functor;var m=this._clonePixelBlock(k[0]);if(null!==m&&null!==m.pixels){var l=m.width*m.height,b;k=(b=
k[1])&&b.pixels[0];var a=b&&b.mask,d=m.mask,f=m.pixels[0];if(2===r)if(!d&&a)d=a;else if(d&&a)for(b=0;b<l;b++)d[b]=d[b]&&a[b]?1:0;m.mask=d;if(1===r)if(null==d)for(b=0;b<l;b++)f[b]=p(f[b]);else for(b=0;b<l;b++)d[b]&&(f[b]=p(f[b]));else if(2===r)if(null==d)for(b=0;b<l;b++)f[b]=p(f[b],k[b]);else for(b=0;b<l;b++)d[b]&&(f[b]=p(f[b],k[b]));m.mask=d;m.calculateStatistics();return m}},remapColor:function(k,p){k=this._clonePixelBlock(k);var r=k.width*k.height,m=p.length,l=Math.floor(m/2),b=p[Math.floor(l)],
a=p[0].value,d=p[p.length-1].value,f=k.pixels[0],e,h,c=!1,g=new Uint8Array(r),n=new Uint8Array(r),q=new Uint8Array(r),v=k.mask,u=4===p[0].mappedColor.length;v&&0!==v.length||(v=new Uint8Array(r),v.fill(u?255:1),k.mask=v);for(h=0;h<r;h++)if(v[h]){var t=f[h];if(t<a||t>d)g[h]=n[h]=q[h]=v[h]=0;else{c=!1;var y=l;var D=b;var B=0;for(e=m-1;1<e-B;){if(t===D.value){c=!0;break}t>D.value?B=y:e=y;y=Math.floor((B+e)/2);D=p[Math.floor(y)]}c||(D=t===p[e].value?p[e]:p[B]);g[h]=D.mappedColor[0];n[h]=D.mappedColor[1];
q[h]=D.mappedColor[2];v[h]=D.mappedColor[3]}}k.pixels=[g,n,q];k.mask=v;k.pixelType="u8";k.maskIsAlpha=u;return k},_clonePixelBlock:function(k){if(k.clone)return k.clone();var p=H.clone(k),r;if(k.pixels&&k.pixels[0]&&0<k.pixels[0].length&&!(p.pixels&&p.pixels[0]&&0<p.pixels[0].length)){p.pixels=[];var m=k.pixels.length;for(r=0;r<m;r++)p.pixels[r]=new k.pixels[r].constructor(k.pixels[r])}if(k.statistics)for(p.statistics=[],m=k.statistics.length,r=0;r<m;r++)p.statistics[r]=H.clone(k.statistics[r]);k.mask&&
(p.mask=new Uint8Array(k.mask));return p},_createContrastBrightnessLUT:function(k,p){if(this._contrastCache&&this._contrastCache.contrastOffset===k&&this._contrastCache.brightnessOffset===p)return this._contrastCache.lut;var r=Math.min(Math.max(k,-100),100),m=Math.min(Math.max(p,-100),100),l,b=new Uint8Array(256);for(l=0;256>l;l++){if(0<r&&100>r)var a=(200*l-25500+510*m)/(2*(100-r))+128;else 0>=r&&-100<r?a=(200*l-25500+510*m)*(100+r)/2E4+128:100===r?(a=200*l-25500+256*(100-r)+510*m,a=0<a?255:0):-100===
r&&(a=128);b[l]=255<a?255:0>a?0:a}this._contrastCache={contrastOffset:k,brightnessOffset:p,lut:b};return b}}})},"esri/layers/rasterLib/function/CompositeBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(H,k,p,r,m,l){return H([p,l],{declaredClass:"esri.layers.rasterLib.function.CompositeBandFunction",functionName:"CompositeBand",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=
this.mixinIgnoreCase({rasters:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.rasters)return Error("The rasters input to composite band function is invalid.");var a=[],d=[],f=b.rasters.length,e;if(b.rasters[0].statistics)for(e=0;e<f;e++)a.push(b.rasters[e].statistics[0]);if(b.rasters[0].histograms)for(e=0;e<f;e++)d.push(b.rasters[e].histograms[0]);this.rasterInfo=k.mixin(b.rasters[0],{bandCount:f,pixelType:this._calculatePixelType(this.pixelType,b.rasters[0].pixelType),statistics:a,
histograms:d});return!0},read2D:function(b){b=b.rasters;if(null!=b&&0!==b.length){var a=this._clonePixelData(b[0]),d=a.pixelBlock,f=[],e=[];for(h=0;h<b.length;h++)f.push(b[h].pixelBlock.pixels[0]),e.push(b[h].pixelBlock.statistics[0]);d.pixels=f;d.stackedStatistics=e;d.planes=b.length;var h;e=d.width*d.height;for(h=0;h<b.length;h++)if(d=b[h].pixelBlock.mask,c&&d)for(f=0;f<e;f++)c[f]&=d[f];else var c=c||d;a.maks=c;return a}},readGL:function(b){this._performance.start();this._initializeProgram({fragment:m.compositeBand,
fragmentName:"CompositeBand"});var a=b.rasters;if(null!=a&&0!==a.length){a=a.length;var d,f=this.bindFrameBuffer();for(d=0;d<a;d++){var e=this._setupTextureData(b.rasters[d],{notOriginal:0<d});var h=0<d?d.toString():"";this._bindTexture(e.texture,"u_image"+h)}this._setUniforms({u_rasterCount:a});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:e.extent,texture:f.texture}}}})})},"esri/layers/rasterLib/function/ContrastBrightnessFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(H,k,p,r,m,l,b){return H([p,l],{declaredClass:"esri.layers.rasterLib.function.ContrastBrightnessFunction",renderTexture:!0,functionName:"ContrastBrightness",supportWebGL:!0,support2D:!0,pixelType:"U8",constructor:function(a){this.functionArguments=this.mixinIgnoreCase({contrastOffset:0,brightnessOffset:0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to contrast and brightness function is invalid.");this.rasterInfo=k.mixin(a.raster,
{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){a=a.raster;if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var d=b.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.functionArguments.contrastOffset,brightnessOffset:this.functionArguments.brightnessOffset});"Unknown"!==
this.pixelType&&(d.pixelType=this.pixelType,d.pixels=d.pixels.map(k.hitch(this,function(f){return this._clampBand(f,d.pixelType)})));return{extent:a.extent,pixelBlock:d}}},readGL:function(a){return this._cbGL(a.raster)},_cbGL:function(a){this._performance.start();this._initializeProgram({fragment:m.contrastBrightness,fragmentName:"ContrastBrightness"});a=this._setupTextureData(a);this._setUniforms({u_contrastOffset:Math.min(Math.max(this.functionArguments.contrastOffset,-100),100),u_brightnessOffset:Math.min(Math.max(this.functionArguments.brightnessOffset,
-100),100),u_scaleFactor:this.renderTexture?255:1});this._bindTexture(a.texture,"u_image");var d=this.bindFrameBuffer();this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:d.texture}}})})},"esri/layers/rasterLib/function/ConvolutionFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./convolutionKernel ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(H,k,p,r,m,l,b,a){return H([p,
b],{declaredClass:"esri.layers.rasterLib.function.ConvolutionFunction",functionName:"Convolution",supportWebGL:!0,support2D:!0,constructor:function(d){this.functionArguments=this.mixinIgnoreCase({columns:3,rows:3,type:0,kernel:null,raster:null},d)},bind:function(d){d=this.getSourceRasterInfo(d);if(!d.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=k.mixin(d.raster,{bandCount:d.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,d.raster.pixelType),
statistics:d.raster.statistics,histograms:d.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(d){this._performance.start();d=d.raster;var f=this._analyzeKernel(),e=a.convolute(d.pixelBlock,{normalizedKernel:f.normalizedKernel,kernelCols:this.functionArguments.columns,kernelRows:this.functionArguments.rows});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&
(e.pixelType=this.pixelType);e.pixels=e.pixels.map(k.hitch(this,function(h){return this._clampBand(h,e.pixelType)}));return{extent:d.extent,pixelBlock:e}},readGL:function(d){this._performance.start();this._initializeProgram({fragment:l.convolution,fragmentName:"Convolution"});var f=this._setupTextureData(d.raster),e=this.bindFrameBuffer(),h=this.gl,c=h.drawingBufferWidth;h=h.drawingBufferHeight;var g=this.functionArguments.kernel;this._setUniforms({u_resolution:d&&d.raster&&d.raster.pixelBlock?[1/
d.raster.pixelBlock.width,1/d.raster.pixelBlock.height]:[1/c,1/h],u_kernel:g,u_kernelSize:g.length});this._bindTexture(f.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:f.extent,texture:e.texture}},_analyzeKernel:function(){var d=this.functionArguments.kernel,f=d.reduce(function(c,g){return c+g});0!==f&&1!==f&&(d=d.map(function(c){return c/f}));var e,h=[];for(e=0;e<d.length;e++)h.some(function(c){return c===d[e]})||h.push(d[e]);return{normalizedKernel:d,
distinctValues:h}},_analyzeKernelPattern:function(){var d=this.functionArguments.rows,f=this.functionArguments.columns,e=this.functionArguments.kernel,h=[],c,g;for(c=0;c<d;c++)h.push({weights:e.slice(c*f,(c+1)*f)});var n;for(c=1;c<d;c++){var q=h[c].weights;for(e=0;e<c;e++)if(n=h[e].weights){var v=q[0]/n[0];for(g=1;g<f;g++)q[g]/n[g]!==v&&(v=null);null!==v&&(h[c]={row:e,factor:v})}}return h}})})},"esri/layers/rasterLib/function/ExtractBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),
function(H,k,p,r,m,l){return H([p,l],{declaredClass:"esri.layers.rasterLib.function.ExtractBandFunction",functionName:"ExtractBand",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({bandIDs:[],missingBandAction:0,raster:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.raster)return Error("The raster input to extract band function is invalid.");var a=[],d=b.raster.statistics,f=[],e=b.raster.histograms,h=this.functionArguments.bandIDs.length||
b.raster.bandCount;this.functionArguments.bandIDs.forEach(k.hitch(this,function(c){if(c>=h-1){if(1===this.functionArguments.missingBandAction)return Error("missing band "+c);c=h-1}if(0>c)return Error("missing band "+c);void 0!==d&&null!==d&&0<d.length&&a.push(d[c]);void 0!==e&&null!==e&&0<e.length&&f.push(e[c])}));this.rasterInfo=k.mixin(b.raster,{bandCount:h,pixelType:this._calculatePixelType(this.pixelType,b.raster.pixelType),statistics:a,histograms:f});return!0},read2D:function(b){b=this._clonePixelData(b.raster);
if(null!==b&&null!==b.pixelBlock&&null!==b.pixelBlock.pixels){this._performance.start();var a=b.pixelBlock,d=a.statistics,f=a.pixels,e=f.length;if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(0===this.functionArguments.bandIDs.length)return b;var h=[],c=[];this.functionArguments.bandIDs.forEach(function(g){if(g>=e-1){if(1===this.functionArguments.missingBandAction)throw"missing band "+g;g=e-1}if(0>g)throw"missing band "+g;h.push(f[g]);void 0!==d&&null!==d&&0<d.length&&
c.push(d[g])});a.pixels=h;a.statistics=c;a.planes=this.functionArguments.bandIDs.length;return b}},readGL:function(b){this._performance.start();if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(3<this.functionArguments.bandIDs.length)throw"this version does not support more than 3 bands yet";this._initializeProgram({fragment:m.extractBand,fragmentName:"ExtractBand"});var a=this.functionArguments.bandIDs;1===a.length&&(a=[a[0],a[0],a[0]]);this._bandIDs=a;this._alterBand=!(0===
this.functionArguments.bandIDs.length||0===a[0]&&1===a[1]&&2===a[2]);var d=!!(this._alterBand&&b.raster&&b.raster.texture);b=this._setupTextureData(b.raster,{bandIDs:a});var f=this.bindFrameBuffer();d?this._setUniforms({u_bandIDs:a,u_alterBand:this._alterBand}):this._setUniforms({u_bandIDs:a,u_alterBand:!1});this._bindTexture(b.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:b.extent,texture:f.texture}}})})},"esri/layers/rasterLib/function/HillshadeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../renderers/colorRampGenerator ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils ./rasterUtils".split(" "),
function(H,k,p,r,m,l,b,a,d,f){return H([p,a],{declaredClass:"esri.layers.rasterLib.function.HillshadeFunction",functionName:"Hillshade",supportWebGL:!0,support2D:!0,renderTexture:!0,constructor:function(e){this.functionArguments=this.mixinIgnoreCase({hillshadeType:0,altitude:45,azimuth:315,zFactor:1,slopeType:1,psPower:.664,psFactor:.024,colorRamp:null,raster:null},e);this._azimuths=[315,270,225,360,180,0];this._altitudes=[60,60,60,60,60,90];this._weights=[3,5,3,2,1,4];var h=this._weights.reduce(function(c,
g){return c+g});this._weights=this._weights.map(function(c){return c/h})},bind:function(e){e=this.getSourceRasterInfo(e);if(!e.raster)return Error("The raster input to hillshade function is invalid.");e.raster.statistics&&(this.srcStatistics=e.raster.statistics);this.rasterInfo=k.mixin(e.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:[{min:0,max:255}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=
"Generic";this._initializeColormap();return!0},read2D:function(e){this._performance.start();e=e.raster;e=d.hillshade(e,{altitude:this.functionArguments.altitude,azimuth:this.functionArguments.azimuth,zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,hillshadeType:this.functionArguments.hillshadeType,slopeType:this.functionArguments.slopeType,isGCS:e.extent.spatialReference.wkid&&null==m[e.extent.spatialReference.wkid]});this._addPerformanceMetric(this._performance.elapsed());
return e},readGL:function(e){this._performance.start();this._initializeProgram({fragment:b.hillshade,fragmentName:"Hillshade"});this.functionArguments.colorRamp&&this._indexedColormap&&!this._clrTexture&&(this._clrTexture=this._setupColormapTexture(this._indexedColormap));var h=this._setupTextureData(e.raster),c=this.bindFrameBuffer(),g=this.gl,n=g.drawingBufferWidth;g=g.drawingBufferHeight;var q=h.extent,v=(q.xmax-q.xmin)/n,u=(q.ymax-q.ymin)/g,t=this.functionArguments.altitude,y=this.functionArguments.azimuth,
D=this.functionArguments.zFactor;1===this.functionArguments.hillshadeType&&(D*=2);var B=D/(8*v),E=D/(8*u);.001<D&&q.spatialReference.wkid&&null==m[q.spatialReference.wkid]&&(B/=111E3,E/=111E3);var x=this.functionArguments.psPower,w=this.functionArguments.psFactor;3===this.functionArguments.slopeType&&((B=q.spatialReference.wkid&&null==m[q.spatialReference.wkid])?(B=111E3*v,E=111E3*u,B=(D+Math.pow(B,x)*w)/(8*B),E=(D+Math.pow(E,x)*w)/(8*E)):(B=(D+Math.pow(v,x)*w)/(8*v),E=(D+Math.pow(u,x)*w)/(8*u)));
var A=(90-t)*Math.PI/180;t=Math.cos(A);var z=(360-y+90)*Math.PI/180;y=Math.sin(A)*Math.cos(z);A=Math.sin(A)*Math.sin(z);x=Array(6);w=Array(6);q=Array(6);var G=this._weights,I;if(1===this.functionArguments.hillshadeType){var K=this._azimuths.length;for(I=0;I<K;I++)t=this._altitudes[I],y=this._azimuths[I],A=(90-t)*Math.PI/180,t=Math.cos(A),z=(360-y+90)*Math.PI/180,y=Math.sin(A)*Math.cos(z),A=Math.sin(A)*Math.sin(z),x[I]=t,w[I]=y,q[I]=A}else x[0]=t,w[0]=y,q[0]=A;x=x.map(function(R){return parseFloat(R)});
w=w.map(function(R){return parseFloat(R)});q=q.map(function(R){return parseFloat(R)});this._setUniforms({u_cellSize:[v,u],u_zfactor:D,u_xFactor:B,u_yFactor:E,u_sinZcosA:y,u_sinZsinA:A,u_cosZ:t,u_sinZcosAs:w,u_sinZsinAs:q,u_cosZs:x,u_weights:G,u_hillshadeType:this.functionArguments.hillshadeType,u_resolution:e&&e.raster&&e.raster.pixelBlock?[1/e.raster.pixelBlock.width,1/e.raster.pixelBlock.height]:[1/n,1/g],u_scaled:!this.renderTexture,u_applyColorramp:this._clrTexture?!0:!1,u_minValue:this.srcStatistics[0].min,
u_maxValue:this.srcStatistics[0].max,u_indexedColormapOffset:this._indexedColormapOffset||0,u_indexedColormapMaxIndex:this._indexedColormap?this._indexedColormap.length/4-1:0});this._clrTexture&&this._bindTexture(this._clrTexture,"u_image1");this._bindTexture(h.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:h.extent,texture:c.texture}},_initializeColormap:function(){this._indexedColormapOffset=0;var e=this._indexedColormap,h=this.functionArguments.colorRamp;
this.functionArguments.colormap?(this._alphaSpecified=(h=f.buildIndexedColormap(this.functionArguments.colormap))&&h.alphaSpecified,this._indexedColormap=h&&h.indexedColormap,this._indexedColormapOffset=h&&h.offset):h?(this._indexedColormap="multipart"===h.type?this.invert?r.createMultiPartColorRamp(this._invertColorRamp(h)):r.createMultiPartColorRamp(h):this.invert?r.createAlgorithmicColorRamp(this._invertColorRamp(h)):r.createAlgorithmicColorRamp(h),h.fromColor&&h.toColor&&"000"===h.fromColor.slice(0,
3).join("")&&"255255255"===h.toColor.slice(0,3).join("")&&(this._clrTexture=this._indexedColormap=null)):this.functionArguments.colormapName?"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=r.createRandomColorRamp()):this._clrTexture=this._indexedColormap=null;if(e&&this._indexedColormap){h=!0;for(var c=0;c<e.length;c++)if(e[c]!==this._indexedColormap[c]){h=!1;break}h||(this._clrTexture=null)}},_setupColormapTexture:function(e){var h=this._createTexture(),c=this.gl,
g=e.length/4,n=new Float32Array(e.length),q;for(q=0;q<e.length;q++)n[q]=e[q]/255;c.getExtension("OES_texture_float");c.texImage2D(c.TEXTURE_2D,0,c.RGBA,g,1,0,c.RGBA,c.FLOAT,n);return h}})})},"esri/layers/rasterLib/function/LocalFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(H,k,p,r,m,l,b){return H([p,l],{declaredClass:"esri.layers.rasterLib.function.LocalFunction",functionName:"Local",
supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({operation:null,rasters:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);var d=0;a.raster?d=a.raster.bandCount:a.rasters&&(d=Math.max.apply(null,a.rasters.map(function(f){return f.bandCount})));if(0===d)return Error("The raster input to local function is invalid. It only takes single band input.");a=a.raster||a.rasters.filter(function(f){return!!f.extent})[0];this.rasterInfo=k.mixin(a,{bandCount:1,
pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){var d=[];d=a.raster?a.raster2?[a.raster,a.raster2]:[a.raster]:a.rasters;a=d.map(function(g){return g.pixelBlock});var f=this.functionArguments.operation;if(null===f)return d[0];this._performance.start();var e=this._getOperations(),h=e.operators[f-1];e=e.functors[f-1];
if(!this.functionArguments.rasters){if(1!==h)throw"no sufficient rasters, require "+h;}else if(999!==h&&this.functionArguments.rasters.length!==h)throw"number of rasters does not meet (short or exceed) the operation requirment, require "+h;var c=31===f?b.isNull(a[0]):50===f?b.setNull(a[0]):b.local(a,{rasterCountNeeded:h,functor:e});"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType,c.pixels=c.pixels.map(k.hitch(this,function(g){return this._clampBand(g,c.pixelType)})));c.statistics||c.calculateStatistics();
return{extent:d[0].extent,pixelBlock:c}},readGL:function(a){this._performance.start();var d=this.functionArguments.operation,f=this._getWebGLOperations(),e=f.operators[d-1],h=m.local;f="result\x3d"+f.functors[d-1]+";";31!==d&&50!==d&&(f+="result \x3d vec4(result.rgb, a.a);");h=h.replace("vec4 replaceme"+e+";",f);f=this.gl.getParameter(this.gl.VERSION);var c="";if(-1<f.toLowerCase().indexOf("webgl 1.0")||-1<f.toLowerCase().indexOf("webgl 0."))c=this._getPolyfill(d);h=h.replace("vec4 polyfill;",c);
1<e&&(h=h.replace("gl_FragColor \x3d localOp1();","gl_FragColor \x3d localOp1();".replace("1",e.toString())));this._initializeProgram({fragment:h,fragmentName:"Local"});d=a.rasters;if(null!=d&&0!==d.length){d=d.length;f=this.bindFrameBuffer();for(e=0;e<d;e++){h=0<e?e.toString():"";var g=this._setupTextureData(a.rasters[e],{reCreate:!0});this._bindTexture(g.texture,"u_image"+h)}this._setUniforms({});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:g.extent,texture:f.texture}}},
_getOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:[function(a,d){return a+d},function(a,d){return a-d},function(a,d){return a*d},function(a){return Math.sqrt(a)},function(a,d){return Math.pow(a,d)},function(a){return Math.acos(a)},function(a){return Math.asin(a)},function(a){return Math.atan(a)},function(a){return Math.atanh(a)},
function(a){return Math.abs(a)},function(a,d){return a&d},function(a,d){return a<<d},function(a){return~a},function(a,d){return a|d},function(a,d){return a>>d},function(a,d){return a^d},function(a,d){return a&&d},function(a){return!a},function(a,d){return a||d},function(a,d){return a!=d},function(a){return Math.cos(a)},function(a,d){return Math.cosh(a)},function(a,d){return a/d},function(a,d){return a==d},function(a){return Math.exp(a)},function(a){return Math.pow(10,a)},function(a){return Math.pow(2,
a)},function(a,d){return a>d?1:0},function(a,d){return a>=d?1:0},function(a,d){return Math.floor(a)},function(a){return!a},function(a){return a},function(a,d){return a<d?1:0},function(a,d){return a<=d?1:0},function(a){return Math.log(a)},function(a,d){return Math.log10(a)},function(a,d){return Math.log2(a)},999,999,999,999,999,999,function(a,d){return a%d},function(a){return-a},function(a,d){return a!=d?1:0},999,function(a,d){return Math.floor(a)},function(a,d){return Math.ceil(a)},function(a,d){return d?
0:a},function(a,d){return Math.sin(a)},function(a,d){return Math.sinh(a)},function(a,d){return a*a},999,999,function(a){return Math.tan(a)},function(a){return Math.tanh(a)},999,function(a){return Math.acosh(a)},function(a){return Math.asinh(a)},function(a,d){return Math.atan2(a,d)},function(a,d){return a/d},function(a,d){return Math.floor(a/d)},999,999,999,999,999,999,999,999,999,999,function(a,d,f){return a?d:f}]}},_polyfill:{sinh:"vec4 sinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp - 1.0/halfexp;\n}",
asinh:"vec4 asinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp - 1.0/halfexp);\n}",cosh:"vec4 cosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp + 1.0/halfexp;\n}",acosh:"vec4 acosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp + 1.0/halfexp);\n}",tanh:"vec4 tanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx - 1.0/expx)/(expx + 1.0/expx);\n}",atanh:"vec4 atanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx + 1.0/expx)/(expx - 1.0/expx);\n}"},_getPolyfill:function(a){var d=
"";switch(a){case 9:d=this._polyfill.atanh;break;case 22:d=this._polyfill.cosh;break;case 52:d=this._polyfill.sinh;break;case 57:d=this._polyfill.tanh;break;case 59:d=this._polyfill.acosh;break;case 60:d=this._polyfill.asinh}return d},_getWebGLOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:["(a + b)","(a - b)",
"(a * b)","sqrt(a)","pow(a, b)","acos(a)","asin(a)","atan(a)","atanh(a)","abs(a)","a","a","a","a","a","a","(a.r\x3d\x3d0.0 || b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","a.r\x3d\x3d0.0?vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","(a.r\x3d\x3d0.0 \x26\x26 b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","(a.r\x3d\x3d0.0 ^^ b.r\x3d\x3d0.0) ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","cos(a)","cosh(a)","a / b","a.r \x3d\x3d b.r? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
"exp(a)","pow(10.0, a)","pow(2.0, a)","a.r \x3e b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3e\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","floor(a)","a.a \x3d\x3d 0.0? vec4(1.0,1.0,1.0,1.0) : vec4(0.0,0.0,0.0,1.0)","a","a.r \x3c b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3c\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","log(a)","log2(a) / log2(10.0)","log2(a)",999,999,999,999,999,999,"mod(a, b)","-a","a.r !\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
999,"floor(a)","ceil(a)","a.r !\x3d 0.0 ? vec4(0.0,0.0,0.0,0.0) : a","sin(a)","sinh(a)","a * a",999,999,"tan(a)","tanh(a)",999,"acosh(a)","asinh(a)","atan(a, b)","a / b","floor(a / b)",999,999,999,999,999,999,999,999,999,999,"a.r!\x3d0 ? b : c"]}}})})},"esri/layers/rasterLib/function/MaskFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(H,k,p,r,m,l,b){return H([p,l],{declaredClass:"esri.layers.rasterLib.function.MaskFunction",
functionName:"Mask",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({includedRanges:null,noDataInterpretation:0,noDataValues:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to mask function is invalid.");this.rasterInfo=k.mixin(a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,a.raster.pixelType),statistics:a.raster.statistics,histograms:a.raster.histograms});
return!0},read2D:function(a){this._performance.start();a=a.raster;var d=b.mask(a.pixelBlock,{includedRanges:this.functionArguments.includedRanges,noDataInterpretation:this.functionArguments.noDataInterpretation,noDataValues:this.functionArguments.noDataValues});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(d.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:d}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.mask,fragmentName:"Mask"});
a=this._setupTextureData(a.raster);var d=this.bindFrameBuffer(),f=this.functionArguments.includedRanges,e=this.functionArguments.noDataValues?this.functionArguments.noDataValues.map(function(h){return parseFloat(h,10)}):null;this._setUniforms({u_includedRanges:f,u_includedRanges_specified:f?!0:!1,u_noDataValues:e,u_noDataValues_specified:e?!0:!1,u_noDataInterpretation:this.functionArguments.noDataInterpretation,u_bandCount:Math.min(this.sourceRasterInfo.raster.bandCount,3)});this._bindTexture(a.texture,
"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:d.texture}}})})},"esri/layers/rasterLib/function/NDVIFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(H,k,p,r,m,l,b){return H([p,l],{declaredClass:"esri.layers.rasterLib.function.NDVIFunction",functionName:"NDVI",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=
this.mixinIgnoreCase({visibleBandID:1,infraredBandID:2,scaled:!0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!(a.raster&&1<a.raster.bandCount))return Error("The raster input to ndvi function is invalid. It requires more than 1 band.");this.rasterInfo=k.mixin(a.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,this.scaled?"U8":"F32"),statistics:this.scaled?[{min:0,max:200}]:[{min:-1,max:1}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||
{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var d=b.calculate(a.pixelBlock,{bandIndexes:[this.functionArguments.infraredBandID+1,this.functionArguments.visibleBandID+1].join(" "),method:1}),f;if(this.functionArguments.scaled){var e=d.pixels[0];var h=d.mask;var c=e.length;var g=new Uint8Array(c);if(null==h)for(f=0;f<c;f++)g[f]=100*e[f]+100&255;else for(f=0;f<c;f++)h[f]&&(g[f]=100*e[f]+100&255);d.pixels[0]=g;d.pixelType="U8"}this._addPerformanceMetric(this._performance.elapsed());
"Unknown"!==this.pixelType&&(d.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:d}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.ndvi,fragmentName:"NDVI"});var d=this.functionArguments.visibleBandID,f=this.functionArguments.infraredBandID,e=this.functionArguments.scaled||!1;this._alterBand=2<Math.max(f,d)?!0:!1;a=this._setupTextureData(a.raster,{bandIDs:this._alterBand?{bandIDs:[f,d,f]}:null});var h=this.bindFrameBuffer();this._alterBand?this._setUniforms({u_bandId_nir:0,
u_bandId_red:1,u_scaled:e}):this._setUniforms({u_bandId_nir:f,u_bandId_red:d,u_scaled:e});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:h.texture}}})})},"esri/layers/rasterLib/function/SlopeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),function(H,k,p,r,m,l,
b,a){return H([p,b],{declaredClass:"esri.layers.rasterLib.function.SlopeFunction",functionName:"Slope",supportWebGL:!0,support2D:!0,constructor:function(d){this.functionArguments=this.mixinIgnoreCase({zFactor:1,slopeType:1,psPower:.664,psFactor:.024,raster:null},d)},bind:function(d){d=this.getSourceRasterInfo(d);if(!d.raster)return Error("The raster input to slope function is invalid.");this.rasterInfo=k.mixin(d.raster,{bandCount:1,pixelType:this._calculatePixelType(this.outputPixelType,"F32"),statistics:1===
this.slopeType||3===this.slopeType?[{min:0,max:90}]:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(d){this._performance.start();d=d.raster;d=a.slope(d,{zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,slopeType:this.functionArguments.slopeType,isGCS:d.extent.spatialReference.wkid&&null==r[d.extent.spatialReference.wkid]});
this._addPerformanceMetric(this._performance.elapsed());return d},readGL:function(d){this._performance.start();this._initializeProgram({fragment:l.slope,fragmentName:"Slope"});var f=this._setupTextureData(d.raster),e=this.bindFrameBuffer(),h=this.gl,c=h.drawingBufferWidth;h=h.drawingBufferHeight;var g=f.extent;this._setUniforms({u_resolution:d&&d.raster&&d.raster.pixelBlock?[1/d.raster.pixelBlock.width,1/d.raster.pixelBlock.height]:[1/c,1/h],u_cellSize:[(g.xmax-g.xmin)/c,(g.ymax-g.ymin)/h],u_zfactor:this.functionArguments.zFactor});
this._bindTexture(f.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:f.extent,texture:e.texture}}})})},"esri/layers/rasterLib/function/StretchFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./vertexShaders ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(H,k,p,r,m,l,b){return H([p,b],{declaredClass:"esri.layers.rasterLib.function.StretchFunction",functionName:"Stretch",supportWebGL:!0,
support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,raster:null,computeGamma:!1},a);this.functionArguments.statistics=this._convertStats(this.functionArguments.statistics);-1===[0,3,5,6].indexOf(this.functionArguments.stretchType)&&(console.error("The specific stretch type has not been implemented: "+this.functionArguments.stretchType),
this.functionArguments.stretchType=5);this.min=null==this.min?0:this.min;this.max=null==this.max?255:this.max},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to stretch function is invalid.");a.raster.statistics&&(this.srcStatistics=this._convertStats(a.raster.statistics));a.raster.histograms&&(this.srcHistograms=a.raster.histograms);this.rasterInfo=k.mixin({},a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),
statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){a=a.raster;this._stretch(a);return a},hasTilingEffects:function(a){a=a||this.functionArguments;return!!(a.dra||a.raster&&"object"===typeof a.raster&&a.raster.dra)},_convertStats:function(a){return a?a.map(function(d){return d&&null!=d.min?[d.min,d.max,d.mean,d.stddev]:d}):null},_updateStatistisHistograms:function(a){var d=this.functionArguments,
f=d.histograms||this.srcHistograms;if(a&&a.pixelBlock&&a.pixelBlock.pixels){if(0===d.stretchType)this._statistics=d.statistics&&0<d.statistics.length?d.statistics:this.srcStatistics,this._histograms=f;else{var e=a.pixelBlock,h=e.pixels.length,c=6===d.stretchType&&(d.dra||!f)||3===d.stretchType&&d.dra;c&&(e.statistics||e.calculateStatistics(),this._calculateStatisticsHistograms(a));if(d.dra)if(e.statistics||e.calculateStatistics(),c)this._statistics=e.statistics,this._histograms=e.histograms;else for(d=
e.statistics,this._statistics=[],a=0;a<h;a++)this._statistics[a]=[d[a].minValue,d[a].maxValue,0,0];else this._statistics=d.statistics&&0<d.statistics.length?d.statistics:this.srcStatistics,this._histograms=f}this._statistics=this._convertStats(this._statistics);this._gammaCorrection=this._getGammaCorrection()}else this._statistics=d.statistics&&0<d.statistics.length?d.statistics:this.srcStatistics,this._histograms=f,this._gammaCorrection=this._getGammaCorrection(),this._statistics=this._convertStats(this._statistics)},
_getGammaCorrection:function(){var a=this.functionArguments.gamma;if(a){var d=[],f;for(f=0;f<a.length;f++)d[f]=1<a[f]?2<a[f]?6.5+Math.pow(a[f]-2,2.5):6.5+100*Math.pow(2-a[f],4):1;return d}},_stretch:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels&&0!==this.functionArguments.stretchType){this._updateStatistisHistograms(a);var d=a.pixelBlock,f=d.pixels;d=d.width*d.height;var e=f.length,h,c;this._createLUT(a);if(null==this.LUT)return this._filterNoLUT(a);var g=this.LUT,n=this.LUTOffset;
for(h=0;h<e;h++){var q=g[h];for(c=0;c<d;c++){var v=f[h][c];f[h][c]=q[v-n]}}a.pixelBlock.pixelType="U8"}},_calculateStatisticsHistograms:function(a){a=a.pixelBlock;var d=a.pixelType,f=a.pixels,e=a.mask,h=f.length,c,g,n=function(w){this.min=-.5;this.max=255.5;this.size=256;k.mixin(this,w);this.counts=this.counts||new Uint32Array(this.size)},q=[],v,u;for(c=0;c<h;c++){var t=new n;var y=t.counts;var D=f[c];if("U8"===d)if(e)for(g=0;g<a.width*a.height;g++)e[g]&&y[D[g]]++;else for(g=0;g<a.width*a.height;g++)y[D[g]]++;
else{var B=a.statistics[c].minValue;var E=a.statistics[c].maxValue;t.min=B;t.max=E;E=(E-B)/256;var x=new Uint32Array(257);if(e)for(g=0;g<a.width*a.height;g++)e[g]&&x[Math.floor((D[g]-B)/E)]++;else for(g=0;g<a.width*a.height;g++)x[Math.floor((D[g]-B)/E)]++;for(g=0;255>g;g++)y[g]=x[g];y[255]=x[255]+x[256]}q.push(t);D=[];B=a.statistics[c].minValue;E=a.statistics[c].maxValue;for(g=u=v=x=0;g<t.size;g++)x+=y[g],v+=g*y[g];v/=x;for(g=0;g<t.size;g++)u+=y[g]*Math.pow(g-v,2);y=Math.sqrt(u/(x-1));g=(v+.5)*(t.max-
t.min)/t.size+t.min;t=y*(t.max-t.min)/t.size;D.push(B);D.push(E);D.push(g);D.push(t);a.statistics[c]={min:B,minValue:B,max:E,maxValue:E,mean:g,stddev:t}}a.histograms=q},_getCutOffPoints:function(a){var d=this.functionArguments,f=999;a&&a.pixelBlock?f=a.pixelBlock.pixels.length:a&&a.texture&&(f=3);a=Math.min(f,this._statistics.length);var e=[],h=[],c,g;switch(d.stretchType){case 5:for(c=0;c<a;c++)e[c]=this._statistics[c][0],h[c]=this._statistics[c][1];break;case 3:for(c=0;c<a;c++)e[c]=this._statistics[c][2]-
d.numberOfStandardDeviations*this._statistics[c][3],h[c]=this._statistics[c][2]+d.numberOfStandardDeviations*this._statistics[c][3],e[c]<this._statistics[c][0]&&(e[c]=this._statistics[c][0]),h[c]>this._statistics[c][1]&&(h[c]=this._statistics[c][1]);break;case 6:for(c=0;c<a;c++){f=this._histograms[c];var n=new Uint32Array(f.size);var q=f.counts;var v=0;var u=-.5===f.min&&1===(f.max-f.min)/q?.5:0;for(g=0;g<f.size;g++)v+=q[g],n[g]=v;q=d.minPercent*v/100;for(g=0;g<f.size;g++)if(n[g]>q){e[c]=f.min+(f.max-
f.min)/f.size*(g+u);break}q=(1-d.maxPercent/100)*v;for(g=f.size-2;0<=g;g--)if(n[g]<q){h[c]=f.min+(f.max-f.min)/f.size*(g+2-u);break}}break;default:for(c=0;c<f;c++)e[c]=0,h[c]=255}return{minCutOff:e,maxCutOff:h}},_createLUT:function(a){var d=this.functionArguments,f=a.pixelBlock,e=f.pixelType;if("U8"===e||"U16"===e||"S8"===e||"S16"===e){if(this._LUTSignature&&(e=this._computeLutSignature(),e.length===this._LUTSignature.length&&!e.some(function(A,z){return A!==this._LUTSignature[z]}.bind(this))))return;
e=f.pixels.length;var h=[],c=[],g=d.max,n=d.min,q=d.gamma,v=g-n,u=this._getCutOffPoints(a);a=u.minCutOff;u=u.maxCutOff;var t=0,y=256;"S8"===f.pixelType?t=-127:"S16"===f.pixelType&&(t=-32767);if("U16"===f.pixelType||"S16"===f.pixelType)y=65536;for(f=0;f<e;f++)h[f]=u[f]-a[f];var D=this._gammaCorrection;if(d.useGamma)for(f=0;f<e;f++){var B=[];for(d=0;d<y;d++){var E=d+t;var x=(E-a[f])/h[f];var w=1;1<q[f]&&(w-=Math.pow(1/v,x*D[f]));E<u[f]&&E>a[f]?B[d]=Math.floor(w*v*Math.pow(x,1/q[f]))+n:E>u[f]?B[d]=g:
E<a[f]&&(B[d]=n)}c[f]=B}else for(f=0;f<e;f++){B=[];for(d=0;d<y;d++)E=d+t,B[d]=E<a[f]?n:E>u[f]?g:Math.floor((E-a[f])/h[f]*v)+n;c[f]=B}this.LUT=c;this.LUTOffset=t;this._LUTSignature=this._computeLutSignature()}},_computeLutSignature:function(){var a=this.functionArguments,d=[],f,e;d.push(a.stretchType);d.push(a.min);d.push(a.max);d.push(a.numberOfStandardDeviations);if(this._statistics)for(f=0;f<this._statistics.length;f++)for(e=0;e<this._statistics[f].length;e++)d.push(this._statistics[f][e]);d.push(a.dra?
1:0);d.push(a.minPercent);d.push(a.maxPercent);if(a.gamma)for(f=0;f<this._statistics.length;f++)d.push(a.gamma[f]);d.push(a.useGamma?1:0);return d},_filterNoLUT:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var d=this.functionArguments,f=a.pixelBlock,e=f.pixels,h=f.mask;f=f.width*f.height;var c=e.length,g=[],n=[],q=d.max,v=d.min,u=d.gamma,t=q-v;var y=this._getCutOffPoints(a);var D=y.minCutOff,B=y.maxCutOff;for(y=0;y<c;y++)g[y]=B[y]-D[y];if(d.useGamma&&null!==u&&u.length>=
c)for(y=0;y<c;y++)n[y]=1<u[y]?2<u[y]?6.5+Math.pow(u[y]-2,2.5):6.5+100*Math.pow(2-u[y],4):1;if(d.useGamma)if(void 0!==h&&null!==h)for(d=0;d<f;d++){if(h[d])for(y=0;y<c;y++){var E=e[y][d];var x=(E-D[y])/g[y];var w=1;1<u[y]&&(w-=Math.pow(1/t,x*n[y]));E<B[y]&&E>D[y]?e[y][d]=Math.floor(w*t*Math.pow(x,1/u[y]))+v:E>B[y]?e[y][d]=q:E<D[y]&&(e[y][d]=v)}}else for(d=0;d<f;d++)for(y=0;y<c;y++)E=e[y][d],x=(E-D[y])/g[y],w=1,1<u[y]&&(w-=Math.pow(1/t,x*n[y])),E<B[y]&&E>D[y]?e[y][d]=Math.floor(w*t*Math.pow(x,1/u[y]))+
v:E>B[y]?e[y][d]=q:E<D[y]&&(e[y][d]=v);else if(void 0!==h&&null!==h)for(d=0;d<f;d++){if(h[d])for(y=0;y<c;y++)E=e[y][d],E<B[y]&&E>D[y]?e[y][d]=Math.floor((E-D[y])/g[y]*t)+v:E>B[y]?e[y][d]=q:E<D[y]&&(e[y][d]=v)}else for(d=0;d<f;d++)for(y=0;y<c;y++)E=e[y][d],E<B[y]&&E>D[y]?e[y][d]=Math.floor((E-D[y])/g[y]*t)+v:E>B[y]?e[y][d]=q:E<D[y]&&(e[y][d]=v);a.pixelBlock.pixelType="U8";return a}},_computeGammaValues:function(a){var d=this._statistics.length,f,e=[];for(f=0;f<d;f++){var h=this._statistics[f][2];"U8"!==
a&&(h=255*(h-this._statistics[f][0])/(this._statistics[f][1]-this._statistics[f][0]));e.push(this._computeGammaValue(h))}return e},_computeGammaValue:function(a){if(0!==a&&!(255<a||0>a)){var d=0;0<a&&150!=a&&255>a&&(d=150>=a?45*Math.cos(.01047*a):17*Math.sin(.021*a));d=Math.log((a+d)/255);if(0!==d&&(a=Math.log(a/255)/d,!isNaN(a)))return Math.min(9.9,Math.max(.01,a))}},readGL:function(a){return this._stretchGL(a.raster)},_stretchGL:function(a){this._performance.start();var d=this.renderTexture,f,e=
a.pixelBlock&&a.pixelBlock.pixels&&a.pixelBlock.pixels.length||this.sourceRasterInfo.raster.bandCount,h=a.pixelBlock,c=this.gl,g=c.drawingBufferWidth,n=c.drawingBufferHeight;if(!h&&this.functionArguments.dra){var q=new Float32Array(g*n*4),v=new Uint8Array(g*n);var u=new Float32Array(g*n);var t=new Float32Array(g*n);var y=new Float32Array(g*n);c.checkFramebufferStatus(c.FRAMEBUFFER)==c.FRAMEBUFFER_COMPLETE&&c.readPixels(0,0,g,n,c.RGBA,c.FLOAT,q);for(f=0;f<g*n;f++)u[f]=q[4*f],t[f]=q[4*f+1],y[f]=q[4*
f+2],v[f]=q[4*f+3];a.pixelBlock=new r({width:g,height:n,pixels:[u,t,y],mask:v});a.pixelBlock.calculateStatistics()}!h&&this.functionArguments.dra&&this._useGPUStats?(u=new Float32Array(e),t=new Float32Array(e)):(this._updateStatistisHistograms(a),q=this._getCutOffPoints(a),u=new Float32Array(e),t=new Float32Array(e),u.set(q.minCutOff.slice(0,e)),t.set(q.maxCutOff.slice(0,e)));this._initializeProgram({fragment:l.stretch,fragmentName:"Stretch"});q=this._setupTextureData(a);v=this.bindFrameBuffer();
this.renderTexture=!1;this._performance.start();if(!h&&this.functionArguments.dra&&this._useGPUStats){this._setUniforms({u_sourceDim:[g,n],u_bandCount:e});if(1===e)var D=this._readMinMax(q,2);else{D=this._readMinMax(q,0);var B=this._readMinMax(q,1)}if(6===this.functionArguments.stretchType||3===this.functionArguments.stretchType&&this.functionArguments.dra)f=this._readHistogram(D,B,a),u=f.minCutOff||u,t=f.minCutOff||t}y=this.functionArguments.max-this.functionArguments.min;a=new Float32Array(e);for(f=
0;f<e;f++)a[f]=y/(t[f]-u[f]);this._useGPUStats&&this._initializeProgram({fragment:l.stretch,fragmentName:"Stretch"});c.blendFunc(c.SRC_ALPHA,c.ZERO);y=new Float32Array(3);var E=new Float32Array(3);for(f=0;3>f;f++)y[f]=this.functionArguments.min,E[f]=this.functionArguments.max;f=this.functionArguments.useGamma;var x=this.functionArguments.gamma,w=this._gammaCorrection;Array.isArray(x)&&x.length>=e||(f=!1);this._setUniforms({u_sourceDim:[g,n],u_bandCount:e,u_minOutput:y,u_maxOutput:E,u_minCutOff:u,
u_maxCutOff:t,u_factor:a,u_state:100,u_useGamma:f,u_gamma:x,u_scaled:!d,u_gammaCorrection:w,u_minMaxTexture:!h&&this.functionArguments.dra&&this._useGPUStats?!0:!1});this.renderTexture=d;c.viewport(0,0,g,n);this._bindTexture(q.texture,"u_image");!h&&this.functionArguments.dra&&this._useGPUStats&&(d=c.getUniformLocation(this.rasterProgram,"u_image1"),c.uniform1i(d,1),c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,D.texture),1<e&&(e=c.getUniformLocation(this.rasterProgram,"u_image2"),c.uniform1i(e,
2),c.activeTexture(c.TEXTURE2),c.bindTexture(c.TEXTURE_2D,B.texture)));this._drawGL();return{extent:q.extent,texture:v.texture}},_readMinMax:function(a,d){var f=this.gl,e=a.width||f.drawingBufferWidth,h=a.height||f.drawingBufferHeight;this._setUniforms({u_state:d});this.renderTexture=!1;var c=a.texture;for(f.activeTexture(f.TEXTURE0);1<e||1<h;){var g=this._createTexture();d=Math.max(Math.ceil(e/2),1);var n=Math.max(Math.ceil(h/2),1);f.getExtension("OES_texture_float");f.texImage2D(f.TEXTURE_2D,0,
f.RGBA,d,n,0,f.RGBA,f.FLOAT,null);a=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,a);f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,g,0);f.viewport(0,0,d,n);f.bindTexture(f.TEXTURE_2D,c);this._setUniforms({u_sourceDim:[e,h]});e=d;h=n;this._drawGL(!0);c=g}a=new Float32Array(e*h*4);f.checkFramebufferStatus(f.FRAMEBUFFER)==f.FRAMEBUFFER_COMPLETE&&f.readPixels(0,0,e,h,f.RGBA,f.FLOAT,a);return{texture:g,minmax:a}},_readHistogram:function(a,d,f){if(a)try{var e=this.gl,h=e.drawingBufferWidth,
c=e.drawingBufferHeight,g,n,q;if(a.texture instanceof WebGLTexture){var v=!0;var u=[1,0,0,1];if(d){var t=a.minmax;var y=d.minmax}else t=[a.minmax[0]],y=[a.minmax[1]]}else for(y=d,t=a,u=new Float32Array(y.length),g=0;g<y.length;g++)u[g]=256/(y[g]-t[g]);var D=new Float32Array(h*c);for(q=0;q<D.length;q++)D[q]=q;if(!this.histogramProgram){var B=m.getShader(e,m.histogram),E=l.getShader(e,l.constant);this.histogramProgram=this._loadProgram(B,E)}e.blendFunc(e.ONE,e.ONE);e.enable(e.BLEND);e.useProgram(this.histogramProgram);
var x=e.getAttribLocation(this.histogramProgram,"a_pixelIndex"),w=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,w);e.bufferData(e.ARRAY_BUFFER,D,e.STATIC_DRAW);e.enableVertexAttribArray(x);e.vertexAttribPointer(x,1,e.FLOAT,!1,0,0);var A=this._setupHistTexture(f),z=this._createTexture();e.getExtension("OES_texture_float");e.texImage2D(e.TEXTURE_2D,0,e.RGBA,257,1,0,e.RGBA,e.FLOAT,null);var G=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,G);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,
e.TEXTURE_2D,z,0);e.viewport(0,0,257,1);var I=e.getUniformLocation(this.histogramProgram,"u_image");e.uniform1i(I,0);e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,A);var K=e.getUniformLocation(this.histogramProgram,"u_sourceDim");e.uniform2f(K,h,c);var R=e.getUniformLocation(this.histogramProgram,"u_bandCount");e.uniform1i(R,3);var U=e.getUniformLocation(this.histogramProgram,"u_halfPixel");e.uniform2f(U,.5/h,.5/c);var ba=e.getUniformLocation(this.histogramProgram,"u_minMaxTexture");if(v){e.uniform1i(ba,
1);var ca=e.getUniformLocation(this.histogramProgram,"u_image1");e.uniform1i(ca,1);e.activeTexture(e.TEXTURE1);e.bindTexture(e.TEXTURE_2D,a.texture);if(d){var da=e.getUniformLocation(this.histogramProgram,"u_image2");e.uniform1i(da,2);e.activeTexture(e.TEXTURE2);e.bindTexture(e.TEXTURE_2D,d.texture)}}else{var ja=e.getUniformLocation(this.histogramProgram,"u_mins");e.uniform4f(ja,t[0],t[0],t[0],t[0]);e.uniform1i(ba,0)}var ea=e.getUniformLocation(this.histogramProgram,"u_color"),L=e.getUniformLocation(this.histogramProgram,
"u_factors"),O=e.getUniformLocation(this.histogramProgram,"u_size");e.uniform1f(O,256);a=[];d=[];e.uniform4fv(ea,[1,0,0,1]);e.uniform4fv(L,[u[0],0,0,1]);e.drawArrays(e.POINTS,0,D.length);var S=this.sourceRasterInfo.raster.bandCount;1<S&&(e.uniform4fv(ea,[0,1,0,1]),e.uniform4fv(L,[0,u[0],0,1]),e.drawArrays(e.POINTS,0,D.length),e.uniform4fv(ea,[0,0,1,1]),e.uniform4fv(L,[0,0,u[0],1]),e.drawArrays(e.POINTS,0,D.length));if(e.checkFramebufferStatus(e.FRAMEBUFFER)==e.FRAMEBUFFER_COMPLETE){var T=new Float32Array(1028);
e.readPixels(0,0,257,1,e.RGBA,e.FLOAT,T);e=0;var J=-.5===t[0]&&1===(y[0]-t[0])/256?.5:0;for(g=0;g<S;g++){var N=new Float32Array(257);var C=new Float32Array(257);for(q=e=0;256>q;q++)e+=T[4*q+g],N[q]=e,C[q]=T[4*q+g];C[256]=T[1024+g];N[256]=e+T[1024+g];var P=this.functionArguments.minPercent*e/100;if(y){for(n=0;256>n;n++)if(N[n]>P){a[g]=t[0]+(y[0]-t[0])/256*(n+J);break}P=(1-this.functionArguments.maxPercent/100)*e;for(n=254;0<=n;n--)if(N[n]<P){d[g]=t[0]+(y[0]-t[0])/256*(n+2-J);break}}}}return{histogram:T,
minCutOff:a,maxCutOff:d}}catch(Q){console.debug("webgl filter exception: "+Q.message)}},_setupHistTexture:function(a){if(a instanceof WebGLTexture)return a;var d=this.originalHistTexture=this._createTexture(),f=this.gl;a=a.pixelBlock;var e=a.width,h=a.height;f.getExtension("OES_texture_float");this.rgbaFloatData=a.getAsRGBAFloat();f.texImage2D(f.TEXTURE_2D,0,f.RGBA,e,h,0,f.RGBA,f.FLOAT,this.rgbaFloatData);return d}})})},"esri/layers/rasterLib/function/RemapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(H,k,p,r,m,l,b){return H([r,l],{declaredClass:"esri.layers.rasterLib.function.RemapFunction",functionName:"Remap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({inputRanges:null,outputValues:null,outputColors:null,colorBreaks:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input is not available.");var d=!(!this.functionArguments.outputColors&&!this.functionArguments.colorBreaks);
this.rasterInfo=k.mixin(a.raster,{bandCount:d?3:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=d?"Processed":"Thematic";return!0},read2D:function(a){return this._remap(a.raster)},readGL:function(a){return this._remapGL(a.raster)},_remap:function(a){this._performance.start();var d=b.remapColor(a.pixelBlock,this.functionArguments.colorBreaks);this._addPerformanceMetric(this._performance.elapsed());
return{extent:a.extent,pixelBlock:d}},_remapGL:function(a){this._performance.start();this._initializeProgram({fragment:m.remap,fragmentName:"Remap"});var d=new Uint8Array(64),f=this.functionArguments.colorBreaks;f.forEach(function(g,n){d[4*n]=g.mappedColor[0];d[4*n+1]=g.mappedColor[1];d[4*n+2]=g.mappedColor[2];d[4*n+3]=1>=g.mappedColor[3]?255*g.mappedColor[3]:g.mappedColor[3]});var e=f[f.length-1],h=e.mappedColor;d[60]=h[0];d[61]=h[1];d[62]=h[2];d[63]=1>=h[3]?255*h[3]:h[3];var c=new Float32Array(16);
f.forEach(function(g,n){c[n]=g.value});c[15]=e.value;this._clrTexture||(this._clrTexture=this._setupColormapTexture(d));f=this._clrTexture;e=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:0,u_indexedColormapMaxIndex:d.length/4-1,u_breaks:c});this._bindTexture(f,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:e.texture}},_setupColormapTexture:function(a){var d=this._createTexture(),f=a.length/4,e=new Float32Array(a.length),
h=this.renderTexture?255:1,c,g=this.gl;for(c=0;c<a.length;c++)e[c]=a[c]/h;g.getExtension("OES_texture_float");g.texImage2D(g.TEXTURE_2D,0,g.RGBA,f,1,0,g.RGBA,g.FLOAT,e);return d}})})},"esri/layers/rasterLib/function/IdentityFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(H,k,p,r,m){return H([r,m],{declaredClass:"esri.layers.rasterLib.function.IdentityFunction",functionName:"Identity",supportWebGL:!0,support2D:!0,
constructor:function(l){this.functionArguments={raster:null}},bind:function(l){l=this.getSourceRasterInfo(l);if(!l.raster)return Error("The raster input to identity function is invalid.");this.rasterInfo=k.mixin(l.raster,{});return!0},read2D:function(l){return l.raster},readGL:function(l){this._initializeProgram({fragment:p.identity,fragmentName:"identity"});l=this._setupTextureData(l.raster);var b=this.bindFrameBuffer();this._bindTexture(l.texture,"u_image");this._drawGL();return{extent:l.extent,
texture:b.texture}}})})},"esri/layers/rasterLib/function/ResampleFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(H,k,p,r,m){return H([r,m],{declaredClass:"esri.layers.rasterLib.function.ResampleFunction",renderTexture:!0,resamplingOrigin:null,resamplingRatio:null,zFactor:1,functionName:"Resample",supportWebGL:!0,support2D:!1,constructor:function(l){this.functionArguments=this.mixinIgnoreCase({resamplingType:0},
l)},bind:function(l){l=this.getSourceRasterInfo(l);if(!l.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=k.mixin(l.raster,{bandCount:l.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,l.raster.pixelType),statistics:l.raster.statistics,histograms:l.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};return!0},readGL:function(l){this._performance.start();this._initializeProgram({fragment:p.resample,fragmentName:"Resample"});
var b=this._setupTextureData(l.raster),a=this.bindFrameBuffer(),d=this.gl,f=d.drawingBufferWidth;d=d.drawingBufferHeight;var e=l.raster;void 0!==e.pixelBlock?(b=b||this._setupTextureData(e),l=e.pixelBlock.width,e=e.pixelBlock.height):(b=b||e,l=f,e=d);this._setUniforms({u_resamplingRatio:this.resamplingRatio||[l/f,e/d],u_anchor:this.resamplingOrigin||[0,1],u_resamplingType:this.functionArguments.resamplingType,u_resolution:[1/f,1/d]});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());
return{extent:b.extent,texture:a.texture}}})})},"esri/layers/rasterLib/renderer/rasterRendererHelper":function(){define("dojo/_base/declare dojo/_base/lang ../../PixelBlock ./RasterColormapRenderer ./RasterUniqueValueRenderer ./RasterRGBRenderer ./RasterStretchColorRampRenderer ./RasterClassBreaksRenderer ./RasterShadedReliefRenderer".split(" "),function(H,k,p,r,m,l,b,a,d){var f=function(){function e(c){h[c.prototype.rendererName]=c}var h={};e(r);e(l);e(b);e(m);e(a);e(d);return h}();return{wellKnownRenderers:f,
isSupported:function(e){if(!e)return!1;var h=!0;f[e.rendererName]||(h=!1);return h},create:function(e){if(!e)return null;if(e.rendererName){var h=e.rendererName;e=e.rendererArguments}else h="uniqueValue rasterStretch rasterShadedRelief rgb rasterColormap classBreaks".split(" ").indexOf(e.type),h="UniqueValue Stretch ShadedRelief RGB Colormap ClassBreaks".split(" ")[h],"rasterStretch"===e.type&&e.bandIndex&&1<e.bandIndex.length&&(h="RGB");return(h=f[h])?new h(e):null},createDefaultRenderer:function(e){if(e&&
e.raster){var h=e.raster.rasterInfo,c=e.raster.dataType;if(h){var g=e.raster.rasterFunction,n=["Stretch","Colormap","ContrastAndBrightness"];if(g&&"U8"===h.pixelType&&-1<n.indexOf(g.functionName))g.renderTexture=!0;else if("Processed"!==c||!(e.useWebGL&&g&&g.renderTexture||!e.useWebGL&&"U8"===h.pixelType)){g&&(h=g.rasterInfo);g=h.bandCount;var q=h.colormap,v=h.vat;n=h.histograms;n&&0===n.length&&(n=null);var u=h.statistics&&h.statistics.map(function(D){return[D.min,D.max,D.mean,D.stddev]});if(1===
g&&q&&0<q.length)var t=this._getDefaultColormapRenderer(v,q);else if(1===g&&v&&v.features&&0<v.features.length)t=new m({});else{q=0;v=!1;c||!e.raster||!e.raster.tileInfo||void 0!==e.raster.tileInfo.tileType&&"Map"!==e.raster.tileInfo.tileType?"U8"===h.pixelType&&"Processed"===c?(q=5,u=u||[[0,255,0,0],[0,255,0,0],[0,255,0,0]],v=!1):"U8"===h.pixelType||"Elevation"===c?(q=5,v=u?!1:!0):"Scientific"===c||"StdTime"===c?(q=5,v=u?!1:!0,t=this._getDefaultScientificColorRamp()):n&&0<n.length?(q=6,v=!1):u?(q=
5,v=!1):(q=6,v=!0):(u=[[0,255,0,0],[0,255,0,0],[0,255,0,0]],q=5,v=!1);u||(q=5,v=!0);var y;3<=g&&!(e.bandIds||e.raster&&e.raster.imageServiceParams&&e.raster.imageServiceParams.bandIds)&&(y=this.getDefaultBandCombination(h));y&&(u=y.map(function(D){return u[D]}));e={stretchType:q,min:0,max:255,dra:v,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,statistics:u,histograms:n,numberOfStandardDeviations:2.5,bandIndex:y};1===g||y&&1===y.length?(t&&(e.colorRamp=t,e.invert=!1),t=new b(e)):t=new l(e)}return t}}}},
getDefaultBandCombination:function(e){var h=e.bandCount;if(1===h)return null;if(2===h)return[0];var c=(e=e.keyProperties)&&e.ChangeAnalysisParameters&&e.ChangeAnalysisParameters.AnalysisType;if(c&&("ccdc"===c.toLowerCase()||"landtrendr"===c.toLowerCase()))return[0];e=e&&e.BandProperties;var g;if(e&&e.length===h){var n=this.getWellKnownBandIndexes(e);e=n.red;c=n.green;var q=n.blue;n=n.nir;null!=e&&null!=c&&null!=q?g=[e,c,q]:null!=n&&null!=e&&null!=c&&(g=[n,e,c])}!g&&3<=h&&(g=[0,1,2]);return g},getWellKnownBandIndexes:function(e){for(var h=
{},c=0;c<e.length;c++){var g=e[c],n=g.BandName&&g.BandName.toLowerCase();"red"===n?h.red=c:"green"===n?h.green=c:"blue"===n?h.blue=c:"nearinfrared"===n||"nearinfrared_1"===n||"nir"===n?h.nir=c:g.WavelengthMax&&g.WavelengthMin&&(n=g.WavelengthMin,g=g.WavelengthMax,null==h.blue&&410<=n&&480>=n&&480<=g&&540>=g?h.blue=c:null==h.green&&490<=n&&560>=n&&560<=g&&610>=g?h.green=c:null==h.red&&595<=n&&670>=n&&660<=g&&730>=g?h.red=c:null==h.nir&&700<=n&&860>=n&&800<=g&&950>=g&&(h.nir=c))}return h},_getDefaultColormapRenderer:function(e,
h){if(h||h.length){var c=[],g=this._ratContainsColormap(e);if(g)var n=this._getRATValueClassNameMap(e);h.forEach(function(q){var v=n?n[q[0]]:q[0];c.push({color:[q[1],q[2],q[3]],value:q[0],label:g?null!=v?v:"":q[0]})});return new r({colormapInfos:c})}},_ratContainsColormap:function(e){if(!e||!e.fields)return!1;var h,c,g;return e.fields.some(function(n){n&&n.name&&(n=n.name.toLowerCase(),"red"===n&&(h=!0),"green"===n&&(c=!0),"blue"===n&&(g=!0));return h&&c&&g})},_getRATValueClassNameMap:function(e){if(!e||
!e.fields)return null;var h={},c,g;e.fields.forEach(function(n){if("classname"===n.name.toLowerCase()||"class_name"===n.name.toLowerCase())c=n.name;"value"===n.name.toLowerCase()&&(g=n.name)});e.features.forEach(function(n){n=n.attributes;h[n[g]]=c?n[c]:n[g]});return h},_getDefaultScientificColorRamp:function(){return{type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}].map(function(e){return{fromColor:e.toColor,
toColor:e.fromColor}}).reverse()}}}})},"esri/layers/rasterLib/renderer/RasterColormapRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction"],function(H,k,p,r){return H([p],{declaredClass:"esri.layers.rasterLib.renderer.RasterColormapRenderer",rendererName:"Colormap",renderTexture:!0,constructor:function(m){m&&m.colormapInfos&&(m.colormap=m.colormapInfos.map(function(l){return[l.value].concat(l.color)}));this._function=new r(m);this._function.outputPixelType=
"U8";this._function.renderTexture=!0},draw2D:function(m){this._updateColormapParameters();m=this._clonePixelData(m);return m=this._function._colorize(m)},drawGL:function(m){this._updateColormapParameters();this._function._colorizeGL(m)},toJson:function(){var m=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:m}},toCommonRendererJson:function(){return{type:"rasterColormap",colormapInfos:this.colormapInfos||this.colormap.map(function(m){return{value:m[0],
color:m.slice(1),label:m[0]}})}},_updateColormapParameters:function(){var m=this._function.functionArguments;m.colormap=this.colormap;m.colormapName=this.colormapName;m.colorRamp=this.colorRamp;m.colorRampName=this.colorRampName}})})},"esri/layers/rasterLib/renderer/RasterRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../PixelBlock"],function(H,k,p,r){return H(null,{declaredClass:"esri.layers.rasterLib.renderer.RasterRenderer",raster:null,constructor:function(m){m=
m||{};this.raster=m.raster||m.Raster||this.raster;this.draw=k.hitch(this,this.draw);this.bind=k.hitch(this,this.bind);m=k.clone(m);Object.keys(m).forEach(function(l){null==m[l]&&delete m[l]});k.mixin(this,m)},bind:function(m){if(!m)throw"failed to bind without options";var l=m;m.layer&&(m=m.layer,l={id:m.id,rawRasterInfo:m.raster.rasterInfo,glSetting:m._glSetting,xformSetting:m.tileManager&&m.tileManager.xformSetting,useWebGL:m.useWebGL,resampling:m.tileMode&&m.tileManager&&m.tileManager.xformSetting.requireProjection&&
!m._hasTilingEffects&&"Thematic"!==m.raster.dataType?1:0,tileMode:m.tileMode});this._rawRasterInfo=l.rawRasterInfo;this.useWebGL=l.useWebGL;this._function&&this._function.setProcessingContext(k.mixin({useProcessedData:!0},l));this._processingContext=l},hasTilingEffects:function(){},draw:function(m){return this.useWebGL?this.drawGL(m):this.draw2D(m)},toJson:function(){},_clonePixelData:function(m){if(null==m)return m;var l={};m.extent&&(l.extent=new p(m.extent.xmin,m.extent.ymin,m.extent.xmax,m.extent.ymax,
m.extent.spatialReference));m=m.processedPixelBlock||m.pixelBlock;if(null==m)return l;l.pixelBlock=m.clone?m.clone():r.prototype.clone(m);return l}})})},"esri/layers/rasterLib/renderer/RasterUniqueValueRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../../../renderers/colorRampGenerator"],function(H,k,p,r,m){return H([p],{declaredClass:"esri.layers.rasterLib.renderer.RasterUniqueValueRenderer",rendererName:"UniqueValue",field:"",
alias:"",uniqueValueInfos:null,constructor:function(l){l&&l.colormap&&(this.colormap=l.colormap,this._function=new r(l),this._function.outputPixelType="U8",this._function.renderTexture=!0)},bind:function(l){this.inherited(arguments);if(!this._function){var b=(this.raster&&this.raster.rasterInfo||this._rawRasterInfo).vat;if(!b)throw"uv renderer requires data source to have raster attribute table";var a=this.attributeField||this.field1||this.field,d=this.infos||this.uniqueValueInfos;this.defaultColor=
this.defaultColor||this.defaultSymbol&&this.defaultSymbol.color;var f=b.fields.filter(function(t){return"value"===t.name.toLowerCase()})[0];if(f)var e=f.name;a||((a=b.fields.filter(function(t){return-1<["classname","category"].indexOf(t.name.toLowerCase())})[0])||(a=b.fields.filter(function(t){return"esriFieldTypeString"===t.type})[0]),this.alias=(this.field=a=a&&a.name||e)&&a.alias||e);var h=[],c;if(!d){d=[];var g=b.fields.filter(function(t){return"alpha"===t.name.toLowerCase()})[0];var n=b.fields.filter(function(t){return"red"===
t.name.toLowerCase()})[0];var q=b.fields.filter(function(t){return"green"===t.name.toLowerCase()})[0];var v=b.fields.filter(function(t){return"blue"===t.name.toLowerCase()})[0];for(f=0;f<b.features.length;f++){var u=b.features[f].attributes;(c=d.some(function(t){t.value===u[a]}))||(g&&n&&q&&v?d.push({value:u[a],alias:u[a],color:[u[n.name],u[q.name],u[v.name],u[g.name]]}):n&&q&&v?d.push({value:u[a],alias:u[a],color:[u[n.name],u[q.name],u[v.name]]}):d.push({value:u[a],alias:u[a]}))}if(!(n&&q&&v))for(c=
m.createRandomColorRamp({size:d.length}),f=0;f<d.length;f++)d[f].color=c[f];this.uniqueValueInfos=d}if(d)d.forEach(function(t){h=h.concat(b.features.filter(function(y){return t.value==y.attributes[a]}).map(function(y){return[y.attributes[e]].concat(t.color||t.symbol&&t.symbol.color)}))}),this.defaultColor&&b.features.filter(function(t){h.some(function(y){return y[0]===t.attributes[e]})||h.push([t.attributes[e]].concat(this.defaultColor))});else throw"missing uniqueValueInfos property";this._function=
new r({colormap:h});this.colormap=h;this._function.outputPixelType="U8";this._function.renderTexture=!0;this._function.setProcessingContext(this._processingContext)}},draw2D:function(l){l=this._clonePixelData(l);return l=this._function._colorize(l)},drawGL:function(l){this._function._colorizeGL(l)},toJson:function(l){var b={field:this.field,uniqueValueInfos:this.uniqueValueInfos,defaultColor:this.defaultColor};l&&(b.colormap=this.colormap);return{rendererName:this.rendererName,rendererArguments:b}},
toCommonRendererJson:function(){var l=this.attributeField||this.field1||this.field,b=(this.infos||this.uniqueValueInfos).map(function(a){return{value:a.value,label:a.alias+"",symbol:{color:3===a.color.length?a.color.concat([255]):a.color,type:"esriSFS",style:"esriSFSSolid"}}});return{type:"uniqueValue",field1:l,uniqueValueInfos:b}}})})},"esri/layers/rasterLib/renderer/RasterRGBRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/rasterUtils".split(" "),
function(H,k,p,r,m,l){return H([p],{declaredClass:"esri.layers.rasterLib.renderer.RasterRGBRenderer",rendererName:"RGB",bandIndex:null,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(b){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
b=k.mixin({},b,{stretchType:this.stretchType});this._stretchFunction=new r(b);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this.bandIndex=b.bandIndex||b.BandIndex;this._function=new m(b);this._function.functionArguments.raster=this._stretchFunction;this._function.renderTexture=!0},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},draw2D:function(b){this._updateStretchParameters();b=this._clonePixelData(b);if("U8"===b.pixelBlock.pixelType&&
!this.contrastOffset&&!this.brightnessOffset)return b;this._stretchFunction._stretch(b);var a=b.pixelBlock,d=this.bandIndex,f=Math.max.apply(null,d);a&&a.pixels.length>f&&d&&(a.pixels=d.map(function(e){return a.pixels[e]}),a.statistics&&(a.statistics=d.map(function(e){return a.statistics[e]})));if(this.contrastOffset||this.brightnessOffset)b.pixelBlock=l.contrastBrightnessStretch(b.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return b},drawGL:function(b){this._updateStretchParameters();
b.pixelBlock&&(b=this._clonePixelData(b));var a=b.pixelBlock,d=this.bandIndex,f=Math.max.apply(null,d),e=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,h=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,c,g;a&&a.pixels.length>f&&d&&(a.pixels=d.map(function(n){return a.pixels[n]}),a.statistics&&(a.statistics=d.map(function(n){return a.statistics[n]})),e&&0<e.length&&
e.length!==d.length&&(c=d.map(function(n){return e[n]})),h&&0<h.length&&h.length!==d.length&&(g=d.map(function(n){return h[n]})));this._stretchFunction.functionArguments.statistics=c||e;this._stretchFunction.functionArguments.histograms=g||h;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._function.renderTexture=!0,b=this._stretchFunction._stretchGL(b),this._function._cbGL(b)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(b))},toJson:function(){var b=
this._stretchFunction.toJson().rasterFunctionArguments;b.bandIndex=this.bandIndex;b.contrastOffset=this.contrastOffset;b.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:b}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:k.clone(this.statistics),
dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,gamma:k.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var b=this._stretchFunction.functionArguments;b.stretchType=this.stretchType;b.min=this.min;b.max=this.max;b.numberOfStandardDeviations=this.numberOfStandardDeviations;b.statistics=this.statistics;b.histograms=this.histograms;b.dra=this.dra;b.minPercent=this.minPercent;
b.maxPercent=this.maxPercent;b.useGamma=this.useGamma;b.gamma=this.gamma;b.computeGamma=this.computeGamma;this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterStretchColorRampRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/ResampleFunction ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(H,k,p,r,m,l,b,a){return H([p],
{declaredClass:"esri.layers.rasterLib.renderer.RasterStretchColorRampRenderer",rendererName:"Stretch",bandIndex:[0],colorRamp:null,invert:!1,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(d){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
d=k.mixin({},d,{stretchType:this.stretchType});Object.keys(d).forEach(function(f){null==d[f]&&delete d[f]});this._function=new l(d);this._stretchFunction=new m(d);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this._clrFunction=new b(d);this._clrFunction.functionArguments.raster=this._stretchFunction;this._clrFunction.renderTexture=!1;this._function.functionArguments.raster=this._clrFunction},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},
draw2D:function(d){this._updateStretchParameters();d=this._clonePixelData(d);if("U8"===d.pixelBlock.pixelType&&!(this.contrastOffset||this.brightnessOffset||this.colorRamp))return d;this._stretchFunction._stretch(d);var f=d.pixelBlock,e=this.bandIndex?this.bandIndex[0]:0;f&&1<f.pixels.length&&f.pixels.length>e&&(f.pixels=[f.pixels[e]],f.statistics&&(f.statistics=[f.statistics[e]]));this.colorRamp&&(d=this._clrFunction._colorize(d));if(this.contrastOffset||this.brightnessOffset)d.pixelBlock=a.contrastBrightnessStretch(d.pixelBlock,
{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return d},drawGL:function(d){this._updateStretchParameters();d.pixelBlock&&(d=this._clonePixelData(d));var f=d.pixelBlock,e=this.bandIndex?this.bandIndex[0]||0:0,h=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,c=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,g,n;f&&1<f.pixels.length&&
f.pixels.length>e&&(f.pixels=[f.pixels[e]],f.statistics&&(f.statistics=[f.statistics[e]]),h&&h.length>e&&(g=[h[e]]),c&&c.length>e&&(n=[c[e]]));this._stretchFunction.functionArguments.statistics=g||h;this._stretchFunction.functionArguments.histograms=n||c;f=!!this.colorRamp;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!1,this._function.renderTexture=!0,d=this._stretchFunction._stretchGL(d),f&&(d=this._clrFunction._colorizeGL(d)),
this._function._cbGL(d)):f?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!0,d=this._stretchFunction._stretchGL(d),this._clrFunction._colorizeGL(d)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(d))},toJson:function(){var d=this._stretchFunction.toJson().rasterFunctionArguments;d.colorRamp=this.colorRamp||"";this.invert&&(d.invert=!0);d.contrastOffset=this.contrastOffset;d.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,
rendererArguments:d}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp,min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:k.clone(this.statistics),dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,
gamma:k.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var d=this._stretchFunction.functionArguments;d.stretchType=this.stretchType;d.min=this.min;d.max=this.max;d.numberOfStandardDeviations=this.numberOfStandardDeviations;d.statistics=this.statistics;d.histograms=this.histograms;d.dra=this.dra;d.minPercent=this.minPercent;d.maxPercent=this.maxPercent;d.useGamma=this.useGamma;d.gamma=this.gamma;d.computeGamma=this.computeGamma;
this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterClassBreaksRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../function/RemapFunction"],function(H,k,p,r,m){return H([p],{declaredClass:"esri.layers.rasterLib.renderer.RasterClassBreaksRenderer",rendererName:"ClassBreaks",renderTexture:!0,constructor:function(l){l=l||{};this._function=new m(l);this._function.outputPixelType="U8";var b=
l.classBreakInfos;l=l.minValue;null!=l&&b&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(l,b))},bind:function(l){this.inherited(arguments);this.isColormapFunction=!1;var b=this.raster&&this.raster.rasterInfo||this._rawRasterInfo,a=b&&b.vat;if(a&&"u8"===b.pixelType.toLowerCase()&&this.classBreakInfos){var d=this.field;if(b=a.fields.filter(function(n){return"value"===n.name.toLowerCase()})[0])var f=b.name;var e=a.features.sort(function(n,q){return parseFloat(n.attributes[d])-
parseFloat(q.attributes[d])})[0].attributes[d];this.isColormapFunction=!0;var h=[],c=this.field,g=this.classBreakInfos;g.forEach(function(n,q){a.features.forEach(function(v){var u=g[q-1]&&g[q-1].classMaxValue||e;v.attributes[c]<=n.classMaxValue&&(v.attributes[c]>u||v.attributes[c]===e)&&(u=n.symbol.color,h.some(function(t){return t[0]===v.attributes[f]})||h.push([v.attributes[f]].concat(u)))})});this._function=new r({colormap:h});this.colormap=h;this._function.outputPixelType="U8";this._function.renderTexture=
!0}this._function&&this._function.setProcessingContext(k.mixin({useProcessedData:!0},this._processingContext))},draw2D:function(l){if(this.isColormapFunction)return this._updateColormapParameters(),l=this._clonePixelData(l),l=this._function._colorize(l);this._updateRemapParameters();return this._function._remap(l)},drawGL:function(l){this.isColormapFunction?(this._updateColormapParameters(),this._function._colorizeGL(l)):(this._function.renderTexture=!0,this._updateRemapParameters(),this._function._remapGL(l))},
toJson:function(){var l=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:l}},toCommonRendererJson:function(){var l,b=this.classBreakInfos,a=this.colorBreaks;if(null==b&&a)for(b=[],l=0;l<a.length-1;l++)b.push({classMaxValue:a[l+1].value,symbol:{color:a[l].mappedColor,type:"esriSFS",style:"esriSFSSolid"},label:a[l].value+" - "+a[l+1].value});return{type:"classBreaks",field:"Value",minValue:null!=this.minValue?this.minValue:a[0].value,classBreakInfos:b}},
_updateRemapParameters:function(){var l=this.classBreakInfos,b=this.minValue;null!=b&&l&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(b,l))},_getSortedColorBreaks:function(l,b){b=b.map(function(d){return{maxValue:d.classMaxValue,color:d.symbol.color}}).sort(function(d,f){return d.maxValue-f.maxValue});var a=[{value:l,mappedColor:b[0].color}];for(l=0;l<b.length;l++)a.push({value:b[l].maxValue,mappedColor:l===b.length-1?b[l].color:b[l+1].color});return a},_updateColormapParameters:function(){this._function.functionArguments.colormap=
this.colormap;this._function.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterShadedReliefRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/HillshadeFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(H,k,p,r,m,l,b){return H([p],{declaredClass:"esri.layers.rasterLib.renderer.RasterShadedReliefRenderer",rendererName:"ShadedRelief",hillshadeType:null,azimuth:315,
altitude:45,zFactor:1,slopeType:null,psPower:.664,psFactor:.024,raster:null,constructor:function(a){this.hillshadeType="number"===typeof this.hillshadeType?this.hillshadeType:["traditional","multi-directional"].indexOf(this.hillshadeType);a&&a.scalingType&&(this.slopeType="adjusted"===a.scalingType?3:1);a&&a.pixelSizePower&&(this.psPower=a.pixelSizePower);a&&a.pixelSizeFactor&&(this.psFactor=a.pixelSizeFactor);a=k.mixin({},a,{hillshadeType:this.hillshadeType,psPower:this.psPower,psFactor:this.psFactor,
slopeType:this.slopeType});Object.keys(a).forEach(function(d){null==a[d]&&delete a[d]});this._function=new m(a);this._hillshadeFunction=new r(a);this._hillshadeFunction.outputPixelType="U8";this._hillshadeFunction.renderTexture=!1;this._function.functionArguments.raster=this._hillshadeFunction},hasTilingEffects:function(){return this._hillshadeFunction.hasTilingEffects()},draw2D:function(a){this._updateHillshadeParameters();a=this._clonePixelData(a);a=this._hillshadeFunction.read2D({raster:a});if(this.contrastOffset||
this.brightnessOffset)a.pixelBlock=b.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return a},drawGL:function(a){this._updateHillshadeParameters();this.contrastOffset||this.brightnessOffset?(this._hillshadeFunction.renderTexture=!1,this._function.renderTexture=!0,a=this._hillshadeFunction.readGL({raster:a}),this._function._cbGL(a)):(this._hillshadeFunction.renderTexture=!0,this._hillshadeFunction.readGL({raster:a}))},toJson:function(){var a=
this._hillshadeFunction.toJson().rasterFunctionArguments;a.colorRamp=this.colorRamp||"";this.invert&&(a.invert=!0);a.contrastOffset=this.contrastOffset;a.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:a}},toCommonRendererJson:function(){return{type:"rasterShadedRelief",hillshadeType:["traditional","multi-directional"][this.hillshadeType]||"traditional",azimuth:this.azimuth,altitude:this.altitude,zFactor:this.zFactor,scalingType:3===this.slopeType?"adjusted":
"none",pixelSizePower:this.psPower,pixelSizeFactor:this.psFactor,colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp}},_updateHillshadeParameters:function(){var a=this._hillshadeFunction.functionArguments;a.hillshadeType=this.hillshadeType;a.azimuth=this.azimuth;a.altitude=this.altitude;a.zFactor=this.zFactor;a.slopeType=this.slopeType;a.psPower=this.psPower;a.psFactor=this.psFactor}})})},"esri/layers/rasterLib/raster/rasterProjectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/sniff ../../../kernel ../../../WKIDUnitConversion ../../../geometry/Extent ../../../geometry/projection ../../../geometry/webMercatorUtils ../../../SpatialReference ../../../geometry/Point".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e){H={requirePE:function(c,g){return!(c.equals(g)||c._canProject(g))},load:function(){var c=new p;if(!this._loadPromise)if(a.isSupported())this._loadPromise=a.load();else{var g=new p;g.reject("projection engine is not supported on this version of the browser, please try with a modern browser");this._loadPromise=g.promise}this._loadPromise.isFulfilled()?this._loadPromise.isResolved()?c.resolve():this._loadPromise.isRejected()&&c.resolve():(this._pendingdfds=this._pendingdfds||
[],this._pendingdfds.push(c),this._loadPromise.then(k.hitch(this,function(){this._pendingdfds.forEach(function(n){n.isFulfilled()||n.resolve()})}),k.hitch(this,function(){this._pendingdfds.forEach(function(n){n.isFulfilled()||n.reject()})})));return c.promise},computeError:function(c,g){return[Math.abs((c[0]+c[4]+c[4*g.rows]+c[4*g.rows+4])/4-c[2*g.rows+2]),Math.abs((c[1]+c[5]+c[4*g.rows+1]+c[4*g.rows+5])/4-c[2*g.rows+3])]},getDefaultDatumTransformationForDataset:function(c,g,n){if(!(g&&c.spatialReference&&
this.requirePE(c.spatialReference,g)&&a.isLoaded()))return null;c=new b(c.toJson());g=new f(g.toJson());return n?a.getTransformation(g,c.spatialReference,c):a.getTransformation(c.spatialReference,g,c)},project:function(c,g,n){if(!g||c.spatialReference.equals(g))return c;var q=a.isLoaded()?a:d;"esri.geometry.Extent"===c.declaredClass?c=new b(c.toJson()):"esri.geometry.Point"===c.declaredClass&&(c=new e(c.toJson()));g=new f(g.toJson());(c=q.project(c,g))&&"esri.geometry.Extent"===c.declaredClass?(c=
new b(c.toJson()),n&&(1E-5>Math.abs(c.xmin+180)&&1E-5>Math.abs(c.xmax-180)?(c.xmin=0,c.xmax=360):(0>c.xmin&&(c.xmin+=360,c.xmax+=360),0>c.xmax&&(c.xmax+=360)))):c&&"esri.geometry.Point"===c.declaredClass&&(c=new e(c.toJson()),n&&0>c.x&&(c.x+=360));return c},projectResolution:function(c,g,n){var q=n.xmin+(n.xmax-n.xmin)/2;n=n.ymin+(n.ymax-n.ymin)/2;c=new b(q,n,q+c.x,n+c.y,c.spatialReference);c=this.project(c,g);return new e(c.xmax-c.xmin,c.ymax-c.ymin,g)},getProjectionOffsetGrid:function(c,g,n,q,v,
u,t){null==t&&(t=[32,32]);var y=c.xmin,D=c.ymin,B=c.xmax,E=c.ymax,x=c.spatialReference,w=g.spatialReference,A=a.isLoaded()?a:d,z=v?-v:null,G=t[0]*n.x,I=t[1]*n.y;B={cols:Math.ceil((B-y)/G)+1,rows:Math.ceil((E-D)/I)+1};c=[];for(E=0;E<B.cols;E++){var K=R;var R=[];for(n=0;n<B.rows;n++){var U=new e({x:y+G*E,y:D+I*n,spatialReference:x});U=A.project(U,w,u);if(!U)return null;q&&0>U.x&&(U.x+=360);R.push(U);0<E&&null!=z&&U.x<K[n].x&&(U.x+=v-z,U.x<K[n].x&&(U.x+=v-z));c.push((U.x-g.xmin)/(g.xmax-g.xmin));c.push((U.y-
g.ymin)/(g.ymax-g.ymin))}}g=this.computeError(c,B);q=new Float32Array((B.cols-1)*(B.rows-1)*12);v=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);u=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(E=0;E<B.cols-1;E++)for(n=0;n<B.rows-1;n++){G=E*B.rows*2+2*n;y=c[G];D=c[G+1];R=c[G+2];x=c[G+3];G+=2*B.rows;w=c[G];A=c[G+1];z=c[G+2];I=c[G+3];K=0;U=12*(n*(B.cols-1)+E);for(G=0;3>G;G++)q[U++]=v[K++]*y+v[K++]*R+v[K++]*z;for(G=K=0;3>G;G++)q[U++]=v[K++]*D+v[K++]*x+v[K++]*I;for(G=K=0;3>G;G++)q[U++]=u[K++]*y+u[K++]*w+u[K++]*
z;for(G=K=0;3>G;G++)q[U++]=u[K++]*D+u[K++]*A+u[K++]*I}return{offsets:c,error:g,coefficients:q,spacing:t,size:[B.cols-1,B.rows-1]}},getHalfWorldWidth:function(c){var g=c&&c.wkid;if(null!=g)return c.isWebMercator()&&(g=3857),null==l[g]?180:h[g]}};r("extend-esri")&&k.setObject("layers.rasterLib.raster.rasterProjectionHelper",H,m);var h={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,
32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,
54100:2.0037508342789244E7,54101:2.0037508342789244E7};return H})},"esri/geometry/projection":function(){define("require exports dojo/Deferred ./pe ../SpatialReference ./GeographicTransformation".split(" "),function(H,k,p,r,m,l){function b(h,c,g,n,q){void 0===n&&(n=null);void 0===q&&(q=!1);if(null===n){var v=l.cacheKey(c,g);void 0!==e[v]?n=e[v]:(n=a(c,g,null),null===n&&(n=new l),e[v]=n)}return d._project(h,c,g instanceof m||!1===q?g:new m(g),n,q)}function a(h,c,g){void 0===g&&(g=null);h=d._getTransformation(h,
c,g);return null!==h?l.fromGE(h):null}Object.defineProperty(k,"__esModule",{value:!0});var d=null;k.isLoaded=function(){return!!d&&r.isLoaded()};k.isSupported=function(){return r.isSupported()};var f=null;k.load=function(){if(f)return f.promise;f=new p;var h=r.load();H(["./geometryEngine"],function(c){d=c;h.then(function(){d._enableProjection(r);f.resolve()},function(g){f.reject(g)})});return f.promise};k.project=function(h,c,g){void 0===g&&(g=null);return h instanceof Array?0===h.length?[]:b(h,h[0].spatialReference,
c,g):b([h],h.spatialReference,c,g)[0]};var e={};k.projectMany=b;k.getTransformation=a;k.getTransformations=function(h,c,g){void 0===g&&(g=null);h=d._getTransformationBySuitability(h,c,g);if(null!==h){c=[];for(g=0;g<h.length;g++)c.push(l.fromGE(h[g]));return c}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","dojo/Deferred","../core/sniff"],function(H,k,p,r,m){function l(v){function u(B,E,x){B[E]=x(B[E])}k._pe=v;h.init();c.init();g.init();n.init();
q.init();k.PeGCSExtent=function(B){function E(){return null!==B&&B.apply(this,arguments)||this}p(E,B);E.prototype.destroy=function(){k._pe.destroy(this)};return E}(k._pe.PeGCSExtent);for(var t=0,y=[k._pe.PeDatum,k._pe.PeGeogcs,k._pe.PeGeogtran,k._pe.PeObject,k._pe.PeParameter,k._pe.PePrimem,k._pe.PeProjcs,k._pe.PeSpheroid,k._pe.PeUnit];t<y.length;t++)v=y[t],u(v.prototype,"getName",function(B){return function(){return B.call(this,Array(h.PE_NAME_MAX))}});t=0;for(y=[k._pe.PeGeogtran,k._pe.PeProjcs];t<
y.length;t++)v=y[t],u(v.prototype,"getParameters",function(B){return function(){for(var E=Array(h.PE_PARM_MAX),x=B.call(this),w=0;w<E.length;w++){var A=k._pe.getValue(x,"*");E[w]=A?k._pe.wrapPointer(A,k._pe.PeParameter):null;x+=Int32Array.BYTES_PER_ELEMENT}return E}});u(k._pe.PeHorizon.prototype,"getCoord",function(B){return function(){var E=this.getSize();if(!E)return null;var x=[],w=B.call(this);f(x,E,w);return x}});u(k._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(B){var E=k._pe._pe_getPeGTlistExtendedGTsSize();
return function(){var x=null,w=B.call(this);if(!k._pe.compare(w,k._pe.NULL)){x=[w];var A=this.getSteps();if(1<A){w=k._pe.getPointer(w);for(var z=1;z<A;z++)x.push(k._pe.wrapPointer(w+E*z,k._pe.PeGTlistExtendedGTs))}}return x}});var D=k._pe._pe_getPeHorizonSize();v=function(B){return function(){var E=this._cache;E||(this._cache=E=new Map);if(E.has(B))return E.get(B);var x=null,w=B.call(this);if(!k._pe.compare(w,k._pe.NULL)){x=[w];var A=w.getNump();if(1<A){w=k._pe.getPointer(w);for(var z=1;z<A;z++)x.push(k._pe.wrapPointer(w+
D*z,k._pe.PeHorizon))}}E.set(B,x);return x}};u(k._pe.PeProjcs.prototype,"horizonGcsGenerate",v);u(k._pe.PeProjcs.prototype,"horizonPcsGenerate",v);k._pe.PeObject.prototype.toString=function(B){void 0===B&&(B=h.PE_STR_OPTS_NONE);k._pe.ensureCache.prepare();var E=k._pe.getPointer(this),x=k._pe.ensureInt8(Array(h.PE_BUFFER_MAX));return k._pe.UTF8ToString(k._pe._pe_object_to_string_ext(E,B,x))}}function b(v){if(v){var u=k._pe.getClass(v);u&&(u=k._pe.getCache(u))&&(v=k._pe.getPointer(v))&&delete u[v]}}
function a(v,u){var t=[];u=Array(u);for(var y=0;y<v;y++)t.push(k._pe.ensureInt8(u));return t}function d(v){if(Array.isArray(v[0])){var u=[];v.forEach(function(t){u.push(t[0],t[1])})}else u=v;return u}function f(v,u,t,y){void 0===y&&(y=!1);if(y)for(y=0;y<2*u;y++)v[y]=k._pe.getValue(t+y*Float64Array.BYTES_PER_ELEMENT,"double");else{var D=0===v.length;for(y=0;y<u;y++)D&&(v[y]=Array(2)),v[y][0]=k._pe.getValue(t,"double"),v[y][1]=k._pe.getValue(t+Float64Array.BYTES_PER_ELEMENT,"double"),t+=2*Float64Array.BYTES_PER_ELEMENT}}
Object.defineProperty(k,"__esModule",{value:!0});var e;k._pe=null;k.isLoaded=function(){return!!k._pe};k.isSupported=function(){return!!m("esri-wasm")};k.load=function(){if(e)return e.promise;e=new r;H(["./support/pe-wasm"],function(v){v({locateFile:function(u){return H.toUrl("./support/"+u)},onAbort:function(u){e.reject(Error(u))}}).then(function(u){l(u);e.resolve()})});return e.promise};(function(v){function u(D,B,E){k._pe.ensureCache.prepare();var x=d(E),w=E===x;x=k._pe.ensureFloat64(x);(D=k._pe._pe_geog_to_proj(k._pe.getPointer(D),
B,x))&&f(E,B,x,w);return D}function t(D,B,E){return y(D,B,E,0)}function y(D,B,E,x){k._pe.ensureCache.prepare();var w=d(E),A=E===w;w=k._pe.ensureFloat64(w);(D=k._pe._pe_proj_to_geog_center(k._pe.getPointer(D),B,w,x))&&f(E,B,w,A);return D}v.geogToProj=u;v.projGeog=function(D,B,E,x){switch(x){case h.PE_TRANSFORM_P_TO_G:return t(D,B,E);case h.PE_TRANSFORM_G_TO_P:return u(D,B,E)}return 0};v.projToGeog=t;v.projToGeogCenter=y})(k.PeCSTransformations||(k.PeCSTransformations={}));var h;(function(v){v.init=
function(){v.PE_BUFFER_MAX=k._pe.PeDefs.prototype.PE_BUFFER_MAX;v.PE_NAME_MAX=k._pe.PeDefs.prototype.PE_NAME_MAX;v.PE_MGRS_MAX=k._pe.PeDefs.prototype.PE_MGRS_MAX;v.PE_USNG_MAX=k._pe.PeDefs.prototype.PE_USNG_MAX;v.PE_DD_MAX=k._pe.PeDefs.prototype.PE_DD_MAX;v.PE_DDM_MAX=k._pe.PeDefs.prototype.PE_DDM_MAX;v.PE_DMS_MAX=k._pe.PeDefs.prototype.PE_DMS_MAX;v.PE_UTM_MAX=k._pe.PeDefs.prototype.PE_UTM_MAX;v.PE_PARM_MAX=k._pe.PeDefs.prototype.PE_PARM_MAX;v.PE_TYPE_NONE=k._pe.PeDefs.prototype.PE_TYPE_NONE;v.PE_TYPE_GEOGCS=
k._pe.PeDefs.prototype.PE_TYPE_GEOGCS;v.PE_TYPE_PROJCS=k._pe.PeDefs.prototype.PE_TYPE_PROJCS;v.PE_TYPE_GEOGTRAN=k._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;v.PE_TYPE_COORDSYS=k._pe.PeDefs.prototype.PE_TYPE_COORDSYS;v.PE_TYPE_UNIT=k._pe.PeDefs.prototype.PE_TYPE_UNIT;v.PE_STR_OPTS_NONE=k._pe.PeDefs.prototype.PE_STR_OPTS_NONE;v.PE_STR_AUTH_NONE=k._pe.PeDefs.prototype.PE_STR_AUTH_NONE;v.PE_STR_AUTH_TOP=k._pe.PeDefs.prototype.PE_STR_AUTH_TOP;v.PE_STR_NAME_CANON=k._pe.PeDefs.prototype.PE_STR_NAME_CANON;v.PE_PARM_X0=
k._pe.PeDefs.prototype.PE_PARM_X0;v.PE_PARM_ND=k._pe.PeDefs.prototype.PE_PARM_ND;v.PE_TRANSFORM_1_TO_2=k._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;v.PE_TRANSFORM_2_TO_1=k._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;v.PE_TRANSFORM_P_TO_G=k._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;v.PE_TRANSFORM_G_TO_P=k._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;v.PE_HORIZON_RECT=k._pe.PeDefs.prototype.PE_HORIZON_RECT;v.PE_HORIZON_POLY=k._pe.PeDefs.prototype.PE_HORIZON_POLY;v.PE_HORIZON_LINE=k._pe.PeDefs.prototype.PE_HORIZON_LINE;
v.PE_HORIZON_DELTA=k._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(h=k.PeDefs||(k.PeDefs={}));(function(v){function u(B,E){var x=null,w=y[B];w||(w={},y[B]=w);w.hasOwnProperty(String(E))?x=w[E]:(B=k._pe.PeFactory.prototype.factoryByType(B,E),k._pe.compare(B,k._pe.NULL)||(x=B,w[E]=x));return x=t(x)}function t(B){if(B){var E=B.getType();switch(E){case h.PE_TYPE_GEOGCS:B=k._pe.castObject(B,k._pe.PeGeogcs);break;case h.PE_TYPE_PROJCS:B=k._pe.castObject(B,k._pe.PeProjcs);break;case h.PE_TYPE_GEOGTRAN:B=k._pe.castObject(B,
k._pe.PeGeogtran);break;default:E&h.PE_TYPE_UNIT&&(B=k._pe.castObject(B,k._pe.PeUnit))}}return B}var y={},D={};v.initialize=function(){k._pe.PeFactory.prototype.initialize(null)};v.coordsys=function(B){return u(h.PE_TYPE_COORDSYS,B)};v.factoryByType=u;v.fromString=function(B,E){var x=null,w=D[B];w||(w={},D[B]=w);w.hasOwnProperty(E)?x=w[E]:(B=k._pe.PeFactory.prototype.fromString(B,E),k._pe.compare(B,k._pe.NULL)||(x=B,w[E]=x));return x=t(x)};v.geogcs=function(B){return u(h.PE_TYPE_GEOGCS,B)};v.geogtran=
function(B){return u(h.PE_TYPE_GEOGTRAN,B)};v.getCode=function(B){return k._pe.PeFactory.prototype.getCode(B)};v.projcs=function(B){return u(h.PE_TYPE_PROJCS,B)};v.unit=function(B){return u(h.PE_TYPE_UNIT,B)}})(k.PeFactory||(k.PeFactory={}));k.PeGCSExtent=null;var c;(function(v){var u;v.init=function(){v.PE_GTLIST_OPTS_COMMON=k._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;u=k._pe._pe_getPeGTlistExtendedEntrySize()};v.getGTlist=function(t,y,D,B,E,x){var w=null,A=new k._pe.PeInteger(x);try{var z=
k._pe.PeGTlistExtended.prototype.getGTlist(t,y,D,B,E,A);if(x=A.val)if(w=[z],1<x){var G=k._pe.getPointer(z);for(t=1;t<x;t++)w.push(k._pe.wrapPointer(G+u*t,k._pe.PeGTlistExtendedEntry))}}finally{k._pe.destroy(A)}return w}})(c=k.PeGTlistExtended||(k.PeGTlistExtended={}));(function(v){v.destroy=function(u){if(u&&u.length){for(var t=0;t<u.length;t++){var y=u[t];b(y);y.getEntries().forEach(function(D){b(D);D=D.getGeogtran();b(D);D.getParameters().forEach(b);[D.getGeogcs1(),D.getGeogcs2()].forEach(function(B){b(B);
var E=B.getDatum();b(E);b(E.getSpheroid());b(B.getPrimem());b(B.getUnit())})})}k._pe.PeGTlistExtendedEntry.prototype.Delete(u[0])}}})(k.PeGTlistExtendedEntry||(k.PeGTlistExtendedEntry={}));(function(v){v.geogToGeog=function(u,t,y,D,B){k._pe.ensureCache.prepare();var E=d(y),x=y===E;E=k._pe.ensureFloat64(E);var w=0;D&&(w=k._pe.ensureFloat64(D));(u=k._pe._pe_geog_to_geog(k._pe.getPointer(u),t,E,w,B))&&f(y,t,E,x);return u}})(k.PeGTTransformations||(k.PeGTTransformations={}));(function(v){function u(y,
D,B,E,x,w){k._pe.ensureCache.prepare();switch(y){case "dd":var A=k._pe._pe_geog_to_dd;var z=h.PE_DD_MAX;break;case "ddm":A=k._pe._pe_geog_to_ddm;z=h.PE_DDM_MAX;break;case "dms":A=k._pe._pe_geog_to_dms,z=h.PE_DMS_MAX}y=0;D&&(y=k._pe.getPointer(D));D=d(E);D=k._pe.ensureFloat64(D);z=a(B,z);E=k._pe.ensureInt32(z);if(x=A(y,B,D,x,E))for(A=0;A<B;A++)w[A]=k._pe.UTF8ToString(z[A]);return x}function t(y,D,B,E,x){k._pe.ensureCache.prepare();switch(y){case "dd":var w=k._pe._pe_dd_to_geog;break;case "ddm":w=k._pe._pe_ddm_to_geog;
break;case "dms":w=k._pe._pe_dms_to_geog}y=0;D&&(y=k._pe.getPointer(D));D=E.map(function(A){return k._pe.ensureString(A)});E=k._pe.ensureInt32(D);D=k._pe.ensureFloat64(Array(2*B));(w=w(y,B,E,D))&&f(x,B,D);return w}v.geog_to_dms=function(y,D,B,E,x){return u("dms",y,D,B,E,x)};v.dms_to_geog=function(y,D,B,E){return t("dms",y,D,B,E)};v.geog_to_ddm=function(y,D,B,E,x){return u("ddm",y,D,B,E,x)};v.ddm_to_geog=function(y,D,B,E){return t("ddm",y,D,B,E)};v.geog_to_dd=function(y,D,B,E,x){return u("dd",y,D,
B,E,x)};v.dd_to_geog=function(y,D,B,E){return t("dd",y,D,B,E)}})(k.PeNotationDms||(k.PeNotationDms={}));var g;(function(v){v.init=function(){v.PE_MGRS_STYLE_NEW=k._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;v.PE_MGRS_STYLE_OLD=k._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;v.PE_MGRS_STYLE_AUTO=k._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;v.PE_MGRS_180_ZONE_1_PLUS=k._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;v.PE_MGRS_ADD_SPACES=k._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};
v.geog_to_mgrs_extended=function(u,t,y,D,B,E,x){k._pe.ensureCache.prepare();var w=0;u&&(w=k._pe.getPointer(u));u=d(y);y=k._pe.ensureFloat64(u);u=a(t,h.PE_MGRS_MAX);var A=k._pe.ensureInt32(u);if(D=k._pe._pe_geog_to_mgrs_extended(w,t,y,D,B,E,A))for(B=0;B<t;B++)x[B]=k._pe.UTF8ToString(u[B]);return D};v.mgrs_to_geog_extended=function(u,t,y,D,B){k._pe.ensureCache.prepare();var E=0;u&&(E=k._pe.getPointer(u));u=y.map(function(x){return k._pe.ensureString(x)});y=k._pe.ensureInt32(u);u=k._pe.ensureFloat64(Array(2*
t));(D=k._pe._pe_mgrs_to_geog_extended(E,t,y,D,u))&&f(B,t,u);return D}})(g=k.PeNotationMgrs||(k.PeNotationMgrs={}));(function(v){v.geog_to_usng=function(u,t,y,D,B,E,x){k._pe.ensureCache.prepare();var w=0;u&&(w=k._pe.getPointer(u));u=d(y);y=k._pe.ensureFloat64(u);u=a(t,h.PE_MGRS_MAX);var A=k._pe.ensureInt32(u);if(D=k._pe._pe_geog_to_usng(w,t,y,D,B,E,A))for(B=0;B<t;B++)x[B]=k._pe.UTF8ToString(u[B]);return D};v.usng_to_geog=function(u,t,y,D){k._pe.ensureCache.prepare();var B=0;u&&(B=k._pe.getPointer(u));
u=y.map(function(E){return k._pe.ensureString(E)});y=k._pe.ensureInt32(u);u=k._pe.ensureFloat64(Array(2*t));(B=k._pe._pe_usng_to_geog(B,t,y,u))&&f(D,t,u);return B}})(k.PeNotationUsng||(k.PeNotationUsng={}));var n;(function(v){v.init=function(){v.PE_UTM_OPTS_NONE=k._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;v.PE_UTM_OPTS_ADD_SPACES=k._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;v.PE_UTM_OPTS_NS=k._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};v.geog_to_utm=function(u,t,y,D,B){k._pe.ensureCache.prepare();
var E=0;u&&(E=k._pe.getPointer(u));u=d(y);y=k._pe.ensureFloat64(u);u=a(t,h.PE_UTM_MAX);var x=k._pe.ensureInt32(u);if(D=k._pe._pe_geog_to_utm(E,t,y,D,x))for(E=0;E<t;E++)B[E]=k._pe.UTF8ToString(u[E]);return D};v.utm_to_geog=function(u,t,y,D,B){k._pe.ensureCache.prepare();var E=0;u&&(E=k._pe.getPointer(u));u=y.map(function(x){return k._pe.ensureString(x)});y=k._pe.ensureInt32(u);u=k._pe.ensureFloat64(Array(2*t));(D=k._pe._pe_utm_to_geog(E,t,y,D,u))&&f(B,t,u);return D}})(n=k.PeNotationUtm||(k.PeNotationUtm=
{}));var q;(function(v){var u=new Map;v.init=function(){v.PE_PCSINFO_OPTION_NONE=k._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;v.PE_PCSINFO_OPTION_DOMAIN=k._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;v.PE_POLE_OUTSIDE_BOUNDARY=k._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;v.PE_POLE_POINT=k._pe.PePCSInfo.prototype.PE_POLE_POINT};v.generate=function(t,y){void 0===y&&(y=v.PE_PCSINFO_OPTION_DOMAIN);var D;if(u.has(t)){var B=u.get(t);B[y]&&(D=B[y])}D||(D=k._pe.PePCSInfo.prototype.generate(t,
y),B||(B=[],u.set(t,B)),B[y]=D);return D}})(q=k.PePCSInfo||(k.PePCSInfo={}));(function(v){v.version_string=function(){return k._pe.PeVersion.prototype.version_string()}})(k.PeVersion||(k.PeVersion={}));k._init=l})},"esri/core/tsSupport/extendsHelper":function(){define([],function(){return function(){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,p){k.__proto__=p}||function(k,p){for(var r in p)p.hasOwnProperty(r)&&(k[r]=p[r])};return function(k,p){function r(){this.constructor=
k}H(k,p);k.prototype=null===p?Object.create(p):(r.prototype=p.prototype,new r)}}()})},"esri/geometry/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(H,k,p){return function(){function r(m){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(m&&m.steps){var l=0;for(m=m.steps;l<m.length;l++){var b=m[l];b instanceof p?this.steps.push(b):this.steps.push(new p({wkid:b.wkid,wkt:b.wkt,isInverse:b.isInverse}))}}}r.cacheKey=
function(m,l){return[void 0!==m.wkid&&null!==m.wkid?m.wkid.toString():"-1",void 0!==m.wkt&&null!==m.wkt?m.wkt.toString():"",void 0!==l.wkid&&null!==l.wkid?l.wkid.toString():"-1",void 0!==l.wkt&&null!==l.wkt?l.wkt.toString():""].join()};r.fromGE=function(m){var l=new r,b="",a=0;for(m=m.steps;a<m.length;a++){var d=p.fromGE(m[a]);l.steps.push(d);b+=d.uid.toString()+","}l._cached_projection={};l._gtlistentry=null;l._chain=b;return l};r.prototype.getInverse=function(){var m=new r;m.steps=[];for(var l=
this.steps.length-1;0<=l;l--)m.steps.push(this.steps[l].getInverse());return m};r.prototype.getGTListEntry=function(){for(var m="",l=0,b=this.steps;l<b.length;l++)m+=b[l].uid.toString()+",";m!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=m);return this._gtlistentry};r.prototype.assignCachedGe=function(m,l,b){this._cached_projection[r.cacheKey(m,l)]=b};r.prototype.getCachedGeTransformation=function(m,l){for(var b="",a=0,d=this.steps;a<d.length;a++)b+=d[a].uid.toString()+
",";b!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=b);m=this._cached_projection[r.cacheKey(m,l)];return void 0===m?null:m};return r}()})},"esri/geometry/GeographicTransformationStep":function(){define(["require","exports"],function(H,k){var p=0;return function(){function r(m){void 0===m&&(m=null);this.uid=p++;m?(this._wkt=void 0!==m.wkt?m.wkt:null,this._wkid=void 0!==m.wkid?m.wkid:-1,this._isInverse=void 0!==m.isInverse?!0===m.isInverse:!1):(this._wkt=null,this._wkid=
-1,this._isInverse=!1)}r.fromGE=function(m){var l=new r;l._wkt=m.wkt;l._wkid=m.wkid;l._isInverse=m.isInverse;return l};Object.defineProperty(r.prototype,"wkt",{get:function(){return this._wkt},set:function(m){this._wkt=m;this.uid=p++},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"wkid",{get:function(){return this._wkid},set:function(m){this._wkid=m;this.uid=p++},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"isInverse",{get:function(){return this._isInverse},
set:function(m){this._isInverse=m;this.uid=p++},enumerable:!0,configurable:!0});r.prototype.getInverse=function(){var m=new r;m._wkt=this.wkt;m._wkid=this._wkid;m._isInverse=!this.isInverse;return m};return r}()})},"esri/layers/rasterLib/raster/TileServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E){H=k([E],{declaredClass:"esri.layers.rasterLib.raster.TileServiceRaster",constructor:function(x){},open:function(){var x=new r,w=this.serviceInfo||this._getServiceInfo(null),A=p.hitch(this,function(G){this.serviceInfo=G;this.version=G.currentVersion;this.rasterInfo=this._parseRasterInfo(G);this.loaded=!0;this._getRasterIdentifier();x.resolve(this)}),z=p.hitch(this,function(G){this.loaded=!0;this._getRasterIdentifier();x.reject(G)});f(w,A,z);return x.promise},
read:function(x){var w=this.url+"/tile/"+x.level+"/"+x.row+"/"+x.col,A={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};return this._requestPixels({url:w+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},decodeParams:A,tileOptions:x})},identify:function(x,w){null==w&&(w=this.tileInfo.lods[this.tileInfo.lods.length-1].level);var A=(x.x-this.tileInfo.origin.x)/
this.tileInfo.lods[w].resolution/this.tileInfo.cols;x=(this.tileInfo.origin.y-x.y)/this.tileInfo.lods[w].resolution/this.tileInfo.rows;var z=Math.floor(A),G=Math.floor(x),I=Math.floor((A-z)*this.tileInfo.cols);I=Math.min(I,this.tileInfo.cols-1);var K=Math.floor((x-G)*this.tileInfo.rows);K=Math.min(K,this.tileInfo.rows-1);var R=new r;this.read({level:w,row:G,col:z}).then(function(U){var ba=K*U.width+I;U&&U.pixels&&0<U.pixels.length?(U=U.mask?U.mask[ba]?U.pixels.map(function(ca){return ca[ba]}):null:
U.pixels.map(function(ca){return ca[ba]}),R.resolve(U)):R.reject("no valid data")},function(U){R.reject(U)});return R.promise},setFetchParameters:function(x,w){},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_getServiceInfo:function(){var x=this.url,w=new r(v._dfdCanceller);w._pendingDfd=c({url:x,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});w._pendingDfd.then(function(A){w.callback(A)},
function(A){w.errback(A)});return w},_parseRasterInfo:function(x){var w=new B;w.extent=new g(x.fullExtent);w.spatialReference=new q(x.spatialReference);this.tileType=x.cacheType||"Map";switch(this.tileType){case "Map":w.bandCount=3;w.pixelType="U8";this.dataType="Processed";break;case "Elevation":w.bandCount=1;w.pixelType=x.pixelType||"F32";this.dataType="Elevation";break;case "Raster":w.bandCount=null,w.pixelType=null,this.dataType=x.serviceDataType&&x.serviceDataType.replace("esriImageServiceDataType",
"")||"Generic"}var A=x.tileInfo;w.width=Math.floor((x.fullExtent.xmax-x.fullExtent.xmin)/A.lods[A.lods.length-1].resolution+.5);w.height=Math.floor((x.fullExtent.ymax-x.fullExtent.ymin)/A.lods[A.lods.length-1].resolution+.5);w.cellSize=new n({x:A.lods[A.lods.length-1].resolution,y:A.lods[A.lods.length-1].resolution,spatialReference:x.spatialReference});this.tileInfo=new D(A);this.tileInfo.tileType=this.tileType;return w}});a("extend-esri")&&p.setObject("layers.rasterLib.raster.TileServiceRaster",
H,e);return H})},"esri/layers/rasterLib/raster/TileRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E){H=k([E],{declaredClass:"esri.layers.rasterLib.raster.TileRaster",sourceType:"TileCache",_RECORD_SIZE:8,constructor:function(x){this._cloudBlobStorage=x&&x._cloudBlobStorage},open:function(){var x=new r,w=this.datasetInfo||this._getDatasetInfo(null),A=p.hitch(this,function(G){this.datasetInfo=G;this.rasterInfo=G=this._parseRasterInfo(G);this.tileType="Cache/LERC"===G.format?"Elevation":"Cache/MIXED"===G.format||"Cache/JPEG"===G.format||"Cache/PNG"===
G.format?"Map":"Raster";this.tileInfo=G.tileInfo;this.dataType=["Generic","Elevation","Processed"][["Raster","Elevation","Map"].indexOf(this.tileType)];this._HEADER_SIZE=G.packetSize*G.packetSize*this._RECORD_SIZE+64;this.loaded=!0;this._cloudBlobStorage=this._cloudBlobStorage||-1<this.url.toLowerCase().indexOf("s3.amazonaws.com")||-1<this.url.toLowerCase().indexOf("windows.net")||-1<this.url.toLowerCase().indexOf("googleapis.com");this._getRasterIdentifier();x.resolve(this)}),z=p.hitch(this,function(G){this.loaded=
!0;this._getRasterIdentifier();x.reject(G)});f(w,A,z);return x.promise},read:function(x){var w=new r,A=x.level,z=x.row,G=x.col,I=this._buildCacheFilePath(this.url,A,z,G),K=this._getIndexRecordFromBundle(A,z,G);c({url:I,content:{},headers:{Range:"bytes\x3d0-"+(this._HEADER_SIZE-1).toString()},handleAs:"arraybuffer"}).then(p.hitch(this,function(R,U){if(!w.isCanceled()){console.log("time in ms request "+(new Date-ba));var ba=new Date;R=new Uint8Array(R);R=this._getTileEndAndContentType(R,K);U={width:this.tileInfo.cols,
height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};this._requestPixels({url:I+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},headers:{Range:"bytes\x3d"+R.position.toString()+"-"+(R.position+R.recordSize).toString()},decodeParams:U,tileOptions:x}).then(function(ca){w.isCanceled()||w.resolve(ca)},function(ca){w.isCanceled()||w.reject(ca)})}}));return w.promise},identify:function(){return null},
setFetchParameters:function(x,w){},toJson:function(){return{url:this.url,tileInfo:this.tileInfo.toJson(),rasterInfo:this.rasterInfo.toJson(),datasetInfo:this.datasetInfo,sourceType:this.sourceType,tileType:this.tileType,_rasterId:this._rasterId}},_getDatasetInfo:function(){return c({url:this.url+"/conf.json",handleAs:"json",content:{}})},_parseRasterInfo:function(x){var w=new B;switch(x.pixelType){case 1:var A="U1";break;case 1:A="U2";break;case 2:A="U4";break;case 3:A="U8";break;case 4:A="S8";break;
case 5:A="U16";break;case 6:A="S16";break;case 7:A="U32";break;case 8:A="S32";break;case 9:A="F32";break;default:A="F32"}var z,G=[],I=x.LODInfos;for(z=0;z<I.levels.length;z++)G.push({level:I.levels[z],resolution:I.resolutions[z],scale:96/.0254*I.resolutions[z]});z=new q(x.extent.spatialReference||x.geodataXform.spatialReference);G=new D({rows:x.blockHeight,cols:x.blockWidth,dpi:96,format:x.format,compressionQuality:0,origin:x.origin,spatialReference:z,lods:G});w.pixelType=A;w.bandCount=x.bandCount;
w.spatialReference=z;w.extent=new g({xmin:x.extent.xmin,ymin:x.extent.ymin,xmax:x.extent.xmax,ymax:x.extent.ymax,spatialReference:z});w.cellSize=new n({x:x.pixelSizeX,y:x.pixelSizeY,spatialReference:z});w.width=Math.floor((w.extent.xmax-w.extent.xmin)/w.cellSize.x+.5);w.height=Math.floor((w.extent.ymax-w.extent.ymin)/w.cellSize.y+.5);w.statistics=x.statistics.map(function(K){Object.keys(K).forEach(function(R){isNaN(K[R])&&(K[R]=null)});return K});w.histograms=x.histograms;w.geodataXform=x.geodataXform;
w.packetSize=x.packetSize;w.format=x.format;w.compressionQuality=x.compressionQuality;w.tileInfo=G;return w},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_buildCacheFilePath:function(x,w,A,z){var G=this.rasterInfo.packetSize;z=Math.floor(z/G)*G;A="R"+this._toHexString4(Math.floor(A/G)*G)+"C"+this._toHexString4(z);G="L";G=10<=w?G+w.toString():G+("0"+w.toString());return this._cloudBlobStorage?x+"/_alllayers/"+
G+"/"+A+".bundle":x+"/"+G+"_"+A+"/bundle"},_getIndexRecordFromBundle:function(x,w,A){x=this.rasterInfo.packetSize;w=w%x*x+A%x;if(0>w)throw"Invalid level / row / col";return w*this._RECORD_SIZE+64},_getTileEndAndContentType:function(x,w){x=x.subarray(w,w+8);w=0;var A;for(A=0;5>A;A++)w|=(x[A]&255)<<8*A;var z=w&0xffffffffff;w=0;for(A=5;8>A;A++)w|=(x[A]&255)<<8*(A-5);return{position:z,recordSize:w&0xffffffffff}},_toHexString4:function(x){x=x.toString(16);if(4!=x.length)for(var w=4-x.length;0<w--;)x="0"+
x;return x}});a("extend-esri")&&p.setObject("layers.rasterLib.raster.TileRaster",H,e);return H})},"esri/layers/rasterLib/raster/FunctionRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff ../DeferredList2 dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../rasterFormats/rasterCodec ./RasterInfo ./BasicRaster ../../rasterLib/function/rasterFunctionHelper".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E){H=k([B],{declaredClass:"esri.layers.rasterLib.raster.FunctionRaster",rasterFunction:null,sourceType:"Function",constructor:function(x){x&&x.rasterFx&&this._init(x.rasterFx,x.rasterFxArgs)},open:function(){var x=this.getMemberRasters().map(function(A){return A.open()});this.identifiers=this.getMemberRasters().map(function(A){return A._rasterId});var w=new r;(new d(x,null,null,!0)).then(function(A){A.some(function(z){return!z[0]})?w.reject(A):
(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.tileInfo=A[0][1].tileInfo,w.resolve(this))}.bind(this));return w.promise},getProjectedFullExtent:function(x){var w=new r;this.getMemberRasters()[0].getProjectedFullExtent(x).then(p.hitch(this,function(A){this.projectedFullExtent=A;w.resolve(A)}));return w.promise},setProcessingContext:function(x){var w=x;x.layer&&(x=x.layer,
w={id:x.id,rawRasterInfo:x.raster.rasterInfo,glSetting:x._glSetting,xformSetting:x.tileManager&&x.tileManager.xformSetting,useWebGL:x.useWebGL,resampling:x.tileMode&&x.tileManager&&x.tileManager.xformSetting.requireProjection&&!x._hasTilingEffects&&"Thematic"!==x.raster.dataType?1:0,tileMode:x.tileMode});this.rasterFunction.setProcessingContext(w);this._layerOptions=w},alterDefinition:function(x){if(x=x||this.rasterFunction)1===this.memberRasters.length&&!x._bindComplete&&(this.rasterFunction=E.create(x,
{raster:this.memberRasters[0]}))&&(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.rasterFunction.setProcessingContext(this._layerOptions)),this._rasterHandler&&this._rasterHandler._connected&&this.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this._layerOptions.id,data:this.rasterFunction.toJson(!0)})},setFetchParameters:function(x,w){var A=this.getMemberRasters();
A&&1===A.length&&A[0].setFetchParameters(x,w)},getMemberRasters:function(){this.memberRasters||(this.memberRasters=[],this._getMemberRasters(this.rasterFunction.functionArguments,this.memberRasters));return this.memberRasters},read:function(x){var w=new r(g._dfdCanceller);if(x.src){var A=this.rasterFunction.read(x);w.resolve(A);return w.promise}var z=this.getMemberRasters().map(function(R){return R.read(x)});z=new d(z);var G,I,K=this.identifiers;w._pendingDfd=z;z.then(p.hitch(this,function(R){if(G=
R.some(function(U){return U[0]}))I={},R.forEach(function(U,ba){I[K[ba]]=U[0]?U[1]:null});A=I?this.rasterFunction.read({extent:x.extent,src:I}):null;A.srcData=I;w.resolve(A)}));return w},_init:function(x,w){if(this.rasterFunction=E.create(x,w))this.rasterFunction._bindComplete=!0;else throw"Cannot initialize a function raster without a raster function";},_getMemberRasters:function(x,w){var A=Object.keys(x),z,G,I;for(z=0;z<A.length;z++)if(I=x[A[z]]){var K=I instanceof Array?I:[I];for(G=0;G<K.length;G++)(I=
K[G])&&("function"===typeof I||"object"===typeof I)&&I.read&&(I.functionArguments?this._getMemberRasters(I.functionArguments,w):I.sourceType&&"Function"!==I.sourceType&&(I._identifier=I._getRasterIdentifier(),w.some(function(R){return R._identifier===I._identifier})||w.push(I)))}return w}});a("extend-esri")&&p.setObject("layers.rasterLib.raster.FunctionRaster",H,e);return H})},"esri/layers/rasterLib/DeferredList2":function(){define(["dojo/DeferredList"],function(H){return function(k,p,r,m,l){this.list=
k;p=new H(k,p,r,m,l);var b=p.resolve.bind(p),a=p.cancel.bind(p);p.cancel=function(){k&&k.forEach(function(d){d.cancel&&d.cancel()});a.apply(this,arguments)}.bind(p);p.resolve=function(){this.isFulfilled()||b.apply(this,arguments)}.bind(p);return p}})},"esri/layers/rasterLib/tile/RasterTileManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/when ../DeferredList2 ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../PixelBlock ./RasterTileInfo ../raster/rasterProjectionHelper".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e){var h=function(c,g){var n;for(n=0;n<c.length;n++)if(g(c[n]))return n;return-1};return H(null,{declaredClass:"esri.layers.rasterLib.tile.RasterTileManager",count:null,fullBoundary:null,tileBoundary:null,tiles:null,resolution:null,virtual:!0,prefetchBufferSize:0,_progressiveGlobal:!1,_MAX_TILES:128,_defaultMatrixResolution:20,constructor:function(c){this.tiles=[];this.xformSetting={};this.mapSpatialReference=c&&c.mapSR;this.layer=c&&c.layer;this.identifiers=this.layer.raster.rasterFunction?
this.layer.raster.getMemberRasters().map(function(g){return g._rasterId}):[this.layer.raster._rasterId];(c=c&&c.tileInfo)&&this.setTileInfo(c)},setTileInfo:function(c){this.tileInfo=c;this.virtual=c.virtual;this.mapResolution=null;this.tiles.length=0;this.xformSetting.requireProjection=!this.virtual&&!this.mapSpatialReference.equals(this.tileInfo.spatialReference);this.xformSetting.requirePE=e.requirePE(this.mapSpatialReference,this.tileInfo.spatialReference);this.xformSetting.meshSize=this.xformSetting.requireProjection?
[this._defaultMatrixResolution,this._defaultMatrixResolution]:[1,1];this.halfWorldWidth=e.getHalfWorldWidth(c.spatialReference)},updateResolution:function(c,g){if(!(this.mapResolution&&c&&this._resolutionEqual(this.mapResolution.x,c.x)&&this._resolutionEqual(this.mapResolution.y,c.y))){this.resetTiles();var n=this.xformSetting.requireProjection;this.mapResolution=this.resolution=c;n&&(this.resolution=e.projectResolution(c,this.tileInfo.spatialReference,this.layer.projectedFullExtent||g));this._resolution=
this.resolution;c=this.resolution;if(!this.tileInfo.virtual){n=.75*Math.min(c.x,c.y)+.25*Math.max(c.x,c.y);if(n>=this.tileInfo.lods[0].resolution){var q=this.tileInfo.lods[0];this.ooe=!0}else{if(n<=this.tileInfo.lods[this.tileInfo.lods.length-1].resolution)q=this.tileInfo.lods[this.tileInfo.lods.length-1];else for(c=0;c<this.tileInfo.lods.length-1;c++)if(q=this.tileInfo.lods[c],g=this.tileInfo.lods[c+1],q.resolution>=n&&g.resolution<=n){q.resolution-n>n-g.resolution&&(q=g);break}this.ooe=!1}this.level=
q&&q.level;c=this.resolution=new a({x:q.resolution,y:q.resolution,spatialReference:this.tileInfo.spatialReference})}n=this.layer.raster.rasterInfo.extent;q=this.tileInfo.origin;g=this.tileInfo.cols;var v=this.tileInfo.rows;this.fullBoundary={rowStart:Math.floor((q.y-n.ymax)/c.y/v),rowEnd:Math.floor((q.y-n.ymin-c.y)/c.y/v),colStart:Math.floor((n.xmin-q.x)/c.x/g),colEnd:Math.floor((n.xmax-q.x-c.x)/c.x/g)};if(n=this.halfWorldWidth){v=Math.ceil(n/c.x/(g/2));var u=this.tileInfo.applyGCS360Transform?360:
n,t=Math.round(g-(u-q.x)/c.x%g);t===g&&(t=0);this.fullBoundary.colRange=v;this.fullBoundary.paddingRight=t;this.fullBoundary.paddingLeft=Math.round((v*g*c.x+q.x-u-(this.tileInfo.applyGCS360Transform?0:q.x+n))/c.x)}this.hasNewData=!0}},getXformGrid:function(){var c=this.mapExtent,g=this.layer._hasTilingEffects?this.extent:this.fullExtent,n=this.layer.getCurrentResolution(),q=JSON.stringify(c.toJson())+JSON.stringify(g.toJson());this._datumTransformationInitialized||(this._datumTransformationInitialized=
!0,this._datumTransformation=e.getDefaultDatumTransformationForDataset(this.layer.raster.rasterInfo.extent,c.spatialReference,!0));this._cachedExtentString&&this._cachedExtentString===q||(this._cachedExtentString=q,this._xformGrid=c=e.getProjectionOffsetGrid(c,g,n,this.tileInfo.applyGCS360Transform,this.halfWorldWidth,this._datumTransformation));c=this._xformGrid;this.xformSetting.meshSize=c&&c.size;return c},getWrapTimes:function(c){var g=e.getHalfWorldWidth(c.spatialReference);if(!g)return 0;var n=
2*g;g=this.tileInfo.applyGCS360Transform?0:-g;return Math.floor((c.xmax-g)/n)-Math.floor((c.xmin-g)/n)},normalizeCoordinate:function(c,g){if(!g)return 0;var n=2*g;if(0<c){for(;c>g;)c-=n;return c}for(;c<-g;)c+=n;return c},resetTiles:function(){this.tiles.forEach(k.hitch(this,function(c){c.fetch&&!c.fetch.isCanceled()&&c.fetch.cancel();c.update&&!c.update.isCanceled()&&c.update.cancel()}));this.tiles.length=0},updateExtent:function(c,g){this.mapExtent=this.extent=c;var n=this.xformSetting.requireProjection;
if(n){this.extent=e.project(c,this.tileInfo.spatialReference,this.tileInfo.applyGCS360Transform);if(!this.extent)return;this.extent.spatialReference=new b(this.extent.spatialReference.toJson())}else if(c.spatialReference.isWebMercator()||4326===c.spatialReference.wkid){var q=4326===c.spatialReference.wkid?180:this.halfWorldWidth,v=c.xmin;if(v<-q||v>q){for(var u=c.xmax,t=2*q;v<-q;)v+=t,u+=t;for(;v>q;)v-=t,u-=t;this.mapExtent=this.extent=c=new l(v,c.ymin,u,c.ymax,c.spatialReference)}}this.updateResolution(g,
c);q=this.extent;v=this.tileInfo;u=v.cols;t=v.rows;g=this.resolution;var y=q;n=n?this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent;this.ooe&&(y=this._getIntersect(q,n));var D=Math.floor((y.xmin-v.origin.x)/g.x/u)-this.prefetchBufferSize,B=Math.floor((y.xmax-v.origin.x)/g.x/u)+this.prefetchBufferSize,E=null,x=this.getWrapTimes(c),w=this.fullBoundary&&this.fullBoundary.colRange;x&&this.halfWorldWidth&&(B===D&&(E=D),B+=x*w);if(c=this.halfWorldWidth&&this.tiles.length&&(x!==this.wrapTimes||
E!==this._circlularColId))this._wrapSwitchCount=this._wrapSwitchCount?this._wrapSwitchCount+1:1;this.wrapTimes=x;this._circlularColId=E;var A=Math.floor((v.origin.y-y.ymax)/g.y/t)-this.prefetchBufferSize;E=Math.floor((v.origin.y-y.ymin)/g.y/t)+this.prefetchBufferSize;this.tileBoundary={rowStart:A,rowEnd:E,colStart:D,colEnd:B};var z,G;((y=(E-A+1)*(B-D+1)>this._MAX_TILES||!this.virtual&&this._resolution.x>8*this.tileInfo.lods[0].resolution)||2<x||c)&&this.resetTiles();if(!(y||2<x)){y=this.tiles;c=!1;
for(z=y.length-1;0<=z;z--){var I=y[z].row;var K=y[z].wrapCol;if(I<A||I>E||K<D||K>B)y[z].fetch&&!y[z].fetch.isCanceled()&&y[z].fetch.cancel(),y[z].update&&!y[z].update.isCanceled()&&y[z].update.cancel(),y.splice(z,1),c=!0}for(z=A;z<=E;z++)for(G=D;G<=B;G++){A=new l(v.origin.x+g.x*u*G,v.origin.y-g.y*t*(z+1),v.origin.x+g.x*u*(G+1),v.origin.y-g.y*t*z,q.spatialReference);var R=x&&w?0<=G?G%w:w- -G%w:G;I=h(y,function(U){return U.row===z&&U.col===R&&U.wrapCol===G});K=n.xmax>=A.xmax?u:Math.round((n.xmax-A.xmin)/
g.x);-1===I&&(y.push({row:z,col:R,wrapCol:G,cellsizeX:g.x,cellsizeY:g.y,width:u,height:t,actualWidth:K,extent:A,normalizedExtent:this._wrapExtent(A,R),pixelBlock:null,virtual:this.virtual,level:this.level,tileType:this.tileInfo.tileType||"Raster"}),c=!0)}c&&this._sortTiles();g=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);this.width=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);this.height=g;this.count=y.length;g=Math.min.apply(null,y.map(function(U){return U.extent.xmin}));
v=Math.max.apply(null,y.map(function(U){return U.extent.xmax}));u=Math.min.apply(null,y.map(function(U){return U.extent.ymin}));t=Math.max.apply(null,y.map(function(U){return U.extent.ymax}));g=this.fullExtent=new l(g,u,v,t,q.spatialReference);if(this.layer.roaming||this.layer.useWebGL)this.layer._hasTilingEffects?(this.xformSetting.offset=[0,0],this.xformSetting.scale=[1,1]):(c&&(this._tilesChanged=!0),this.xformSetting.offset=[(q.xmin-g.xmin)/(g.xmax-g.xmin),-(g.ymin-q.ymin)/(g.ymax-g.ymin)],this.xformSetting.scale=
[(q.xmax-q.xmin)/(g.xmax-g.xmin),(q.ymax-q.ymin)/(g.ymax-g.ymin)])}},fetchTiles:function(c){(this._tilesChanged||c)&&this._fetchTiles(c)},_fetchTiles:function(c){this._fetchCounter=0;var g=this.extent;this.fetchAllCompleted=c?new p:null;(this._tilesChanged||c&&this.layer._hasTilingEffects)&&this.tiles.forEach(k.hitch(this,function(q){q.updateCompleted=!1}));var n={};!this.layer.roaming&&this.layer._hasTilingEffects&&c?(this.identifiers.forEach(function(q,v){n[q]={extent:this.extent,pixelBlock:new d({width:this.layer._map.width,
height:this.layer._map.height,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.extent,src:n,isEmpty:!0}):this._tilesChanged&&(this.identifiers.forEach(function(q,v){n[q]={extent:this.fullExtent,pixelBlock:new d({width:128,height:128,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.fullExtent,src:n,isEmpty:!0});this.tiles.forEach(k.hitch(this,function(q){if(q.fetch)q.update||(q.update=this.updateTile(q));
else{if(this._isTileOutSide(q,g)){q.updateCompleted=!0;return}this._requestTile(q)}this.layer.roaming&&this.layer.useWebGL?this._fillPixelData(q):q.src&&c&&(this.layer._hasTilingEffects||this.layer.useWebGL)&&(this._fillPixelData(q),this.layer._hasTilingEffects&&(q.updateCompleted=!0),q.processedPixelBlock=null,q.renderedPixelBlock=null)}));0===this._fetchCounter&&(this._fetched=!0);this._tilesChanged=!1;c&&this._updateFetchStatus()},updateTile:function(c,g){var n=new p;if(!c.src&&!c.fetch)return n.resolve(c),
n.promise;r(c.src||c._fetched||c.fetch,k.hitch(this,function(){var q=this.layer.tileMode&&this.layer._rasterHandler&&!(this.layer._hasTilingEffects||this.layer.useWebGL),v=this.layer._drawTile,u=this._validateRawPixelBlocks(c);this.layer._hasTilingEffects&&!this.layer.useWebGL&&(v=v&&(this._progressiveGlobal||g));if((g||!g&&u)&&(q||v||this.layer.roaming)){if(this.xformSetting.requireProjection&&this.layer.useWebGL&&(this.xformSetting.gridConfig=this.getXformGrid(),null==this.xformSetting.gridConfig))return n.cancel(),
n.promise;this._processTile(c,g).then(k.hitch(this,function(t){n.isCanceled()||this._renderTile(t,g).then(k.hitch(this,function(y){this.hasNewData=!1;n.isCanceled()||n.resolve(y)}))}))}else g||u||(c.updateCompleted=!0),this.layer.useWebGL||this.layer._hasTilingEffects?n.resolve(this.originalPixelData):n.resolve()}));return n.promise},setLayer:function(c){this.layer=c},fillupTiles:function(){this.tiles.forEach(k.hitch(this,function(c){c.update&&c.updateCompleted&&!c.filled&&(c.updateCompleted=!1,this._fillPixelData(c),
c.updateCompleted=!0)}))},_validateRawPixelBlocks:function(c){return c&&c.src&&!this.identifiers.some(function(g){return!(c.src[g].pixelBlock&&0!==c.src[g].pixelBlock.validPixelCount&&c.src[g].pixelBlock.pixels&&0<c.src[g].pixelBlock.pixels.length)})},_wrapExtent:function(c,g){if(c){if(this.tileInfo.applyGCS360Transform){var n=this.normalizeCoordinate(c.xmin,180);0>n&&(n+=360);return new l({xmin:n,ymin:c.ymin,xmax:c.xmax-c.xmin+n,ymax:c.ymax,spatialReference:c.spatialReference})}if(this.halfWorldWidth){n=
null!=g?new l({xmin:this.tileInfo.origin.x+this.tileInfo.cols*g*this.resolution.x,ymin:c.ymin,xmax:this.tileInfo.origin.x+this.tileInfo.cols*(g+1)*this.resolution.x,ymax:c.ymax,spatialReference:c.spatialReference}):new l({xmin:c.xmin,ymin:c.ymin,xmax:c.xmax,ymax:c.ymax,spatialReference:c.spatialReference});g=this.normalizeCoordinate(n.xmin,this.halfWorldWidth);var q=g-n.xmin;.01<Math.abs(q)&&(n.xmin=g,n.xmax+=q)}return n||c}},_getIntersect:function(c,g){return new l(Math.max(c.xmin,g.xmin),Math.max(c.ymin,
g.ymin),Math.min(c.xmax,g.xmax),Math.min(c.ymax,g.ymax),c.spatialReference)},_isTileOutSide:function(c,g){var n=!1;if(c.virtual){var q=c.normalizedExtent;if(g=g||(this.xformSetting.requireProjection?this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent)){c=q.xmin-this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;n=q.ymin-this.prefetchBufferSize*this.tileInfo.rows*this.resolution.y;var v=q.xmax+this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;q=q.ymax+this.prefetchBufferSize*
this.tileInfo.rows*this.resolution.y;n=v<=g.xmin||c>=g.xmax||q<=g.ymin||n>=g.ymax}else n=!1}else n=0>c.level||c.row<this.fullBoundary.rowStart||c.row>this.fullBoundary.rowEnd||c.col<this.fullBoundary.colStart||c.col>this.fullBoundary.colEnd;return n},_resolutionEqual:function(c,g){return c===g||c&&g&&Math.abs(c-g)<Math.abs(g/1E4)?!0:!1},_requestTile:function(c){var g=this.identifiers,n;if(this._isTileOutSide(c)){var q=new p;c.updateCompleted=!0;q.resolve(null);q=q.promise}else q=this.layer.raster.rasterFunction?
new m(this.layer.raster.getMemberRasters().map(function(v){return v.read(c)})):new m([this.layer.raster.read(c)]);c.fetch=q;this._fetchCounter++;r(c.src||c._fetched||q,k.hitch(this,function(v){if(n=v&&v.some(function(t){return t[0]})){var u={};v.forEach(function(t,y){u[g[y]]=t[0]&&t[1]?{extent:t[1].extent,pixelBlock:t[1].pixelBlock,width:t[1].width,height:t[1].height}:null});c.src=u}else c.src=null;this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);c._fetched=!0;this._updateFetchStatus()}),
k.hitch(this,function(){this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);c._fetched=!0;this._updateFetchStatus()}));c.update=this.updateTile(c)},_updateFetchStatus:function(){this.layer._drawTile&&this.fetchAllCompleted&&!this.fetchAllCompleted.isResolved()&&!this.tiles.some(function(c){return!c._fetched})&&(this.tiles.forEach(k.hitch(this,function(c){this._fillPixelData(c)})),this.fetchAllCompleted.resolve())},_fillPixelData:function(c,g){if(c&&!c.updateCompleted)if(Math.abs(c.cellsizeX-
this.resolution.x)>c.cellsizeX/10)c.updateCompleted=!0;else if(!1===this._validateRawPixelBlocks(c))c.updateCompleted=!0;else{var n=c.extent;if(this.layer.roaming||this.layer.useWebGL&&!this.layer._hasTilingEffects){var q=this.fullExtent;var v=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);var u=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);g?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new d({width:v,
height:u,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(k.hitch(this,function(y){this.originalPixelData.src[y].pixelBlock.width=v;this.originalPixelData.src[y].pixelBlock.height=u}))}else q=this.extent,v=this.layer._map.width,u=this.layer._map.height,g?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new d({width:v,height:u,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(k.hitch(this,function(y){this.originalPixelData.src[y].pixelBlock.width=
v;this.originalPixelData.src[y].pixelBlock.height=u}));if(q.xmax<=n.xmin||q.xmin>=n.xmax||q.ymax<=n.ymin||q.ymin>=n.ymax)return null;var t=this.originalPixelData.isEmpty=!1;this.identifiers.forEach(k.hitch(this,function(y){c.src&&(this._fillPixelBlock(c.src[y],this.originalPixelData.src[y],{extent:q,width:v,height:u,normalizedExtent:c.normalizedExtent},!1),t=!0)}));c.filled=t;this.hasNewData=!0}},_fillPixelBlock:function(c,g,n,q){var v=c.extent,u=n.extent;q=n.width;var t=n.height;if(c.pixelBlock&&
c.pixelBlock.pixels&&c.pixelBlock.pixels[0]){var y=(v.xmax-v.xmin)/c.width,D=Math.max(v.xmin,u.xmin),B=Math.min(v.ymax,u.ymax),E=Math.round((D-v.xmin)/y),x=c.width-Math.round(Math.abs(v.xmax-Math.min(v.xmax,u.xmax))/y),w=Math.round(Math.abs(v.ymax-B)/y),A=c.height-Math.round((Math.max(v.ymin,u.ymin)-v.ymin)/y),z=this.halfWorldWidth;D=Math.round((D-u.xmin)/y);n=n.normalizedExtent;if(!(this.wrapTimes&&z&&v.xmin<-z)){if(this.wrapTimes&&z){if(this.tileInfo.applyGCS360Transform)360<v.xmin&&(D-=this.fullBoundary.paddingLeft);
else if(v.xmin>z){D-=this.fullBoundary.paddingLeft;var G=this.normalizeCoordinate(v.xmin,z);var I=this.normalizeCoordinate(v.xmax,z)}else G=v.xmin,I=v.xmax;this.tileInfo.applyGCS360Transform?n&&360>n.xmin&&360<n.xmax&&(x-=this.fullBoundary.paddingRight):n&&n.xmin<z&&n.xmax>z?x-=this.fullBoundary.paddingRight:G<z&&I>z&&(x-=this.fullBoundary.paddingRight)}G=Math.round(Math.abs(u.ymax-B)/y);I=c.pixelBlock.pixels.length;g=g.pixelBlock;n=c.width;v=g.mask||new Uint8Array(q*t);var K=c.pixelBlock,R=K.mask,
U=0;for(y=0;y<I;y++){B=K.pixels[y];z=g.pixels[y]||new B.constructor(q*t);for(c=w;c<A;c++)for(U=(G+c-w)*q+D,u=E;u<x;u++)z[U+u-E]=B[c*n+u];g.pixels[y]=z}if(R)for(c=w;c<A;c++)for(U=(G+c-w)*q+D,u=E;u<x;u++)v[U+u-E]=R[c*n+u];else for(c=w;c<A;c++)for(U=(G+c-w)*q+D,u=E;u<x;u++)v[U+u-E]=1;g.pixelType=g.pixelType||K.pixelType;g.mask=v;if(!(g.statistics&&0<g.statistics.length))for(g.statistics=[],c=0;c<K.statistics.length;c++)g.statistics[c]={minValue:K.statistics[c].minValue,maxValue:K.statistics[c].maxValue};
else if(K.statistics&&g.statistics)for(c=0;c<g.statistics.length;c++)g.statistics[c].minValue=Math.min(K.statistics[c].minValue,g.statistics[c].minValue),g.statistics[c].maxValue=Math.max(K.statistics[c].maxValue,g.statistics[c].maxValue)}}},_processTile:function(c,g){var n=new p,q=this.layer._hasTilingEffects,v=this.layer.useWebGL,u=q||v,t=this.layer.raster.rasterFunction&&c&&(q||v||!c.processedPixelBlock);if(g)var y=c;else this._fillPixelData(c),y=u?this.originalPixelData:c;this.xformSetting.hasNewTexture=
this.hasNewData;var D;t?(this.identifiers.forEach(function(B){if(0===y.src[B].pixelBlock.pixels.length||0===y.src[B].pixelBlock.pixels[0].length)D=!0}),D?n.resolve({extent:y.extent,processedPixelBlock:y.src[this.identifiers[0]],pixelBlock:y.src[this.identifiers[0]]}):v?(this.processedPixelData=this.layer.raster.rasterFunction.read(y),n.resolve(this.processedPixelData)):this.layer._rasterHandler?this.layer._rasterHandler.process({extent:y.extent,src:y.src}).then(function(B){q?(this.processedPixelData=
B,n.resolve(this.processedPixelData)):(c.processedPixelBlock=B.pixelBlock,n.resolve(c))}):(g=this.layer.raster.rasterFunction.read(c),c.processedPixelBlock=g.pixelBlock,n.resolve(c))):u?n.resolve(y.src[this.identifiers[0]]):(c.pixelBlock=y.src[this.identifiers[0]]&&y.src[this.identifiers[0]].pixelBlock,n.resolve(c));return n.promise},_renderTile:function(c){var g=new p,n=this.layer._hasTilingEffects,q=this.layer.useWebGL,v=Math.abs((c.extent.xmax-c.extent.xmin)/c.width-this.layer.getCurrentResolution().x)>
this.resolution.x/10;v=this.layer.useWebGL&&(v||this._isTileOutSide(c,this.layer._map.extent));this.xformSetting.hasNewTexture=this.hasNewData;this.layer._rasterRenderer&&c&&(c.texture||c.src||c.pixelBlock||c.processedPixelBlock)?(this.layer._rasterRenderer.interpolation=this.layer.interpolation,q&&!v?(this.layer.raster.rasterFunction&&this.layer.raster.rasterFunction.renderTexture||this.layer._rasterRenderer.draw(c),g.resolve(c)):this.layer._rasterHandler?this.layer._rasterHandler.render({extent:c.extent,
pixelBlock:c.processedPixelBlock||c.pixelBlock}).then(function(u){n?(u.renderedPixelBlock=u.pixelBlock,g.resolve(u)):(c.renderedPixelBlock=u.pixelBlock,g.resolve(c))}.bind(this)):(c.renderedPixelBlock=this.layer._rasterRenderer.draw(c).pixelBlock,g.resolve(c))):(c.renderedPixelBlock=c.processedPixelBlock||c.pixelBlock,g.resolve(c));return g.promise},_sortTiles:function(){this.tiles.sort(function(c,g){return c.row<g.row||c.row==g.row&&c.col<g.col?-1:1})}})})},"esri/dijit/RasterFunctionEditor/utils":function(){define("dojo/_base/lang dojo/_base/url dojo/has dojo/on dojo/Deferred dojo/_base/array dojo/i18n!../../nls/jsapi ../../kernel ../../request ../../lang ../../config ../../layers/ArcGISImageServiceLayer ../../layers/ImageServiceParameters ../../layers/MosaicRule ../../layers/RasterFunction ../../tasks/Geoprocessor ../../tasks/JobInfo ../../renderers/colorUtils ../../renderers/colorRampUtils ../../layers/ArcGISRenderingImageServiceLayer".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y){function D(O){if(O){var S=l.map([O.FromColor,O.ToColor],function(T){T=u.toRGB({h:T.Hue,s:T.Saturation,v:T.Value});return[T.r,T.g,T.b]});return{fromColor:S[0],toColor:S[1],type:"algorithmic",algorithm:O.Algorithm}}}function B(O){if(O)return O=u.toHSV(u.getDojoColor(O)),{type:"HsvColor",Hue:O.h,Saturation:O.s,Value:O.v,AlphaValue:255}}function E(O){if(O){var S=O.toJson?O.toJson():void 0;return{Algorithm:S&&S.Algorithm||"esriHSVAlgorithm",type:"AlgorithmicColorRamp",
FromColor:B(O.fromColor),ToColor:B(O.toColor)}}}function x(O,S,T){function J(P,Q){return O+" ("+C[P]+" - "+C[Q]+")"}var N=b.rasterFunctions.enumLabels,C={1:N.esriMonthJanuary,2:N.esriMonthFebruary,3:N.esriMonthMarch,4:N.esriMonthApril,5:N.esriMonthMay,6:N.esriMonthJune,7:N.esriMonthJuly,8:N.esriMonthAugust,9:N.esriMonthSeptember,10:N.esriMonthOctober,11:N.esriMonthNovember,12:N.esriMonthDecember};if(T&&""===T)return O.toString();N="Months"===T;T="Quarters"===T;if(!N&&!T)return O.toString();if(1==
S&&N)return O+" ("+C[+O]+")";switch(+O){case 1:return J(1,3);case 2:return J(4,6);case 3:case 7:return J(7,9);case 4:return T?J(10,12):J(4,6);case 10:return J(10,12)}return O.toString()}function w(O){return(new Date(Number(O))).toISOString().replace("Z","")}function A(O){return(new Date(O+"Z")).getTime()}function z(O,S){return O.some(function(T){return T.label===S.label}.bind(this))}function G(O){if(O&&O.type){var S,T=da,J=O.type.replace("Arguments","");if(J.toLowerCase()===T.local.toLowerCase()){var N=
O.Operation;0<=ea.indexOf(N&&N.value)&&(S="CellStatisticsFunction")}J.toLowerCase()===T.gpAdapter.toLowerCase()&&(S=(S=O.ToolName)&&S.value&&S.value.replace("_sa",""));J.toLowerCase()===T.pythonAdapter.toLowerCase()&&(O=O.ClassName,S="object"===typeof O?O.value:O);return S||J}}function I(O,S){Array.isArray(O)?O.forEach(function(T,J){S(O,J)}.bind(this)):K(O)&&Object.keys(O).forEach(function(T){S(O,T)}.bind(this))}function K(O){return null!==O&&"object"===typeof O}var R={},U,ba,ca,da={local:"LocalFunction",
gpAdapter:"GPAdapterFunction",pythonAdapter:"PythonAdapterFunction"},ja=new Map,ea=[38,39,40,41,42,43,47,54,55,58,66,67,68,69,70,71,72,73,74,75,93,94],L=this&&this.__spreadArrays||function(){for(var O=0,S=0,T=arguments.length;S<T;S++)O+=arguments[S].length;O=Array(O);var J=0;for(S=0;S<T;S++)for(var N=arguments[S],C=0,P=N.length;C<P;C++,J++)O[J]=N[C];return O};H.mixin(R,{fetchRFT:function(O,S,T,J,N){var C=new m;var P=(P=(P=O.name)&&P.slice(-8))&&".rft.xml"===P.toLowerCase();return O&&O.itemDataUrl?
P?N?this.convertRFT({url:N+"/ConvertRasterFunctionTemplate",rft:{itemId:O.id},format:"json"},S,J,T):(T("errorUtilitiesServiceNotAvailable"),C.reject(Error("errorUtilitiesServiceNotAvailable")),C.promise):d({url:O.itemDataUrl,callbackParamName:"callback",content:{f:"json"},handleAs:"json",load:S,error:T}).then(J):(T("errorRetrievingRFTItem"),C.reject(Error("errorRetrievingRFTItem")),C.promise)},convertRFT:function(O,S,T,J){var N=O.url,C=function(){ca&&(ca.remove(),ca=null);ba&&(ba.remove(),ba=null)};
U||(U=new q(N),r(U,"error",C));ba=r(U,"job-complete",function(P){ba&&(ba.remove(),ba=null);P.jobInfo.jobStatus!==v.STATUS_SUCCEEDED?(C(),J(P)):U.getResultData(P.jobInfo.jobId,"outputRasterFunction")});ca=r(U,"get-result-data-complete",function(P){ca&&(ca.remove(),ca=null);var Q=P&&P.result&&P.result.value;Q&&Q.url&&(P={url:Q.url,handleAs:"json",load:T,error:J},Q=(new k(Q.url)).authority,-1===e.defaults.io.corsEnabledServers.indexOf(Q)&&e.defaults.io.corsEnabledServers.push(Q),d(P))});O={inputRasterFunction:JSON.stringify(O.rft),
format:O.format};return U.submitJob(O,S,null,J)},getRasterJsonFromLayer:function(O){if(!O)return null;var S=O.url;S&&0<S.indexOf("?token\x3d")&&(S=S.slice(0,S.indexOf("?token\x3d")));var T=O.credential||S&&a.id.findCredential(S);f.isDefined(T)&&(S=S+"?token\x3d"+T.token,T.referer&&(S+=T.referer));S={url:S,name:O.name};O.renderingRule&&(S.renderingRule=O.renderingRule.toJson?O.renderingRule.toJson():O.renderingRule);O.mosaicRule&&(S.mosaicRule=O.mosaicRule.toJson?O.mosaicRule.toJson():O.mosaicRule);
return S},getLayerIdfromRasterValue:function(O,S){if(O&&S){var T;l.some(S,function(J){if(J&&J.url===O.url&&J.name===O.name&&O.name)return T=J.id,!0});return T}},getColorRampFromArg:function(O){if(O){var S;if(O.type&&-1<O.type.toLowerCase().indexOf("colorramp"))var T=O;else O.value&&-1<O.value.type.toLowerCase().indexOf("colorramp")&&(T=O.value);if(T)return O=T.type.toLowerCase(),"multipartcolorramp"===O?S=t.fromJson({type:"multipart",colorRamps:l.map(T.ArrayOfColorRamp,function(J){return D(J)})}):
"algorithmiccolorramp"===O&&(S=t.fromJson(D(T))),S.id=S.name=T.Name,S}},getRFxArgColorRampValue:function(O){if(O){if(O.fromColor&&O.toColor)return H.mixin(E(O),{Name:O.name});if(O.colorRamps){var S=l.map(O.colorRamps,E);return{type:"MultiPartColorRamp",NumColorRamps:S.length,ArrayOfColorRamp:S,Name:O.name}}}},RFX_VARIABLE_TYPE:"RasterFunctionVariable",RFX_TEMPLATE_TYPE:"RasterFunctionTemplate",ARGUMENT_ARRAY_TYPE:"ArgumentArray",getArgRFT:function(O){if(O){if("RasterFunctionTemplate"===O.type)return O;
if(O.value&&"RasterFunctionTemplate"===O.value.type)return O.value}},getEnumData:function(O,S,T){if(Array.isArray(O))return O.forEach(function(J){J.key=J.key.toString()}),O},getImageServiceTitle:function(O){O=O.split("/");return O[O.length-2]},isReferencedObject:function(O){if(O&&f.isDefined(O._object_ref_id))return!0},functionTypes:da,defaultRasterNodeProps:{name:"Raster",isDataset:!0,isPublic:!1,type:"RasterFunctionVariable"},getArcGISImageServiceLayerItem:function(O){if(O){O=H.clone(O);O.name||
(O.name=this.getImageServiceTitle(O.url));var S=new c;O.mosaicRule&&(S.mosaicRule=new g(O.mosaicRule));O.renderingRule&&(S.renderingRule=new n(O.renderingRule));S=new h(O.url,{id:O.name+(new Date).toString(),imageServiceParameters:S});S.name=O.name;return S}},filterMDInfoIfMosiacRuleIsSet:function(O){var S=H.clone(O.multidimensionalInfo),T=[],J=O.mosaicRule&&O.mosaicRule.multidimensionalDefinition;if(J&&0<J.length){var N=S.variables.filter(function(C){return J[0].variableName===C.name}.bind(this));
if(!N||0===N.length)return S;N=N[0];T=H.clone(N);T.dimensions=[];J.forEach(function(C){var P=N.dimensions.filter(function(la){return C.dimensionName===la.name}.bind(this));if(P&&0!==P.length){var Q=(P=P[0])&&P.values,Y=0,fa=1,na=C.values&&C.values.length;switch(C.values&&C.values[0].length||na){case 1:Y=Q.indexOf(C.values[0]);fa=Y+1;break;case 2:Y=Q.indexOf(C.values[0][0]),fa=Q.indexOf(C.values[0][1])+1}Q=Q.slice(Y,fa);P.values=Q;T.dimensions.push(P)}else T.dimensions=H.clone(N.dimensions)}.bind(this));
S.variables=[T]}return S},getRecurrentIntervalName:x,getFormattedDateString:w,parseFormattedDateString:A,getVariables:function(O){var S=O.selectedVariables,T=void 0===S?[]:S;return O.multiDimensionalData.variables.filter(function(J){var N=T.some(function(C){return"string"===typeof C?C===J.name:C.value===J.name}.bind(this));return T.length?N:!0}.bind(this))},getDimensions:function(O){var S=O.variables;O=O.selectedDimension;var T=void 0===O?"":O;return(void 0===S?[]:S).reduce(function(J,N){N=N.dimensions.filter(function(C){return T?
C.name===T:!0}.bind(this));return N.length?L(J,N):J}.bind(this),[])},getFormattedDimensionValues:function(O){var S=[];O.forEach(function(T){var J=T.hasRanges,N=T.recurring,C;T.values.forEach(function(P){var Q=H.clone(P);J||(Q=[Q]);"StdTime"===T.name&&(Q=Q.map(function(Y){return N?x(Y,T.interval,T.intervalUnit):w(Number(Y))}.bind(this)));Q=J?Q.join(" \u2014 "):Q.join("");C={label:Q,value:N?J?P.join(" \u2014 "):P.toString():Q,selected:!1,disabled:!1};z(S,C)||S.push(C)}.bind(this))}.bind(this));return S},
dimensionHasRanges:function(O){var S=!1;0<O.length&&(S=O[0].hasRanges);return S},getFormattedDimensionRanges:function(O){var S=[],T=[];O.forEach(function(J){J=J.label.split(" \u2014 ");S.push({label:J[0],value:J[0],selected:!1,disabled:!1});T.push({label:J[1],value:J[1],selected:!1,disabled:!1})});return{min:S,max:T}},applyMultidimensionalDefinitionFilter:function(O,S){var T=S&&S.dimensions&&0<S.dimensions.length;S&&"BY_RANGES"===S.definitionType?T=T&&S.minValues&&0<S.minValues.length&&S.maxValues&&
0<S.maxValues.length:S&&"BY_VALUES"===S.definitionType&&(T=T&&S.values&&0<S.values.length);if(!T)return O;O=H.clone(O);O.forEach(function(J){var N=J.hasRanges,C=[],P=0<=S.dimensions.indexOf(J.name);P||(C=J.values);P&&S.dimensions.forEach(function(Q,Y){if(Q===J.name)switch(S.definitionType){case "BY_RANGES":Q=S.minValues[Y];Y=S.maxValues[Y];"StdTime"===J.name&&(Q=A(Q),Y=A(Y));"boolean"===typeof Q||isNaN(Q)||(Q=Number(Q));"boolean"===typeof Y||isNaN(Y)||(Y=Number(Y));var fa=-1,na=-1;if(N)for(var la=
0;la<J.values.length&&!(J.values[la][0]===Q&&(fa=la),J.values[la][1]===Y&&(na=la+1),0<=fa&&1<=na);la++);else fa=J.values.indexOf(Q),na=J.values.indexOf(Y)+1;C=L(C,J.values.slice(fa,na));break;case "BY_VALUES":var W=N?S.values[Y].split(" \u2014 "):[S.values[Y]];"StdTime"===J.name&&(W=W.map(function(aa){return A(aa)}.bind(this)));Q=J.values.filter(function(aa){"boolean"===typeof aa||isNaN(aa)||(aa=Number(aa));return N?aa.includes(W[0])&&aa.includes(W[1]):W[0]==aa}.bind(this));C=L(C,Q)}}.bind(this));
J.values=H.clone(C)}.bind(this));return O},mapObjectByProperty:function(O,S){return O.map(function(T){return T[S]}.bind(this))},removeDuplicatesFromArray:function(O){return O.filter(function(S,T,J){return J.indexOf(S)===T}.bind(this))},UIModifier:{show:function(O){O.classList.remove("hidden")},hide:function(O){O.classList.add("hidden")}},isArrayEqual:function(O,S){return O&&S?O.length===S.length&&O.every(function(T){return 0<=S.indexOf(T)}.bind(this)):!1},makeComboboxSelection:function(O,S){var T=
!1;O.forEach(function(J){J.value[0]===S?T=J.selected=!0:J.selected=!1});T||O.unshift({label:S,value:S,selected:!0,disabled:!0})},processRFTAsLayerInput:function(O){var S=esri.isDefined(esriGeowConfig.isMultiTenant)&&!1===esriGeowConfig.isMultiTenant,T=esriGeowConfig.self.helperServices.analysis&&esriGeowConfig.self.helperServices.analysis.url?esriGeowConfig.self.helperServices.analysis.url:"";S=(S?T:T.replace("rasteranalysis","rasterutils")).replace("SpatialAnalysisTools/GPServer","RasterRendering/ImageServer");
return new y(S,{raster:JSON.stringify(O),type:"rft"})},getFunctionName:G,coerceEnumDataForCurrentEnv:function(O,S,T){if(!T||"multitenant"!==T)return S;T={ZonalStatistics:{statistics_type:["CIRCULAR_MEAN"]}};var J=G(O),N;for(N in T)if(N===J){var C=T[N],P;for(P in C){var Q=C[P];O[P]&&(S=S.filter(function(Y){return!(0<=Q.indexOf(Y.key))}.bind(this)))}}return S},createObjectMap:function(O){var S=function(T,J){T=T[J];K(T)&&(void 0!==T._object_id&&ja.set(T._object_id,T),I(T,S))};I(O,S)},processAllComponents:I,
isDefinedObject:K,getReferencedObject:function(O){return ja.has(O)?ja.get(O):null}});p("extend-esri")&&H.setObject("dijit.RasterFunctionEditor.utils",R,a);return R})},"esri/layers/ArcGISRenderingImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/config dojo/has dojox/encoding/digests/_base ../kernel ../config ../request ../deferredUtils ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),function(H,k,p,r,m,l,b,a,d,f,e,h){H=H([e,h],{declaredClass:"esri.layers.ArcGISRenderingImageServiceLayer",
rasterType:{rft:"rft",rasterObject:"rasterObj",url:"url"},constructor:function(c,g){this.type=g.type;var n=this._processRasterParam(g.raster);n&&(this._initialize(c+"?raster\x3d"+n,g),this.useMapImage=g&&g.useMapImage||!1)},_processRasterParam:function(c){if(c)return this.type===this.rasterType.rft||this.type===this.rasterType.rasterObject?("object"===typeof c&&(c=JSON.stringify(c)),c=l.stringToWord(c),l.wordToBase64(c)):c},refresh:function(c){if(!0===c)this.inherited(arguments);else{var g=this.disableClientCaching;
this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=g}},setRaster:function(c){c=this._processRasterParam(c);this._url.query.raster=c;this._params.raster=c;this.refresh(!0)},setRenderer:function(c,g){this.renderer=c;this.onRendererChange();g||this.refresh(!0)},exportMapImage:function(c,g){var n=a.defaults.map;c=k.mixin({size:n.width+","+n.height},this._params,c?c.toJson(this.normalization):{},{f:"json"});delete c._ts;this._exportMapImage(this._url.path+"/exportImage",c,
g)},getMultidimensionalInfo:function(){var c=this._url.path+"/multiDimensionalInfo",g=new p(f._dfdCanceller);if(this._multidimensionalInfo)return g.resolve(this._multidimensionalInfo),g;!this.loaded||10.3<=this.version&&this.hasMultidimensions?(g._pendingDfd=d({url:c,content:k.mixin(this._params,{f:"json",token:this._getToken()}),handleAs:"json",callbackParamName:"callback"}),g._pendingDfd.then(k.hitch(this,function(n){this._multidimensionalInfo=n.multidimensionalInfo;g.callback(n.multidimensionalInfo)}),
function(n){g.errback(n)})):(c=Error("Layer does not support multidimensional info"),c.log=!!r.isDebug,g.errback(c));return g}});m("extend-esri")&&k.setObject("layers.ArcGISRenderingImageServiceLayer",H,b);return H})},"esri/dijit/analysis/storageUtils":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/promise/all dojo/has dojo/json ../../request ../../kernel".split(" "),function(H,k,p,r,m,l,b,a,d){k={MAX_RESOURCES:10,checkResourceLimit:!0,_getItemUrl:function(f){var e=
f.folderId||f.ownerFolder;return this._portalUrl+"/sharing/rest/content/users/"+f.owner+"/"+(e?e+"/":"")+"/items/"+f.id},addToItemResource:function(f,e){this._portalUrl=e.portalUrl;delete e.portalUrl;f=this._getItemUrl(f);f+="/addResources";e={filename:e.jobInfo.jobId+".json",text:b.stringify(e),resourcesPrefix:"jobs",f:"json"};return a({url:f,content:e},{usePost:!0})},getItemResource:function(f,e){e&&e.portalUrl&&(this._portalUrl=e.portalUrl);f=this._getItemUrl(f);f+="/resources/"+e.resource;return a({url:f,
content:{f:"json"}})},removeItemResource:function(f,e){e&&e.portalUrl&&(this._portalUrl=e.portalUrl);f=this._getItemUrl(f);return a({url:f+"/removeResources",content:{resource:e.resource,deleteAll:e.deleteAll,f:"json"}},{usePost:!0})},addToStorage:function(f){if(window.sessionStorage){var e=window.sessionStorage.getItem("esri_analysis_jobhistory");e=e?b.parse(e):[];e.push(f);window.sessionStorage.setItem("esri_analysis_jobhistory",b.stringify(e))}},addAllToStorage:function(f){window.sessionStorage&&
window.sessionStorage.setItem("esri_analysis_jobhistory",b.stringify(f))},removeFromStorage:function(f){if(window.sessionStorage){var e=window.sessionStorage.getItem("esri_analysis_jobhistory");e&&(e=b.parse(e));e=H.filter(e,function(h){return h.jobInfo&&h.jobInfo.jobId!==f.jobInfo.jobId});window.sessionStorage.setItem("esri_analysis_jobhistory",b.stringify(e))}},removeAllFromStorage:function(){window.sessionStorage&&window.sessionStorage.removeItem("esri_analysis_jobhistory")},getJobsInfoList:function(){var f;
window.sessionStorage&&(f=window.sessionStorage.getItem("esri_analysis_jobhistory"))&&(f=b.parse(f));return f},addItemResources:function(f,e){var h=this.getJobsInfoList(),c=[];H.forEach(h,function(g){g.portalUrl=e.portalUrl;var n=new r;c.push(n);this.addToItemResource(f,g).then(p.hitch(this,function(q){q&&!0===q.success&&(this.removeFromStorage(g),n.resolve(q))}))},this);return m(c)},saveJobsQueue:function(f,e){var h=this.getJobsInfoList(),c=new r;h&&0<h.length&&this.removeResourceQueue(f,e).then(p.hitch(this,
function(){if(h.length>this.MAX_RESOURCES){for(this.sortJobsInfoList(h,{asc:!1});h.length>this.MAX_RESOURCES;)h.pop();this.addAllToStorage(h)}this.addItemResources(f,e).then(p.hitch(this,function(g){c.resolve(g)}),p.hitch(this,function(g){c.reject(g)}))}),p.hitch(this,function(g){c.reject(g)}));return c.promise},saveJobsInfoList:function(f,e){return this.checkResourceLimit?this.saveJobsQueue(f,e):this.addItemResources(f,e)},getResources:function(f,e){e&&e.portalUrl&&(this._portalUrl=e.portalUrl);
f=this._getItemUrl(f);return a({url:f+"/resources",content:{f:"json"}})},getResourcesInfo:function(f,e){var h=[],c=new r;this.sortResources(f,e).then(p.hitch(this,function(g){H.forEach(g.resources,function(n){e.resource=n.resource;h.push(this.getItemResource(f,e))},this);m(h).then(p.hitch(this,function(n){c.resolve(n)}),p.hitch(this,function(n){c.reject(n)}))}),p.hitch(this,function(g){c.reject(g)}));return c.promise},sortJobsInfoList:function(f,e){f.sort(p.hitch(this,function(h,c){return e.asc?h.timestamp-
c.timestamp:c.timestamp-h.timestamp}))},sortResources:function(f,e){var h=new r;this.getResources(f,e).then(p.hitch(this,function(c){c.resources&&0<c.resources.length&&c.resources.sort(p.hitch(this,function(g,n){return e.asc?g.created-n.created:n.created-g.created}));h.resolve(c)}),p.hitch(this,function(c){h.reject(c)}));return h.promise},removeResourceQueue:function(f,e){var h=new r,c=[];var g=this.getJobsInfoList().length;var n=this.MAX_RESOURCES-g;n=0<n?n:0;e.asc=!0;this.sortResources(f,e).then(p.hitch(this,
function(q){if(q&&q.resources&&0<q.resources.length)if(0===n){var v=q.resources.shift();e.resource=v.resource;e.deleteAll=!0;c.push(this.removeItemResource(f,e));q.resources=[]}else for(;q.resources.length>n;)v=q.resources.shift(),e.resource=v.resource,c.push(this.removeItemResource(f,e));m(c).always(p.hitch(this,function(){h.resolve(q)}))}),p.hitch(this,function(q){h.reject(q)}));return h.promise}};l("extend-esri")&&p.setObject("dijit.analysis.storageUtils",k,d);return k})},"esri/dijit/analysis/_AnalysisOptions":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-attr dojo/_base/json dojo/dom-class dojo/dom-construct dojo/dom-style dojo/aspect dojo/has dojo/_base/array dojo/_base/window dojo/on dojo/query dojo/number ./Settings ./SettingsViewModel ./utils ./mixins/browselayers/BrowseLayerMixin ./mixins/FilterAndSelection dijit/Dialog dijit/form/NumberTextBox dojo/i18n!../../nls/jsapi ../../lang ../../kernel".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x){H=H([u,t],{declaredClass:"esri.dijit.analysis._AnalysisOptions",showSelectFolder:!1,showChooseExtent:!0,showHelp:!0,showCredits:!0,returnFeatureCollection:!1,showCloseIcon:!0,showSelectAnalysisLayer:!0,map:null,showReadyToUseLayers:!0,showAnalysisBusyIndicator:!0,showGeoAnalyticsParams:!1,showBrowseLayers:!1,showAnalysisModeLabel:!1,distanceDefaultUnits:"Miles",showSettings:!1,showOutputType:!1,context:{},includeRouteLayers:!1,doSaveJobInfo:!1,
doSaveInStorage:!1,showCreditCalcBusyIndicator:!0,useArcGISComponents:!1,isServerAdvanceLicensed:!0,constructor:function(w){w.rerun&&this._initRerunProps(w)},isAdmin:function(w){return E.isDefined(w.role)&&("org_admin"===w.role||"account_admin"===w.role)},isOwner:function(w,A){return w.owner?w.owner===A.id:w.userId?w.userId===A.username:w.credential?w.credential.userId===A.username:!0},_initRerunProps:function(w){w.OutputName&&w.OutputName.serviceProperties?w.outputLayerName=w.OutputName.serviceProperties.name:
w.resultName&&(w.outputLayerName=w.resultName);w.timeStepReference&&(w.timeReference=w.timeStepReference);this.set("extentCheck",w.extentCheck);this._numberFormatHandle=a.before(D,"_setValueAttr",function(A,z,G){A=g.format(A);return[A,z,G]});this.on("close",k.hitch(this,function(){this._numberFormatHandle&&(this._numberFormatHandle.remove(),this._numberFormatHandle=null)}))},_setShowSelectFolderAttr:function(w){!0===w&&w===this.get("returnFeatureCollection")&&(w=!w);this.showSelectFolder=w;this._webMapFolderSelect&&
this._webMapFolderSelect.set("required",w);this._chooseFolderRow&&b.set(this._chooseFolderRow,"display",!0===this.showSelectFolder?"block":"none");w&&this._webMapFolderSelect&&this.getFolderStore().then(k.hitch(this,function(A){this.folderStore=A;v.setupFoldersUI({folderStore:this.folderStore,folderId:this.folderId,folderName:this.folderName,folderSelect:this._webMapFolderSelect,username:this.portalUser?this.portalUser.username:""})}))},_getShowSelectFolderAttr:function(){return this.showSelectFolder},
_setShowChooseExtentAttr:function(w){this.showChooseExtent=w},_getShowChooseExtentAttr:function(){return this.showChooseExtent},_setExtentCheckAttr:function(w){this.extentCheck=w;E.isDefined(this._useExtentCheck)&&E.isDefined(w)&&this._useExtentCheck.set("checked",w)},_setMapAttr:function(w){this.map=w},_getMapAttr:function(){return this.map},_setShowHelpAttr:function(w){this.showHelp=w},_getShowHelpAttr:function(){return this.showHelp},_setReturnFeatureCollectionAttr:function(w){this.returnFeatureCollection=
w;this.set("showSelectFolder",!w)},_getReturnFeatureCollectionAttr:function(){return this.returnFeatureCollection},_setShowCreditsAttr:function(w){(this.showCredits=w)&&this._showCreditsLink&&this._usageForm&&(this._onCreditsClickHandle=h.pausable(this._showCreditsLink,"click",k.hitch(this,this._handleShowCreditsClick)))},_getShowCreditsAttr:function(){return this.showCredits},_setShowCloseIconAttr:function(w){this.showCloseIcon=w},_getShowCloseIconAttr:function(){return this.showCloseIcon},_setShowSelectAnalysisLayerAttr:function(w){this.showSelectAnalysisLayer=
w;this._analysisSelect&&this._analysisSelect.set("required",w)},_getShowSelectAnalysisLayerAttr:function(){return this.showSelectAnalysisLayer},_setIsSingleTenantAttr:function(w){this.isSingleTenant=w},_getIsSingleTenantAttr:function(){return this.isSingleTenant},_setAllowChooseLabelAttr:function(w){this.allowChooseLabel=w},_getAllowChooseLabelAttr:function(){return this.allowChooseLabel},_setTitleAttr:function(w){this.title=w;this._toolTitle&&p.set(this._toolTitle,"innerHTML",w)},_getTitleAttr:function(){return this.title=
p.get(this._toolTitle,"innerHTML")},_setShowReadyToUseLayersAttr:function(w){this.showReadyToUseLayers=w},_getShowReadyToUseLayersAttr:function(w){return this.showReadyToUseLayers},_setFolderIdAttr:function(w){this.folderId=w},_getFolderIdAttr:function(){this._webMapFolderSelect&&this.folderStore&&(this.folderId=this._webMapFolderSelect.item?this.folderStore.getValue(this._webMapFolderSelect.item,"id"):"");return this.folderId},_setFolderNameAttr:function(w){this.folderName=w},_getFolderNameAttr:function(){this._webMapFolderSelect&&
this.folderStore&&this._webMapFolderSelect.item&&(this.folderName=this.folderStore.getValue(this._webMapFolderSelect.item,"name"));return this.folderName},_setHelperServicesAttr:function(w){this.helperServices=w},_getHelperServicesAttr:function(w){return this.helperServices},_getPortalSelfAttr:function(){return this.portalSelf},_setPortalSelfAttr:function(w){this.portalSelf=w},_setShowAnalysisBusyIndicatorAttr:function(w){w&&this.own(this.on("start",k.hitch(this,function(){this.showLoadingIndicator()})),
this.on("job-fail, job-result, job-cancel",k.hitch(this,function(){this.hideLoadingIndicator()})),this.on("job-status",k.hitch(this,function(A){"esriJobFailed"===A.jobStatus&&this.hideLoadingIndicator()})))},_setShowGeoAnalyticsParamsAttr:function(w){this.showGeoAnalyticsParams=w},_getShowGeoAnalyticsParamsAttr:function(){return this.showGeoAnalyticsParams},_setShowBrowseLayersAttr:function(w){this.showBrowseLayers=w},_getShowBrowseLayersAttr:function(){return this.showBrowseLayers},showLoadingIndicator:function(){this.get("showAnalysisBusyIndicator")&&
(this._saveBtn.set("iconClass","esriLoading"),this.set("disableRunAnalysis",!0))},hideLoadingIndicator:function(){this.get("showAnalysisBusyIndicator")&&(this._saveBtn.set("iconClass",""),this.set("disableRunAnalysis",!1))},_setDistanceDefaultUnitsAttr:function(w){this.distanceDefaultUnits=w},_getDistanceDefaultUnitsAttr:function(){return this.distanceDefaultUnits},_setAnalysisModeAttr:function(w){this.analysisMode=w},_setShowAnalysisModeLabelAttr:function(w){this.showAnalysisModeLabel=w;this._titleLbl&&
this._analysisModeLblNode&&(b.set(this._titleLbl,"display",this.showAnalysisModeLabel?"none":"block"),b.set(this._analysisModeLblNode,"display",this.showAnalysisModeLabel?"flex":"none"),this.showAnalysisModeLabel&&("standard"===this.analysisMode?this.analysisModeLabel=this.i18n.standard:"bigdata"===this.analysisMode||this.showGeoAnalyticsParams?this.analysisModeLabel=this.i18n.bigData:"raster"===this.analysisMode&&(this.analysisModeLabel=this.i18n.raster),p.set(this._analysisModeCrumb,"innerHTML",
this.analysisModeLabel)))},_getTimeReferenceAttr:function(){if(this._timeRefDay){var w="",A="",z="";var G=this._timeRefDay.get("value");var I=this._timeRefTime.get("value");G&&(w=G.toDateString(),z="Date");I&&(A=I.toTimeString(),z="DateTime");this.set("timeReferenceType",z);G=A&&-1!==A.indexOf("GMT")?w+" "+A.substring(0,A.indexOf("GMT")+3):A?w+" "+A.split(" ")[0]+" GMT":w+" GMT";this.timeReference=(new Date(G)).getTime()}return this.timeReference},_setTimeReferenceAttr:function(w){w=new Date(w+6E4*
(new Date(w)).getTimezoneOffset());this._timeRefDay&&this._timeRefDay.set("value",w);this._timeRefTime&&"DateTime"===this.timeReferenceType&&this._timeRefTime.set("value",w)},_setTimeReferenceTypeAttr:function(w){this.timeReferenceType=w},_setSLayersAttr:function(w){this.sLayers=w},_setContextAttr:function(w){this.context=w},_setIncludeRouteLayersAttr:function(w){this.includeRouteLayers=w},_getIncludeRouteLayersAttr:function(){return this.includeRouteLayers},_setShowSettingsAttr:function(w){this.showSettings=
w;var A=this.analysisMode&&("raster"===this.analysisMode||"bigdata"===this.analysisMode),z="ClassifyPixelsUsingDeepLearning DetectObjectsUsingDeepLearning ClassifyObjectsUsingDeepLearning CalculateSlope DeriveAspect MonitorVegetation ApplyRFxTemplate RemapValues ExtractRaster AggregateMultidimensionalRaster GenerateMultidimensionalAnomaly GenerateTrendRaster PredictUsingTrendRaster FindArgumentStatistics Sample ConvertFeatureToRaster".split(" "),G=["ClassifyPixelsUsingDeepLearning","DetectObjectsUsingDeepLearning",
"ClassifyObjectsUsingDeepLearning"],I=this.analysisMode&&"raster"===this.analysisMode;z=I&&-1!==z.indexOf(this.toolName)&&this.isSingleTenant;var K=I&&-1!==G.indexOf(this.toolName);G=K&&this.isSingleTenant;var R=I&&"Sample"===this.toolName,U=-1!==["DetectObjectsUsingDeepLearning","ClassifyObjectsUsingDeepLearning"].indexOf(this.toolName),ba=-1!=="SummarizeRasterWithin ZonalStatisticsAsTable CalculateDensityRaster InterpolatePointsEBK CreateViewshedRaster Watershed ConvertRasterToFeature Sample".split(" ").indexOf(this.toolName),
ca=-1!=="CalculateDistance DetermineOptimumTravelCostNetwork DetermineTravelCostPathAsPolyline OptimalPathAsLine OptimalPathAsRaster DistanceAllocation DistanceAccumulation OptimalRegionConnections".split(" ").indexOf(this.toolName),da=-1!=="DetectObjectsUsingDeepLearning Sample SummarizeRasterWithin ZonalStatisticsAsTable CalculateDensityRaster InterpolatePointsEBK CreateViewshedRaster Watershed CalculateDistance DetermineOptimumTravelCostNetwork DetermineTravelCostPathAsPolyline DistanceAllocation DistanceAccumulation OptimalRegionConnections".split(" ").indexOf(this.toolName),
ja=I&&!U&&!R;da=I&&da;R=I&&!R;K=I&&!ba&&!K&&!ca;ba=I&&!this.isSingleTenant;w&&(v.settingsDlg||(w=e.doc.createDocumentFragment(),w=l.create("div",{style:"width:200px;height:200px;"},w),ca=f.filter(this.sLayers,function(ea){return ea.type?"Table"!==ea.type:!0}),v.settingsVM=new q({showHelp:!0,showCloseIcon:!1,showOverwriteResultOption:!1,showCloseAnalysisOption:!0,showStoreAnalysisOption:!0,showCoordinateSystems:this.analysisMode&&("raster"===this.analysisMode&&!U||"bigdata"===this.analysisMode),showProcessSR:this.analysisMode&&
"bigdata"===this.analysisMode,showOutSR:ja,showExtent:!0,showRasterSettings:I,showGeoAnalyticsSettings:this.analysisMode&&"bigdata"===this.analysisMode,showRasterPPFSettings:z,showRasterPTSettings:G,showRasterSnapSettings:ja,showRasterMaskSettings:da,showCellsizeSettings:R,showResamplingSettings:K,showCreditWarningSettings:ba,showHeader:!1,layers:ca,showJobsHistory:!1,jobsHistoryItem:null}),this.signInPromise.then(k.hitch(this,function(){v.settingsVM.set("portalUrl",this.portalUrl)})),v.settings=
new n({viewModel:v.settingsVM},w),this.i18n||(this.i18n={},k.mixin(this.i18n,B.common),k.mixin(this.i18n,B.analysisTools),k.mixin(this.i18n,B.analysisMsgCodes),k.mixin(this.i18n,B.analysisSettings)),v.settingsDlg=new y({title:this.i18n.analysisEnv,content:v.settings,style:"width:400px;"}),v.settingsDlg.own(v.settings.on("ok-settings",k.hitch(this,function(){v.settingsDlg.hide()})),v.settings.on("cancel-settings",k.hitch(this,function(){v.settingsDlg.hide()})))),v.settingsDlg&&(v.settingsVM.set("showRasterSettings",
I),v.settingsVM.set("showGeoAnalyticsSettings",this.analysisMode&&"bigdata"===this.analysisMode),v.settingsVM.set("showCoordinateSystems",this.analysisMode&&("raster"===this.analysisMode&&!U||"bigdata"===this.analysisMode)),v.settingsVM.set("showProcessSR",this.analysisMode&&"bigdata"===this.analysisMode),v.settingsVM.set("showOutSR",ja),v.settingsVM.set("showRasterPPFSettings",z),v.settingsVM.set("showRasterPTSettings",G),v.settingsVM.set("showRasterSnapSettings",ja),v.settingsVM.set("showCellsizeSettings",
R),v.settingsVM.set("showResamplingSettings",K),v.settingsVM.set("showCreditWarningSettings",ba),v.settingsVM.set("showRasterMaskSettings",da),this.domNode&&c("[esriHelpTopic\x3d'toolDescription']",this.domNode).forEach(k.hitch(this,function(ea){ea&&(this._settingsLink=l.create("a",{href:"#","class":"esriAnalysisSettingsIcon"},ea,"before"),h(this._settingsLink,"click",k.hitch(this,this._handleSettingsLinkClick)))})),this._settingWatchers||(this._settingWatchers=!0,I=this.get("context"),v.settingsVM.extent&&
(I.extent=v.settingsVM.extent,this._useExtentCheck&&this._useExtentCheck.set("checked",!1)),v.settingsVM.outSR&&(I.outSR=v.settingsVM.outSR),v.settingsVM.processSR&&(I.processSR=v.settingsVM.processSR),v.settingsVM.extent&&(I.extent=v.settingsVM.extent,this._useExtentCheck&&this._useExtentCheck.set("checked",!1)),v.settingsVM.cellSize&&(I.cellSize=v.settingsVM.cellSize),v.settingsVM.mask&&(I.mask=v.settingsVM.mask),v.settingsVM.snapRaster&&(I.snapRaster=v.settingsVM.snapRaster),v.settingsVM.processorType&&
(I.processorType=v.settingsVM.processorType),v.settingsVM.parallelProcessingFactor&&(I.parallelProcessingFactor=v.settingsVM.parallelProcessingFactor),v.settingsVM.recycleProcessingWorkers&&(I.recycleProcessingWorkers=v.settingsVM.recycleProcessingWorkers),v.settingsVM.retryOnFailures&&(I.retryOnFailures=v.settingsVM.retryOnFailures),v.settingsVM.resamplingMethod&&(I.resamplingMethod=v.settingsVM.resamplingMethod),this.set("returnFeatureCollection",!A&&v.settingsVM.returnFeatureCollection),this._updateContextDatastore(I,
v.settingsVM.datastore),this.set("context",I),v.settingsVM.watch("outSR",k.hitch(this,function(ea,L,O){if(ea=this.get("context"))ea.outSR=O,this.set("context",ea)})),v.settingsVM.watch("processSR",k.hitch(this,function(ea,L,O){if(ea=this.get("context"))ea.processSR=O,this.set("context",ea)})),v.settingsVM.watch("extent",k.hitch(this,function(ea,L,O){if(ea=this.get("context"))ea.extent=O,this.set("context",ea);this._useExtentCheck&&this._useExtentCheck.set("checked",!E.isDefined(O))})),v.settingsVM.watch("cellSize",
k.hitch(this,function(ea,L,O){if(ea=this.get("context"))ea.cellSize=O,this.set("context",ea)})),v.settingsVM.watch("mask",k.hitch(this,function(ea,L,O){if(ea=this.get("context"))ea.mask=O,this.set("context",ea)})),v.settingsVM.watch("snapRaster",k.hitch(this,function(ea,L,O){if(ea=this.get("context"))ea.snapRaster=O,this.set("context",ea)})),v.settingsVM.watch("returnFeatureCollection",k.hitch(this,function(ea,L,O){this.set("returnFeatureCollection",!(this.analysisMode&&("raster"===this.analysisMode||
"bigdata"===this.analysisMode))&&O)})),v.settingsVM.watch("datastore",k.hitch(this,function(ea,L,O){if(ea=this.get("context"))this._updateContextDatastore(ea,O),this.set("context",ea)})),v.settingsVM.watch("processorType",k.hitch(this,function(ea,L,O){if(ea=this.get("context"))ea.processorType=O,this.set("context",ea)})),v.settingsVM.watch("parallelProcessingFactor",k.hitch(this,function(ea,L,O){if(ea=this.get("context"))ea.parallelProcessingFactor=O,this.set("context",ea)})),v.settingsVM.watch("recycleProcessingWorkers",
k.hitch(this,function(ea,L,O){if(ea=this.get("context"))ea.recycleProcessingWorkers=O,this.set("context",ea)})),v.settingsVM.watch("retryOnFailures",k.hitch(this,function(ea,L,O){if(ea=this.get("context"))ea.retryOnFailures=O,this.set("context",ea)})),v.settingsVM.watch("resamplingMethod",k.hitch(this,function(ea,L,O){if(ea=this.get("context"))ea.resamplingMethod=O,this.set("context",ea)})))))},_updateContextDatastore:function(w,A){w&&A&&(A&&-1===["BDS","GDB"].indexOf(A)?w.dataStore=A:w.dataStore=
null,setTimeout(k.hitch(this,function(){this.set("showSelectFolder",this.showGeoAnalyticsParams?!w.dataStore:this.showSelectFolder)}),0))},_setShowOutputTypeAttr:function(w){this.showOutputType=w},_setDoSaveJobInfoAttr:function(w){this.doSaveJobInfo=w},_setDoSaveInStorageAttr:function(w){this.doSaveInStorage=w},_getResultNameAttr:function(w){this.resultName="";this.outputLayerInput?this.resultName=this.outputLayerInput.get("value"):this._outputLayerInput&&(this.resultName=this._outputLayerInput.get("value"));
return this.resultName},_setArcadeEditorAttr:function(w){this.arcadeEditor=w},_setShowCreditCalcBusyIndicatorAttr:function(w){var A=[];this.showCredits&&this._showCreditsLink&&this._usageForm&&(w?(A.push(a.before(this,"_handleShowCreditsClick",k.hitch(this,function(){var z=this._form&&this._form.validate();"DeriveNewLocations"===this.toolName||"FindExistingLocations"===this.toolName?z=z&&this.expressionGrid.validate():"EnrichLayer"==this.toolName&&(z=z&&this.validateSelectedGrid());z?this._pauseCreditLinkClick(this._onCreditsClickHandle,
!0):this._pauseCreditLinkClick(this._onCreditsClickHandle,!1)}))),A.push(a.after(this._usageForm,"_setContentAttr",k.hitch(this,function(){this._pauseCreditLinkClick(this._onCreditsClickHandle,!1)}))),A.push(a.after(this._usageForm,"_setErrorContentAttr",k.hitch(this,function(){this._pauseCreditLinkClick(this._onCreditsClickHandle,!1)})))):A.forEach(function(z){z.remove();z=null}))},_setuseArcGISComponentsAttr:function(w){this.useArcGISComponents=w},_getuseArcGISComponentsAttr:function(w){return this.useArcGISComponents},
_setIsServerAdvanceLicensedAttr:function(w){this.isServerAdvanceLicensed=w},_getIsServerAdvanceLicensedAttr:function(){return this.isServerAdvanceLicensed},_handleSettingsLinkClick:function(){this.showSettingsDlg()},showSettingsDlg:function(w){w&&w.preventDefault();this._hasPCSWarnShown&&this.showGeoAnalyticsParams&&this._errorMessagePane&&v.hideMessages(this._errorMessagePane);v.settingsDlg.show()},_handleModeCrumbClick:function(w){w.preventDefault();this._onClose(!1)},_onFocus:function(){this.map&&
"function"===typeof this.map.disableKeyboardNavigation&&this.map.disableKeyboardNavigation();this.emit("focus");this.inherited(arguments)},_onBlur:function(){this.map&&"function"===typeof this.map.enableKeyboardNavigation&&this.map.enableKeyboardNavigation();this.emit("blur");this.inherited(arguments)},_handleAtrrValueUpdate:function(w,A,z){"0"!==z&&(w=this.get("statisticSelect"),(z=this.getOptions(z))&&z.type&&v.addStatisticsOptions({selectWidget:w,type:z.type,showGeoAnalyticsParams:this.showGeoAnalyticsParams}))},
_pauseCreditLinkClick:function(w,A){A?(w.pause(),b.set(this._showCreditsLink,{color:"grey",cursor:"none"}),m.add(this._showCreditsLink,"esriAnalysisTextDisabled esriLoadingBar2")):(w.resume(),b.set(this._showCreditsLink,{color:"#21759B",cursor:"pointer"}),m.remove(this._showCreditsLink,"esriAnalysisTextDisabled esriLoadingBar2"))},constructAnalysisInputLyrObj:function(w,A){A=E.isDefined(A)?A:this.isSingleTenant;return v.constructAnalysisInputLyrObj(w,A,!this.showGeoAnalyticsParams)},_addBarrierstoJobParams:function(w,
A){w instanceof Object&&(A.pointBarrierLayer&&(w.pointBarrierLayer=r.toJson(this.constructAnalysisInputLyrObj(A.pointBarrierLayer))),A.lineBarrierLayer&&(w.lineBarrierLayer=r.toJson(this.constructAnalysisInputLyrObj(A.lineBarrierLayer))),A.polygonBarrierLayer&&(w.polygonBarrierLayer=r.toJson(this.constructAnalysisInputLyrObj(A.polygonBarrierLayer))));return w}});d("extend-esri")&&k.setObject("dijit.analysis._AnalysisOptions",H,x);return H})},"esri/dijit/analysis/Settings":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/json dojo/has dojo/json dojo/string dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/NodeList dojo/NodeList-dom dojo/_base/fx dojo/fx/easing dojo/promise/all dojo/Evented dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/Button dijit/form/CheckBox dijit/form/Form dijit/form/Select dijit/form/TextBox dijit/form/NumberTextBox dijit/form/ToggleButton dijit/form/ValidationTextBox dijit/layout/ContentPane dijit/form/FilteringSelect dijit/Dialog dijit/ConfirmDialog dojox/mvc/at dgrid1/OnDemandGrid dgrid1/Tree dgrid1/Editor dgrid1/Keyboard dgrid1/Selection dgrid1/Selector dgrid1/extensions/ColumnResizer dgrid1/extensions/DijitRegistry ../../kernel ../../lang ../../geometry/Extent ../../SpatialReference ../../layers/ArcGISImageServiceLayer ./_Widget ./utils ./SettingsViewModel ./JobsList ./components/DataStoreSelect dojo/i18n!../../nls/jsapi dojo/text!./templates/Settings.html".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x,w,A,z,G,I,K,R,U,ba,ca,da,ja,ea,L,O,S,T,J,N,C,P,Q,Y,fa,na,la,W,aa,oa,ha,pa,F,M,Z,X){var ka=k([S,N,C,P,J,T,Q,Y]);H=oa.createSubclass([B,E,x,w],{declaredClass:"esri.dijit.analysis.Settings",templateString:X,widgetsInTemplate:!0,i18n:null,toolName:"Settings",helpFileName:"AnalysisEnvironments",viewModelType:pa,cssClass:{primaryButton:"btn calcite blue",button:"btn calcite"},constructor:function(V,ia){this._pbConnects=[];V.containerNode&&(this.container=
V.containerNode);this.cssClass=p.mixin({},this.cssClass)},destroy:function(){this.inherited(arguments);r.forEach(this._pbConnects,m.disconnect);delete this._pbConnects},postMixInProperties:function(){this.inherited(arguments);this.i18n={};p.mixin(this.i18n,Z.common);p.mixin(this.i18n,Z.analysisSettings);this._initModelWatchers()},postCreate:function(){this.inherited(arguments);this.viewModel.showOkCancel&&(this._state={});this.initUI()},startup:function(){this._spatialRefGrid.startup()},initUI:function(){this._rasterUX=
[this._snapLblRow,this._snapSelRow,this._rasterLblRow,this._cellLblRow,this._cellSelectRow,this._cellSelectNumRow,this._maskLblRow,this._maskSelRow];this._extentUX=[this._processExtLblRow,this._extentLblRow,this._extentRow];this._coordSysUX=[this._processSRRow,this._processSRLblRow,this._outSRLblRow,this._outSRRow,this._coordinateLblRow];this._geoanalyticsUX=[this._geoanalyticsLblRow,this._datastoreLabelRow,this._selectDataStore];this._rasterPPFUX=[this._parallelProcessingLblRow,this._parallelProcessingFactorLblRow,
this._parallelProcessingFactorNumRow,this._recycleProcessingWorkersLblRow,this._recycleProcessingWorkersNumRow,this._retryOnFailuresLblRow,this._retryOnFailuresNumRow];this._rasterPTUX=[this._processorLblRow,this._processorTypeLblRow,this._processorTypeSelRow];this._rasterStorageUX=[this._storageLblRow,this._resamplingMethodLblRow,this._resamplingMethodSelRow];ha.initHelpLinks(this.domNode,this.viewModel.showHelp);ha.updateDisplay(this._rasterUX,this.viewModel.showRasterSettings,"table-row");ha.updateDisplay([this._overwriteRow],
this.viewModel.showOverwriteResultOption,"table-row");ha.updateDisplay([this._closeAnalysisRow],this.viewModel.showCloseAnalysisOption,"table-row");ha.updateDisplay([this._storeAnalysisRow],this.viewModel.showStoreAnalysisOption,"table-row");ha.updateDisplay(this._coordSysUX,this.viewModel.showCoordinateSystems,"table-row");ha.updateDisplay([this._processSRRow,this._processSRLblRow],this.viewModel.showProcessSR,"table-row");ha.updateDisplay([this._outSRLblRow,this._outSRRow],this.viewModel.showOutSR,
"table-row");ha.updateDisplay([this._coordinateLblRow],this.viewModel.showProcessSR||this.viewModel.showProcessSR,"table-row");ha.updateDisplay(this._extentUX,this.viewModel.showExtent,"table-row");ha.updateDisplay([this._closeDiv],this.viewModel.showCloseIcon,"block");ha.updateDisplay([this._settingsHeader],this.viewModel.showHeader,"block");ha.updateDisplay([this._actionbuttonCtr],this.viewModel.showOkCancel,"block");ha.updateDisplay(this._geoanalyticsUX,this.viewModel.showGeoAnalyticsSettings,
"table-row");ha.updateDisplay(this._rasterPPFUX,this.viewModel.showRasterPPFSettings,"table-row");ha.updateDisplay(this._rasterPTUX,this.viewModel.showRasterPTSettings,"table-row");ha.updateDisplay([this._maskLblRow,this._maskSelRow],this.viewModel.showRasterMaskSettings,"table-row");ha.updateDisplay([this._snapLblRow,this._snapSelRow],this.viewModel.showRasterSnapSettings,"table-row");ha.updateDisplay([this._cellLblRow,this._cellSelectRow,this._cellSelectNumRow],this.viewModel.showCellsizeSettings,
"table-row");ha.updateDisplay(this._rasterStorageUX,this.viewModel.showResamplingSettings,"table-row");ha.updateDisplay([this._creditWarningRow],this.viewModel.showCreditWarningSettings,"table-row");this._spatialRefGrid||(this._spatialRefGrid=new ka({collection:this.viewModel.spatialRefStore,id:this.id+"_settingsgrid",showHeader:!1,columns:[{renderExpando:!0,label:"Name",field:"name",sortable:!1,resizable:!0}],"class":"esriAnalysisSpatialRefTree"},this._spatialRefGridNode),g(".dijitButton",this._coordDialog.domNode).forEach(function(V,
ia){0===ia?n.add(V,this.cssClass.primaryButton):n.add(V,this.cssClass.button)},this));this.viewModel.outSR&&this._outSRInput.set("value",this.viewModel.outSR.wkid);this.viewModel.processSR&&this._processSRInput.set("value",this.viewModel.processSR.wkid);this.viewModel.layers&&this._updateLayerOptions(this.viewModel.layers);this._updateProcessSRSelectValue();this._handleProcessSRSelectChange(this._processSRSelect.get("value"));this._updateOutSRSelectValue();this._handleSRSelectChange(this._outSRSelect.get("value"));
this._updateExtentSelectValue();this._handleExtentOptionChange(this._extentSelect.get("value"));this._updateCellSizeSelectValue();this._handleCellSizeSelectChange(this._cellSizeSelect.get("value"));this._updateSnapRasterSelectValue();this._handleSnapRasterSelectChange(this._snapRasterSelect.get("value"));this._updateMaskSelectValue();this._handleMaskSelectChange(this._maskSelect.get("value"));this._updateProcessorTypeSelectValue();this._handleProcessorTypeSelectChange(this._processorTypeSelect.get("value"));
this._updateparallelProcessingFactorInputValue();this._handleparallelProcessingFactorInputChange(this._parallelProcessingFactorInput.get("value"));this._updaterecycleProcessingWorkersInputValue();this._handlerecycleProcessingWorkersInputChange(this._recycleProcessingWorkersInput.get("value"));this._updateretryOnFailuresInputValue();this._handleretryOnFailuresInputChange(this._retryOnFailuresInput.get("value"));this._updateResamplingMethodSelectValue();this._handleResamplingMethodSelectChange(this._resamplingMethodSelect.get("value"));
this._closeAnalysisCheck.set("checked",this.viewModel.closeAnalysisWidget);this._storeAnalysisCheck.set("checked",!this.viewModel.returnFeatureCollection);this._creditWarningCheck.set("checked",this.viewModel.creditWarning);this.viewModel.showJobsHistory&&this.buildJobsUI();this.viewModel.showGeoAnalyticsSettings&&this.buildDataStoreUI();this._handleCloseMsg()},_initModelWatchers:function(){this.own(this.viewModel.watch("showCloseIcon",p.hitch(this,function(V,ia,ma){ha.updateDisplay([this._closeDiv],
ma,"block")})),this.viewModel.watch("showHelp",p.hitch(this,function(V,ia,ma){ha.initHelpLinks(this.domNode,ma)})),this.viewModel.watch("showOverwriteResultOption",p.hitch(this,function(V,ia,ma){ha.updateDisplay([this._overwriteRow],ma,"table-row")})),this.viewModel.watch("showCloseAnalysisOption",p.hitch(this,function(V,ia,ma){ha.updateDisplay([this._closeAnalysisRow],ma,"table-row")})),this.viewModel.watch("showStoreAnalysisOption",p.hitch(this,function(V,ia,ma){ha.updateDisplay([this._storeAnalysisRow],
ma,"table-row")})),this.viewModel.watch("showCoordinateSystems",p.hitch(this,function(V,ia,ma){ha.updateDisplay(this._coordSysUX,ma,"table-row")})),this.viewModel.watch("showProcessSR",p.hitch(this,function(V,ia,ma){ha.updateDisplay([this._processSRRow,this._processSRLblRow],ma,"table-row");ha.updateDisplay([this._coordinateLblRow],ma||this.viewModel.showOutSR,"table-row");this._updateProcessSRSelectValue();this._handleProcessSRSelectChange(this._processSRSelect.get("value"))})),this.viewModel.watch("showOutSR",
p.hitch(this,function(V,ia,ma){ha.updateDisplay([this._outSRLblRow,this._outSRRow],ma,"table-row");ha.updateDisplay([this._coordinateLblRow],ma||this.viewModel.showProcessSR,"table-row");this._updateOutSRSelectValue();this._handleSRSelectChange(this._outSRSelect.get("value"))})),this.viewModel.watch("showExtent",p.hitch(this,function(V,ia,ma){ha.updateDisplay(this._extentUX,ma,"table-row");this._updateExtentSelectValue();ma&&this._handleExtentOptionChange(this._extentSelect.get("value"))})),this.viewModel.watch("showRasterSettings",
p.hitch(this,function(V,ia,ma){ha.updateDisplay(this._rasterUX,ma,"table-row");this._updateCellSizeSelectValue();this._handleCellSizeSelectChange(this._cellSizeSelect.get("value"));this._updateSnapRasterSelectValue();this._handleSnapRasterSelectChange(this._snapRasterSelect.get("value"));this._updateMaskSelectValue();this._handleMaskSelectChange(this._maskSelect.get("value"));this._updateResamplingMethodSelectValue();this._handleResamplingMethodSelectChange(this._resamplingMethodSelect.get("value"))})),
this.viewModel.watch("showRasterPPFSettings",p.hitch(this,function(V,ia,ma){ha.updateDisplay(this._rasterPPFUX,ma,"table-row");this._updateparallelProcessingFactorInputValue();this._handleparallelProcessingFactorInputChange(this._parallelProcessingFactorInput.get("value"));this._updaterecycleProcessingWorkersInputValue();this._handlerecycleProcessingWorkersInputChange(this._recycleProcessingWorkersInput.get("value"));this._updateretryOnFailuresInputValue();this._handleretryOnFailuresInputChange(this._retryOnFailuresInput.get("value"))})),
this.viewModel.watch("showRasterPTSettings",p.hitch(this,function(V,ia,ma){ha.updateDisplay(this._rasterPTUX,ma,"table-row");ha.updateDisplay([this._maskLblRow,this._maskSelRow],!ma&&this.viewModel.showRasterSettings,"table-row");this._updateProcessorTypeSelectValue();this._handleProcessorTypeSelectChange(this._processorTypeSelect.get("value"))})),this.viewModel.watch("showRasterSnapSettings",p.hitch(this,function(V,ia,ma){ha.updateDisplay([this._snapLblRow,this._snapSelRow],ma,"table-row");this._updateparallelProcessingFactorInputValue();
this._handleSnapRasterSelectChange(this._snapRasterSelect.get("value"))})),this.viewModel.watch("showRasterMaskSettings",p.hitch(this,function(V,ia,ma){ha.updateDisplay([this._maskLblRow,this._maskSelRow],ma,"table-row");this._handleMaskSelectChange(this._maskSelect.get("value"))})),this.viewModel.watch("showCellsizeSettings",p.hitch(this,function(V,ia,ma){ha.updateDisplay([this._cellLblRow,this._cellSelectRow,this._cellSelectNumRow],ma,"table-row");this._updateCellSizeSelectValue();this._handleCellSizeSelectChange(this._cellSizeSelect.get("value"))})),
this.viewModel.watch("layers",p.hitch(this,function(V,ia,ma){this._updateLayerOptions(this.viewModel.layers)})),this.viewModel.watch("showHeader",p.hitch(this,function(V,ia,ma){ha.updateDisplay([this._settingsHeader],ma,"block")})),this.viewModel.watch("showOkCancel",p.hitch(this,function(V,ia,ma){ha.updateDisplay([this._actionbuttonCtr],ma,"block")})),this.viewModel.watch("showGeoAnalyticsSettings",p.hitch(this,function(V,ia,ma){ha.updateDisplay(this._geoanalyticsUX,ma,"table-row");ma&&this.buildDataStoreUI()})),
this.viewModel.watch("isCustomProcessSR",p.hitch(this,function(){this._updateProcessSRSelectValue();this._handleProcessSRSelectChange(this._processSRSelect.get("value"))})),this.viewModel.watch("isCustomExtent",p.hitch(this,function(){this._updateExtentSelectValue();this._handleExtentOptionChange(this._extentSelect.get("value"))})),this.viewModel.watch("isCustomOutSR",p.hitch(this,function(){this._updateOutSRSelectValue();this._handleSRSelectChange(this._outSRSelect.get("value"))})),this.viewModel.watch("closeAnalysisWidget",
p.hitch(this,function(V,ia,ma){this._handleCloseAnalysisCheck(ma)})),this.viewModel.watch("returnFeatureCollection",p.hitch(this,function(V,ia,ma){this._handleReturnFeatureCollectionCheck(ma)})),this.viewModel.watch("showJobsHistory",p.hitch(this,this.buildJobsUI)),this.viewModel.watch("jobsViewModel",p.hitch(this,this.buildJobsUI)),this.viewModel.watch("showResamplingSettings",p.hitch(this,function(V,ia,ma){ha.updateDisplay(this._rasterStorageUX,ma,"table-row")})),this.viewModel.watch("showCreditWarningSettings",
p.hitch(this,function(V,ia,ma){ha.updateDisplay([this._creditWarningRow],ma,"table-row")})))},buildJobsUI:function(){ha.updateDisplay([this._settingsNavCtrl],this.viewModel.showJobsHistory,"block");n.toggle(this._form.domNode,"tab-contents tab-section is-active",this.viewModel.showJobsHistory);n.toggle(this._jobHistoryCtr,"tab-contents tab-section",this.viewModel.showJobsHistory);n.toggle(this.domNode,"esri-analysis-category",this.viewModel.showJobsHistory);this.viewModel.showJobsHistory&&(this._addTabHandlers||
(g(".tab-nav a",this.domNode).on("click",p.hitch(this,function(V){V.stopPropagation();g(".tab-title",this.domNode).removeClass("is-active");n.add(V.target,"is-active");V=n.contains(V.target,"general-tab");ha.updateDisplay([this._form.domNode],V,"block");ha.updateDisplay([this._jobHistoryCtr],!V,"block")})),this._addTabHandlers=!0),this.buildJobsList())},buildJobsList:function(){this.viewModel.jobsViewModel&&!this._jobsListWidget&&(this._jobsListWidget=new F({viewModel:this.viewModel.jobsViewModel},
this._jobsListDiv))},buildDataStoreUI:function(){this._dataStoreSelect||(this._dataStoreSelect=new M({geoAnalyticsServer:this.viewModel.geoAnalyticsServer,value:this.viewModel.get("datastore")},c.create("div",null,this._dataStoreTd)),this._dataStoreSelect.startup(),this._dataStoreSelect.on("change",p.hitch(this,this._handleDSSelectChange)))},_updateExtentSelectValue:function(){if(this.viewModel.get("isCustomExtent"))this._extentSelect.set("value","SPECIFIED");else if(this.viewModel.viewProps&&this.viewModel.viewProps.extentLayer&&
this._layerNames){var V=r.indexOf(this._layerNames,this.viewModel.viewProps.extentLayer.name);this._extentSelect.set("value","LAYER_"+V)}else this._extentSelect.set("value","DEFAULT");this.viewModel.get("isCustomExtent")&&this.viewModel.extent&&(this._xMinInput.set("value",this.viewModel.extent.xmin),this._xMaxInput.set("value",this.viewModel.extent.xmax),this._yMinInput.set("value",this.viewModel.extent.ymin),this._yMaxInput.set("value",this.viewModel.extent.ymax))},_updateProcessSRSelectValue:function(){this.viewModel.processSR&&
this.viewModel.get("isCustomProcessSR")&&this._processSRInput.set("value",this.viewModel.processSR.wkid);if(this.viewModel.get("isCustomProcessSR"))this._processSRSelect.set("value","SPECIFIED");else if(this.viewModel.viewProps&&this.viewModel.viewProps.pSRLayer&&this._layerNames){var V=r.indexOf(this._layerNames,this.viewModel.viewProps.pSRLayer.name);this._processSRSelect.set("value","LAYER_"+V)}else this._processSRSelect.set("value","DEFAULT")},_updateOutSRSelectValue:function(){this.viewModel.outSR&&
this.viewModel.get("isCustomOutSR")&&this._outSRInput.set("value",this.viewModel.outSR.wkid);if(this.viewModel.get("isCustomOutSR"))this._outSRSelect.set("value","SPECIFIED");else if(this.viewModel.viewProps&&this.viewModel.viewProps.outSRLayer&&this._layerNames){var V=r.indexOf(this._layerNames,this.viewModel.viewProps.outSRLayer.name);this._outSRSelect.set("value","LAYER_"+V)}else this._outSRSelect.set("value","DEFAULT")},_updateCellSizeSelectValue:function(){if(this.viewModel.get("isCustomCellSize"))this._cellSizeSelect.set("value",
"SPECIFIED");else if(this.viewModel.viewProps&&this.viewModel.viewProps.cellSizeLayer&&this._layerNames){var V=r.indexOf(this._layerNames,this.viewModel.viewProps.cellSizeLayer.name);this._cellSizeSelect.set("value","LAYER_"+V)}else this.viewModel.cellSize?this._cellSizeSelect.set("value",this.viewModel.cellSize):this._cellSizeSelect.set("value",this._cellSizeSelect.get("value"));this.viewModel.get("isCustomCellSize")&&this.viewModel.cellSize&&this._cellSizeInput.set("value",this.viewModel.cellSize)},
_updateSnapRasterSelectValue:function(){if(this.viewModel.viewProps&&this.viewModel.viewProps.snapRasterLayer&&this._layerNames){var V=r.indexOf(this._layerNames,this.viewModel.viewProps.snapRasterLayer.name);this._snapRasterSelect.set("value","LAYER_"+this._layerNames[V])}else this._snapRasterSelect.set("value",this._snapRasterSelect.get("value"))},_updateMaskSelectValue:function(){if(this.viewModel.viewProps&&this.viewModel.viewProps.maskLayer&&this._layerNames){var V=r.indexOf(this._layerNames,
this.viewModel.viewProps.maskLayer.name);this._maskSelect.set("value","LAYER_"+V)}else this._maskSelect.set("value",this._maskSelect.get("value"))},_updateProcessorTypeSelectValue:function(){this.viewModel.processorType?this._processorTypeSelect.set("value",this.viewModel.processorType):this._processorTypeSelect.set("value",this._processorTypeSelect.get("value"))},_updateparallelProcessingFactorInputValue:function(){this.viewModel.parallelProcessingFactor?this._parallelProcessingFactorInput.set("value",
this.viewModel.parallelProcessingFactor):this._parallelProcessingFactorInput.set("value",this._parallelProcessingFactorInput.get("value"))},_updaterecycleProcessingWorkersInputValue:function(){this.viewModel.recycleProcessingWorkers?this._recycleProcessingWorkersInput.set("value",this.viewModel.recycleProcessingWorkers):this._recycleProcessingWorkersInput.set("value",this._recycleProcessingWorkersInput.get("value"))},_updateretryOnFailuresInputValue:function(){this.viewModel.retryOnFailures?this._retryOnFailuresInput.set("value",
this.viewModel.retryOnFailures):this._retryOnFailuresInput.set("value",this._retryOnFailuresInput.get("value"))},_updateResamplingMethodSelectValue:function(){this.viewModel.resamplingMethod?this._resamplingMethodSelect.set("value",this.viewModel.resamplingMethod):this._resamplingMethodSelect.set("value",this._resamplingMethodSelect.get("value"))},_handleSRSelectChange:function(V){this._coordDialog.hide();this._outSRBtn.set("disabled","SPECIFIED"!==V);ha.updateDisplay(this._outSRCustomRow,"SPECIFIED"===
V&&this.viewModel.showOutSR,"table-row");ha.updateDisplay(this._outSRCustomInputRow,"SPECIFIED"===V&&this.viewModel.showOutSR,"table-row");this._outSRInput.set("required","SPECIFIED"===V);-1!==V.indexOf("LAYER_")&&(V=V.split("_")[1],V=this.viewModel.layers[V],this.viewModel.showOkCancel?(this._outSR={wkid:parseInt(V.fullExtent.spatialReference.wkid,10)},this._state.outSRLayer={name:V.name,url:V.url,fullExtent:V.fullExtent}):this.viewModel.set("outSR",{wkid:parseInt(V.fullExtent.spatialReference.wkid,
10)}))},_handleProcessSRSelectChange:function(V){this._coordDialog.hide();this._processSRBtn.set("disabled","SPECIFIED"!==V);ha.updateDisplay(this._processSRCustomRow,"SPECIFIED"===V&&this.viewModel.showProcessSR,"table-row");ha.updateDisplay(this._processSRCustomInputRow,"SPECIFIED"===V&&this.viewModel.showProcessSR,"table-row");this._processSRInput.set("required","SPECIFIED"===V);-1!==V.indexOf("LAYER_")&&(V=V.split("_")[1],V=this.viewModel.layers[V],this.viewModel.showOkCancel?(this._processSR=
{wkid:parseInt(V.fullExtent.spatialReference.wkid,10)},this._state.pSRLayer={name:V.name,url:V.url,fullExtent:V.fullExtent}):this.viewModel.set("processSR",{wkid:parseInt(V.fullExtent.spatialReference.wkid,10)}))},_handleOutSRBtnClick:function(){this._outSRClick=!0;this._coordDialog.show()},_handleProcessSRBtnClick:function(){this._outSRClick=!1;this._coordDialog.show()},_handleExtentOptionChange:function(V){var ia="SPECIFIED"===V;ha.updateDisplay([this._extentLbl,this._customExtentRow],this.viewModel.showExtent&&
ia,"table-row");this._xMinInput.set("required",ia);this._xMaxInput.set("required",ia);this._yMinInput.set("required",ia);this._yMaxInput.set("required",ia);-1!==V.indexOf("LAYER_")?(V=V.split("_")[1],V=this.viewModel.layers[V],ia=new la(V.fullExtent),this.viewModel.showOkCancel?(this._extent=ia.shiftCentralMeridian(),this._state.extentLayer={name:V.name,url:V.url,fullExtent:V.fullExtent}):this.viewModel.set("extent",ia.shiftCentralMeridian())):"SPECIFIED"===V?(ia=new la(this._xMinInput.get("value"),
this._yMinInput.get("value"),this._xMaxInput.get("value"),this._yMaxInput.get("value"),new W({wkid:102100})),this.viewModel.showOkCancel?(this._extent=ia,this._state.extentLayer=null):this.viewModel.set("extent",ia)):"DEFAULT"===V&&(this._extent=null,this._state.extentLayer=null)},_validateExtent:function(){var V=!0,ia="";this._handleCloseMsg();this._xMinInput.get("value")>this._xMaxInput.get("value")&&(V=!1,ia+=this.i18n.xMinMaxExtent);this._yMinInput.get("value")>this._yMaxInput.get("value")&&(V=
!1,ia+="\x3cbr/\x3e"+this.i18n.yMinMaxExtent);V||this._showMessages(ia);return V},_handleSRDlgOk:function(){var V;for(ia in this._spatialRefGrid.get("selection"))this._spatialRefGrid.get("selection").hasOwnProperty(ia)&&(V=ia);V=this._spatialRefGrid.collection.getSync(V);var ia=V.sRef.wkid;this.viewModel.showOkCancel?this._outSRClick?this._outSR={wkid:parseInt(ia,10)}:this._processSR={wkid:parseInt(ia,10)}:this.viewModel.set(this._outSRClick?"outSR":"processSR",{wkid:parseInt(ia,10)});this._outSRClick?
this._outSRInput.textbox.value=ia:this._processSRInput.textbox.value=ia;this._outSRClick?h.set(this._outSRLabel,"innerHTML",V.name):h.set(this._processSRLabel,"innerHTML",V.name)},_handleSRDlgCancel:function(){},_handleOutSRInputChange:function(V){V&&(h.set(this._outSRLabel,"innerHTML",""),ha.updateDisplay([this._outSRLabel],!1,"inline"),this.viewModel.showOkCancel?(this._outSR={wkid:parseInt(V,10)},this._state.outSRLayer=null):this.viewModel.set("outSR",{wkid:parseInt(V,10)}))},_handleProcessSRInputChange:function(V){V&&
(h.set(this._processSRLabel,"innerHTML",""),ha.updateDisplay([this._processSRLabel],!1,"inline"),this.viewModel.showOkCancel?(this._processSR={wkid:parseInt(V,10)},this._state.pSRLayer=null):this.viewModel.set("processSR",{wkid:parseInt(V,10)}))},_handleCellSizeSelectChange:function(V){ha.updateDisplay([this._cellSelectNumRow],"SPECIFIED"===V&&this.viewModel.showRasterSettings,"table-row");-1!==V.indexOf("LAYER_")?(V=this._cellSizeSelect.getOptions(V),this.viewModel.showOkCancel?(this._cellSize={url:V.url},
this._state.cellSizeLayer={name:V.label.substring(6),url:V.url,fullExtent:V.fullExtent}):this.viewModel.set("cellSize",{url:V.url})):"SPECIFIED"===V?this.viewModel.showOkCancel?(this._cellSize=this._cellSizeInput.get("value"),this._state.cellSizeLayer=null):this.viewModel.set("cellSize",this._cellSizeInput.get("value")):this.viewModel.showOkCancel?(this._cellSize=V,this._state.cellSizeLayer=null):this.viewModel.set("cellSize",V)},_handleSnapRasterSelectChange:function(V){-1!==V.indexOf("LAYER_")?
(V=this._snapRasterSelect.getOptions(V),this.viewModel.showOkCancel?(this._snapRaster={url:V.url},this._state.snapRasterLayer={name:V.label.substring(6),url:V.url,fullExtent:V.fullExtent}):this.viewModel.set("snapRaster",{url:V.url})):this.viewModel.showOkCancel?(this._snapRaster="NONE"===V?void 0:V,this._state.snapRasterLayer=null):this.viewModel.set("snapRaster","NONE"===V?void 0:V)},_handleMaskSelectChange:function(V){-1!==V.indexOf("LAYER_")?(V=this._maskSelect.getOptions(V),this.viewModel.showOkCancel?
(this._mask={url:V.url},this._state.maskLayer={name:V.label.substring(6),url:V.url,fullExtent:V.fullExtent}):this.viewModel.set("mask",{url:V.url})):this.viewModel.showOkCancel?(this._mask="NONE"===V?void 0:V,this._state.maskLayer=null):this.viewModel.set("mask","NONE"===V?void 0:V)},_handleCellSizeInputChange:function(V){V&&"SPECIFIED"===this._cellSizeSelect.get("value")&&(this.viewModel.showOkCancel?this._cellSize=V:this.viewModel.set("cellSize",V))},_handleDSSelectChange:function(V){this.viewModel.showOkCancel||
this.viewModel.set("datastore",V.value)},_handleProcessorTypeSelectChange:function(V){this.viewModel.showOkCancel?this._processorType="NONE"===V?void 0:V:this.viewModel.set("processorType",V);this.viewModel.set("showRasterPPFSettings",this.viewModel.showRasterPTSettings&&"GPU"!=V)},_handleparallelProcessingFactorInputChange:function(V){this.viewModel.showOkCancel?this._parallelProcessingFactor=V:this.viewModel.set("parallelProcessingFactor",V)},_handlerecycleProcessingWorkersInputChange:function(V){this.viewModel.showOkCancel?
this._recycleProcessingWorkers=V:this.viewModel.set("recycleProcessingWorkers",V)},_handleretryOnFailuresInputChange:function(V){this.viewModel.showOkCancel?this._retryOnFailures=V:this.viewModel.set("retryOnFailures",V)},_handleResamplingMethodSelectChange:function(V){this.viewModel.showOkCancel?this._resamplingMethod=V:this.viewModel.set("resamplingMethod",V)},_updateLayerOptions:function(V){var ia=r.map(V,function(qa,ua){return{value:"LAYER_"+ua,label:"Layer "+qa.name,url:qa.url,fullExtent:qa.fullExtent}}),
ma=[{value:"minof",label:this.i18n.minInputs},{value:"maxof",label:this.i18n.maxInputs,selected:!0},{value:"SPECIFIED",label:this.i18n.extentSpecfiedBelow}],ra=[{value:"DEFAULT",label:this.i18n.defaultLabel},{value:"SPECIFIED",label:this.i18n.extentSpecfiedBelow}],sa=[{value:"GPU",label:this.i18n.gpu},{value:"CPU",label:this.i18n.cpu}],Ba=[{value:"NEAREST",label:this.i18n.nearest},{value:"BILINEAR",label:this.i18n.bilinear},{value:"CUBIC",label:this.i18n.cubic}];var wa=[].concat([{value:"DEFAULT",
label:this.i18n.defaultExtentLabel},{value:"SPECIFIED",label:this.i18n.extentSpecfiedBelow}]).concat(ia);ra=[].concat(ra).concat(ia);var ta=r.filter(V,function(qa){return qa instanceof aa||"esri.layers.RasterXLayer"===qa.declaredClass||qa.url&&"imageserver"===qa.url.split("/").pop().toLowerCase()});ia=[].concat(r.map(ta,function(qa,ua){return{value:"LAYER_"+qa.name,label:"Layer "+qa.name,url:qa.url,fullExtent:qa.fullExtent}},this));var va=r.map(V,function(qa,ua){return-1<ta.indexOf(qa)?{value:"LAYER_"+
qa.name,label:"Layer "+qa.name,url:ha.constructAnalysisInputLyrObj(qa).url,fullExtent:qa.fullExtent}:{value:"LAYER_"+ua,label:"Layer "+qa.name,url:qa.url,fullExtent:qa.fullExtent}});this._layerNames=r.map(V,function(qa,ua){return qa.name});this._outSRSelect.removeOption(this._outSRSelect.getOptions());this._processSRSelect.removeOption(this._processSRSelect.getOptions());this._extentSelect.removeOption(this._extentSelect.getOptions());this._maskSelect.removeOption(this._maskSelect.getOptions());this._cellSizeSelect.removeOption(this._cellSizeSelect.getOptions());
this._snapRasterSelect.removeOption(this._snapRasterSelect.getOptions());this._processorTypeSelect.removeOption(this._processorTypeSelect.getOptions());this._resamplingMethodSelect.removeOption(this._resamplingMethodSelect.getOptions());this._outSRSelect.addOption(wa);this._processSRSelect.addOption(wa);this._extentSelect.addOption(ra);this._maskSelect.addOption([{value:"NONE",label:""}].concat(va));this._cellSizeSelect.addOption([].concat(ma).concat(ia));this._snapRasterSelect.addOption([{value:"NONE",
label:""}].concat(ia));this._processorTypeSelect.addOption([{value:"NONE",label:""}].concat(sa));this._resamplingMethodSelect.addOption(Ba);this._updateExtentSelectValue();this._updateOutSRSelectValue();this._updateProcessSRSelectValue();this._updateCellSizeSelectValue();this._updateSnapRasterSelectValue();this._updateMaskSelectValue();this._updateProcessorTypeSelectValue();this._updateparallelProcessingFactorInputValue();this._updaterecycleProcessingWorkersInputValue();this._updateretryOnFailuresInputValue();
this._updateResamplingMethodSelectValue()},_handleCloseAnalysisCheck:function(V){this.viewModel.showOkCancel||this.viewModel.set("closeAnalysisWidget",V)},_handleReturnFeatureCollectionCheck:function(V){this.viewModel.showOkCancel||this.viewModel.set("returnFeatureCollection",!V)},_handleOkButtonClick:function(V){V&&V.preventDefault();this._form.validate()&&("SPECIFIED"!==this._extentSelect.get("value")||this._validateExtent())&&(this.viewModel.set("viewProps",this._state),"DEFAULT"!==this._outSRSelect.get("value")?
this.viewModel.set("outSR",this._outSR):"DEFAULT"===this._outSRSelect.get("value")&&this.viewModel.set("outSR",null),"DEFAULT"!==this._processSRSelect.get("value")?this.viewModel.set("processSR",this._processSR):"DEFAULT"===this._processSRSelect.get("value")&&this.viewModel.set("processSR",null),"SPECIFIED"===this._extentSelect.get("value")&&this._validateExtent()&&(this._extent=new la(this._xMinInput.get("value"),this._yMinInput.get("value"),this._xMaxInput.get("value"),this._yMaxInput.get("value"),
new W({wkid:102100}))),this.viewModel.set("extent",this._extent),this.viewModel.set("mask",this._mask),this.viewModel.set("snapRaster",this._snapRaster),this.viewModel.set("cellSize",this._cellSize),this.viewModel.set("resamplingMethod",this._resamplingMethod),this.viewModel.set("creditWarningChecked",this._creditWarning),this._dataStoreSelect&&this.viewModel.set("datastore",this._dataStoreSelect.get("value")),this.viewModel.set("closeAnalysisWidget",this._closeAnalysisCheck.get("checked")),this.viewModel.set("returnFeatureCollection",
!this._storeAnalysisCheck.get("checked")),this.viewModel.set("isCustomExtent","SPECIFIED"===this._extentSelect.get("value")),this.viewModel.set("isCustomOutSR","SPECIFIED"===this._outSRSelect.get("value")),this.viewModel.set("isCustomProcessSR","SPECIFIED"===this._processSRSelect.get("value")),this.viewModel.set("isCustomCellSize","SPECIFIED"===this._cellSizeSelect.get("value")),this.viewModel.set("processorType",this._processorType),this.viewModel.set("parallelProcessingFactor",this._parallelProcessingFactor),
this.viewModel.set("recycleProcessingWorkers",this._recycleProcessingWorkers),this.viewModel.set("retryOnFailures",this._retryOnFailures),this.viewModel.save(),this.emit("ok-settings",{viewMode:this.viewModel}))},_handleCancelButtonClick:function(){this.viewModel.reset();this.reset();this.emit("cancel-settings",{viewMode:this.viewModel})},_handleCreditWarningCheck:function(V){this.viewModel.set("creditWarning",V)},reset:function(){"SPECIFIED"!==this._extentSelect.get("value")||this._validateExtent()||
this.viewModel.get("isCustomExtent")||(this._xMinInput.reset(),this._xMaxInput.reset(),this._yMinInput.reset(),this._yMaxInput.reset());this.initUI()},_showMessages:function(V){h.set(this._bodyNode,"innerHTML",V);u.fadeIn({node:this._errorMessagePane,easing:t.quadIn,onEnd:p.hitch(this,function(){e.set(this._errorMessagePane,{display:""})})}).play()},_handleCloseMsg:function(V){V&&V.preventDefault();u.fadeOut({node:this._errorMessagePane,easing:t.quadOut,onEnd:p.hitch(this,function(){e.set(this._errorMessagePane,
{display:"none"})})}).play()}});a("extend-esri")&&p.setObject("dijit.analysis.Settings",H,fa);return H})},"dojo/NodeList":function(){define(["./query"],function(H){return H.NodeList})},"dijit/ConfirmDialog":function(){define(["dojo/_base/declare","./Dialog","./_ConfirmDialogMixin"],function(H,k,p){return H("dijit.ConfirmDialog",[k,p],{})})},"dijit/_ConfirmDialogMixin":function(){define(["dojo/_base/declare","./_WidgetsInTemplateMixin","dojo/i18n!./nls/common","dojo/text!./templates/actionBar.html",
"./form/Button"],function(H,k,p,r){return H("dijit._ConfirmDialogMixin",k,{actionBarTemplate:r,buttonOk:p.buttonOk,_setButtonOkAttr:{node:"okButton",attribute:"label"},buttonCancel:p.buttonCancel,_setButtonCancelAttr:{node:"cancelButton",attribute:"label"}})})},"dojox/mvc/at":function(){define(["dojo/_base/kernel","dojo/_base/lang","./sync","./_atBindingExtension"],function(H,k,p){H.experimental("dojox.mvc");H=function(r,m){return{atsignature:"dojox.mvc.at",target:r,targetProp:m,bindDirection:p.both,
direction:function(l){this.bindDirection=l;return this},transform:function(l){this.converter=l;return this},equals:function(l){this.equalsCallback=l;return this}}};H.from=p.from;H.to=p.to;H.both=p.both;return k.setObject("dojox.mvc.at",H)})},"dojox/mvc/sync":function(){define(["dojo/_base/lang","dojo/_base/config","dojo/_base/array","dojo/has"],function(H,k,p,r){function m(d,f,e,h,c,g,n,q,v,u){if(!(e(v,q)||"*"==c&&0>p.indexOf(h.get("properties")||[n],n)||"*"==c&&n in(u||{}))){e="*"==c?n:c;if(r("mvc-bindings-log-api"))var t=
b(h,e,g,n);try{v=d?d(v,f):v}catch(y){r("mvc-bindings-log-api")&&console.log("Copy from"+t.join(" to ")+" was not done as an error is thrown in the converter.");return}r("mvc-bindings-log-api")&&console.log(t.reverse().join(" is being copied from: ")+" (Value: "+v+" from "+q+")");H.isFunction(h.set)?h.set(e,v):h[e]=v}}var l=H.getObject("dojox.mvc",!0);r.add("mvc-bindings-log-api",(k.mvc||{}).debugBindings);var b=r("mvc-bindings-log-api")?function(d,f,e,h){return[[e.canConvertToLoggable||!e.declaredClass?
e:e.declaredClass,h].join(":"),[d.canConvertToLoggable||!d.declaredClass?d:d.declaredClass,f].join(":")]}:"";k={from:1,to:2,both:3};var a=function(d,f,e,h,c){var g=(c||{}).converter;if(g){var n={source:d,target:e};var q=g.format&&H.hitch(n,g.format);var v=g.parse&&H.hitch(n,g.parse)}var u=[],t=[],y=H.mixin({},d.constraints,e.constraints);g=(c||{}).bindDirection||l.both;var D=(c||{}).equals||a.equals;if(r("mvc-bindings-log-api"))var B=b(d,f,e,h);if("*"==h){if("*"!=f)throw Error("Unmatched wildcard is specified between source and target.");
c=e.get("properties");if(!c){c=[];for(var E in e)e.hasOwnProperty(E)&&"_watchCallbacks"!=E&&c.push(E)}t=e.get("excludes")}else c=[f];g&l.from&&(H.isFunction(d.set)&&H.isFunction(d.watch)?u.push(d.watch.apply(d,("*"!=f?[f]:[]).concat([function(x,w,A){m(q,y,D,e,h,d,x,w,A,t)}]))):r("mvc-bindings-log-api")&&console.log(B.reverse().join(" is not a stateful property. Its change is not reflected to ")+"."),p.forEach(c,function(x){if("*"!=h||!(x in(t||{}))){var w=H.isFunction(d.get)?d.get(x):d[x];m(q,y,D,
e,"*"==h?x:h,d,x,void 0,w)}}));g&l.to&&(g&l.from||p.forEach(c,function(x){if("*"!=h||!(x in(t||{}))){var w=H.isFunction(e.get)?e.get(h):e[h];m(v,y,D,d,x,e,"*"==h?x:h,void 0,w)}}),H.isFunction(e.set)&&H.isFunction(e.watch)?u.push(e.watch.apply(e,("*"!=h?[h]:[]).concat([function(x,w,A){m(v,y,D,d,f,e,x,w,A,t)}]))):r("mvc-bindings-log-api")&&console.log(B.join(" is not a stateful property. Its change is not reflected to ")+"."));r("mvc-bindings-log-api")&&console.log(B.join(" is bound to: "));E={};E.unwatch=
E.remove=function(){for(var x=null;x=u.pop();)x.unwatch();r("mvc-bindings-log-api")&&console.log(B.join(" is unbound from: "))};return E};H.mixin(l,k);return H.setObject("dojox.mvc.sync",H.mixin(a,{equals:function(d,f){return d===f||"number"==typeof d&&isNaN(d)&&"number"==typeof f&&isNaN(f)||H.isFunction((d||{}).getTime)&&H.isFunction((f||{}).getTime)&&d.getTime()==f.getTime()||(H.isFunction((d||{}).equals)?d.equals(f):H.isFunction((f||{}).equals)?f.equals(d):!1)}},k))})},"dojox/mvc/_atBindingExtension":function(){define(["dojo/_base/config",
"dojo/has","dijit/_WidgetBase","./atBindingExtension"],function(H,k,p,r){k.add("mvc-extension-per-widget",(H.mvc||{}).extensionPerWidget);k("mvc-extension-per-widget")||r(p.prototype)})},"dojox/mvc/atBindingExtension":function(){define("dojo/aspect dojo/_base/array dojo/_base/lang dijit/_WidgetBase ./_atBindingMixin dijit/registry".split(" "),function(H,k,p,r,m){return function(l){k.forEach(arguments,function(b){b.dataBindAttr?console.warn("Detected a widget or a widget class that has already been applied data binding extension. Skipping..."):
(p._mixin(b,m.mixin),H.before(b,"postscript",function(a,d){this._dbpostscript(a,d)}),H.before(b,"startup",function(){this._started||this._startAtWatchHandles()}),H.before(b,"destroy",function(){this._stopAtWatchHandles()}),H.around(b,"set",function(a){return function(d,f){return d==m.prototype.dataBindAttr?this._setBind(f):"dojox.mvc.at"==(f||{}).atsignature?this._setAtWatchHandle(d,f):a.apply(this,p._toArray(arguments))}}))});return arguments}})},"dojox/mvc/_atBindingMixin":function(){define("dojo/_base/array dojo/_base/lang dojo/_base/declare dojo/has dojo/Stateful ./resolve ./sync".split(" "),
function(H,k,p,r,m,l,b){function a(c){try{var g=require("dijit/registry")}catch(q){return}for(c=c.domNode&&c.domNode.parentNode;c;){if(c=g.getEnclosingWidget(c)){var n=c._relTargetProp||"target";if((k.isFunction(c.get)?c.get(n):c[n])||n in c.constructor.prototype)return c}c=c&&c.domNode.parentNode}}function d(c,g,n,q,v){function u(){t.Two&&t.Two.unwatch();delete t.Two;var E=y&&(k.isFunction(y.get)?y.get(D):y[D]),x=l(c,E);E=l(n,E);r("mvc-bindings-log-api")&&(!x||/^rel:/.test(c)&&!y)&&e(c,g);r("mvc-bindings-log-api")&&
(!E||/^rel:/.test(n)&&!y)&&e(n,q);x&&E&&(!/^rel:/.test(c)&&!/^rel:/.test(n)||y)&&(x.set&&x.watch||"*"!=g?null==g?(k.isFunction(E.set)?E.set(q,x):E[q]=x,r("mvc-bindings-log-api")&&console.log("dojox/mvc/_atBindingMixin set "+x+" to: "+f(E,q))):t.Two=b(x,g,E,q,v):r("mvc-bindings-log-api")&&e(c,g))}var t={},y=a(n),D=y&&y._relTargetProp||"target";u();if(y&&/^rel:/.test(c)||/^rel:/.test(n)&&k.isFunction(y.set)&&k.isFunction(y.watch))t.rel=y.watch(D,function(E,x,w){x!==w&&(r("mvc-bindings-log-api")&&console.log("Change in relative data binding target: "+
y),u())});var B={};B.unwatch=B.remove=function(){for(var E in t)t[E]&&t[E].unwatch(),delete t[E]};return B}var f=r("mvc-bindings-log-api")?function(c,g){return[c._setIdAttr||!c.declaredClass?c:c.declaredClass,g].join(":")}:"",e=r("mvc-bindings-log-api")?function(c,g){console.warn(g+" could not be resolved"+("string"==typeof c?" with "+c:"")+".")}:"",h={dataBindAttr:"data-mvc-bindings",_dbpostscript:function(c,g){g=this._refs=(c||{}).refs||{};for(var n in c)if("dojox.mvc.at"==(c[n]||{}).atsignature){var q=
c[n];delete c[n];g[n]=q}q=new m;var v=this;q.toString=function(){return"[Mixin value of widget "+v.declaredClass+", "+(v.id||"NO ID")+"]"};q.canConvertToLoggable=!0;this._startAtWatchHandles(q);for(n in g)void 0!==q[n]&&((c=c||{})[n]=q[n]);this._stopAtWatchHandles()},_startAtWatchHandles:function(c){this.canConvertToLoggable=!0;var g=this._refs;if(g){var n=this._atWatchHandles=this._atWatchHandles||{};this._excludes=null;for(var q in g)g[q]&&"*"!=q&&(n[q]=d(g[q].target,g[q].targetProp,c||this,q,{bindDirection:g[q].bindDirection,
converter:g[q].converter,equals:g[q].equalsCallback}));"dojox.mvc.at"==(g["*"]||{}).atsignature&&(n["*"]=d(g["*"].target,g["*"].targetProp,c||this,"*",{bindDirection:g["*"].bindDirection,converter:g["*"].converter,equals:g["*"].equalsCallback}))}},_stopAtWatchHandles:function(){for(var c in this._atWatchHandles)this._atWatchHandles[c].unwatch(),delete this._atWatchHandles[c]},_setAtWatchHandle:function(c,g){if("ref"==c)throw Error(this+": 1.7 ref syntax used in conjunction with 1.8 dojox/mvc/at syntax, which is not supported.");
var n=this._atWatchHandles=this._atWatchHandles||{};n[c]&&(n[c].unwatch(),delete n[c]);this._excludes=this[c]=null;this._started?n[c]=d(g.target,g.targetProp,this,c,{bindDirection:g.bindDirection,converter:g.converter,equals:g.equalsCallback}):this._refs[c]=g},_setBind:function(c){c=eval("({"+c+"})");for(var g in c){var n=c[g];"dojox.mvc.at"!=(n||{}).atsignature?console.warn(g+" in "+dataBindAttr+" is not a data binding handle."):this._setAtWatchHandle(g,n)}},_getExcludesAttr:function(){if(this._excludes)return this._excludes;
var c=[],g;for(g in this._atWatchHandles)"*"!=g&&c.push(g);return c},_getPropertiesAttr:function(){if(this.constructor._attribs)return this.constructor._attribs;var c=["onClick"].concat(this.constructor._setterAttrs);H.forEach(["id","excludes","properties","ref","binding"],function(g){g=H.indexOf(c,g);0<=g&&c.splice(g,1)});return this.constructor._attribs=c}};h[h.dataBindAttr]="";p=p("dojox/mvc/_atBindingMixin",null,h);p.mixin=h;return p})},"dojox/mvc/resolve":function(){define(["dojo/_base/lang",
"dijit/registry","dojo/Stateful"],function(H,k){return H.setObject("dojox.mvc.resolve",function(p,r){if("string"==typeof p){var m=p.match(/^(expr|rel|widget):(.*)$/)||[];try{p="rel"==m[1]?H.getObject(m[2]||"",!1,r):"widget"==m[1]?k.byId(m[2]):H.getObject(m[2]||p,!1,r)}catch(l){}}return p})})},"dgrid1/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],function(H,k,p){return H([k,p],{})})},"dgrid1/Grid":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/has ./List ./util/misc dojo/_base/sniff".split(" "),
function(H,k,p,r,m,l,b,a){function d(f,e){e&&e.nodeType&&f.appendChild(e)}H=H(b,{columns:null,hasNeutralSort:!1,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(f){return"object"!==typeof f?this.columns[f]:this.cell(f).column},listType:"grid",cell:function(f,e){if(f.column&&f.element)return f;f.target&&f.target.nodeType&&(f=f.target);if(f.nodeType){do{if(this._rowIdToObject[f.id])break;var h=f.columnId;if(h){e=h;var c=f;break}f=f.parentNode}while(f&&f!==this.domNode)}if(!c&&"undefined"!==
typeof e){var g=this.row(f);if(h=g&&g.element){h=h.getElementsByTagName("td");for(var n=0;n<h.length;n++)if(h[n].columnId===e){c=h[n];break}}}if(null!=f)return{row:g||this.row(f),column:e&&this.column(e),element:c}},createRowCells:function(f,e,h,c,g){var n=p.create("table",{className:"dgrid-row-table",role:"presentation"}),q=9>l("ie")?p.create("tbody",null,n):n,v,u,t;h=h||this.subRows;var y=0;for(v=h.length;y<v;y++){var D=h[y];var B=p.create("tr",null,q);D.className&&(B.className=D.className);var E=
0;for(u=D.length;E<u;E++){var x=D[E];var w=x.id;var A=x.field?" field-"+a.escapeCssIdentifier(x.field,"-"):"";(t="function"===typeof x.className?x.className(c):x.className)&&(A+=" "+t);A=p.create(f,{className:"dgrid-cell"+(w?" dgrid-column-"+a.escapeCssIdentifier(w,"-"):"")+A,role:"th"===f?"columnheader":"gridcell"});A.columnId=w;if(w=x.colSpan)A.colSpan=w;if(w=x.rowSpan)A.rowSpan=w;e(A,x,c,g);B.appendChild(A)}}return n},_createBodyRowCell:function(f,e,h,c){var g=h;e.get?g=e.get(h):"field"in e&&"_item"!==
e.field&&(g=h[e.field]);e.renderCell?d(f,e.renderCell(h,g,f,c)):this._defaultRenderCell.call(e,h,g,f,c)},_createHeaderRowCell:function(f,e){var h=e.headerNode=f,c=e.field;c&&(f.field=c);e.renderHeaderCell?d(h,e.renderHeaderCell(h)):("label"in e||e.field)&&h.appendChild(document.createTextNode("label"in e?e.label:e.field));!1!==e.sortable&&c&&"_item"!==c&&(f.sortable=!0,f.className+=" dgrid-sortable")},left:function(f,e){f.element||(f=this.cell(f));return this.cell(this._move(f,-(e||1),"dgrid-cell"))},
right:function(f,e){f.element||(f=this.cell(f));return this.cell(this._move(f,e||1,"dgrid-cell"))},_defaultRenderCell:function(f,e,h){if(this.formatter){var c=this.formatter,g=this.grid.formatterScope;f="string"===typeof c&&g?g[c](e,f):this.formatter(e,f);null!=f&&f.hasOwnProperty("html")?h.innerHTML=f.html:null!=f&&h.appendChild(document.createTextNode(f))}else null!=e&&h.appendChild(document.createTextNode(e))},renderRow:function(f,e){f=this.createRowCells("td",k.hitch(this,"_createBodyRowCell"),
e&&e.subRows,f,e);e=p.create("div",{role:"row"});e.appendChild(f);return e},renderHeader:function(){var f=this,e=this.headerNode;e.setAttribute("role","row");p.empty(e);var h=this.createRowCells("th",k.hitch(this,"_createHeaderRowCell"),this.subRows&&this.subRows.headerRows);this._rowIdToObject[h.id=this.id+"-header"]=this.columns;e.appendChild(h);this._sortListener&&this._sortListener.remove();this._sortListener=m(h,"click,keydown",function(c){if("click"===c.type||32===c.keyCode||!l("opera")&&13===
c.keyCode){var g=c.target;do if(g.sortable){var n=g.field||g.columnId;var q=f.sort[0];n=f.hasNeutralSort&&q&&q.property===n&&q.descending?[]:[{property:n,descending:q&&q.property===n&&!q.descending}];q={bubbles:!0,cancelable:!0,grid:f,parentType:c.type,sort:n};m.emit(c.target,"dgrid-sort",q)&&(f._sortNode=g,f.set("sort",n));break}while((g=g.parentNode)&&g!==e)}})},resize:function(){var f=this.headerNode.firstChild,e=this.contentNode,h;this.inherited(arguments);e.style.width="";e&&f&&(h=f.offsetWidth)>
e.offsetWidth&&(e.style.width=h+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(){this.inherited(arguments);this.updateSortArrow(this.sort)},_findSortArrowParent:function(f){var e=this.columns,h;for(h in e){var c=e[h];if(c.field===f)return c.headerNode}},updateSortArrow:function(f,e){this._lastSortedArrow&&(this._lastSortedArrow.parentNode&&r.remove(this._lastSortedArrow.parentNode,"dgrid-sort-up dgrid-sort-down"),
p.destroy(this._lastSortedArrow),delete this._lastSortedArrow);e&&(this.sort=f);f[0]&&(e=f[0].property,f=f[0].descending,e=this._sortNode||this._findSortArrowParent(e),delete this._sortNode,e&&(e=e.contents||e,this._lastSortedArrow=p.create("div",{className:"dgrid-sort-arrow ui-icon",innerHTML:"\x26nbsp;",role:"presentation"},e,"first"),r.add(e,"dgrid-sort-"+(f?"down":"up")),this.resize()))},styleColumn:function(f,e){return this.addCssRule("#"+a.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+
a.escapeCssIdentifier(f,"-"),e)},_configColumns:function(f,e){var h=[],c=e instanceof Array;a.each(e,function(g,n){"string"===typeof g&&(e[n]=g={label:g});c||g.field||(g.field=n);n=g.id=g.id||(isNaN(n)?n:f+n);this._configColumn&&(this._configColumn(g,e,f),n=g.id);c&&(this.columns[n]=g);g.grid?g.grid!==this&&console.warn("Sharing column definition objects with multiple grids is not supported.",g.grid,this):g.grid=this;h.push(g)},this);return c?e:h},_destroyColumns:function(){this.cleanup()},configStructure:function(){var f=
this.subRows,e=this._columns=this.columns;this.columns=!e||e instanceof Array?{}:e;if(f)for(e=0;e<f.length;e++)f[e]=this._configColumns(e+"-",f[e]);else this.subRows=[this._configColumns("",e)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(f){this._destroyColumns();this.subRows=null;this.columns=f;this._updateColumns()},_setSubRows:function(f){this._destroyColumns();this.subRows=f;this._updateColumns()},_updateColumns:function(){this.configStructure();this.renderHeader();
this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this.sort.length?(this._lastSortedArrow=null,this.updateSortArrow(this.sort)):this.resize())}});H.appendIfNode=d;return H})},"dgrid1/List":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/on dojo/query dojo/sniff ./util/misc".split(" "),function(H,k,p,r,m,l,b,a){function d(t,y){return l("#"+a.escapeCssIdentifier(t),y)[0]}function f(t,y){t.className="dgrid-scrollbar-measure";
document.body.appendChild(t);y=t["offset"+y]-t["client"+y];t.className="";t.parentNode&&document.body.removeChild(t);return y}function e(t){p.replace(this.domNode,t,this._class||"");this._class=t}function h(){return this._class}var c=[];b("mozilla")&&c.push("has-mozilla");b("touch")&&c.push("has-touch");p.add(document.documentElement,c);b.add("pointer",function(t){return"PointerEvent"in t?"pointer":"MSPointerEvent"in t?"MSPointer":!1});var g,n;b.add("dom-scrollbar-width",function(t,y,D){return f(D,
"Width")});b.add("dom-scrollbar-height",function(t,y,D){return f(D,"Height")});b.add("dom-rtl-scrollbar-left",function(t,y,D){t=document.createElement("div");D.className="dgrid-scrollbar-measure";D.setAttribute("dir","rtl");D.appendChild(t);document.body.appendChild(D);y=!!b("ie")||!!b("trident")||/\bEdge\//.test(navigator.userAgent)||t.offsetLeft>=b("dom-scrollbar-width");D.className="";D.parentNode&&document.body.removeChild(D);r.destroy(t);D.removeAttribute("dir");return y});var q=0,v=function(){this._started&&
this.resize()},u=H(null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,addUiClasses:!0,highlightDuration:250,resizeThrottleDelay:a.defaultDelay,resizeThrottleMethod:"throttleDelayed",postscript:function(t,y){var D=this;(this._Row=function(B,E,x){this.id=B;this.data=E;this.element=x}).prototype.remove=function(){D.removeRow(this.element)};y&&(this.srcNodeRef=y=y.nodeType?y:d(y));this.create(t,y)},listType:"list",create:function(t,y){y=this.domNode=y||document.createElement("div");
if(t){this.params=t;H.safeMixin(this,t);var D=t["class"]||t.className||y.className}this.sort=this.sort||[];this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();this.id=y.id=y.id||this.id||u.autoIdPrefix+q++;this.buildRendering();D&&e.call(this,D);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var t=this.domNode,y=this.addUiClasses,D=this;var B=this.isRTL="rtl"===(document.body.dir||document.documentElement.dir||
document.body.style.direction).toLowerCase();t.className="";t.setAttribute("role","grid");p.add(t,"dgrid dgrid-"+this.listType+(y?" ui-widget":""));var E=this.headerNode=r.create("div",{className:"dgrid-header dgrid-header-row"+(y?" ui-widget-header":"")+(this.showHeader?"":" dgrid-header-hidden")},t);var x=this.bodyNode=r.create("div",{className:"dgrid-scroller"},t);b("ff")&&(x.tabIndex=-1);this.headerScrollNode=r.create("div",{className:"dgrid-header dgrid-header-scroll dgrid-scrollbar-width"+(y?
" ui-widget-header":"")},t);this.footerNode=r.create("div",{className:"dgrid-footer"+(this.showFooter?"":" dgrid-footer-hidden")},t);B&&(t.className+=" dgrid-rtl"+(b("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));m(x,"scroll",function(w){D.showHeader&&(E.scrollLeft=w.scrollLeft||x.scrollLeft);w.stopPropagation();m.emit(t,"scroll",{scrollTarget:x})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=r.create("div",{className:"dgrid-content"+(y?" ui-widget-content":"")},this.bodyNode);
"string"===typeof this.resizeThrottleMethod&&a[this.resizeThrottleMethod]?y=a[this.resizeThrottleMethod](v,this,this.resizeThrottleDelay):"function"===typeof this.resizeThrottleMethod?y=this.resizeThrottleMethod(k.hitch(this,v),this.resizeThrottleDelay):(console.warn("Invalid value specified for resizeThrottleMethod:  "+this.resizeThrottleMethod),y=a.throttleDelayed(v,this,this.resizeThrottleDelay));this._resizeHandle=m(window,"resize",y);this._listeners.push(this._resizeHandle)},postCreate:function(){},
startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this.sort))},configStructure:function(){},resize:function(){var t=this.bodyNode,y=this.footerNode;y=this.showFooter?y.offsetHeight:0;this.headerScrollNode.style.height=t.style.marginTop=this.headerNode.offsetHeight+"px";t.style.marginBottom=y+"px";g||(g=b("dom-scrollbar-width"),n=b("dom-scrollbar-height"),b("ie")&&(g++,n++),a.addCssRule(".dgrid-scrollbar-width","width: "+g+"px"),a.addCssRule(".dgrid-scrollbar-height",
"height: "+n+"px"),17!==g&&(a.addCssRule(".dgrid-header-row","right: "+g+"px"),a.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+g+"px")))},addCssRule:function(t,y){t=a.addCssRule(t,y);this.cleanAddedRules&&this._listeners.push(t);return t},on:function(t,y){t=m(this.domNode,t,y);b("dom-addeventlistener")||this._listeners.push(t);return t},cleanup:function(){for(var t in this._rowIdToObject)if(this._rowIdToObject[t]!==this.columns){var y=d(t,this.domNode);y&&this.removeRow(y,!0)}},destroy:function(){if(this._listeners){for(var t=
this._listeners.length;t--;)this._listeners[t].remove();this._listeners=null}this._started=!1;this.cleanup();r.destroy(this.domNode)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoRowId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},highlightRow:function(t,y){var D="dgrid-highlight"+(this.addUiClasses?" ui-state-highlight":"");t=t.element||t;p.add(t,D);setTimeout(function(){p.remove(t,D)},y||this.highlightDuration)},adjustRowIndices:function(t){var y=t.rowIndex;if(-1<
y){do-1<t.rowIndex&&this.setRowIndex(t,y++,t.rowIndex);while((t=t.nextSibling)&&t.rowIndex!==y)}},renderArray:function(t,y,D){D=D||{};var B=D.start||0,E=document.createDocumentFragment(),x=[],w=0,A=t.length;y||(this._lastCollection=t);for(;w<A;)x[w]=this.insertRow(t[w],E,null,B++,D),w++;(t=y?y.parentNode:this.contentNode)&&t.parentNode&&(t!==this.contentNode||A)&&(t.insertBefore(E,y||null),A&&this.adjustRowIndices(x[A-1]));return x},renderHeader:function(){},setRowIndex:function(t,y,D){t.rowIndex=
y;this.maintainOddEven&&(y=1===y%2?"dgrid-row-odd":"dgrid-row-even",void 0!==D?(D=1===D%2?"dgrid-row-odd":"dgrid-row-even",D!==y&&p.replace(t,D,y)):p.add(t,y))},_autoRowId:0,insertRow:function(t,y,D,B,E){var x=this.id+"-row-"+(this.collection&&this.collection.getIdentity?this.collection.getIdentity(t):this._autoRowId++),w=d(x,this.domNode),A=w&&w.previousSibling;w&&(w===D&&(D=(D.connected||D).nextSibling),this.removeRow(w,!1,E));w=this.renderRow(t,E);w.className=(w.className||"")+" dgrid-row "+(this.addUiClasses?
" ui-state-default":"");this._rowIdToObject[w.id=x]=t;y.insertBefore(w,D||null);this.setRowIndex(w,B);A&&A.rowIndex!==w.rowIndex-1&&this.adjustRowIndices(A);return w},renderRow:function(t){var y=document.createElement("div");y.appendChild(document.createTextNode(t));return y},removeRow:function(t,y){t=t.element||t;delete this._rowIdToObject[t.id];y||r.destroy(t)},row:function(t){var y;if(t instanceof this._Row)return t;t.target&&t.target.nodeType&&(t=t.target);if(t.nodeType){do{var D=t.id;if(y=this._rowIdToObject[D])return new this._Row(D.substring(this.id.length+
5),y,t);t=t.parentNode}while(t&&t!==this.domNode)}else return"object"===typeof t?y=this.collection.getIdentity(t):(y=t,t=this._rowIdToObject[this.id+"-row-"+y]),new this._Row(y,t,d(this.id+"-row-"+y,this.domNode))},cell:function(t){return{row:this.row(t)}},_move:function(t,y,D,B){var E;var x=E=t.element;y=y||1;do if(t=E[0>y?"previousSibling":"nextSibling"]){do if((E=t)&&-1<(E.className+" ").indexOf(D+" ")){x=E;y+=0>y?1:-1;break}while(t=(!B||!E.hidden)&&E[0>y?"lastChild":"firstChild"])}else if(E=E.parentNode,
!E||E===this.bodyNode||E===this.headerNode)break;while(y);return x},up:function(t,y,D){t.element||(t=this.row(t));return this.row(this._move(t,-(y||1),"dgrid-row",D))},down:function(t,y,D){t.element||(t=this.row(t));return this.row(this._move(t,y||1,"dgrid-row",D))},scrollTo:function(t){"undefined"!==typeof t.x&&(this.bodyNode.scrollLeft=t.x);"undefined"!==typeof t.y&&(this.bodyNode.scrollTop=t.y)},getScrollPosition:function(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}},get:function(t){var y=
"_get"+t.charAt(0).toUpperCase()+t.slice(1);return"function"===typeof this[y]?this[y].apply(this,[].slice.call(arguments,1)):this[t]},set:function(t,y){if("object"===typeof t)for(var D in t)this.set(D,t[D]);else D="_set"+t.charAt(0).toUpperCase()+t.slice(1),"function"===typeof this[D]?this[D].apply(this,[].slice.call(arguments,1)):this[t]=y;return this},_getClass:h,_setClass:e,_getClassName:h,_setClassName:e,_setSort:function(t,y){this.sort="string"!==typeof t?t:[{property:t,descending:y}];this._applySort()},
_applySort:function(){this.refresh();if(this._lastCollection){var t=this.sort;if(t&&0<t.length){var y=t[0].property,D=!!t[0].descending;this._lastCollection.sort(function(B,E){B=B[y];E=E[y];void 0===B&&(B="");void 0===E&&(E="");return B===E?0:B>E!==D?1:-1})}this.renderArray(this._lastCollection)}},_setShowHeader:function(t){var y=this.headerNode;this.showHeader=t;p.toggle(y,"dgrid-header-hidden",!t);this.renderHeader();this.resize();t&&(y.scrollLeft=this.getScrollPosition().x)},_setShowFooter:function(t){this.showFooter=
t;p.toggle(this.footerNode,"dgrid-footer-hidden",!t);this.resize()}});u.autoIdPrefix="dgrid_";return u})},"dgrid1/util/misc":function(){define(["dojo/has"],function(H){var k=[],p,r,m,l=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,b=setTimeout,a=clearTimeout;H.add("requestidlecallback",function(f){return"function"===typeof f.requestIdleCallback});var d={defaultDelay:15,throttle:function(f,e,h){var c=!1;h=h||d.defaultDelay;return function(){c||(c=!0,f.apply(e,arguments),b(function(){c=!1},h))}},throttleDelayed:function(f,
e,h){var c=!1;h=h||d.defaultDelay;return function(){if(!c){c=!0;var g=arguments;b(function(){c=!1;f.apply(e,g)},h)}}},debounce:function(f,e,h){var c;h=h||d.defaultDelay;return function(){c&&(a(c),c=null);var g=arguments;c=b(function(){c=null;f.apply(e,g)},h)}},each:function(f,e,h){var c;if(f)if("number"===typeof f.length){var g=0;for(c=f.length;g<c;g++)e.call(h,f[g],g,f)}else for(g in f)e.call(h,f[g],g,f)},addCssRule:function(f,e){p||(p=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(p),
p=p.sheet||p.styleSheet,r=p.deleteRule?"deleteRule":"removeRule",m=p.cssRules?"cssRules":"rules");var h=k.length;k[h]=(p.cssRules||p.rules).length;p.addRule?p.addRule(f,e):p.insertRule(f+"{"+e+"}",k[h]);return{get:function(c){return p[m][k[h]].style[c]},set:function(c,g){"undefined"!==typeof k[h]&&(p[m][k[h]].style[c]=g)},remove:function(){var c=k[h],g;if(void 0!==c){p[r](c);k[h]=void 0;var n=h+1;for(g=k.length;n<g;n++)k[n]>c&&k[n]--}}}},escapeCssIdentifier:function(f,e){return"string"===typeof f?
f.replace(l,e||"\\$1"):f}};return d})},"dgrid1/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/on dojo/when dojo/query ./util/misc".split(" "),function(H,k,p,r,m,l,b,a,d){function f(c){return c&&(0<=c.className.indexOf("dgrid-row")||0<=c.className.indexOf("dgrid-loading"))}function e(c){return c&&0<=c.className.indexOf("dgrid-preload")}var h=0;return p([H,k],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,
farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:d.defaultDelay,keepScrollPosition:!1,rowHeight:0,_deleteQueue:[],postCreate:function(){this.inherited(arguments);var c=this;l(this.bodyNode,"scroll",d[this.pagingMethod](function(g){c._processScroll(g)},null,this.pagingDelay))},renderQuery:function(c,g){var n=this,q=g&&g.container||this.contentNode,v,u=0,t=g&&g.start||0;"level"in c&&(u=v=c.level);var y={query:c,count:0,level:u,top:!1};var D={node:m.create("div",{className:"dgrid-preload",
style:{height:"0"}},q),count:0,query:c,next:y,level:u,top:!0};var B=D.node;B.rowIndex=0;y.previous=D;var E=y.node=m.create("div",{className:"dgrid-preload",style:{height:"0"}},q);D.id=h++;B.setAttribute("data-preloadid",D.id);y.id=h++;E.setAttribute("data-preloadid",y.id);E.rowIndex=this.minRowsPerPage;n._insertPreload(D);var x=m.create("div",{className:"dgrid-loading"},E,"before");m.create("div",{className:"dgrid-below"},x).innerHTML=this.loadingMessage;g=r.mixin({start:0,count:this.minRowsPerPage},
g);null!=v&&(g.queryLevel=v);return this._trackError(function(){var w=c(g);return n.renderQueryResults(w,E,g).then(function(A){return w.totalLength.then(function(z){var G=A.length,I=E.parentNode;!n._rows||"queryLevel"in g||(n._rows.min=0,n._rows.max=G===z?Infinity:G-1);m.destroy(x);"queryLevel"in g||(n._total=z);0===z&&I&&(n.noDataNode&&m.destroy(n.noDataNode),n._insertNoDataNode(I));D.count=t;y.count=z-G-t;E.rowIndex=t+G;z?n._updatePreloadRowHeights(D):(E.style.display="none",B.style.display="none");
n._previousScrollPosition&&I&&I.offsetHeight&&(n.scrollTo(n._previousScrollPosition),delete n._previousScrollPosition);return b(n._processScroll()).then(function(){return A})})}).otherwise(function(A){m.destroy(x);throw A;})})},_insertPreload:function(c){var g=this.preload;if(g){for(;g.node.compareDocumentPosition(c.node)&Node.DOCUMENT_POSITION_PRECEDING;)if(g=g.previous,null==g)return;for(;g.node.compareDocumentPosition(c.node)&Node.DOCUMENT_POSITION_FOLLOWING&&g.next;)g=g.next;g.previous.next=c;
c.previous=g.previous;c=c.next;c.next=g;g.previous=c}else this.preload=c},refresh:function(c){var g=this,n=c&&c.keepScrollPosition,q;"undefined"===typeof n&&(n=this.keepScrollPosition);n&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this._renderedCollection)return this.renderQuery(function(v){v=g._renderedCollection.fetchRange({start:v.start,end:v.start+v.count});v.then(function(u){q=u});return v}).then(function(){g._emitRefreshComplete();return q})},resize:function(){this.inherited(arguments);
this._processScroll()},cleanup:function(){this.inherited(arguments);this.preload=null},renderQueryResults:function(c){var g=this.inherited(arguments),n=this._getRenderedCollection(this.preload);n&&n.releaseRange&&g.then(function(q){q[0]&&!q[0].parentNode.tagName&&c.totalLength.then(function(){n.releaseRange(q[0].rowIndex,q[q.length-1].rowIndex+1)})});return g},_getFirstRowSibling:function(c){return c.lastChild},_calcRowHeight:function(c){var g=c.nextSibling;return g&&!/\bdgrid-preload\b/.test(g.className)?
g.offsetTop-c.offsetTop:c.offsetHeight},_calcAverageRowHeight:function(c){for(var g=c.length,n=0,q=0;q<g;q++)n+=this._calcRowHeight(c[q]);return g&&n?n/g:0},_updatePreloadRowHeights:function(){var c=this.preload,g=0;if(c){for(;c.previous;)c=c.previous;for(;c;)c.rowHeight||(c.rowHeight=this._calcAverageRowHeight(c.node.parentNode.querySelectorAll(".dgrid-row")),this._adjustPreloadHeight(c)),g=c?c.rowHeight:g,c=c.next;this.rowHeight=g}},lastScrollTop:0,_processScroll:function(c){function g(da,ja){ja=
ja?"next":"previous";for(var ea;ea=da[ja];)da=ea;return da}function n(da,ja){function ea(){a:{var W=!ja;for(var aa=da;aa=aa[ja?"previous":"next"];)if(W===aa.top){W=aa;break a}W=void 0}if(W&&S!==W&&!e(W.top?W.node.nextSibling:W.node.previousSibling))return O(),da=W,N=da.node,T=ja?da.node.offsetTop-B:D-(da.node.offsetTop+da.node.offsetHeight),na=(W=L(N))&&W.rowIndex,Y=void 0,W}function L(W){var aa=e(W);(W=W[C])&&!f(W)&&(W=aa&&e(W)?null:(aa=ea())?aa:L(W));return W}function O(){da.count+=P;ja&&(N.rowIndex-=
P);t._adjustPreloadHeight(da);P=0;t._releaseRange(da,ja,na,Y)}var S=da;da=g(da,ja);var T=ja?da.node.offsetTop-B:D-(da.node.offsetTop+da.node.offsetHeight),J=t.farOffRemoval,N=da.node,C=ja?"previousSibling":"nextSibling",P=0,Q=0,Y;if(T>2*J){var fa;var na=(fa=L(N))&&fa.rowIndex;for(Y=void 0;fa&&S!==da;){var la=t._calcRowHeight(fa);Q+la+J>T||!f(fa)?fa=ea():(Q+=la,P+=fa.count||1,t._pruneRow(fa,ja),"rowIndex"in fa&&(Y=fa.rowIndex),fa=L(fa))}O();t._deleteNodeQueue()}}function q(da,ja){do da=ja?da.next:
da.previous;while(da&&!da.node.offsetWidth);return da}var v=this.preload,u;this._updatePreloadRowHeights();if(u=v&&v.rowHeight){var t=this,y=t.bodyNode,D=c&&c.scrollTop||this.getScrollPosition().y,B=y.offsetHeight+D;c=t.lastScrollTop;y=t.bufferRows*u;var E=y-u,x,w=!0;for(t.lastScrollTop=D;v&&!v.node.offsetWidth;)v=v.previous;for(;v&&v!==A;){var A=t.preload;t.preload=v;u=v.node;var z=u.offsetTop;if(B+1+E<z)v=q(v,w=!1);else if(D-1-E>z+u.offsetHeight)v=q(v,w=!0);else{z=((u.top?D-y:B)-z)/v.rowHeight;
var G=(B-D+2*y)/v.rowHeight;G+=Math.min(Math.abs(Math.max(Math.min((D-c)*v.rowHeight,t.maxRowsPerPage/2),t.maxRowsPerPage/-2)),10);u.top&&(z-=G);z=Math.max(z,0);10>z&&0<z&&G+z<t.maxRowsPerPage&&(G+=Math.max(0,z),z=0);G=Math.min(Math.max(G,t.minRowsPerPage),t.maxRowsPerPage,v.count);if(0===G)v=q(v,w);else{G=Math.ceil(G);z=Math.min(Math.floor(z),v.count-G);var I={};v.count-=G;var K=u,R=t.queryRowsOverlap,U=!v.top&&v;if(U)v.previous&&(n(v),0<z&&e(u.previousSibling)?(z=Math.min(v.count,z),v.previous.count+=
z,t._adjustPreloadHeight(v.previous,!0),u.rowIndex+=z,R=0):G+=z,v.count-=z),I.start=u.rowIndex-R,I.count=Math.min(G+R,t.maxRowsPerPage),u.rowIndex=I.start+I.count;else{if(v.next)if(K=u.nextSibling,n(v,!0),e(u.nextSibling))v.next.count+=v.count-z,v.next.node.rowIndex=z+G,t._adjustPreloadHeight(v.next),v.count=z,R=0,K=v.next.node;else var ba=!0;I.start=v.count;I.count=Math.min(G+R,t.maxRowsPerPage);I.scrollingUp=!0}ba&&K&&K.offsetWidth&&(ba=K.offsetTop);t._adjustPreloadHeight(v);"level"in v.query&&
(I.queryLevel=v.query.level);if("queryLevel"in I||!(I.start>t._total||0>I.count)){var ca=m.create("div",{className:"dgrid-loading",style:{height:G*v.rowHeight+"px"}},K,"before");m.create("div",{className:"dgrid-"+(U?"below":"above"),innerHTML:t.loadingMessage},ca);ca.count=G;t._trackError(function(){(function(da,ja,ea){var L=v.query(I);x=t.renderQueryResults(L,da,I).then(function(O){var S=t._rows;!S||"queryLevel"in I||!O.length||(ja?(S.max<=S.min&&(S.min=O[0].rowIndex),S.max=O[O.length-1].rowIndex):
(S.max<=S.min&&(S.max=O[O.length-1].rowIndex),S.min=O[0].rowIndex));K=da.nextSibling;m.destroy(da);ea&&K&&K.offsetWidth&&t.scrollTo({y:t.bodyNode.scrollTop+K.offsetTop-ea});L.totalLength.then(function(T){"queryLevel"in I||(t._total=T,t._rows&&t._rows.max>=t._total-1&&(t._rows.max=Infinity));ja&&(ja.count=T-ja.node.rowIndex,t._adjustPreloadHeight(ja))});t._processScroll();return O},function(O){m.destroy(da);throw O;})})(ca,U,ba)});v=v.previous}}}}return x}},_adjustPreloadHeight:function(c,g){c.node.style.height=
this._calculatePreloadHeight(c,g)+"px"},_calculatePreloadHeight:function(c,g){return Math.min(c.count*c.rowHeight,g?Infinity:this.maxEmptySpace)},_pruneRow:function(c,g,n){this.removeRow(c,!0,n);this._queueNodeForDeletion(c)},_queueNodeForDeletion:function(c){this._deleteQueue.push(c)},_deleteNodeQueue:function(){for(var c=document.createElement("div"),g=this._deleteQueue,n=g.length;n--;)c.appendChild(g[n]);this._deleteQueue=[];setTimeout(function(){m.destroy(c)},1)},_removePreloads:function(c){if(c&&
c.length){var g=this,n=this._getHeadPreload();c.forEach(function(q){if(q=g._findPreload(q,n))q.previous&&(q.previous.next=q.next),q.next&&(q.next.previous=q.previous)})}},_getHeadPreload:function(){var c=this.preload;if(c)for(;c.previous;)c=c.previous;return c},_findPreload:function(c,g){for(g||(g=this._getHeadPreload());g;){if(g.node===c)return g;g=g.next}},_getRenderedCollection:function(){return this._renderedCollection},_releaseRange:function(c,g,n,q){if(c){var v=c.level;c=this._getRenderedCollection(c);
null!=q&&c.releaseRange&&"number"===typeof n&&"number"===typeof q&&(g?c.releaseRange(q,n+1):c.releaseRange(n,q+1),this._rows&&!v&&(this._rows[g?"max":"min"]=q,this._rows.max>=this._total-1&&(this._rows.max=Infinity)))}}})})},"dgrid1/_StoreMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/aspect dojo/dom-construct dojo/has dojo/on dojo/when".split(" "),function(H,k,p,r,m,l,b,a){function d(f){if("object"!==typeof f)f=Error(f);else if("cancel"===f.dojoType)return;b.emit(this.domNode,
"dgrid-error",{grid:this,error:f,cancelable:!0,bubbles:!0})&&console.error(f)}return H(null,{collection:null,_renderedCollection:null,_rows:null,_observerHandle:null,_structureHandle:null,shouldTrackCollection:!0,getBeforePut:!0,noDataMessage:"",loadingMessage:"",_total:0,constructor:function(){this.dirty={};this._updating={};this._columnsWithSet={};this._structureHandle=r.before(this,"configStructure",k.hitch(this,function(){this._columnsWithSet={}}))},destroy:function(){this.inherited(arguments);
this._structureHandle&&this._structureHandle.remove();this._renderedCollection&&this._cleanupCollection();this._refreshTimeout&&clearTimeout(this._refreshTimeout)},_configColumn:function(f){f.set&&(this._columnsWithSet[f.field]=f);this.inherited(arguments)},_setCollection:function(f){this._renderedCollection&&(this.cleanup(),this._cleanupCollection({shouldRevert:!f||f.storage!==this._renderedCollection.storage}));this.collection=f;if(this._started){if(f){var e=f;this.sort&&0<this.sort.length&&(e=
f.sort(this.sort));e.track&&this.shouldTrackCollection&&(e=e.track(),this._rows=[],this._observerHandle=this._observeCollection(e,this.contentNode,{rows:this._rows}));this._renderedCollection=e}this.refresh()}},_setStore:function(){this.collection||console.debug("set('store') call detected, but you probably meant set('collection')")},_getTotal:function(){return this._total},_cleanupCollection:function(f){f=f||{};this._observerHandle&&(this._observerHandle.remove(),this._observerHandle=this._rows=
null);!1!==f.shouldRevert&&(this.dirty={});this._renderedCollection=this.collection=null},_applySort:function(){this.collection?this.set("collection",this.collection):this.store&&console.debug("_StoreMixin found store property but not collection; this is often the sign of a mistake during migration from 0.3 to 0.4")},_emitRefreshComplete:function(){var f=this;this._refreshTimeout=setTimeout(function(){b.emit(f.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:f});f._refreshTimeout=null},
0)},_insertNoDataNode:function(f){this._removeNoDataNode();f=f||this.contentNode;var e=this.noDataNode=m.create("div",{className:"dgrid-no-data",innerHTML:this.noDataMessage});f.insertBefore(e,this._getFirstRowSibling?this._getFirstRowSibling(f):null);return e},_removeNoDataNode:function(){return this.noDataNode?(m.destroy(this.noDataNode),delete this.noDataNode,!0):!1},row:function(){var f=this.inherited(arguments);f&&f.data&&"undefined"!==typeof f.id&&(f.id=this.collection.getIdentity(f.data));
return f},refresh:function(){var f=this.inherited(arguments);this.collection||this._insertNoDataNode();return f},refreshCell:function(f){if(!this.collection||!this._createBodyRowCell)throw Error("refreshCell requires a Grid with a collection.");this.inherited(arguments);return this.collection.get(f.row.id).then(k.hitch(this,"_refreshCellFromItem",f))},_refreshCellFromItem:function(f,e,h){var c=f.element;m.empty(c);var g=this.dirty&&this.dirty[f.row.id];g&&(e=k.delegate(e,g));this._createBodyRowCell(c,
f.column,e,h)},renderArray:function(){var f=this.inherited(arguments);this.collection||f.length&&this.noDataNode&&m.destroy(this.noDataNode);return f},insertRow:function(f,e,h,c,g){var n=this.collection,q=this.dirty;n=n&&n.getIdentity(f);var v;n in q&&!(n in this._updating)&&(v=q[n]);v&&(f=k.delegate(f,v));q=this.inherited(arguments);g&&g.rows&&(g.rows[c]=q);this.noDataNode&&(m.destroy(this.noDataNode),this.noDataNode=null);return q},updateDirty:function(f,e,h){var c=this.dirty,g=c[f];g||(g=c[f]=
{});g[e]=h},save:function(){function f(y,D){return function(B){var E=e._columnsWithSet,x=e._updating,w;if("function"===typeof B.set)B.set(D);else for(w in D)B[w]=D[w];for(w in E){var A=E[w].set(B);void 0!==A&&(B[w]=A)}x[y]=!0;return h.put(B).then(function(z){delete c[y];delete x[y];n[y]=z;return n})}}var e=this,h=this.collection,c=this.dirty,g=new p,n={},q=function(y){var D;return e.getBeforePut||!(D=e.row(y).data)?function(){return h.get(y)}:function(){return D}},v=g.then(function(){return n}),u;
for(u in c){var t=f(u,c[u]);v=v.then(q(u)).then(t)}g.resolve();return v},revert:function(){this.dirty={};this.refresh()},_trackError:function(f){"string"===typeof f&&(f=k.hitch(this,f));var e=this;try{var h=a(f())}catch(c){f=new p,f.reject(c),h=f.promise}h.otherwise(function(c){d.call(e,c)});return h},removeRow:function(f,e,h){var c={element:f};e||this.up(c).element!==f||this.down(c).element!==f||this._insertNoDataNode();(c=h&&h.rows||this._rows)&&delete c[f.rowIndex];return this.inherited(arguments)},
renderQueryResults:function(f,e,h){h=k.mixin({rows:this._rows},h);var c=this;return f.then(function(g){g=c.renderArray(g,e,h);delete c._lastCollection;return g})},_observeCollection:function(f,e,h){var c=this,g=h.rows,n,q=[f.on("delete, update",function(v){var u=v.previousIndex,t=v.index;void 0!==u&&g[u]&&("max"in g&&(void 0===t||t<g.min||t>g.max)&&g.max--,0>g.max&&(g.max=0),n=g[u],n.parentNode===e&&c.removeRow(n,!1,h),g.splice(u,1),("delete"===v.type||"update"===v.type&&(u<t||void 0===t))&&g[u]&&
g[u].rowIndex--);"delete"===v.type&&(n=null)}),f.on("add, update",function(v){var u=v.previousIndex,t=v.index;if(void 0!==t&&(!("max"in g)||t>=g.min&&t<=g.max)){"max"in g&&(void 0===u||u<g.min||u>g.max)&&g.max++;if(g.length){if(u=g[t],!u&&(u=g[t-1]))u=(u.connected||u).nextSibling}else u=c._getFirstRowSibling&&c._getFirstRowSibling(e);n&&u&&n.id===u.id&&(u=(u.connected||u).nextSibling);u&&!u.parentNode&&(u=document.getElementById(u.id));g.splice(t,0,void 0);n=c.insertRow(v.target,e,u,t,h);c.highlightRow(n)}n=
null}),f.on("add, delete, update",function(v){var u="undefined"!==typeof v.previousIndex?v.previousIndex:Infinity,t="undefined"!==typeof v.index?v.index:Infinity,y=Math.min(u,t);u!==t&&g[y]&&c.adjustRowIndices(g[y]);Infinity!==u&&c._processScroll&&(g[u]||g[u-1])&&c._processScroll();c._onNotification(g,v,f);f===c._renderedCollection&&"totalLength"in v&&(c._total=v.totalLength)})];return{remove:function(){for(;0<q.length;)q.pop().remove()}}},_onNotification:function(){}})})},"dgrid1/Tree":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/dom-construct dojo/dom-class dojo/on dojo/promise/all dojo/query dojo/when ./util/has-css3 ./Grid dojo/has!touch?./util/touch".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g){return H(null,{collapseOnRefresh:!1,enableTreeTransitions:!0,treeIndentWidth:9,constructor:function(){this._treeColumnListeners=[]},shouldExpand:function(n,q,v){return v},expand:function(n,q,v,u){function t(){x||y._processScroll&&y._processScroll()}if(!this._treeColumn)return e();var y=this,D=n.element?n:this.row(n),B=!!this._expanded[D.id],E=h("transitionend");n=D.element;n=-1<n.className.indexOf("dgrid-expando-icon")?n:f(".dgrid-expando-icon",n)[0];v=v||!this.enableTreeTransitions;
if(n&&n.mayHaveChildren&&(v||q!==B)){var x=void 0===q?!this._expanded[D.id]:q,w=this.getScrollPosition();this._resetExpanded(D.id,x);b.replace(n,"ui-icon-triangle-1-"+(x?"se":"e"),"ui-icon-triangle-1-"+(x?"e":"se"));b.toggle(D.element,"dgrid-row-expanded",x);q=D.element;var A=q.connected,z={};if(!A){A=z.container=q.connected=l.create("div",{className:"dgrid-tree-container"},q,"after");var G=function(ba){var ca=y._renderedCollection.getChildren(D.data);y.sort&&0<y.sort.length&&(ca=ca.sort(y.sort));
ca.track&&y.shouldTrackCollection&&(A._rows=ba.rows=[],ca=ca.track(),A._handles=[ca.tracking,y._observeCollection(ca,A,ba)]);G.collection=ca;return"start"in ba?ca.fetchRange({start:ba.start,end:ba.start+ba.count}):ca.fetch()};"level"in n&&(A.level=G.level=n.level+1);if(this.renderQuery)var I=u?y._renderedCollection.getChildren(D.data).fetchRange({start:0,end:1}).totalLength.then(function(ba){z.start=ba-y.minRowsPerPage;z.end=ba-1;z.count=y.minRowsPerPage;y._previousScrollPosition=w;return y.renderQuery(G,
z)}):this.renderQuery(G,z);else{var K=l.create("div",null,A);I=this._trackError(function(){return y.renderQueryResults(G(z),K,k.mixin({rows:z.rows},"level"in G?{queryLevel:G.level}:null)).then(function(ba){l.destroy(K);return ba})})}E&&a(A,E,this._onTreeTransitionEnd)}A.hidden=!x;var R=A.style;if(!E||v)R.display=x?"block":"none",R.height="",t();else{a.once(A,E,t);if(x){R.display="block";var U=A.scrollHeight;R.height="0px"}else b.add(A,"dgrid-tree-resetting"),R.height=A.scrollHeight+"px";setTimeout(function(){b.remove(A,
"dgrid-tree-resetting");R.height=x?U?U+"px":"auto":"0px"},0)}}return e(I)},_configColumns:function(){var n=this.inherited(arguments);this._resetExpanded();for(var q=0,v=n.length;q<v;q++)if(n[q].renderExpando){this._configureTreeColumn(n[q]);break}return n},insertRow:function(n,q,v,u,t){t=t||{};var y=t.queryLevel="queryLevel"in t?t.queryLevel:"level"in q?q.level:0,D=this.inherited(arguments),B=this.row(D);(y=this.shouldExpand(B,y,this._expanded[B.id]))&&this._expandWhenInDom(D,t);(y||!this.collection.mayHaveChildren||
this.collection.mayHaveChildren(n))&&b.add(D,"dgrid-row-expandable");return D},_expandWhenInDom:function(n,q,v){n.offsetHeight?(n=this.expand(n,!0,!0,q.scrollingUp),v&&n.then(function(){v.resolve()})):n.parentNode&&this.domNode.offsetHeight&&(this._expandPromises&&!v&&(v=new m,this._expandPromises.push(v.promise)),setTimeout(this._expandWhenInDom.bind(this,n,q,v),0))},_queueNodeForDeletion:function(n){this.inherited(arguments);var q=n.connected;q&&this._deleteQueue.push(q)},_pruneRow:function(n,q){var v=
n.connected,u;if(v){var t=this.row(n).id;this._expanded[t]&&(u=f("\x3e.dgrid-preload",v)[q?1:0])&&(u=this._findPreload(u),u=q?u.next:u.previous,u.expandedContent||(u.expandedContent={}),u.expandedContent[t]=v.offsetHeight)}this.inherited(arguments,[n,q,{treePrune:!0,removeBelow:q}])},refresh:function(n){this._expandPromises=[];var q=(this.keepScrollPosition||n&&n.keepScrollPosition)&&Object.keys(this._expanded).length?this.inherited(arguments,k.mixin(n||{},{keepScrollPosition:!1})):this.inherited(arguments);
return e(q).then(function(){var v=this._expandPromises;delete this._expandPromises;return d(v)}.bind(this))},removeRow:function(n,q,v){var u=n.connected,t={};if(u){u._handles&&(p.forEach(u._handles,function(x){x.remove()}),delete u._handles);u._rows&&(t.rows=u._rows);var y=f("\x3e.dgrid-row",u);var D=f("\x3e.dgrid-preload",u);if(y&&y.length){if(this._releaseRange){var B=y[0].rowIndex;var E=y[y.length-1].rowIndex;this._releaseRange(this._findPreload(D[0]),!1,B,E)}y.forEach(function(x){v&&v.treePrune?
this._pruneRow(x,v.removeBelow):this.removeRow(x,!0,t)},this)}this._removePreloads&&this._removePreloads(D);u._rows&&(u._rows.length=0,delete u._rows);q?this._queueNodeForDeletion(u):l.destroy(u)}this.inherited(arguments)},_refreshCellFromItem:function(n,q){if(!n.column.renderExpando)return this.inherited(arguments);this.inherited(arguments,[n,q,{queryLevel:f(".dgrid-expando-icon",n.element)[0].level}])},cleanup:function(){this.inherited(arguments);this.collapseOnRefresh&&this._resetExpanded()},_destroyColumns:function(){this.inherited(arguments);
for(var n=this._treeColumnListeners,q=n.length;q--;)n[q].remove();this._treeColumnListeners=[];this._treeColumn=null},_calcRowHeight:function(n){var q=n.connected;return this.inherited(arguments)+(q?q.offsetHeight:0)},_configureTreeColumn:function(n){var q=this,v=".dgrid-content .dgrid-column-"+n.id,u;this._treeColumn=n;if(!n._isConfiguredTreeColumn){var t=n.renderCell||this._defaultRenderCell;n._isConfiguredTreeColumn=!0;n.renderCell=function(D,B,E,x){var w=x&&"queryLevel"in x?x.queryLevel:0,A=!q.collection.mayHaveChildren||
q.collection.mayHaveChildren(D);var z=n.renderExpando(w,A,q._expanded[q.collection.getIdentity(D)],D);z.level=w;z.mayHaveChildren=A;(D=t.call(n,D,B,E,x))&&D.nodeType?(E.appendChild(z),E.appendChild(D)):E.insertBefore(z,E.firstChild)};"function"!==typeof n.renderExpando&&(n.renderExpando=this._defaultRenderExpando)}var y=this._treeColumnListeners;0===y.length&&(y.push(this.on(n.expandOn||".dgrid-expando-icon:click,"+v+":dblclick,"+v+":keydown",function(D){var B=q.row(D);q.collection.mayHaveChildren&&
!q.collection.mayHaveChildren(B.data)||"keydown"===D.type&&32!==D.keyCode||"dblclick"===D.type&&u&&1<u.count&&B.id===u.id&&-1<D.target.className.indexOf("dgrid-expando-icon")||q.expand(B);-1<D.target.className.indexOf("dgrid-expando-icon")&&(u&&u.id===q.row(D).id?u.count++:u={id:q.row(D).id,count:1})})),h("touch")&&y.push(this.on(g.selector(v,g.dbltap),function(){q.expand(this)})))},_defaultRenderExpando:function(n,q,v){var u=this.grid.isRTL?"right":"left",t="dgrid-expando-icon";q&&(t+=" ui-icon ui-icon-triangle-1-"+
(v?"se":"e"));return l.create("div",{className:t,innerHTML:"\x26nbsp;",style:"margin-"+u+": "+n*this.grid.treeIndentWidth+"px; float: "+u+";"})},_onNotification:function(n,q){"delete"===q.type&&this._resetExpanded(q.id);this.inherited(arguments)},_onTreeTransitionEnd:function(n){var q=this,v=this.style.height;v&&(this.style.display="0px"===v?"none":"block");n&&(b.add(this,"dgrid-tree-resetting"),setTimeout(function(){b.remove(q,"dgrid-tree-resetting")},0));this.style.height=""},_resetPlaceHolder:function(n){var q=
this._getHeadPreload&&this._getHeadPreload();if(q)if(null!=n)a:for(;q;){var v=q.expandedContent;if(v&&v[n]){delete v[n];this._adjustPreloadHeight(q);break a}q=q.next}else for(n=q;n;)n.expandedContent&&(delete n.expandedContent,this._adjustPreloadHeight(n)),n=n.next},_resetExpanded:function(n,q){this._resetPlaceHolder(n);null==n?this._expanded={}:q?this._expanded[n]=!0:delete this._expanded[n]},_calculatePreloadHeight:function(n){var q=this.inherited(arguments),v=n.expandedContent;v&&Object.keys(v).forEach(function(u){q+=
v[u]});return q},_getRenderedCollection:function(n){return n.level?n.query.collection:this.inherited(arguments)}})})},"dgrid1/util/has-css3":function(){define(["dojo/has"],function(H){function k(r,m){r=r.style;var l;if(m in r)return!0;m=m.slice(0,1).toUpperCase()+m.slice(1);for(l=p.length;l--;)if(p[l]+m in r)return p[l];return!1}var p=["ms","O","Moz","Webkit"];H.add("css-transitions",function(r,m,l){return k(l,"transitionProperty")});H.add("css-transforms",function(r,m,l){return k(l,"transform")});
H.add("css-transforms3d",function(r,m,l){return k(l,"perspective")});H.add("transitionend",function(){var r=H("css-transitions");return r?!0===r?"transitionend":{ms:"MSTransitionEnd",O:"oTransitionEnd",Moz:"transitionend",Webkit:"webkitTransitionEnd"}[r]:!1});return H})},"dgrid1/Editor":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/dom-construct dojo/dom-class dojo/on dojo/query dojo/sniff ./Grid".split(" "),function(H,k,p,r,m,l,b,a,d,f){return k(null,{editorFocusWrapperClassName:"dgrid-editor-focus-wrapper",
constructor:function(){this._editorInstances={};this._editorColumnListeners=[];this._editorCellListeners={};this._editorsPendingStartup=[]},postCreate:function(){var e=this;this.inherited(arguments);this.on(".dgrid-input:focusin",function(){e._focusedEditorCell=e.cell(this)});this._editorFocusoutHandle=b.pausable(this.domNode,".dgrid-input:focusout",function(h){e._focusedEditorCell&&e._focusedEditorCell.element.contains(h.target)||(e._focusedEditorCell=null)});this._listeners.push(this._editorFocusoutHandle)},
insertRow:function(){this._editorRowListeners={};var e=this.inherited(arguments),h=this.row(e),c=this._editorCellListeners[e.id]=this._editorCellListeners[e.id]||{},g;for(g in this._editorRowListeners)c[g]=this._editorRowListeners[g];this._editorRowListeners=null;(c=this._previouslyFocusedEditorCell)&&c.row.id===h.id&&(this.edit(this.cell(h,c.column.id)),this._previouslyFocusedEditorCell=null);return e},refresh:function(){for(var e in this._editorInstances){var h=this._getEditorRootNode(this._editorInstances[e].domNode);
h&&h.parentNode&&(this._removeEditorBlurHandles(),h.parentNode.removeChild(h))}return this.inherited(arguments)},removeRow:function(e){var h=this,c=this._focusedEditorCell,g=this.row(e);c&&g&&c.row.id===g.id&&(this._previouslyFocusedEditorCell=c,this._editorFocusoutHandle.pause(),setTimeout(function(){h._editorFocusoutHandle.resume();h._previouslyFocusedEditorCell=null},0));if(this._editorCellListeners[e.id]){for(var n in this._editorCellListeners[e.id])this._editorCellListeners[e.id][n].remove();
delete this._editorCellListeners[e.id]}for(c=this._alwaysOnWidgetColumns.length;c--;)if(g=(g=this.cell(e,this._alwaysOnWidgetColumns[c].id).element)&&(g.contents||g).widget)this._editorFocusoutHandle.pause(),g.destroyRecursive(),this._editorFocusoutHandle.resume();return this.inherited(arguments)},renderArray:function(){var e=this.inherited(arguments);e.length?this._startupPendingEditors():this._editorsPendingStartup=[];return e},_onNotification:function(){this.inherited(arguments);this._startupPendingEditors()},
_destroyColumns:function(){this._editorStructureCleanup();this.inherited(arguments)},_editorStructureCleanup:function(){var e=this._editorInstances,h=this._editorColumnListeners;this._editTimer&&clearTimeout(this._editTimer);for(var c in e){var g=e[c];g.domNode&&g.destroyRecursive()}this._editorInstances={};for(e=h.length;e--;)h[e].remove();for(var n in this._editorCellListeners)for(c in this._editorCellListeners[n])this._editorCellListeners[n][c].remove();for(e=0;e<this._editorColumnListeners.length;e++)this._editorColumnListeners[e].remove();
this._editorCellListeners={};this._editorColumnListeners=[];this._editorsPendingStartup=[]},configStructure:function(){this._alwaysOnWidgetColumns=[];this.inherited(arguments)},_configColumns:function(){for(var e=this.inherited(arguments),h=0,c=e.length;h<c;h++)e[h].editor&&this._configureEditorColumn(e[h]);return e},_configureEditorColumn:function(e){var h=this,c=e.renderCell||this._defaultRenderCell,g=e.editOn,n="string"!==typeof e.editor;g?this._editorInstances[e.id]=this._createSharedEditor(e,
c):n&&this._alwaysOnWidgetColumns.push(e);e.renderCell=g?function(q,v,u,t){if(!t||!t.alreadyHooked){var y=b(u,g,function(){h._activeOptions=t;h.edit(this)});if(h._editorRowListeners)h._editorRowListeners[e.id]=y;else{var D=h.row(q);h._editorCellListeners[D.element.id][e.id]=y}}return c.call(e,q,v,u,t)}:function(q,v,u,t){if(!e.canEdit||e.canEdit(q,v))q=h._createEditor(e,q),h._showEditor(q,e,u,v),u[n?"widget":"input"]=q;else return c.call(e,q,v,u,t)}},edit:function(e){function h(B){c._activeCell=u;
c._showEditor(n,q,u,y);c._editTimer=setTimeout(function(){var E=c._getEditorFocusNode(n);E.focus&&E.focus();q._editorBlurHandle&&q._editorBlurHandle.resume();c._editTimer=null;B.resolve(n)},0)}var c=this,g,n;e.column||(e=this.cell(e));if(!e||!e.element)return null;this._previouslyFocusedEditorCell=e;var q=e.column;var v=q.field;var u=e.element.contents||e.element;if(n=this._editorInstances[q.id]){if(this._activeCell!==u){var t=e.row;var y=(g=this.dirty&&this.dirty[t.id])&&v in g?g[v]:q.get?q.get(t.data):
t.data[v];if(!q.canEdit||q.canEdit(e.row.data,y)){var D=new r;e=this._getEditorFocusNode(n);e.offsetWidth?(e.blur(),setTimeout(function(){h(D)},0)):h(D);return D.promise}}}else if(q.editor&&(n=u.widget||u.input))return D=new r,n.focus&&n.focus(),D.resolve(n),D.promise;return null},refreshCell:function(e){var h=e.column,c=h.get?h.get(e.row.data):e.row.data[h.field],g;h.editor&&(e.column.editOn&&this._activeCell===e.element?g=this._editorInstances[e.column.id]:e.column.editOn||(g=e.element.widget||
e.element.input));if(g)return g.domNode?g.set("value",c):this._updateInputValue(g,c),(new r).resolve();h._editorBlurHandle&&h._editorBlurHandle.remove();return this.inherited(arguments)},_showEditor:function(e,h,c,g){var n=e.domNode;n||this._updateInputValue(e,g);c.innerHTML="";l.add(c,"dgrid-cell-editing");n&&h.editOn&&e.validate&&e.reset&&e.reset();c.appendChild(this._getEditorRootNode(e));n&&!h.editOn?this._editorsPendingStartup.push([e,h,c,g]):this._startupEditor(e,h,c,g)},_startupEditor:function(e,
h,c,g){e.domNode&&(e._started||e.startup(),e._dgridIgnoreChange=!0,e.set("value",g),setTimeout(function(){e._dgridIgnoreChange=!1},0));e._dgridLastValue=g;this._activeCell&&(this._activeValue=g,b.emit(c,"dgrid-editor-show",{grid:this,cell:this.cell(c),column:h,editor:e,bubbles:!0,cancelable:!1}))},_startupPendingEditors:function(){for(var e=this._editorsPendingStartup,h=e.length;h--;)this._startupEditor.apply(this,e[h]);this._editorsPendingStartup=[]},_handleEditorChange:function(e,h){var c=e.target;
"_dgridLastValue"in c&&-1<c.className.indexOf("dgrid-input")&&this._updatePropertyFromEditor(h||this.cell(c).column,c,e)},_getEditorFocusNode:function(e){var h=e.parentNode||e.domNode&&e.domNode.parentNode;h&&l.contains(h,this.editorFocusWrapperClassName)||(h=e.focusNode||e.domNode||e);return h},_getEditorRootNode:function(e){if(e){var h=e.parentNode||e.domNode&&e.domNode.parentNode;h&&l.contains(h,this.editorFocusWrapperClassName)||(h=e.domNode||e);return h}},_createEditorFocusWrapper:function(e,
h){isNaN(h)&&(h=isNaN(e.tabIndex)?-1:e.tabIndex);h=m.create("div",{className:this.editorFocusWrapperClassName,tabIndex:h});h.appendChild(e);return h},_createEditor:function(e,h){var c=e.editor,g=e.editOn,n=this,q="string"!==typeof c&&c,v={};var u=e.editorArgs||{};"function"===typeof u&&(u=u.call(this,e,h));if(q){var t=new q(u);u=t.focusNode||t.domNode;u.className+=" dgrid-input";if(d("mac")&&e.editOn&&/checkbox|radio/i.test(u.type))u=this._createEditorFocusWrapper(t.domNode,e.tabIndex),this._listeners.push(b(u,
"blur",function(){t._dgridIgnoreChange||n._updatePropertyFromEditor(e,t,{type:"widget"})}));else if(!g)t.on("change",function(){t._dgridIgnoreChange||n._updatePropertyFromEditor(e,t,{type:"widget"})})}else this._hasInputListener||(this._hasInputListener=!0,this.on("change",function(D){n._handleEditorChange(D)})),"textarea"===c?q="textarea":(q="input",v.type=c),t=u=m.create(q,p.mixin(v,{className:"dgrid-input",name:e.field,tabIndex:isNaN(e.tabIndex)?-1:e.tabIndex},u)),d("mac")&&e.editOn&&/checkbox|radio/i.test(c)&&
(u=this._createEditorFocusWrapper(t),t.tabIndex=0,t.removeAttribute("tabindex")),9>d("ie")&&(c="radio"===c||"checkbox"===c?b(t,"click",function(D){n._handleEditorChange(D,e)}):b(t,"change",function(D){n._handleEditorChange(D,e)}),g?this._editorColumnListeners.push(c):this._editorRowListeners?this._editorRowListeners[e.id]=c:this._editorCellListeners[this.row(h).element.id][e.id]=c);if(e.autoSelect){var y=t.focusNode||t;y.select&&b(y,"focus",function(){setTimeout(function(){y.select()},0)})}return t},
_createSharedEditor:function(e){function h(){var t=g._activeCell;v.blur();"function"===typeof g.focus&&setTimeout(function(){g.focus(t)},n&&9>d("ie")?15:0)}var c=this._createEditor(e),g=this,n=c.domNode,q=this._getEditorRootNode(c),v=this._getEditorFocusNode(c),u=n?function(){c.set("value",c._dgridLastValue)}:function(){g._updateInputValue(c,c._dgridLastValue);g._updatePropertyFromEditor(e,c)};this._editorColumnListeners.push(b(v,"keydown",function(t){t=t.keyCode||t.which;27===t?(u(),g._activeValue=
c._dgridLastValue,h()):13===t&&!1!==e.dismissOnEnter&&h()}));(e._editorBlurHandle=b.pausable(this._getEditorFocusNode(c),"blur",function(t){if(!c.dropDown||!c.dropDown.domNode.contains(t.relatedTarget||document.activeElement)){if(t&&t.target){var y=t.target;if((y=l.contains(y,g.editorFocusWrapperClassName)&&y)&&t.relatedTarget===(c.focusNode||c)){y.focus();return}}g._updatePropertyFromEditor(e,c,{type:"widget"});t=q.parentNode;y={alreadyHooked:!0};var D=g.cell(q);b.emit(D.element,"dgrid-editor-hide",
{grid:g,cell:D,column:e,editor:c,bubbles:!0,cancelable:!1});e._editorBlurHandle.pause();t.removeChild(q);D.row&&(l.remove(D.element,"dgrid-cell-editing"),m.empty(t),f.appendIfNode(t,e.renderCell(D.row.data,g._activeValue,t,g._activeOptions?p.delegate(y,g._activeOptions):y)));g._focusedEditorCell=g._activeCell=g._activeValue=g._activeOptions=null}})).pause();this._editorColumnListeners.push(e._editorBlurHandle);return c},_updatePropertyFromEditor:function(e,h,c){var g;if(!h.isValid||h.isValid())if(c=
this._updateProperty((h.domNode||h).parentNode,this._activeCell?this._activeValue:h._dgridLastValue,this._retrieveEditorValue(e,h),c),this._activeCell?this._activeValue=c:h._dgridLastValue=c,"radio"===h.type&&h.name&&!e.editOn&&e.field)for(g in c=this.row(h),a("input[type\x3dradio][name\x3d"+h.name+"]",this.contentNode).forEach(function(n){var q=this.row(n);n!==h&&n._dgridLastValue&&(n._dgridLastValue=!1,this.updateDirty?this.updateDirty(q.id,e.field,!1):q.data[e.field]=!1)},this),this.dirty)c.id.toString()!==
g&&this.dirty[g][e.field]&&this.updateDirty(g,e.field,!1)},_updateProperty:function(e,h,c,g){var n=this;if((h&&h.valueOf())!==(c&&c.valueOf())){var q=this.cell(e),v=q.row,u=q.column;e=q.element;if(u.field&&v)if(q={grid:this,cell:q,oldValue:h,value:c,bubbles:!0,cancelable:!0},g&&g.type&&(q.parentType=g.type),b.emit(e,"dgrid-datachange",q))this.updateDirty?(this.updateDirty(v.id,u.field,c),u.autoSave&&setTimeout(function(){n._trackError("save")},0)):v.data[u.field]=c;else{var t;(t=e.widget)?(t._dgridIgnoreChange=
!0,t.set("value",h),setTimeout(function(){t._dgridIgnoreChange=!1},0)):(t=e.input)&&this._updateInputValue(t,h);return h}}return c},_updateInputValue:function(e,h){e.value=h;if("radio"===e.type||"checkbox"===e.type)e.checked=e.defaultChecked=!!h},_retrieveEditorValue:function(e,h){return"function"===typeof h.get?this._convertEditorValue(h.get("value")):this._convertEditorValue(h["checkbox"===h.type||"radio"===h.type?"checked":"value"])},_convertEditorValue:function(e,h){"number"===typeof h?e=isNaN(e)?
e:parseFloat(e):"boolean"===typeof h?e="true"===e?!0:"false"===e?!1:e:h instanceof Date&&(h=new Date(e),e=isNaN(h.getTime())?e:h);return e},_removeEditorBlurHandles:function(){H.forEach(this.subRows,function(e){e instanceof Array?H.forEach(e,function(h){h._editorBlurHandle&&h._editorBlurHandle.remove()}):e._editorBlurHandle&&e._editorBlurHandle.remove()})}})})},"dgrid1/Keyboard":function(){define("dojo/_base/declare dojo/aspect dojo/dom-class dojo/on dojo/_base/lang dojo/has ./util/misc dojo/_base/sniff".split(" "),
function(H,k,p,r,m,l,b){function a(x){x.preventDefault()}var d={checkbox:1,radio:1,button:1},f=/\bdgrid-cell\b/,e=/\bdgrid-row\b/,h=H(null,{pageSkip:10,tabIndex:0,keyMap:null,headerKeyMap:null,mouseDownEventType:"mousedown",postMixInProperties:function(){this.inherited(arguments);this.keyMap||(this.keyMap=m.mixin({},h.defaultKeyMap));this.headerKeyMap||(this.headerKeyMap=m.mixin({},h.defaultHeaderKeyMap))},postCreate:function(){function x(z){var G=z.target;return G.type&&(!d[G.type]||32===z.keyCode)}
function w(z){function G(){A._focusedHeaderNode&&(A._focusedHeaderNode.tabIndex=-1);if(A.showHeader){if(K)for(var ca=A.headerNode.getElementsByTagName("th"),da=0,ja;ja=ca[da];++da){if(R.test(ja.className)){A._focusedHeaderNode=ba=ja;break}}else A._focusedHeaderNode=ba=A.headerNode;ba&&(ba.tabIndex=A.tabIndex)}}function I(){var ca=A._focusedNode||ba;if(!R.test(ca.className)||!z.contains(ca)){for(var da=z.getElementsByTagName("*"),ja=0,ea;ea=da[ja];++ja)if(R.test(ea.className)){ca=A._focusedNode=ea;
break}ba.tabIndex=-1;ca.tabIndex=A.tabIndex}}var K=A.cellNavigation,R=K?f:e,U=z===A.headerNode,ba=z;U?(G(),A._listeners.push(k.after(A,"renderHeader",G,!0))):A._listeners.push(k.after(A,"renderArray",I,!0),k.after(A,"_onNotification",function(ca,da){0===da.totalLength?z.tabIndex=0:1===da.totalLength&&"add"===da.type&&I()},!0));A._listeners.push(r(z,A.mouseDownEventType,function(ca){x(ca)||A._focusOnNode(ca.target,U,ca)}));A._listeners.push(r(z,"keydown",function(ca){if(!ca.metaKey&&!ca.altKey){var da=
A[U?"headerKeyMap":"keyMap"][ca.keyCode];da&&!x(ca)&&da.call(A,ca)}}))}this.inherited(arguments);var A=this;this.tabableHeader&&(w(this.headerNode),r(this.headerNode,"dgrid-cellfocusin",function(){A.scrollTo({x:this.scrollLeft})}));w(this.contentNode);this._debouncedEnsureScroll=b.debounce(this._ensureScroll,this)},_pruneRow:function(){var x=this._focusedNode;this._focusedNode=null;this.inherited(arguments);this._focusedNode=x},removeRow:function(x){if(!this._focusedNode)return this.inherited(arguments);
var w=this,A=document.activeElement===this._focusedNode,z=this[this.cellNavigation?"cell":"row"](this._focusedNode),G=z.row||z,I;x=x.element||x;x===G.element&&((I=this.down(G,1,!0))&&I.element!==x||(I=this.up(G,1,!0)),this._removedFocus={active:A,rowId:G.id,columnId:z.column&&z.column.id,siblingId:I&&I.element!==x?I.id:void 0},setTimeout(function(){w._removedFocus&&w._restoreFocus(G.id)},0),this._focusedNode=null);this.inherited(arguments)},insertRow:function(){var x=this.inherited(arguments);this._removedFocus&&
!this._removedFocus.wait&&this._restoreFocus(x);return x},_restoreFocus:function(x){var w=this._removedFocus,A;if((x=(x=x&&this.row(x))&&x.element&&x.id===w.rowId?x:"undefined"!==typeof w.siblingId&&this.row(w.siblingId))&&x.element){if(!x.element.parentNode.parentNode){w.wait=!0;return}"undefined"!==typeof w.columnId&&(A=this.cell(x,w.columnId))&&A.element&&(x=A);w.active&&0!==x.element.offsetHeight?this._focusOnNode(x,!1,null):(p.add(x.element,"dgrid-focus"),x.element.tabIndex=this.tabIndex,this._focusedNode=
x.element)}delete this._removedFocus},addKeyHandler:function(x,w,A){x=k.after(this[A?"headerKeyMap":"keyMap"],x,w,!0);this._listeners.push(x);return x},_ensureRowScroll:function(x){var w=this.getScrollPosition().y;w>x.offsetTop?this.scrollTo({y:x.offsetTop}):w+this.contentNode.offsetHeight<x.offsetTop+x.offsetHeight&&this.scrollTo({y:x.offsetTop-this.contentNode.offsetHeight+x.offsetHeight})},_ensureColumnScroll:function(x){var w=this.getScrollPosition().x,A=x.offsetLeft;if(w>A)this.scrollTo({x:A});
else{var z=this.bodyNode.clientWidth;x=x.offsetWidth;var G=A+x;w+z<G&&this.scrollTo({x:z>x?G-z:A})}},_ensureScroll:function(x,w){!x.column&&!x.row&&x.data&&x.element?this._ensureRowScroll(x.element):(this.cellNavigation&&(this.columnSets||1<this.subRows.length)&&!w&&this._ensureRowScroll(x.row.element),this.bodyNode.clientWidth<this.contentNode.offsetWidth&&this._ensureColumnScroll(x.element))},_focusOnNode:function(x,w,A){var z="_focused"+(w?"Header":"")+"Node",G=this[z],I=this.cellNavigation?"cell":
"row",K=this[I](x),R;if(x=K&&K.element){if(this.cellNavigation){var U=x.getElementsByTagName("input");var ba=0;for(R=U.length;ba<R;ba++){var ca=U[ba];if((-1!==ca.tabIndex||"_dgridLastValue"in ca)&&!ca.disabled){ca.focus();var da=!0;break}}}null!==A&&(A=m.mixin({grid:this},A),A.type&&(A.parentType=A.type),A.bubbles||(A.bubbles=!0));G&&(p.remove(G,"dgrid-focus"),G.removeAttribute("tabindex"),A&&(A[I]=this[I](G),r.emit(G,"dgrid-cellfocusout",A)));G=this[z]=x;A&&(A[I]=K);z=this.cellNavigation?f:e;!da&&
z.test(x.className)&&(x.tabIndex=this.tabIndex,x.focus());p.add(x,"dgrid-focus");A&&r.emit(G,"dgrid-cellfocusin",A);this._debouncedEnsureScroll(K,w)}},focusHeader:function(x){this._focusOnNode(x||this._focusedHeaderNode,!0)},focus:function(x){(x=x||this._focusedNode)?this._focusOnNode(x,!1):(this._removedFocus&&(this._removedFocus.active=!0),this.contentNode.focus())}}),c=h.moveFocusVertical=function(x,w){if(this._focusedNode&&x.target!==this.contentNode){var A=this.cellNavigation,z=this[A?"cell":
"row"](x);z=A&&z.column.id;w=this.down(this._focusedNode,w,!0);A&&(w=this.cell(w,z));this._focusOnNode(w,!1,x);x.preventDefault()}};H=h.moveFocusUp=function(x){c.call(this,x,-1)};var g=h.moveFocusDown=function(x){c.call(this,x,1)},n=h.moveFocusPageUp=function(x){c.call(this,x,-this.pageSkip)},q=h.moveFocusPageDown=function(x){c.call(this,x,this.pageSkip)},v=h.moveFocusHorizontal=function(x,w){if(this.cellNavigation&&x.target!==this.contentNode){var A=!this.row(x);this._focusOnNode(this.right(this["_focused"+
(A?"Header":"")+"Node"],w),A,x);x.preventDefault()}},u=h.moveFocusLeft=function(x){v.call(this,x,-1)},t=h.moveFocusRight=function(x){v.call(this,x,1)},y=h.moveHeaderFocusEnd=function(x,w){if(this.cellNavigation){var A=this.headerNode.getElementsByTagName("th");this._focusOnNode(A[w?0:A.length-1],!0,x)}x.preventDefault()},D=h.moveHeaderFocusHome=function(x){y.call(this,x,!0)},B=h.moveFocusEnd=function(x,w){var A=this.cellNavigation,z=this.contentNode,G=z.scrollTop+(w?0:z.scrollHeight);z=z[w?"firstChild":
"lastChild"];var I=-1<z.className.indexOf("dgrid-preload"),K=I?z[(w?"next":"previous")+"Sibling"]:z;x.preventDefault();this.scrollTo({y:G});if(I){for(;K&&0>K.className.indexOf("dgrid-row");)K=K[(w?"next":"previous")+"Sibling"];if(!K)return}if(!I||1>z.offsetHeight)A&&(K=this.cell(K,this.cell(x).column.id)),this._focusOnNode(K,!1,x);else{l("dom-addeventlistener")||(x=m.mixin({},x));var R=k.after(this,"renderArray",function(U){var ba=U[w?0:U.length-1];A&&(ba=this.cell(ba,this.cell(x).column.id));this._focusOnNode(ba,
!1,x);R.remove();return U});this._listeners.push(R)}},E=h.moveFocusHome=function(x){B.call(this,x,!0)};h.defaultKeyMap={32:a,33:n,34:q,35:B,36:E,37:u,38:H,39:t,40:g};h.defaultHeaderKeyMap={32:a,35:y,36:D,37:u,39:t};return h})},"dgrid1/Selection":function(){define("dojo/_base/declare dojo/aspect dojo/dom-class dojo/mouse dojo/on dojo/sniff dojo/has!touch?./util/touch dojo/query dojo/dom".split(" "),function(H,k,p,r,m,l,b){function a(q,v){v=q.unselectable=v?"on":"";q=q.getElementsByTagName("*");for(var u=
q.length;--u;)"INPUT"!==q[u].tagName&&"TEXTAREA"!==q[u].tagName&&(q[u].unselectable=v)}function d(q,v){var u=q.bodyNode,t=v?"text":21>l("ff")?"-moz-none":"none";e&&"msUserSelect"!==e?u.style[e]=t:l("dom-selectstart")?v||q._selectstartHandle?v&&q._selectstartHandle&&(q._selectstartHandle.remove(),delete q._selectstartHandle):q._selectstartHandle=m(u,"selectstart",function(y){var D=y.target&&y.target.tagName;"INPUT"!==D&&"TEXTAREA"!==D&&y.preventDefault()}):(a(u,!v),v||q._unselectableHandle)?v&&q._unselectableHandle&&
(q._unselectableHandle.remove(),delete q._unselectableHandle):q._unselectableHandle=k.after(q,"renderRow",function(y){a(y,!0);return y})}l.add("dom-comparedocumentposition",function(q,v,u){return!!u.compareDocumentPosition});l.add("dom-selectstart","undefined"!==typeof document.onselectstart);var f=l("mac")?"metaKey":"ctrlKey",e=l("css-user-select"),h=l("pointer"),c=h&&"MS"===h.slice(0,2),g=h?h+(c?"Down":"down"):"mousedown",n=h?h+(c?"Up":"up"):"mouseup";"WebkitUserSelect"===e&&"undefined"!==typeof document.documentElement.style.msUserSelect&&
(e=!1);return H(null,{selectionDelegate:".dgrid-row",selectionEvents:g+","+n+",dgrid-cellfocusin",selectionTouchEvents:l("touch")?b.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var q=this.selectionMode;this.selectionMode="";this._setSelectionMode(q)},destroy:function(){this.inherited(arguments);
this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(q){q!==this.selectionMode&&(this.clearSelection(),this.selectionMode=q,this._selectionHandlerName="_"+q+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},_setAllowTextSelection:function(q){"undefined"!==typeof q?d(this,q):d(this,"none"===this.selectionMode);this.allowTextSelection=
q},_handleSelect:function(q,v){if(!r.isRight(q)&&this[this._selectionHandlerName]&&this.allowSelect(this.row(v))&&("dgrid-cellfocusin"!==q.type||"mousedown"!==q.parentType)&&(q.type!==n||v===this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=q;if(!q.keyCode||!q.ctrlKey||32===q.keyCode)if(!q.shiftKey&&q.type===g&&this.isSelected(v))this._waitForMouseUp=v;else this[this._selectionHandlerName](q,v);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(q,v){q=q.keyCode?
q.ctrlKey:q[f];this._lastSelected===v?this.select(v,null,!q||!this.isSelected(v)):(this.clearSelection(),this.select(v),this._lastSelected=v)},_multipleSelectionHandler:function(q,v){var u=this._lastSelected,t=q.keyCode?q.ctrlKey:q[f];if(!q.shiftKey){var y=t?null:!0;u=null}this.select(v,u,y);u||(this._lastSelected=v)},_extendedSelectionHandler:function(q,v){if(q[f]||!this.isSelected(v)||1!==this.getSelectedCount())(2===q.button?this.isSelected(v):q.keyCode?q.ctrlKey:q[f])||this.clearSelection(null,
!0),this._multipleSelectionHandler(q,v)},_toggleSelectionHandler:function(q,v){this.select(v,null,null)},_initSelectionEvents:function(){var q=this,v=this.contentNode,u=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};l("touch")&&!l("pointer")&&this.selectionTouchEvents?(m(v,b.selector(u,this.selectionTouchEvents),function(t){q._handleSelect(t,this);q._ignoreMouseSelect=this}),m(v,m.selector(u,this.selectionEvents),function(t){q._ignoreMouseSelect!==this?q._handleSelect(t,
this):t.type===n&&(q._ignoreMouseSelect=null)})):m(v,m.selector(u,this.selectionEvents),function(t){q._handleSelect(t,this)});this.addKeyHandler&&this.addKeyHandler(32,function(t){q._handleSelect(t,t.target)});if(this.allowSelectAll)this.on("keydown",function(t){t[f]&&65===t.keyCode&&!/\bdgrid-input\b/.test(t.target.className)&&(t.preventDefault(),q[q.allSelected?"clearSelection":"selectAll"]())});this._setCollection&&this._listeners.push(k.before(this,"_setCollection",function(t){q._updateDeselectionAspect(t)}));
this._updateDeselectionAspect()},_updateDeselectionAspect:function(q){function v(y,D){if((y=u.row(y))&&u.selection[y.id])u[D](y)}var u=this;this._removeDeselectSignals&&this._removeDeselectSignals();var t=q&&q.track&&this._observeCollection?[k.before(this,"_observeCollection",function(y){t.push(y.on("delete",function(D){"undefined"===typeof D.index&&v(D.id,"deselect")}))}),k.after(this,"_observeCollection",function(y){t.push(y.on("update",function(D){"undefined"!==typeof D.index&&v(y.getIdentity(D.target),
"select")}))},!0)]:[k.before(this,"removeRow",function(y,D){D||(y=this.row(y))&&y.id in this.selection&&this.deselect(y)})];this._removeDeselectSignals=function(){for(var y=t.length;y--;)t[y].remove();t=[]}},allowSelect:function(){return!0},_fireSelectionEvent:function(q){var v=this._selectionEventQueues[q],u=this._selectionTriggerEvent;var t={bubbles:!0,grid:this};u&&(t.parentType=u.type);t[this._selectionTargetType]=v;this._selectionEventQueues[q]=[];m.emit(this.contentNode,"dgrid-"+q,t)},_fireSelectionEvents:function(){var q=
this._selectionEventQueues,v;for(v in q)q[v].length&&this._fireSelectionEvent(v)},_select:function(q,v,u){"undefined"===typeof u&&(u=!0);q.element||(q=this.row(q));if(!1===u||this.allowSelect(q)){var t=this.selection;var y=!!t[q.id];null===u&&(u=!y);var D=q.element;u||this.allSelected?t[q.id]=u:delete this.selection[q.id];D&&(u?p.add(D,"dgrid-selected"+(this.addUiClasses?" ui-state-active":"")):p.remove(D,"dgrid-selected ui-state-active"));u!==y&&D&&this._selectionEventQueues[(u?"":"de")+"select"].push(q);
if(v)if(v.element||(v=this.row(v)),v){if(v=v.element)for(t=this._determineSelectionDirection(D,v),t||(v=document.getElementById(v.id),t=this._determineSelectionDirection(D,v));q.element!==v&&(q=this[t](q));)this._select(q,null,u)}else this._lastSelected=D,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")}},
_determineSelectionDirection:l("dom-comparedocumentposition")?function(q,v){q=v.compareDocumentPosition(q);return q&1?!1:2===q?"down":"up"}:function(q,v){return 1>v.sourceIndex?!1:v.sourceIndex>q.sourceIndex?"down":"up"},select:function(q,v,u){this._select(q,v,u);this._fireSelectionEvents()},deselect:function(q,v){this.select(q,v,!1)},clearSelection:function(q,v){this.allSelected=!1;for(var u in this.selection)q!==u&&this._select(u,null,!1);v||(this._lastSelected=null);this._fireSelectionEvents()},
selectAll:function(){this.allSelected=!0;this.selection={};for(var q in this._rowIdToObject){var v=this.row(this._rowIdToObject[q]);this._select(v.id,null,!0)}this._fireSelectionEvents()},getSelectedCount:function(){var q=0,v;for(v in this.selection)v&&(q+=1);return q},isSelected:function(q){if("undefined"===typeof q||null===q)return!1;q.element||(q=this.row(q));return q.id in this.selection?!!this.selection[q.id]:this.allSelected&&(!q.data||this.allowSelect(q))},refresh:function(){this.deselectOnRefresh&&
this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var q=this.inherited(arguments),v=this.selection,u,t;for(u=0;u<q.length;u++){var y=this.row(q[u]);(t=y.id in v?v[y.id]:this.allSelected)&&this.select(y,null,t)}this._fireSelectionEvents();return q}})})},"dgrid1/Selector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/sniff dojo/dom-construct dojo/dom-class ./Selection".split(" "),function(H,k,p,r,m,l){return H(l,{postCreate:function(){this.inherited(arguments);
this.on(".dgrid-selector:click,.dgrid-selector:keydown",k.hitch(this,"_handleSelectorClick"));this.on("dgrid-select",k.hitch(this,"_changeSelectorInput",!0));this.on("dgrid-deselect",k.hitch(this,"_changeSelectorInput",!1))},_defaultRenderSelectorInput:function(b,a,d,f){var e=b.grid;m.add(d,"dgrid-selector");return d.input=r.create("input",{"aria-checked":a,checked:a,disabled:!e.allowSelect(e.row(f)),tabIndex:isNaN(b.tabIndex)?-1:b.tabIndex,type:b.selector},d)},_configureSelectorColumn:function(b){var a=
this,d=b.selector;this._selectorColumns.push(b);this._selectorSingleRow=this._selectorSingleRow||"radio"===b.selector;var f="function"===typeof d?d:this._defaultRenderSelectorInput;b.sortable=!1;b.renderCell=function(e,h,c){h=(h=e&&a.row(e))&&a.selection[h.id];f(b,!!h,c,e)};b.renderHeaderCell=function(e){var h="label"in b?b.label:b.field||"";"radio"!==b.selector&&a.allowSelectAll?(b._selectorHeaderCheckbox=f(b,!1,e,{}),a._hasSelectorHeaderCheckbox=!0):e.appendChild(document.createTextNode(h))}},_handleSelectorClick:function(b){if("INPUT"!==
b.target.nodeName||"keydown"!==b.type||32!==b.keyCode){var a=this.cell(b).row;if("click"===b.type||32===b.keyCode||!p("opera")&&13===b.keyCode||0===b.keyCode){this._selectionTriggerEvent=b;if(a){if(this.allowSelect(a)){var d=this._lastSelected&&this.row(this._lastSelected);this._selectorSingleRow?d&&d.id===a.id||(this.clearSelection(),this.select(a,null,!0),this._lastSelected=a.element):a&&(b.shiftKey?this._changeSelectorInput(!0,{rows:[a]}):d=null,d=b.shiftKey?d:null,this.select(d||a,a,d?void 0:
null),this._lastSelected=a.element)}}else this[this.allSelected?"clearSelection":"selectAll"]();this._selectionTriggerEvent=null}}},_changeSelectorInput:function(b,a){this._selectorColumns.length&&this._updateRowSelectors(b,a);this._hasSelectorHeaderCheckbox&&this._updateHeaderCheckboxes()},_updateRowSelectors:function(b,a){a=a.rows;for(var d=a.length,f=this._selectorColumns.length,e=0;e<d;e++)for(var h=0;h<f;h++){var c=this.cell(a[e],this._selectorColumns[h].id).element;c&&(c=(c.contents||c).input)&&
!c.disabled&&(c.checked=b,c.setAttribute("aria-checked",b))}},_updateHeaderCheckboxes:function(){for(var b=this._selectorColumns.length,a=0;a<b;a++){var d="false",f=this._selectorColumns[a]._selectorHeaderCheckbox;if(f){var e=this.selection;var h=!1;for(var c in e)if(e[c]!=this.allSelected){h=!0;break}f.indeterminate=h;f.checked=this.allSelected;h?d="mixed":this.allSelected&&(d="true");f.setAttribute("aria-checked",d)}}},configStructure:function(){this.inherited(arguments);var b=this.columns;this._selectorColumns=
[];this._hasSelectorHeaderCheckbox=this._selectorSingleRow=!1;for(var a in b)b[a].selector&&this._configureSelectorColumn(b[a])},_handleSelect:function(b){var a=this.cell(b).column;a&&a.selector||this.inherited(arguments)}})})},"dgrid1/extensions/ColumnResizer":function(){define("dojo/_base/declare dojo/_base/array dojo/on dojo/query dojo/_base/lang dojo/dom dojo/dom-construct dojo/dom-geometry dojo/has ../util/misc dojo/_base/html".split(" "),function(H,k,p,r,m,l,b,a,d,f){function e(u,t,y,D,B){for(var E=
1;E<t;E++)u[y+E][D]=B}function h(u){for(var t=u.length,y=t,D=k.filter(u[0],function(K){return!K.hidden}).length,B=Array(t);t--;)B[t]=Array(D);var E={};for(t=0;t<y;t++)for(var x=B[t],w=u[t],A=0,z=0;A<D;A++){var G=w[z],I;if("undefined"===typeof x[A]){x[A]=G.id;G.rowSpan&&1<G.rowSpan&&e(B,G.rowSpan,t,A,G.id);if(0<t&&G.colSpan&&1<G.colSpan)for(I=1;I<G.colSpan;I++)x[++A]=G.id,G.rowSpan&&1<G.rowSpan&&e(B,G.rowSpan,t,A,G.id);E[G.id]=u[0][A].id;z++}}return E}function c(u,t,y,D,B){if(!(0>=y)){var E=u.columns[t];
if(E){var x={grid:u,columnId:t,width:y,bubbles:!0,cancelable:!0};D&&(x.parentType=D);if(!u._resizedColumns||p.emit(u.headerNode,"dgrid-columnresize",x))return"auto"===y?delete E.width:(E.width=y,y+="px"),(D=u._columnSizes[t])?D.set("width",y):D=f.addCssRule("#"+f.escapeCssIdentifier(u.domNode.id)+" .dgrid-column-"+f.escapeCssIdentifier(t,"-"),"width: "+y+";"),u._columnSizes[t]=D,!1!==B&&u.resize(),!0}}}var g,n,q=0,v={create:function(){g=b.create("div",{className:"dgrid-column-resizer"});n=b.create("div",
{className:"dgrid-resize-guard"})},destroy:function(){b.destroy(g);b.destroy(n);g=n=null},show:function(u){var t=a.position(u.domNode,!0);g.style.top=t.y+"px";g.style.height=t.h+"px";document.body.appendChild(g);u.domNode.appendChild(n)},move:function(u){g.style.left=u+"px"},hide:function(){g.parentNode.removeChild(g);n.parentNode.removeChild(n)}};return H(null,{resizeNode:null,minWidth:40,adjustLastColumn:!0,_resizedColumns:!1,buildRendering:function(){this.inherited(arguments);q||v.create();q++},
destroy:function(){this.inherited(arguments);for(var u in this._columnSizes)this._columnSizes[u].remove();--q||v.destroy()},resizeColumnWidth:function(u,t){return c(this,u,t)},configStructure:function(){var u=this._oldColumnSizes=m.mixin({},this._columnSizes),t;this._resizedColumns=!1;this._columnSizes={};this.inherited(arguments);for(t in u)t in this._columnSizes||u[t].remove();delete this._oldColumnSizes},_configColumn:function(u){this.inherited(arguments);var t=u.id,y;"width"in u&&((y=this._oldColumnSizes[t])?
y.set("width",u.width+"px"):y=f.addCssRule("#"+f.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+f.escapeCssIdentifier(t,"-"),"width: "+u.width+"px;"),this._columnSizes[t]=y)},renderHeader:function(){this.inherited(arguments);var u=this;if(this.columnSets&&this.columnSets.length)for(var t=this.columnSets.length;t--;)var y=m.mixin(y||{},h(this.columnSets[t]));else this.subRows&&1<this.subRows.length&&(y=h(this.subRows));t=r(".dgrid-cell",u.headerNode);for(var D=t.length;D--;){var B=t[D],E=B.columnId,
x=u.columns[E],w=B.childNodes;if(x&&!1!==x.resizable){x=b.create("div",{className:"dgrid-resize-header-container"});for(B.contents=x;0<w.length;)x.appendChild(w[0]);w=b.create("div",{className:"dgrid-resize-handle resizeNode-"+f.escapeCssIdentifier(E,"-")},x);B.appendChild(x);w.columnId=y&&y[E]||E}}u.mouseMoveListen||(p(u.headerNode,".dgrid-resize-handle:mousedown"+(d("touch")?",.dgrid-resize-handle:touchstart":""),function(A){u._resizeMouseDown(A,this);u.mouseMoveListen.resume();u.mouseUpListen.resume()}),
u._listeners.push(u.mouseMoveListen=p.pausable(document,"mousemove"+(d("touch")?",touchmove":""),f.throttleDelayed(function(A){u._updateResizerPosition(A)}))),u._listeners.push(u.mouseUpListen=p.pausable(document,"mouseup"+(d("touch")?",touchend":""),function(A){u._resizeMouseUp(A);u.mouseMoveListen.pause();u.mouseUpListen.pause()})),u.mouseMoveListen.pause(),u.mouseUpListen.pause())},_resizeMouseDown:function(u,t){u.preventDefault();l.setSelectable(this.domNode,!1);this._startX=this._getResizeMouseLocation(u);
this._targetCell=r(".dgrid-column-"+f.escapeCssIdentifier(t.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(u);v.show(this)},_resizeMouseUp:function(u){var t=this._columnSizes,y;this.adjustLastColumn&&(y=this.headerNode.clientWidth-1);if(!this._resizedColumns){var D=r(".dgrid-cell",this.headerNode);this.columnSets&&this.columnSets.length?D=D.filter(function(G){return"0"===G.columnId.split("-")[0]&&!(G.columnId in t)}):this.subRows&&1<this.subRows.length&&(D=D.filter(function(G){return"0"===
G.columnId.charAt(0)&&!(G.columnId in t)}));var B=D.map(function(G){return G.offsetWidth});D.forEach(function(G,I){c(this,G.columnId,B[I],null,!1)},this);this._resizedColumns=!0}l.setSelectable(this.domNode,!0);D=this._targetCell;var E=this._getResizeMouseLocation(u)-this._startX,x=D.offsetWidth+E,w=this._getResizedColumnWidths(),A=w.totalWidth;w=w.lastColId;var z=r(".dgrid-column-"+f.escapeCssIdentifier(w,"-"),this.headerNode)[0].offsetWidth;x<this.minWidth&&(x=this.minWidth);c(this,D.columnId,x,
u.type)&&D.columnId!==w&&this.adjustLastColumn&&(A+E<y?c(this,w,"auto",u.type):z-E<=this.minWidth&&c(this,w,this.minWidth,u.type));v.hide();delete this._startX;delete this._targetCell},_updateResizerPosition:function(u){if(this._targetCell){u=this._getResizeMouseLocation(u);var t=this._targetCell.offsetWidth,y=u;t+(u-this._startX)<this.minWidth&&(y=this._startX-(t-this.minWidth));v.move(y)}},_getResizeMouseLocation:function(u){var t=0;u.pageX?t=u.pageX:u.clientX&&(t=u.clientX+document.body.scrollLeft+
document.documentElement.scrollLeft);return t},_getResizedColumnWidths:function(){var u=0,t=r((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode),y=t.length;if(!y)return{};for(var D=t[y-1].columnId;y--;)u+=t[y].offsetWidth;return{totalWidth:u,lastColId:D}}})})},"dgrid1/extensions/DijitRegistry":function(){define(["dojo/_base/declare","dojo/dom-geometry","dijit/_WidgetBase","dijit/registry"],function(H,k,p,r){var m=p.prototype;return H(null,{minSize:0,maxSize:Infinity,
layoutPriority:0,showTitle:!0,buildRendering:function(){r.add(this);this.inherited(arguments);this.domNode.setAttribute("widgetId",this.id)},startup:function(){if(!this._started){this.inherited(arguments);var l=this.getParent();l&&l.isLayoutContainer&&this._resizeHandle.remove()}},destroyRecursive:function(){this.destroy()},destroy:function(){this.inherited(arguments);r.remove(this.id)},getChildren:function(){return[]},getParent:function(){return r.getEnclosingWidget(this.domNode.parentNode)},isLeftToRight:function(){return!this.isRTL},
placeAt:function(l,b){return m.placeAt.call(this,l,b)},resize:function(l){l&&k.setMarginBox(this.domNode,l);this.inherited(arguments)},_set:function(l,b){this[l]=b},watch:function(){}})})},"esri/dijit/analysis/_Widget":function(){define(["dijit/_WidgetBase","dojo/_base/lang","dojo/dom-class"],function(H,k,p){return H.createSubclass({declaredClass:"esri.dijit.analysis.Widget",create:function(r,m){r=k.mixin({viewModel:{}},r);r.viewModel=this._ensureViewModelInstance(r.viewModel);this.inherited(arguments,
[r,m])},destroy:function(){this.inherited(arguments);this.viewModel.destroy&&this.viewModel.destroy();this.viewModel=null},viewModel:null,_setViewModelAttr:function(r){this._set("viewModel",this._ensureViewModelInstance(r))},viewModelType:null,visible:!0,_setVisibleAttr:function(r){this._set("visible",r);p.toggle(this.domNode,"esri-hidden",!r)},_ensureViewModelInstance:function(r){return r&&!r.declaredClass&&this.viewModelType?new this.viewModelType(r):r}})})},"esri/dijit/analysis/SettingsViewModel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Color dojo/has dojo/json dojo/Stateful ./storeUtils ./SpatialReferences ./JobsViewModel ../../kernel ../../lang".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h){H=H([b],{declaredClass:"esri.dijit.analysis.SettingsViewModel",showHelp:!0,showOverwriteResultOption:!0,showCloseAnalysisOption:!0,showStoreAnalysisOption:!0,showCoordinateSystems:!0,showOutSR:!0,showProcessSR:!0,showExtent:!0,showRasterSettings:!0,showGeoAnalyticsSettings:!0,showRasterPPFSettings:!1,showRasterPTSettings:!1,showRasterSnapSettings:!0,showRasterMaskSettings:!1,showCreditWarningSettings:!0,showResamplingSettings:!1,showCloseIcon:!0,showHeader:!0,showOkCancel:!0,
showJobsHistory:!1,isCustomExtent:!1,layers:null,viewProps:null,closeAnalysisWidget:!0,returnFeaturCollection:!1,jobsViewModel:null,geoAnalyticsServer:null,creditWarning:!0,spatialRefStore:a.createHierarchicalStore({data:d}),spatialRefData:d,constructor:function(c){var g=this.get("saveModel");g&&g.layers&&c.layers&&(this._arrayUnique(c.layers.concat(g.layers),"name"),delete g.layers);k.mixin(c,g);this.watch("showJobsHistory",k.hitch(this,this.updateJobsVM));this.watch("portalUrl",k.hitch(this,this.updateJobsVM));
this.watch("jobsHistoryItem",k.hitch(this,this.updateJobsVM))},_showCloseIconSetter:function(c){this.showCloseIcon=c},_showHelpSetter:function(c){this.showHelp=c},_showOverwriteResultOptionSetter:function(c){this.showOverwriteResultOption=c},_showCloseAnalysisOptionSetter:function(c){this.showCloseAnalysisOption=c},_showStoreAnalysisOptionSetter:function(c){this.showStoreAnalysisOption=c},_showCoordinateSystemsSetter:function(c){this.showCoordinateSystems=c},_showExtentSetter:function(c){this.showExtent=
c},_showRasterSettingsSetter:function(c){this.showRasterSettings=c},_showRasterPPFSettingsSetter:function(c){this.showRasterPPFSettings=c},_showRasterPTSettingsSetter:function(c){this.showRasterPTSettings=c},_showRasterSnapSettingsSetter:function(c){this.showRasterSnapSettings=c},_showRasterMaskSettingsSetter:function(c){this.showRasterMaskSettings=c},_returnFeatureCollectionSetter:function(c){this.returnFeatureCollection=c},_closeAnalysisWidgetSetter:function(c){this.closeAnalysisWidget=c},_overwriteResultSetter:function(c){this.overwriteResult=
c},_outSRSetter:function(c){this.outSR=c},_processSRSetter:function(c){this.processSR=c},_extentSetter:function(c){this.extent=c},_snapRasterSetter:function(c){this.snapRaster=c},_cellSizeSetter:function(c){this.cellSize=c},_maskSetter:function(c){this.mask=c},_layersSetter:function(c){this.layers=c},_showHeaderSetter:function(c){this.showHeader=c},_showOutSRSetter:function(c){this.showOutSR=c;this.set("outSR",c?this.outSR:void 0)},_showProcessSRSetter:function(c){this.showProcessSR=c;this.set("processSR",
c?this.processSR:void 0)},_showOkCancelSetter:function(c){this.showOkCancel=!0},_isCustomExtentSetter:function(c){this.isCustomExtent=c},_isCustomOutSRSetter:function(c){this.isCustomOutSR=c},_isCustomProcessSRSetter:function(c){this.isCustomProcessSR=c},_isCustomCellSizeSetter:function(c){this.isCustomCellSize=c},_showGeoAnalyticsSettingsSetter:function(c){this.showGeoAnalyticsSettings=c},_datastoreSetter:function(c){this.datastore=c},_portalUrlSetter:function(c){this.portalUrl=c},_jobsHistoryItemSetter:function(c){this.jobsHistoryItem=
c},_viewPropsSetter:function(c){this.viewProps=c},_saveModelGetter:function(){var c;window.localStorage&&(c=window.localStorage.getItem("esri_analysis_settings"))&&(c=l.parse(c));return c},_saveModelSetter:function(c){c||(c={isCustomExtent:this.isCustomExtent,isCustomOutSR:this.isCustomOutSR,isCustomProcessSR:this.isCustomProcessSR,isCustomCellSize:this.isCustomCellSize,outSR:this.outSR,processSR:this.processSR,extent:this.extent,cellSize:this.cellSize,snapRaster:this.snapRaster,mask:this.mask,datastore:this.datastore,
viewProps:this.viewProps,closeAnalysisWidget:this.closeAnalysisWidget,returnFeatureCollection:this.returnFeatureCollection,processorType:this.processorType,parallelProcessingFactor:this.parallelProcessingFactor,recycleProcessingWorkers:this.recycleProcessingWorkers,retryOnFailures:this.retryOnFailures,resamplingMethod:this.resamplingMethod,creditWarning:this.creditWarning},this.layers&&0<this.layers.length&&(c.layers=p.map(this.layers,function(g){return{name:g.name,url:g.url,fullExtent:g.fullExtent,
type:g.type,format:g.format}})));window.localStorage&&c&&window.localStorage.setItem("esri_analysis_settings",l.stringify(c))},_geoAnalyticsServerSetter:function(c){this.geoAnalyticsServer=c},_processorTypeSetter:function(c){this.processorType=c},_parallelProcessingFactorSetter:function(c){this.parallelProcessingFactor=c},_recycleIntervalOfProecssingWorkersSetter:function(c){this.recycleIntervalOfProecssingWorkers=c},_numberOfRetriesOnRandomFailureSetter:function(c){this.numberOfRetriesOnRandomFailure=
c},_resamplingMethodSetter:function(c){this.resamplingMethod=c},_creditWarningSetter:function(c){this.creditWarning=c},save:function(){this.set("saveModel")},reset:function(){k.mixin(this,this.get("saveModel"))},updateJobsVM:function(){this.showJobsHistory&&this.portalUrl&&this.jobsHistoryItem&&!this.jobsViewModel&&(this.jobsViewModel=new f({portalUrl:this.portalUrl,item:this.jobsHistoryItem}),this.watch("jobsHistoryItem",k.hitch(this,function(){this.jobsViewModel.set("item",this.jobsHistoryItem)})),
this.watch("portalUrl",k.hitch(this,function(){this.jobsViewModel.set("portalUrl",this.portalUrl)})))},_arrayUnique:function(c,g){c=c.concat();for(var n=0;n<c.length;++n)for(var q=n+1;q<c.length;++q)(!g&&c[n]===c[q]||g&&c[n][g]===c[q][g])&&c.splice(q--,1);return c}});m("extend-esri")&&k.setObject("dijit.analysis.SettingsViewModel",H,e);return H})},"esri/dijit/analysis/storeUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dstore/Memory dstore/Trackable dstore/Tree ../../kernel".split(" "),
function(H,k,p,r,m,l,b){var a=H([r,m]);r={createHierarchicalStore:function(d){d=this.createSyncStore(d,l);d.getRootCollection=function(){return this.root.filter({parent:void 0})};return d.getRootCollection()},createSyncStore:function(d,f){d=d||{};d.data&&(d=k.mixin({},d,{data:k.clone(d.data)}));return new (f?H([a,f]):a)(d)},createStore:function(d){for(var f={identifier:"id",label:"id",items:[]},e=0,h=d.length;e<h;e++)f.items.push(k.mixin({id:e},d[e%h]));return this.createSyncStore({data:f})}};p("extend-esri")&&
k.setObject("dijit.analysis.storeUtils",r,b);return r})},"dstore/Memory":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array ./Store ./Promised ./SimpleQuery ./QueryResults".split(" "),function(H,k,p,r,m,l,b){return H([r,m,l],{constructor:function(){this.storage.version=0},postscript:function(){this.inherited(arguments);this.setData(this.data||[])},data:null,autoEmitEvents:!1,getSync:function(a){return this.storage.fullData[this.storage.index[a]]},putSync:function(a,d){d=d||{};
var f=this.storage,e=f.index,h=f.fullData,c=this.Model;!c||a instanceof c||(a=this._restore(a));var g=this.getIdentity(a);null==g&&(this._setIdentity(a,"id"in d?d.id:Math.random()),g=this.getIdentity(a));f.version++;f=g in e?"update":"add";c={target:a};var n;if("update"===f){if(!1===d.overwrite)throw Error("Object already exists");g=n=e[g]}else g=this.defaultNewToStart?0:h.length;if("beforeId"in d){var q=d.beforeId;null===q?(d=h.length,"update"===f&&--d):(d=e[q],n<d&&--d);void 0!==d?c.beforeId=q:
(console.error("options.beforeId was specified but no corresponding index was found"),d=g)}else d=g;if(d===n)h[d]=a;else for(void 0!==n&&h.splice(n,1),h.splice(d,0,a),n=void 0===n?d:Math.min(n,d),d=h.length;n<d;++n)e[this.getIdentity(h[n])]=n;this.emit(f,c);return a},addSync:function(a,d){(d=d||{}).overwrite=!1;return this.putSync(a,d)},removeSync:function(a){var d=this.storage,f=d.index;d=d.fullData;if(a in f)return f=d.splice(f[a],1)[0],this._reindex(),this.emit("delete",{id:a,target:f}),!0},setData:function(a){this.parse&&
(a=this.parse(a));a.items&&(this.idProperty=a.identifier||this.idProperty,a=a.items);this.storage.fullData=this.data=a;this._reindex()},_reindex:function(){for(var a=this.storage,d=a.index={},f=a.fullData,e=this.Model,h=Object.prototype,c=0,g=f.length;c<g;c++){var n=f[c];if(e&&!(n instanceof e)){var q=this._restore(n,n.__proto__===h);n!==q&&(f[c]=n=q)}d[this.getIdentity(n)]=c}a.version++},fetchSync:function(){var a=this.data;if(!a||a._version!==this.storage.version){a=this.storage.fullData;for(var d=
this.queryLog,f=0,e=d.length;f<e;f++)a=d[f].querier(a);a._version=this.storage.version;this.data=a}return new b(a)},fetchRangeSync:function(a){var d=this.fetchSync();return new b(d.slice(a.start,a.end),{totalLength:d.length})},_includePropertyInSubCollection:function(a){return"data"!==a&&this.inherited(arguments)}})})},"dstore/Store":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/has dojo/when dojo/_base/declare ./QueryMethod ./Filter dojo/Evented".split(" "),function(H,k,p,
r,m,l,b,a,d){function f(h){return function(c,g){var n=this;m(c,function(q){q={target:q};var v=g[1]||{};"beforeId"in v&&(q.beforeId=v.beforeId);n.emit(h,q)});return c}}r.add("object-proto",!!{}.__proto__&&!{}.watch);var e=r("object-proto");return l(d,{constructor:function(h){h&&l.safeMixin(this,h);this.Model&&this.Model.createSubclass&&(this.Model=this.Model.createSubclass([]).extend({_store:this}));this.storage=new d;var c=this;this.autoEmitEvents&&(p.after(this,"add",f("add")),p.after(this,"put",
f("update")),p.after(this,"remove",function(g,n){m(g,function(){c.emit("delete",{id:n[0]})});return g}))},autoEmitEvents:!0,idProperty:"id",queryAccessors:!0,getIdentity:function(h){return h.get?h.get(this.idProperty):h[this.idProperty]},_setIdentity:function(h,c){h.set?h.set(this.idProperty,c):h[this.idProperty]=c},forEach:function(h,c){var g=this;return m(this.fetch(),function(n){for(var q=0,v;void 0!==(v=n[q]);q++)h.call(c,v,q,g);return n})},matchesFilter:function(h){var c=this.queryLog;if(c&&
h){h=[h];for(var g=0,n=c.length;g<n;g++)h=c[g].querier(h);return 0<h.length}return!0},on:function(h,c,g){var n=this;return this.storage.on(h,function(q){c&&(!g||n.matchesFilter(q&&q.target))&&c&&c(q)})},emit:function(h,c){c=c||{};c.type=h;try{return this.storage.emit(h,c)}catch(g){console.error(g)}finally{return c.cancelable}},parse:null,stringify:null,Model:null,_restore:function(h,c){var g=this.Model;if(g&&h){var n=g.prototype,q=n._restore;q?h=q.call(h,g,c):e&&c?h.__proto__=n:h=H.delegate(n,h)}return h},
create:function(h){return new this.Model(h)},_createSubCollection:function(h){var c=H.delegate(this.constructor.prototype),g;for(g in this)this._includePropertyInSubCollection(g,c)&&(c[g]=this[g]);return l.safeMixin(c,h)},_includePropertyInSubCollection:function(h,c){return!(h in c)||c[h]!==this[h]},queryLog:[],filter:new b({type:"filter",normalizeArguments:function(h){var c=this.Filter;return h instanceof c?[h]:[new c(h)]}}),Filter:a,sort:new b({type:"sort",normalizeArguments:function(h,c){if("function"===
typeof h)var g=[h];else g=h instanceof Array?h.slice():"object"===typeof h?[].slice.call(arguments):[{property:h,descending:c}],g=k.map(g,function(n){n=H.mixin({},n);n.descending=!!n.descending;return n}),g=[g];return g}}),select:new b({type:"select"}),_getQuerierFactory:function(h){return this["_create"+(h[0].toUpperCase()+h.substr(1))+"Querier"]}})})},"dstore/QueryMethod":function(){define([],function(){return function(H){var k=H.type,p=H.normalizeArguments,r=H.applyQuery,m=H.querierFactory;return function(){var l=
Array.prototype.slice.call(arguments),b=p?p.apply(this,l):l;l={type:k,arguments:l,normalizedArguments:b};var a=this._getQuerierFactory(k)||m;a&&(l.querier=a.apply(this,b));b=this._createSubCollection({queryLog:this.queryLog.concat(l)});return r?r.call(this,b,l):b}}})},"dstore/Filter":function(){define(["dojo/_base/declare"],function(H){function k(r){return function(){var m=this.constructor,l=new m;l.type=r;l.args=Array.prototype.slice.call(arguments);return this.type?k("and").call(m.prototype,this,
l):l}}function p(r){return function(){for(var m=this.constructor,l=[],b=0;b<arguments.length;b++){var a=arguments[b];l.push(a instanceof m?a:new m(a))}m=new m;m.type=r;m.args=l;this.type===r?m.args=this.args.concat(l):this.type?l.unshift(this):1===l.length&&l[0].type&&(m.type=l[0].type,m.args=l[0].args.slice());return m}}H=H(null,{constructor:function(r){var m=typeof r;switch(m){case "object":m=this;for(var l in r){var b=r[l];m=b instanceof this.constructor?m[b.type](l,b.args[0]):b&&b.test?m.match(l,
b):m.eq(l,b)}this.type=m.type;this.args=m.args;break;case "function":case "string":this.type=m,this.args=[r]}},and:p("and"),or:p("or"),eq:k("eq"),ne:k("ne"),lt:k("lt"),lte:k("lte"),gt:k("gt"),gte:k("gte"),contains:k("contains"),"in":k("in"),match:k("match")});H.filterCreator=k;H.logicalOperatorCreator=p;return H})},"dstore/Promised":function(){define(["dojo/_base/declare","dojo/Deferred","./QueryResults","dojo/when"],function(H,k,p,r){function m(l,b){return function(){var a=new k;try{a.resolve(this[l].apply(this,
arguments))}catch(d){a.reject(d)}return b?(a=new p(a.promise),a.totalLength=r(a.totalLength),a):a.promise}}return H(null,{get:m("getSync"),put:m("putSync"),add:m("addSync"),remove:m("removeSync"),fetch:m("fetchSync",!0),fetchRange:m("fetchRangeSync",!0)})})},"dstore/QueryResults":function(){define(["dojo/_base/lang","dojo/when"],function(H,k){function p(r,m){return k(this,function(l){for(var b=0,a=l.length;b<a;b++)r.call(m,l[b],b,l)})}return function(r,m){var l=m&&"totalLength"in m;if(r.then){r=H.delegate(r);
var b=r.then(function(a){var d=l?m.totalLength:a.totalLength||a.length;a.totalLength=d;return!l&&d});r.totalLength=l?m.totalLength:b;r.response=m&&m.response}else r.totalLength=l?m.totalLength:r.length;r.forEach=p;return r}})},"dstore/SimpleQuery":function(){define(["dojo/_base/declare","dojo/_base/array"],function(H,k){function p(m,l){if(-1<m.indexOf(".")){var b=m.split("."),a=b.length;return function(d){for(var f=0;f<a;f++)d=d&&(l&&d.get?d.get(b[f]):d[b[f]]);return d}}return function(d){return d.get?
d.get(m):d[m]}}var r={eq:function(m,l){return m===l},"in":function(m,l){return-1<k.indexOf(l.data||l,m)},ne:function(m,l){return m!==l},lt:function(m,l){return m<l},lte:function(m,l){return m<=l},gt:function(m,l){return m>l},gte:function(m,l){return m>=l},match:function(m,l,b){return l.test(m,b)},contains:function(m,l,b,a){var d=this;l=l.data?l.data:Array.isArray(l)?l:[l];return k.every(l,function(f){if("object"===typeof f&&f.type){var e=d._getFilterComparator(f.type);return k.some(m,function(h){return e.call(d,
h,f.args[1],b,a)})}return-1<k.indexOf(m,f)})}};return H(null,{_createFilterQuerier:function(m){function l(f){var e=f.type;f=f.args;var h=a._getFilterComparator(e);if(h){var c=f[0],g=p(c,b),n=f[1];n&&n.fetchSync&&(n=n.fetchSync());return function(y){return h.call(a,g(y),n,y,c)}}switch(e){case "and":case "or":for(var q=0,v=f.length;q<v;q++){var u=l(f[q]);var t=t?function(y,D){return"and"===e?function(B){return y(B)&&D(B)}:function(B){return y(B)||D(B)}}(t,u):u}return t;case "function":return f[0];case "string":t=
a[f[0]];if(!t)throw Error("No filter function "+f[0]+" was found in the collection");return t;case void 0:return function(){return!0};default:throw Error('Unknown filter operation "'+e+'"');}}var b=this.queryAccessors,a=this,d=l(m);return function(f){return k.filter(f,d)}},_getFilterComparator:function(m){return r[m]||this.inherited(arguments)},_createSelectQuerier:function(m){return function(l){var b=m.length;return k.map(l,m instanceof Array?function(a){for(var d={},f=0;f<b;f++){var e=m[f];d[e]=
a[e]}return d}:function(a){return a[m]})}},_createSortQuerier:function(m){var l=this.queryAccessors;return function(b){b=b.slice();"function"===typeof m?b.sort(m):m&&m.length&&b.sort(function(a,d){for(var f=0;f<m.length;f++){var e=m[f];if("function"==typeof e)var h=e(a,d);else{h=e.get||(e.get=p(e.property,l));e=e.descending;var c=h(a);h=h(d);null!=c&&(c=c.valueOf());null!=h&&(h=h.valueOf());h=c===h?0:!!e===("undefined"===typeof h||null===h&&"undefined"!==typeof c||null!=c&&c<h)?1:-1}if(0!==h)return h}return 0});
return b}}})})},"dstore/Trackable":function(){define("dojo/_base/lang dojo/_base/declare dojo/aspect dojo/when dojo/promise/all dojo/_base/array dojo/on".split(" "),function(H,k,p,r,m,l,b){function a(e,h,c){for(var g=e.length-1;0<=g;--g){var n=e[g],q=n.start;n=q+n.count;if(h>n){e.splice(g+1,0,{start:h,count:c-h});return}c>=q&&(h=Math.min(h,q),c=Math.max(c,n),e.splice(g,1))}e.unshift({start:h,count:c-h})}var d=0,f={track:function(){function e(){return function(){var B=this,E=this.inherited(arguments);
r(E,function(x){x=B._results=x.slice();B._partialResults&&(B._partialResults=null);B._ranges=[];a(B._ranges,0,x.length)});return E}}function h(){return function(B){var E=this,x=B.start,w=B.end,A=this.inherited(arguments);this._results||r(A,function(z){return r(z.totalLength,function(G){var I=E._partialResults||(E._partialResults=[]);w=Math.min(w,x+z.length);I.length=G;G=[x,w-x].concat(z);I.splice.apply(I,G);a(E._ranges,x,w);return z})});return A}}function c(B,E){d++;var x=E.target;E=H.delegate(E,
y[B]);var w=E.beforeId;r(u._results||u._partialResults,function(A){if(A){var z,G,I=u._ranges,K="id"in E?E.id:g.getIdentity(x),R=-1,U=-1,ba=-1,ca=-1;if("delete"===B||"update"===B)for(z=0;-1===R&&z<I.length;++z){var da=I[z];var ja=da.start;for(G=ja+da.count;ja<G;++ja)if(g.getIdentity(A[ja])==K){R=E.previousIndex=ja;U=z;var ea=w==K;A.splice(R,1);da.count--;for(ja=z+1;ja<I.length;++ja)I[ja].start--;break}}if("add"===B||"update"===B){if(t){if(t([x]).length){var L=0;G=I.length-1;for(ea=-1;L<=G&&-1===ba;)z=
L+Math.round((G-L)/2),da=I[z],U=A.slice(da.start,da.start+da.count),void 0!==w&&(ea=null===w?U.length:D(U,w)),-1===ea&&(ea=R>=Math.max(0,da.start-1)&&R<=da.start+da.count?R:g.defaultNewToStart?0:U.length),U.splice(ea,0,x),ja=l.indexOf(t(U),x),K=da.start+ja,0===ja&&0!==da.start?G=z-1:ja>=U.length-1&&K<A.length?L=z+1:(ba=K,ca=z);if(-1===ba&&0<L&&L<I.length)var O=!0}}else{ja=-1;if(void 0===w||ea)"update"===B?(ba=R,ca=U):g.defaultNewToStart?ja=ba=0:(ba=A.length,ja=I.length-1);else if(null===w)ba=A.length,
ja=I.length-1;else for(z=0,G=I.length;-1===ca&&z<G;++z)da=I[z],ba=D(A,w,da.start,da.start+da.count),-1!==ba&&(ca=z);-1!==ja&&-1===ca&&(da=I[ja])&&da.start<=ba&&ba<=da.start+da.count&&(ca=ja)}if(-1<ba&&-1<ca)for(E.index=ba,A.splice(ba,0,x),I[ca].count++,z=ca+1;z<I.length;++z)I[z].start++;else if(O)for(E.beforeIndex=I[L].start,z=L;z<I.length;++z)I[z].start++}E.totalLength=A.length}(A=u["on_tracked"+B])&&A.call(u,E)})}var g=this.store||this,n=[],q={add:1,update:1,"delete":1},v;for(v in q)n.push(this.on(v,
function(B){return function(E){c(B,E)}}(v)));var u=k.safeMixin(H.delegate(this),{_ranges:[],fetch:e(),fetchRange:h(),releaseRange:function(B,E){if(this._partialResults){a:for(var x=this._ranges,w=0,A;A=x[w];++w){var z=A.start,G=z+A.count;if(B<=z)if(E>=G)x.splice(w,1);else{A.start=E;A.count=G-A.start;break a}else if(B<G)if(E>z){x.splice(w,1,{start:z,count:B-z},{start:E,count:G-E});break a}else A.count=B-A.start}for(;B<E;++B)delete this._partialResults[B]}},on:function(B,E){var x=this,w=this.getInherited(arguments);
return b.parse(u,B,E,function(A,z){return z in q?p.after(u,"on_tracked"+z,E,!0):w.call(x,z,E)})},tracking:{remove:function(){for(;0<n.length;)n.pop().remove();this.remove=function(){}}},track:null});this.fetchSync&&(k.safeMixin(u,{fetchSync:e(),fetchRangeSync:h()}),u.fetchSync());var t;l.forEach(this.queryLog,function(B){var E=t,x=B.querier;x&&(t=E?function(w){return x(E(w))}:x)});var y={add:{index:void 0},update:{previousIndex:void 0,index:void 0},"delete":{previousIndex:void 0}},D=function(B,E,
x,w){w=void 0!==w?w:B.length;for(x=void 0!==x?x:0;x<w;++x)if(g.getIdentity(B[x])===E)return x;return-1};return u}};m=k(null,f);m.create=function(e,h){e=k.safeMixin(H.delegate(e),f);k.safeMixin(e,h);return e};return m})},"dstore/Tree":function(){define(["dojo/_base/declare"],function(H){return H(null,{constructor:function(){this.root=this},mayHaveChildren:function(k){return"hasChildren"in k?k.hasChildren:!0},getRootCollection:function(){return this.root.filter({parent:null})},getChildren:function(k){return this.root.filter({parent:this.getIdentity(k)})}})})},
"esri/dijit/analysis/SpatialReferences":function(){define(["dojo/_base/lang","dojo/has","../../kernel"],function(H,k,p){for(var r=[{name:"Spatial References"},{name:"PCS",parent:"Spatial References"},{name:"UTM",parent:"PCS"},{name:"World",parent:"PCS"},{name:"Continental",parent:"World"},{name:"Sinusoidal",type:"PCS",sRef:{wkid:54008},parent:"World"},{name:"Winkel Tripel (NGS version)",type:"PCS",sRef:{wkid:54042},parent:"World"},{name:"NAD 1983 Contiguous USA Albers",type:"PCS",sRef:{wkid:5070},
parent:"Continental"},{name:"GDA 1994 Australia Albers",type:"PCS",sRef:{wkid:3577},parent:"Continental"},{name:"ETRS 1989 Lambert Azimuthal Equal Area Coord Ref Sys",type:"PCS",sRef:{wkid:3035},parent:"Continental"},{name:"ETRS 1989 Lambert Conformal Conic Coord Ref Sys",type:"PCS",sRef:{wkid:3034},parent:"Continental"},{name:"NAD 1983 Albers Canada",type:"PCS",sRef:{wkid:102001},parent:"Continental"},{name:"NAD 1983 Lambert Canada",type:"PCS",sRef:{wkid:102002},parent:"Continental"},{name:"NAD 1983 Lambert contiguous USA",
type:"PCS",sRef:{wkid:102004},parent:"Continental"},{name:"NAD 1983 Albers Alaska",type:"PCS",sRef:{wkid:3338},parent:"Continental"},{name:"NAD 1983 Albers Hawaii",type:"PCS",sRef:{wkid:102007},parent:"Continental"},{name:"NAD 1983 Albers North America",type:"PCS",sRef:{wkid:102008},parent:"Continental"},{name:"NAD 1983 Lambert North America",type:"PCS",sRef:{wkid:102009},parent:"Continental"},{name:"WGS 1984 Sinusoidal Africa",type:"PCS",sRef:{wkid:102011},parent:"Continental"},{name:"WGS 1984 Lambert Asia",
type:"PCS",sRef:{wkid:102012},parent:"Continental"},{name:"SAD 1969 Lambert South America",type:"PCS",sRef:{wkid:102015},parent:"Continental"},{name:"WGS 1984 Lambert Azimuthal EqArea North Pole",type:"PCS",sRef:{wkid:102017},parent:"Continental"},{name:"WGS 1984 Stereographic North Pole",type:"PCS",sRef:{wkid:102018},parent:"Continental"},{name:"WGS 1984 Lambert Azimuthal EqArea South Pole",type:"PCS",sRef:{wkid:102020},parent:"Continental"},{name:"WGS 1984 Stereographic South Pole",type:"PCS",sRef:{wkid:102021},
parent:"Continental"},{name:"WGS 1984 Lambert for Africa",type:"PCS",sRef:{wkid:102024},parent:"Continental"},{name:"WGS 1984 Albers for Northern Asia",type:"PCS",sRef:{wkid:102025},parent:"Continental"},{name:"WGS 1984 Lambert for Northern Asia",type:"PCS",sRef:{wkid:102027},parent:"Continental"},{name:"WGS 1984 Albers for Southern Asia",type:"PCS",sRef:{wkid:102028},parent:"Continental"},{name:"WGS 1984 Lambert for Southern Asia",type:"PCS",sRef:{wkid:102030},parent:"Continental"},{name:"SAD 1969 Albers South America",
type:"PCS",sRef:{wkid:102033},parent:"Continental"},{name:"NAD 1983 USGS Contiguous USA Albers",type:"PCS",sRef:{wkid:102039},parent:"Continental"},{name:"WGS 1984 UTM Zone 1N",type:"PCS",sRef:{wkid:32601},parent:"UTM"},{name:"WGS 1984 UTM Zone 2N",type:"PCS",sRef:{wkid:32602},parent:"UTM"},{name:"WGS 1984 UTM Zone 3N",type:"PCS",sRef:{wkid:32603},parent:"UTM"},{name:"WGS 1984 UTM Zone 4N",type:"PCS",sRef:{wkid:32604},parent:"UTM"},{name:"WGS 1984 UTM Zone 5N",type:"PCS",sRef:{wkid:32605},parent:"UTM"},
{name:"WGS 1984 UTM Zone 6N",type:"PCS",sRef:{wkid:32606},parent:"UTM"},{name:"WGS 1984 UTM Zone 7N",type:"PCS",sRef:{wkid:32607},parent:"UTM"},{name:"WGS 1984 UTM Zone 8N",type:"PCS",sRef:{wkid:32608},parent:"UTM"},{name:"WGS 1984 UTM Zone 9N",type:"PCS",sRef:{wkid:32609},parent:"UTM"},{name:"WGS 1984 UTM Zone 10N",type:"PCS",sRef:{wkid:32610},parent:"UTM"},{name:"WGS 1984 UTM Zone 11N",type:"PCS",sRef:{wkid:32611},parent:"UTM"},{name:"WGS 1984 UTM Zone 12N",type:"PCS",sRef:{wkid:32612},parent:"UTM"},
{name:"WGS 1984 UTM Zone 13N",type:"PCS",sRef:{wkid:32613},parent:"UTM"},{name:"WGS 1984 UTM Zone 14N",type:"PCS",sRef:{wkid:32614},parent:"UTM"},{name:"WGS 1984 UTM Zone 15N",type:"PCS",sRef:{wkid:32615},parent:"UTM"},{name:"WGS 1984 UTM Zone 16N",type:"PCS",sRef:{wkid:32616},parent:"UTM"},{name:"WGS 1984 UTM Zone 17N",type:"PCS",sRef:{wkid:32617},parent:"UTM"},{name:"WGS 1984 UTM Zone 18N",type:"PCS",sRef:{wkid:32618},parent:"UTM"},{name:"WGS 1984 UTM Zone 19N",type:"PCS",sRef:{wkid:32619},parent:"UTM"},
{name:"WGS 1984 UTM Zone 20N",type:"PCS",sRef:{wkid:32620},parent:"UTM"},{name:"WGS 1984 UTM Zone 21N",type:"PCS",sRef:{wkid:32621},parent:"UTM"},{name:"WGS 1984 UTM Zone 22N",type:"PCS",sRef:{wkid:32622},parent:"UTM"},{name:"WGS 1984 UTM Zone 23N",type:"PCS",sRef:{wkid:32623},parent:"UTM"},{name:"WGS 1984 UTM Zone 24N",type:"PCS",sRef:{wkid:32624},parent:"UTM"},{name:"WGS 1984 UTM Zone 25N",type:"PCS",sRef:{wkid:32625},parent:"UTM"},{name:"WGS 1984 UTM Zone 26N",type:"PCS",sRef:{wkid:32626},parent:"UTM"},
{name:"WGS 1984 UTM Zone 27N",type:"PCS",sRef:{wkid:32627},parent:"UTM"},{name:"WGS 1984 UTM Zone 28N",type:"PCS",sRef:{wkid:32628},parent:"UTM"},{name:"WGS 1984 UTM Zone 29N",type:"PCS",sRef:{wkid:32629},parent:"UTM"},{name:"WGS 1984 UTM Zone 30N",type:"PCS",sRef:{wkid:32630},parent:"UTM"},{name:"WGS 1984 UTM Zone 31N",type:"PCS",sRef:{wkid:32631},parent:"UTM"},{name:"WGS 1984 UTM Zone 32N",type:"PCS",sRef:{wkid:32632},parent:"UTM"},{name:"WGS 1984 UTM Zone 33N",type:"PCS",sRef:{wkid:32633},parent:"UTM"},
{name:"WGS 1984 UTM Zone 34N",type:"PCS",sRef:{wkid:32634},parent:"UTM"},{name:"WGS 1984 UTM Zone 35N",type:"PCS",sRef:{wkid:32635},parent:"UTM"},{name:"WGS 1984 UTM Zone 36N",type:"PCS",sRef:{wkid:32636},parent:"UTM"},{name:"WGS 1984 UTM Zone 37N",type:"PCS",sRef:{wkid:32637},parent:"UTM"},{name:"WGS 1984 UTM Zone 38N",type:"PCS",sRef:{wkid:32638},parent:"UTM"},{name:"WGS 1984 UTM Zone 39N",type:"PCS",sRef:{wkid:32639},parent:"UTM"},{name:"WGS 1984 UTM Zone 40N",type:"PCS",sRef:{wkid:32640},parent:"UTM"},
{name:"WGS 1984 UTM Zone 41N",type:"PCS",sRef:{wkid:32641},parent:"UTM"},{name:"WGS 1984 UTM Zone 42N",type:"PCS",sRef:{wkid:32642},parent:"UTM"},{name:"WGS 1984 UTM Zone 43N",type:"PCS",sRef:{wkid:32643},parent:"UTM"},{name:"WGS 1984 UTM Zone 44N",type:"PCS",sRef:{wkid:32644},parent:"UTM"},{name:"WGS 1984 UTM Zone 45N",type:"PCS",sRef:{wkid:32645},parent:"UTM"},{name:"WGS 1984 UTM Zone 46N",type:"PCS",sRef:{wkid:32646},parent:"UTM"},{name:"WGS 1984 UTM Zone 47N",type:"PCS",sRef:{wkid:32647},parent:"UTM"},
{name:"WGS 1984 UTM Zone 48N",type:"PCS",sRef:{wkid:32648},parent:"UTM"},{name:"WGS 1984 UTM Zone 49N",type:"PCS",sRef:{wkid:32649},parent:"UTM"},{name:"WGS 1984 UTM Zone 50N",type:"PCS",sRef:{wkid:32650},parent:"UTM"},{name:"WGS 1984 UTM Zone 51N",type:"PCS",sRef:{wkid:32651},parent:"UTM"},{name:"WGS 1984 UTM Zone 52N",type:"PCS",sRef:{wkid:32652},parent:"UTM"},{name:"WGS 1984 UTM Zone 53N",type:"PCS",sRef:{wkid:32653},parent:"UTM"},{name:"WGS 1984 UTM Zone 54N",type:"PCS",sRef:{wkid:32654},parent:"UTM"},
{name:"WGS 1984 UTM Zone 55N",type:"PCS",sRef:{wkid:32655},parent:"UTM"},{name:"WGS 1984 UTM Zone 56N",type:"PCS",sRef:{wkid:32656},parent:"UTM"},{name:"WGS 1984 UTM Zone 57N",type:"PCS",sRef:{wkid:32657},parent:"UTM"},{name:"WGS 1984 UTM Zone 58N",type:"PCS",sRef:{wkid:32658},parent:"UTM"},{name:"WGS 1984 UTM Zone 59N",type:"PCS",sRef:{wkid:32659},parent:"UTM"},{name:"WGS 1984 UTM Zone 60N",type:"PCS",sRef:{wkid:32660},parent:"UTM"}],m=0;m<r.length;++m)r[m].hasChildren=void 0===r[m].type;r={identifier:"name",
items:r};k("extend-esri")&&H.setObject("dijit.analysis.SpatialReferences",r,p);return r})},"esri/dijit/analysis/JobsViewModel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/json dojo/Stateful dojo/topic ./utils ./storageUtils ../../kernel ../../lang".split(" "),function(H,k,p,r,m,l,b,a,d,f,e){H=H([l],{declaredClass:"esri.dijit.analysis.JobsViewModel",constructor:function(h){this.watch("item",k.hitch(this,this.fetchJobs))},_portalUrlSetter:function(h){this.portalUrl=
h},_itemSetter:function(h){this.item=h},_jobsSetter:function(h){this.jobs=h},_currentJobSetter:function(h){h&&h.jobParams&&a.jobParamsToWidgetProps(h).then(k.hitch(this,function(c){this.currentJob=c;b.publish("analysis/jobs/selectedjob",this.currentJob,this.item)}))},fetchJobs:function(){this.portalUrl&&this.item&&d.getResourcesInfo(this.item,{portalUrl:this.portalUrl}).then(k.hitch(this,function(h){h=p.filter(h,function(c){return e.isDefined(c.toolName)&&e.isDefined(c.jobInfo)&&e.isDefined(c.jobParams)});
this.set("jobs",h)}),k.hitch(this,function(h){console.log("Error fetching jobs",h)}))}});r("extend-esri")&&k.setObject("dijit.analysis.JobsViewModel",H,f);return H})},"esri/dijit/analysis/JobsList":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/json dojo/date/locale dojo/has dojo/json dojo/on dojo/string dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/NodeList dojo/NodeList-dom dojo/_base/fx dojo/fx/easing dojo/Evented dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/Button dijit/form/CheckBox dijit/form/Form dijit/form/Select dijit/form/TextBox dijit/form/ToggleButton dijit/form/ValidationTextBox dijit/layout/ContentPane dijit/form/FilteringSelect dijit/Dialog dijit/ConfirmDialog dojox/mvc/at dgrid1/OnDemandGrid dgrid1/Tree dgrid1/Editor dgrid1/Keyboard dgrid1/Selection dgrid1/Selector dgrid1/extensions/ColumnResizer dgrid1/extensions/DijitRegistry ../../kernel ../../lang ./_Widget ./utils ./JobsViewModel dojo/i18n!../../nls/jsapi dojo/text!./templates/JobsList.html".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x,w,A,z,G,I,K,R,U,ba,ca,da,ja,ea,L,O,S,T,J,N,C,P,Q,Y,fa,na,la,W,aa,oa,ha){H=la.createSubclass([E,x,w,A],{declaredClass:"esri.dijit.analysis.JobsList",templateString:ha,widgetsInTemplate:!0,i18n:null,toolName:"JobsList",helpFileName:"AnalysisEnvironments",viewModelType:aa,cssClass:{primaryButton:"btn calcite blue",button:"btn calcite",tableRow:"esriHelpPopup"},constructor:function(pa,F){this._pbConnects=[];pa.containerNode&&(this.container=pa.containerNode);
this.cssClass=p.mixin({},this.cssClass)},destroy:function(){this.inherited(arguments)},postMixInProperties:function(){this.inherited(arguments);this.i18n={};p.mixin(this.i18n,oa.common);this._initModelWatchers()},postCreate:function(){this.inherited(arguments);this.buildJobsList()},startup:function(){},buildJobsList:function(){r.forEach(this.viewModel.jobs,function(pa){var F=n.create("tr",{"class":this.cssClass.tableRow},this._analysisJobTBody),M=n.create("td",{innerHTML:"\x3ca href\x3d'#'\x3e"+pa.toolName+
"\x3c/a\x3e"},F);n.create("td",{innerHTML:this._formatTimeStamp(pa.timestamp)},F);e(M,"click",p.hitch(this,this._openTool,pa))},this)},_initModelWatchers:function(){this.own(this.viewModel.watch("jobs",p.hitch(this,this.buildJobsList)))},_openTool:function(pa){this.viewModel.set("currentJob",pa)},_formatTimeStamp:function(pa){return a.format(new Date(pa),{formatLength:"medium"})}});d("extend-esri")&&p.setObject("dijit.analysis.JobsList",H,fa);return H})},"esri/dijit/analysis/components/DataStoreSelect":function(){define("../../../kernel ../../../lang ../../../request dijit/_WidgetBase dojox/lang/functional/object dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/has dojo/promise/all dojo/Evented dojo/i18n!../nls/DataStoreSelect".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h){k=l([r,e],{declaredClass:"esri.dijit.analysis.components.DataStoreSelect",geoAnalyticsServer:null,i18n:null,postMixInProperties:function(){this.inherited(arguments);this.i18n={};b.mixin(this.i18n,h)},buildRendering:function(){this.createElements()},postCreate:function(){this.inherited(arguments);this.buildDataStoreUI()},createElements:function(){this.domNode=a.create("div",{style:"width:100%;height:100%"});this._dsSelect=a.create("select",{"class":"dijit dijitReset dijitInline dijitLeft dijitDownArrowButton esriLeadingMargin1 longInput esriLongLabel dijitSelect dijitValidationTextBox",
onchange:b.hitch(this,this._handleDSSelectChange)},this.domNode)},_handleDSSelectChange:function(c){this.emit("change",{value:this._dsSelect.value})},buildDataStoreUI:function(){if(this.geoAnalyticsServer&&!this.bdfsTemplateOptions){var c=this.geoAnalyticsServer.replace("/System/GeoAnalyticsTools/GPServer","");p({url:c+"/DataStoreCatalogs",content:{f:"json"}}).then(b.hitch(this,function(g){var n=g.services.map(function(q){return q.name});g=n.map(function(q){return p({url:c+"/"+q+"/BigDataCatalogServer",
content:{f:"json"}})});f(g).then(b.hitch(this,function(q){var v=[];q.filter(function(t,y){t.name=n[y];return void 0!==t.outputTemplates}).forEach(function(t){t.outputTemplates.forEach(function(y){v.push({label:t.name.replace("DataStoreCatalogs/bigDataFileShares_","")+"-"+y.title,innerHTML:t.name.replace("DataStoreCatalogs/bigDataFileShares_","")+"-"+y.title,value:t.name.replace("DataStoreCatalogs/bigDataFileShares_","/bigDataFileShares/")+":"+y.name})})});this.bdfsTemplateOptions=v;q=a.create("optGroup",
{label:this.i18n.agsDataStore});var u=a.create("optGroup",{label:this.i18n.bdfsTemplates});q.appendChild(a.create("option",{label:this.i18n.relationalDS,value:"GDB",innerHTML:this.i18n.relationalDS}));q.appendChild(a.create("option",{label:this.i18n.spatialDS,value:"BDS",innerHTML:this.i18n.spatialDS}));v.forEach(b.hitch(this,function(t){u.appendChild(a.create("option",t))}));this._dsSelect.appendChild(q);this._dsSelect.appendChild(u);m.keys(this._dsSelect.options).some(function(t){return t.label===
this.value},this);this._setCurValue()}))}),b.hitch(this,function(){this._dsSelect.add(a.create("option",{label:this.i18n.relationalDS,value:"GDB",innerHTML:this.i18n.relationalDS}));this._dsSelect.add(a.create("option",{label:this.i18n.spatialDS,value:"BDS",innerHTML:this.i18n.spatialDS}));this._setCurValue()}))}},_setCurValue:function(){m.keys(this._dsSelect.options).some(function(c){return c.label===this.value},this)?this._dsSelect.value=this.value:this._dsSelect.value="BDS"},reset:function(){this._dsSelect.reset()},
_setGeoAnalyticsServerAttr:function(c){this.geoAnalyticsServer=c},_setValueAttr:function(c){this.value=c||"BDS"},_getValueAttr:function(){return this._dsSelect?this._dsSelect.value:null}});d("extend-esri")&&b.setObject("dijit.analysis.components.DataStoreSelect",k,H);return k})},"dojox/lang/functional/object":function(){define(["dojo/_base/kernel","dojo/_base/lang","./lambda"],function(H,k,p){var r={};k.mixin(p,{keys:function(m){var l=[],b;for(b in m)b in r||l.push(b);return l},values:function(m){var l=
[],b;for(b in m)b in r||l.push(m[b]);return l},filterIn:function(m,l,b){b=b||H.global;l=p.lambda(l);var a={},d;for(d in m)if(!(d in r)){var f=m[d];l.call(b,f,d,m)&&(a[d]=f)}return a},forIn:function(m,l,b){b=b||H.global;l=p.lambda(l);for(var a in m)a in r||l.call(b,m[a],a,m);return b},mapIn:function(m,l,b){b=b||H.global;l=p.lambda(l);var a={},d;for(d in m)d in r||(a[d]=l.call(b,m[d],d,m));return a}});return p})},"dojox/lang/functional/lambda":function(){define(["../..","dojo/_base/lang","dojo/_base/array"],
function(H,k,p){var r=k.getObject("lang.functional",!0,H),m={},l=1<"ab".split(/a*/).length?String.prototype.split:function(d){var f=this.split.call(this,d);(d=d.exec(this))&&0==d.index&&f.unshift("");return f},b=function(d){var f=[],e=l.call(d,/\s*->\s*/m);if(1<e.length)for(;e.length;)d=e.pop(),f=e.pop().split(/\s*,\s*|\s+/m),e.length&&e.push("(function("+f.join(", ")+"){ return ("+d+"); })");else if(d.match(/\b_\b/))f=["_"];else{e=d.match(/^\s*(?:[+*\/%&|\^\.=<>]|!=)/m);var h=d.match(/[+\-*\/%&|\^\.=<>!]\s*$/m);
if(e||h)e&&(f.push("$1"),d="$1"+d),h&&(f.push("$2"),d+="$2");else{e=d.replace(/(?:\b[A-Z]|\.[a-zA-Z_$])[a-zA-Z_$\d]*|[a-zA-Z_$][a-zA-Z_$\d]*:|this|true|false|null|undefined|typeof|instanceof|in|delete|new|void|arguments|decodeURI|decodeURIComponent|encodeURI|encodeURIComponent|escape|eval|isFinite|isNaN|parseFloat|parseInt|unescape|dojo|dijit|dojox|window|document|'(?:[^'\\]|\\.)*'|"(?:[^"\\]|\\.)*"/g,"").match(/([a-z_$][a-z_$\d]*)/gi)||[];var c={};p.forEach(e,function(g){c.hasOwnProperty(g)||(f.push(g),
c[g]=1)})}}return{args:f,body:d}},a=function(d){return d.length?function(){var f=d.length-1,e=r.lambda(d[f]).apply(this,arguments);for(--f;0<=f;--f)e=r.lambda(d[f]).call(this,e);return e}:function(f){return f}};k.mixin(r,{rawLambda:function(d){return b(d)},buildLambda:function(d){d=b(d);return"function("+d.args.join(",")+"){return ("+d.body+");}"},lambda:function(d){if("function"==typeof d)return d;if(d instanceof Array)return a(d);if(m.hasOwnProperty(d))return m[d];var f=b(d);return m[d]=new Function(f.args,
"return ("+f.body+");")},clearLambdaCache:function(){m={}}});return r})},"esri/dijit/analysis/mixins/browselayers/BrowseLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/query ../../../../kernel ../../../../request ../../../../lang ../../../../layers/CSVLayer ../../../../arcgis/Portal ../../../../SpatialReference ../../ProjectExtent dojo/Deferred ../../ItemTypes ../../utils ./configs/AGOLBrowseItem ./configs/EnterpriseBrowseItem dojo/i18n!../../nls/BrowseLayerMixin".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u){H=H([],{tableSupportedTools:"JoinFeatures SummarizeAttributes ExtractData GeocodeLocationsfromTable CopyToDataStore AppendData CalculateField MergeLayers DescribeDataset DetectIncidents".split(" "),allowedItemTypes:[],defaultItemTypes:[g.MS,g.FS],availableItemTypeFilters:["layers","featureLayers"],_createBrowseItems:function(t,y,D){t=t||{};var B=t.browseValue||{};y=y||{};var E=this.defaultItemTypes.concat(this.get("allowedItemTypes"));if(this.useArcGISComponents)this.setUpItemBrowser(t,
y,D).then(function(){this.map&&this._chopExtentAtDateLine(this.map.extent).then(this._projectExtentAndDispatch.bind(this))}.bind(this));else{var x=[];E.forEach(function(w){x.push('type:"'+w+'"')});"browse"===B?(D=this._browsedlg.browseItems.get("query"),D.custom=this._queryTagsForLivingAtlasBrowseItems(y),this._browsedlg.browseItems.set("extent",this.get("map").extent),this._browsedlg.browseItems.set("query",D),this._browsedlg.show()):(this.showGeoAnalyticsParams&&x.push('type:"'+g.BIGDATA+'"'),D=
this._browseLyrsdlg.browseItems.get("query"),D.types=x,this._browseLyrsdlg.browseItems.set("query",D),y.geometryTypes?(this._browseLyrsdlg.browseItems.plugIn.checkGeometryType=!0,0<y.geometryTypes.length&&(this._browseLyrsdlg.browseItems.plugIn.geometryTypes=y.geometryTypes)):this._browseLyrsdlg.browseItems.plugIn.checkGeometryType=!1,y.layerTypes?(this._browseLyrsdlg.browseItems.plugIn.checkLayerType=!0,0<y.layerTypes.length&&(this._browseLyrsdlg.browseItems.plugIn.layerTypes=y.layerTypes)):this._browseLyrsdlg.browseItems.plugIn.checkLayerType=
!1,y.customCheck?(this._browseLyrsdlg.browseItems.plugIn.customCheckHandler=y.customCheck.customCheckHandler,this._browseLyrsdlg.browseItems.plugIn.customCheckFailureMessage=y.customCheck.customCheckFailureMessage):this._browseLyrsdlg.browseItems.plugIn.customCheckHandler=void 0,this._browseLyrsdlg.show())}},setUpItemBrowser:function(t,y,D){var B=new c;window.require(["arcgis-components/wrappers/ItemBrowser","esri/arcgis/Portal"],function(E,x){if(!this.ib){var w=document.createElement("div");!t.isDialog&&
document.body.appendChild(w);var A=new x.Portal(this.portalSelf&&this.portalSelf.urlKey&&this.portalSelf.customBaseUrl?location.protocol+"//"+this.portalSelf.urlKey+"."+this.portalSelf.customBaseUrl+"/sharing/rest":(this.portalSelf&&this.portalSelf.portalHostname?location.protocol+"//"+this.portalSelf.portalHostname:this.portalUrl)+"/sharing/rest");"ArcGISEnterpriseOnKubernetes"===(this.portalSelf||{}).portalDeploymentType&&(t.disableBoundary=!0,t.disableLAAL=!0);var z=this.defaultItemTypes.concat(this.get("allowedItemTypes")),
G=function(){this._closeFullScreenBrowser();t.isDialog&&this._closeDialog();this._resetSelectBox(D);!t.isDialog&&this._removeDOMfromBody(w)},I=function(ca){this._closeFullScreenBrowser();t.isDialog&&this._closeDialog();ca[0]&&ca[0].type===g.RFT?this.onSelectRFTTool.bind(this)(ca[0],A):ca[0]&&ca[0].type===g.DLPK?this.onSelectDLPKTool.bind(this)(ca[0],A):this.onBrowseItemSelect.bind(this)(ca[0],A,D);!t.isDialog&&this._removeDOMfromBody(w)},K=function(ca){this._closeFullScreenBrowser();t.isDialog&&this._closeDialog();
this.onSelectGPTool.bind(this)(ca);!t.isDialog&&this._removeDOMfromBody(w)},R=function(ca){this._closeFullScreenBrowser();t.isDialog&&this._closeDialog();this.onEditRFTTool.bind(this)(ca,A);!t.isDialog&&this._removeDOMfromBody(w)},U=function(ca){this._closeFullScreenBrowser();t.isDialog&&this._closeDialog();this.onBrowseItemSelect.bind(this)(ca,A,D);!t.isDialog&&this._removeDOMfromBody(w)},ba=function(ca){t.isDialog&&this._closeDialog();ca&&ca.type===g.RFT?this.onEditRFTTool.bind(this)(ca,A):this.onBrowseItemSelect.bind(this)(ca,
A,D,!0);!t.isDialog&&this._removeDOMfromBody(w)};-1<this.tableSupportedTools.indexOf(this.helpFileName)&&(z=z.concat([this.showGeoAnalyticsParams?g.TABLE:g.BTABLE]));A.signIn().then(function(){this._fetchGroupForRFT(A).then(function(ca){-1<z.indexOf(g.IS)?this.availableItemTypeFilters=["layers","featureLayers","mapImageLayers","imageryLayers"]:-1===z.indexOf(g.GPSERVICE)&&-1===z.indexOf(g.RFT)&&-1===z.indexOf(g.FILE)&&(this.availableItemTypeFilters=this.availableItemTypeFilters.concat(["layers","featureLayers"]));
-1<this.tableSupportedTools.indexOf(this.helpFileName)&&(this.availableItemTypeFilters=this.availableItemTypeFilters.concat(["tables"]));ca={allowedItemTypes:this.showGeoAnalyticsParams?[g.BIGDATA].concat(z):z,availableItemTypeFilters:this.showGeoAnalyticsParams?this.availableItemTypeFilters.concat(["bigDataFileShares"]):this.availableItemTypeFilters,customQueryTags:y,addQueryParameters:t.addQueryParameters,portal:A,isPortal:this.isSingleTenant,onSelectSubLayer:U.bind(this),onActionSubLayer:ba.bind(this),
onSelectGPTool:K.bind(this),onEditRFT:R.bind(this),rftGroupId:ca,disableLAAL:t.disableLAAL,disableBoundary:t.disableBoundary,title:t.title,disabledSubResources:this._getDisableResources(t.disabledSubResources),showRFTSystemSection:null!=t.showRFTSystemSection?t.showRFTSystemSection:"raster"===t.analysisMode?!0:!1,showRFTEditCustomAction:null!=t.showRFTEditCustomAction?t.showRFTEditCustomAction:!0,enableMapAreaFilter:null!=t.enableMapAreaFilter?t.enableMapAreaFilter:!0};var da=k.mixin(E.initialState.settings.config,
this.isSingleTenant?v.getConfig(ca):q.getConfig(ca)),ja=k.mixin(E.initialState.parameters,{section:"myContent",filter:k.mixin(E.initialState.parameters.filter,{searchMapArea:!1})});-1<ca.allowedItemTypes.indexOf(g.RFT)&&!this.isSingleTenant&&(da.addQueryParameters=function(O){return"all"===O.parameters.section?"-owner: (esri_*)":""});if(-1<ca.allowedItemTypes.indexOf(g.RFT)&&ca.showRFTSystemSection){var ea=this.isSingleTenant;ja.section="System";ja.sort={field:"title",order:"asc"};da.enableMapAreaFilter=
!1;da.addQueryParameters=function(O){var S;return!ea&&O.parameters&&"all"===O.parameters.section?"-owner: (esri_*)":O.parameters&&O.parameters.searchString&&O.parameters.searchString.current&&"System"===O.parameters.section?(O=O.parameters.searchString.current,-1===O.indexOf(":")&&(S="tags: ("+O+")"),S?S:""):""};var L;p.some(da.customSections,function(O){if("System"===O.name)return L=O.baseQuery,!0});require(["arcgis-raster-function-editor/RFxRegistry"],function(O){O.initialize({sysRFxBaseQuery:L,
asRFxEditorBuddy:!1,isMultiTenant:!1===this.isSingleTenant});O=O.createRequestProxy(b);this._originalRequestModule=b;b=O}.bind(this))}this.ib=new E.ItemBrowserWrapper(w,{apiVersion:3,portal:A,request:b,initialState:k.mixin(E.initialState,{settings:k.mixin(E.initialState.settings,{config:k.mixin(da,{onBack:G.bind(this),onSelect:I.bind(this)})}),ui:k.mixin(E.initialState.ui,{expanded:k.mixin(E.initialState.ui.expanded,{filters:!0})})}),parameters:ja});t.isDialog&&this._createDialog(w,A);B.resolve()}.bind(this))}.bind(this))}}.bind(this));
return B},_queryTagsForLivingAtlasBrowseItems:function(t){if((t=t&&t.tags)&&0!==t.length){if(1===t.length)return['tags:"'+t[0]+'"'];m=[];t.forEach(function(y){m.push('tags:"'+y+'"')});return m}},onBrowseItemSelect:function(t,y,D,B){y=this._getPortalItem(t,y);var E={selection:y,dialog:this._browseLyrsdlg||this._browsedlg};!t.url||n.isHostedService(t.url)||this.isSingleTenant||y.selectedLayer instanceof d?this._handleBrowseItemsSelect(E,B):this._getProxyServiceInfo(t).then(function(){a.isDefined(t.analysisProxyCheck)&&
"failure"===t.analysisProxyCheck?this._resetSelectBox(D):this._handleBrowseItemsSelect(E,B)}.bind(this),function(){this._resetSelectBox(D)}.bind(this))},onSelectGPTool:function(t){t.resource.url=t.url;this._handleSelectGpTool(t.resource)},onSelectRFTTool:function(t,y){this._handleSelectRFTTool(this._getPortalItem(t,y))},onSelectDLPKTool:function(t,y){this._handleSelectDLPKTool(this._getPortalItem(t,y))},onEditRFTTool:function(t,y){this._handleEditRFTTool(this._getPortalItem(t,y))},_getPortalItem:function(t,
y){t.resource&&t.item?(y=new f.PortalItem(k.mixin(t.item,{portal:y})),y.selectedLayer=t.resource,y.selectedLayer.url=t.url):(y=new f.PortalItem(k.mixin(t,{portal:y})),t.type&&-1<[g.CSV,g.XLS].indexOf(t.type)&&(y.selectedLayer=y));return y},_createDialog:function(t,y){window.require(["dijit/Dialog","esri/dijit/analysis/mixins/browselayers/configs/Common"],function(D,B){this.itemBrowserDialog||(this.itemBrowserDialog=new D({style:"width: 900px; height:900px; overflow: auto",id:"itemBrowserDialog",closable:!1,
title:u.customAnalysisLayerTitle}));this.itemBrowserDialog.set("content",t);this.itemBrowserDialog.show()}.bind(this))},_closeDialog:function(){this.itemBrowserDialog.hide();this.itemBrowserDialog.destroy();delete this.itemBrowserDialog;delete this.ib},_closeFullScreenBrowser:function(){this._originalRequestModule&&(b=this._originalRequestModule);this.ib.dispatch({type:"CLOSE_FULLSCREEN_BROWSER"})},_setAllowedItemTypesAttr:function(t){this.allowedItemTypes=t},_setAvailableItemTypeFiltersAttr:function(t){this.availableItemTypeFilters=
t},_getDisableResources:function(t){var y={};t&&t.length&&t.forEach(function(D){D&&D.url&&(y[D.url]=!0)},this);return y},_projectExtentAndDispatch:function(t){this.sr||(this.sr=new e(4326));h(t,this.sr,function(y){this._dispatchExtentToItemBrowser(y[0])}.bind(this),function(y){console.error(y)}.bind(this))},_chopExtentAtDateLine:function(t){var y=new c;window.esri.geometry.normalizeCentralMeridian([t],null,function(D){if(D[0].rings){var B=(new window.esri.geometry.Polygon(t.spatialReference)).addRing(D[0].rings[0]).getExtent();
D=(new window.esri.geometry.Polygon(t.spatialReference)).addRing(D[0].rings[1]).getExtent();y.resolve(B.getWidth()>D.getWidth()?B:D)}else y.resolve(D[0])},function(D){y.reject(D)});return y},_dispatchExtentToItemBrowser:function(t){window.require(["arcgis-components/wrappers/ItemBrowser"],function(y){this.ib.dispatch(y.updateExtent({minx:t.xmin,miny:t.ymin,maxx:t.xmax,maxy:t.ymax}))}.bind(this))},_fetchGroupForRFT:function(t){var y=new c;-1===this.allowedItemTypes.indexOf(g.RFT)&&y.resolve();this._systemRFTsGroup&&
y.resolve(this._systemRFTsGroup);n.fetchGroupForRFT(t).then(function(D){this._systemRFTsGroup=D;y.resolve(D)}.bind(this));return y},_removeDOMfromBody:function(t){setTimeout(function(){document.body.removeChild(t)},300);delete this.ib},_resetSelectBox:function(t){t&&t.reset()},_getProxyServiceInfo:function(t){var y=new c,D;a.isDefined(t)&&a.isDefined(t.url)||y.reject({error:"mapLayer is not defined"});var B=t.url+(-1<t.url.indexOf("?")?"\x26":"?")+"f\x3djson";var E=l.id.findCredential(t.url);var x=
t.url;this.proxyCheckedServers||(this.proxyCheckedServers=[]);p.some(this.proxyCheckedServers,function(w){D=x.substring(0,x.indexOf("/",9));if(w.server===D)return t.analysisProxyCheck=w.check,!0},this)?y.resolve({}):(E&&E.token&&(B+="\x26token\x3d"+E.token),y=b({url:B,content:null},{useProxy:!0}),y.then(function(){t.analysisProxyCheck="success";this.proxyCheckedServers.push({server:x.substring(0,x.indexOf("/",9)),check:"success"})}.bind(this),function(){t.analysisProxyCheck="failure";this.proxyCheckedServers.push({server:x.substring(0,
x.indexOf("/",9)),check:"failure"})}.bind(this)));return y.promise}});r("extend-esri")&&k.setObject("dijit.analysis.mixins.browselayers.BrowseLayerMixin",H,l);return H})},"esri/layers/CSVLayer":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../arcgis/csv ./FeatureLayer ../geometry/Extent ../tasks/FeatureSet".split(" "),function(H,k,p,r,m,l,b,a,d){k=k(b,{declaredClass:"esri.layers.CSVLayer",_preventInit:!0,_fieldTypeMap:{Date:"esriFieldTypeDate",Number:"esriFieldTypeDouble",
String:"esriFieldTypeString"},constructor:function(f,e){this.url=f;e=p.mixin({},e);this.columnDelimiter=e.columnDelimiter;this.latitudeFieldName=e.latitudeFieldName;this.longitudeFieldName=e.longitudeFieldName;f=e.layerDefinition;f||(f={fields:e.fields||[],geometryType:"esriGeometryPoint",copyrightText:e.copyright},e.fields&&H.forEach(e.fields,function(h){h.type=this._fieldTypeMap[h.type||"String"];h.alias||(h.alias=h.name)},this));this._buildCsvFcParam={url:this.url,columnDelimiter:this.columnDelimiter,
layerDefinition:f,outFields:e.outFields};this.latitudeFieldName&&this.longitudeFieldName&&(this._buildCsvFcParam.locationInfo={locationType:"coordinates",latitudeFieldName:this.latitudeFieldName,longitudeFieldName:this.longitudeFieldName});this._projectFeatures=p.hitch(this,this._projectFeatures);this._addFeatures=p.hitch(this,this._addFeatures);this._initCSVLayer(e)},refresh:function(){this._fireUpdateStart();this.applyEdits(null,null,this.graphics);this._loadFeatures()},_isWebGLCompatible:function(){return!1},
_setMap:function(f){var e=this.inherited(arguments);this._fireUpdateStart();this._projectFeatures(this._csvFC).then(this._addFeatures).otherwise(this._errorHandler);this._csvFC=null;return e},_initCSVLayer:function(f){var e=this;l.buildCSVFeatureCollection(this._buildCsvFcParam).then(function(h){!e._buildCsvFcParam.locationInfo||e.latitudeFieldName&&e.longitudeFieldName||(e.latitudeFieldName=e._buildCsvFcParam.locationInfo.latitudeFieldName,e.longitudeFieldName=e._buildCsvFcParam.locationInfo.longitudeFieldName);
e._csvFC=h;var c=h.layerDefinition;c.extent=e._getFCExtent(h);f.outFields||(f.outFields=["*"]);f.timeInfo&&(c.timeInfo=f.timeInfo);e._initFeatureLayer({layerDefinition:c},f)}).otherwise(this._errorHandler)},_loadFeatures:function(){l.buildCSVFeatureCollection(this._buildCsvFcParam).then(this._projectFeatures).then(this._addFeatures).otherwise(this._errorHandler)},_projectFeatures:function(f){return l.projectFeatureCollection(f,this._map.spatialReference)},_addFeatures:function(f){f=new d(f.featureSet);
this.applyEdits(f.features,null,null);this._fireUpdateEnd()},_getFCExtent:function(f){if(f&&f.featureSet&&f.featureSet.features){f=f.featureSet.features;var e=f.length;if(1<e){var h=f[0].geometry;var c=new a(h.x,h.y,h.x,h.y);for(--e;0<e;e--)h=f[e].geometry,c.xmin=Math.min(c.xmin,h.x),c.ymin=Math.min(c.ymin,h.y),c.xmax=Math.max(c.xmax,h.x),c.ymax=Math.max(c.ymax,h.y);0>=c.getWidth()&&0>=c.getHeight()&&(c=null)}}return c}});r("extend-esri")&&p.setObject("layers.CSVLayer",k,m);return k})},"esri/arcgis/csv":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/sniff dojo/number dojox/data/CsvStore ../kernel ../config ../request ../SpatialReference ../geometry/jsonUtils ../geometry/webMercatorUtils".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h){function c(B){var E=0,x="";k.forEach([","," ",";","|","\t"],function(w){var A=B.split(w).length;A>E&&(E=A,x=w)});return x}function g(B,E){if(!B||"[object Date]"!==Object.prototype.toString.call(B)||isNaN(B.getTime()))return!1;B=!0;if(r("chrome")&&/\d+\W*$/.test(E)){if(E.match(/[^0-9a-zA-Z\s]/))return!1;if(E=E.match(/[a-zA-Z]{2,}/)){B=!1;for(var x=0,w=E.length,A=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i;!B&&
x<=w&&!(B=!A.test(E[x]));)x++;B=!B}}return B}function n(B,E,x){var w=B.indexOf("\n");w=H.trim(B.substr(0,w));var A=E.columnDelimiter;A||(A=c(w));var z=new l({data:B,separator:A});z.fetch({onComplete:function(G,I){I=0;var K={layerDefinition:E.layerDefinition,featureSet:{features:[],geometryType:"esriGeometryPoint"}},R=K.layerDefinition.objectIdField,U=K.layerDefinition.fields;R||k.some(U,function(C){return"esriFieldTypeOID"===C.type?(R=C.name,!0):!1})||(U.push({name:"__OBJECTID",alias:"__OBJECTID",
type:"esriFieldTypeOID",editable:!1}),R="__OBJECTID");var ba=z._attributes,ca=[],da=[];k.forEach(U,function(C){"esriFieldTypeDate"===C.type?ca.push(C.name):("esriFieldTypeDouble"===C.type||"esriFieldTypeInteger"===C.type)&&da.push(C.name)});if(E.locationInfo&&"coordinates"===E.locationInfo.locationType){var ja=E.locationInfo.latitudeFieldName;var ea=E.locationInfo.longitudeFieldName}else k.forEach(ba,function(C){var P=k.indexOf(t,C.toLowerCase());-1!==P&&(ja=C);P=k.indexOf(y,C.toLowerCase());-1!==
P&&(ea=C)}),ja&&ea&&(E.locationInfo={locationType:"coordinates",latitudeFieldName:ja,longitudeFieldName:ea});if(ja&&ea){-1===k.indexOf(da,ja)&&da.push(ja);-1===k.indexOf(da,ea)&&da.push(ea);if(H.isArray(E.outFields)&&-1===k.indexOf(E.outFields,"*"))var L=E.outFields;k.forEach(ba,function(C){k.some(U,function(P){return C===P.name})||U.push({name:C,alias:C,type:C===ja||C===ea?"esriFieldTypeDouble":"esriFieldTypeString"})});ba=0;var O=G.length;for(ba;ba<O;ba++){var S=G[ba],T=z.getAttributes(S),J={};
k.forEach(T,function(C){if(C&&(C===ja||C===ea||!L||-1<k.indexOf(L,C))){var P=C;0===C.length&&k.forEach(U,function(Y,fa){Y.name==="attribute_"+(fa-1)&&(C="attribute_"+(fa-1))});if(-1<k.indexOf(ca,C)){P=z.getValue(S,P);var Q=new Date(P);J[C]=g(Q,P)?Q.getTime():null}else-1<k.indexOf(da,C)?(Q=m.parse(z.getValue(S,P)),C!==ja&&C!==ea||!(isNaN(Q)||181<Math.abs(Q))||(Q=parseFloat(z.getValue(S,P))),isNaN(Q)?J[C]=null:J[C]=Q):J[C]=z.getValue(S,P)}});J[R]=I;I++;T=J[ja];var N=J[ea];null==N||null==T||isNaN(T)||
isNaN(N)||(L&&-1===k.indexOf(L,ja)&&delete J[ja],L&&-1===k.indexOf(L,ea)&&delete J[ea],K.featureSet.features.push({geometry:{x:N,y:T,spatialReference:{wkid:4326}},attributes:J}))}K.layerDefinition.name="csv";x&&x(K)}else setTimeout(function(){console.error("File does not seem to contain fields with point coordinates.")},1),x&&x(null,Error("File does not seem to contain fields with point coordinates."))},onError:function(G){console.error("Error fetching items from CSV store: ",G);x&&x(null,G)}});return!0}
function q(B,E,x,w,A,z){0===B.length&&A(null);var G=e.getGeometryType(E),I=[];k.forEach(B,function(K){K=new G(K);K.spatialReference=x;I.push(K)},this);E=[102113,102100,3857];x.wkid&&4326===x.wkid&&w.wkid&&-1<k.indexOf(E,w.wkid)?(k.forEach(I,function(K){K.xmin?(K.xmin=Math.max(K.xmin,-180),K.xmax=Math.min(K.xmax,180),K.ymin=Math.max(K.ymin,-89.99),K.ymax=Math.min(K.ymax,89.99)):K.rings?k.forEach(K.rings,function(R){k.forEach(R,function(U){U[0]=Math.min(Math.max(U[0],-180),180);U[1]=Math.min(Math.max(U[1],
-89.99),89.99)},this)},this):K.paths?k.forEach(K.paths,function(R){k.forEach(R,function(U){U[0]=Math.min(Math.max(U[0],-180),180);U[1]=Math.min(Math.max(U[1],-89.99),89.99)},this)},this):K.x&&(K.x=Math.min(Math.max(K.x,-180),180),K.y=Math.min(Math.max(K.y,-89.99),89.99))},this),B=[],k.forEach(I,function(K){K=h.geographicToWebMercator(K);102100!==w.wkid&&(K.spatialReference=w);B.push(K.toJson())},this),A(B)):null!==x.wkid&&-1<k.indexOf(E,x.wkid)&&null!==w.wkid&&4326===w.wkid?(B=[],k.forEach(I,function(K){B.push(h.webMercatorToGeographic(K).toJson())},
this),A(B)):(E=function(K,R){K&&K.length===B.length?(B=[],k.forEach(K,function(U){U&&(U.rings&&0<U.rings.length&&0<U.rings[0].length&&0<U.rings[0][0].length&&!isNaN(U.rings[0][0][0])&&!isNaN(U.rings[0][0][1])||U.paths&&0<U.paths.length&&0<U.paths[0].length&&0<U.paths[0][0].length&&!isNaN(U.paths[0][0][0])&&!isNaN(U.paths[0][0][1])||U.xmin&&!isNaN(U.xmin)&&U.ymin&&!isNaN(U.ymin)||U.x&&!isNaN(U.x)&&U.y&&!isNaN(U.y))?B.push(U.toJson()):B.push(null)},this),A(B)):z(K,R)},a.defaults.geometryService?a.defaults.geometryService.project(I,
w,H.hitch(this,E),z):A(null))}function v(B,E){var x=[102113,102100,3857];return B&&E&&B.wkid===E.wkid&&B.wkt===E.wkt||B&&E&&B.wkid&&E.wkid&&-1<k.indexOf(x,B.wkid)&&-1<k.indexOf(x,E.wkid)?!0:!1}function u(B,E,x,w){if(B.featureSet&&0!==B.featureSet.features.length)if(v(x,E))w(B);else{var A=function(K){var R=[];k.forEach(B.featureSet.features,function(U,ba){K[ba]&&(U.geometry=K[ba],R.push(U))},this);w(B)},z=function(K,R){console.error("error projecting featureSet ("+B.layerDefinition.name+"). Final try.");
w(B)},G=function(K,R){console.error("error projecting featureSet ("+B.layerDefinition.name+"). Try one more time.");q(I,B.featureSet.geometryType,E,x,H.hitch(this,A),H.hitch(this,z))};if(B.featureSet.features&&0<B.featureSet.features.length){var I=[];k.forEach(B.featureSet.features,function(K){if(K.geometry.toJson)I.push(K.geometry);else{var R=e.getGeometryType(B.featureSet.geometryType);I.push(new R(K.geometry))}});E.toJson||(E=new f(E));x.toJson||(x=new f(x));q(I,B.featureSet.geometryType,E,x,H.hitch(this,
A),H.hitch(this,G))}else w(B)}}var t="lat latitude y ycenter latitude83 latdecdeg point-y lat_dd".split(" "),y="lon lng long longitude x xcenter longitude83 longdecdeg point-x long_dd".split(" "),D={latFieldStrings:t,longFieldStrings:y,buildCSVFeatureCollection:function(B){var E=new p,x=function(A,z){z?E.errback(z):E.callback(A)},w={url:B.url,handleAs:"text",load:function(A){n(A,B,H.hitch(this,x))},error:function(A){E.errback(A);console.error("error: "+A)}};-1<B.url.indexOf("arcgis.com")&&-1<B.url.indexOf("/content/items")&&
-1<B.url.indexOf("/data")&&(w.headers={"Content-Type":""});d(w,{usePost:!1});return E},projectFeatureCollection:function(B,E,x){var w=new p;x||(x=new f({wkid:4326}));u(B,x,E,H.hitch(this,function(A){w.callback(A)}));return w},generateDefaultPopupInfo:function(B){var E={esriFieldTypeDouble:1,esriFieldTypeSingle:1},x={esriFieldTypeInteger:1,esriFieldTypeSmallInteger:1},w={esriFieldTypeDate:1},A=null;B=k.map(B.layerDefinition.fields,H.hitch(this,function(z){"NAME"===z.name.toUpperCase()&&(A=z.name);
var G="esriFieldTypeOID"!==z.type&&"esriFieldTypeGlobalID"!==z.type&&"esriFieldTypeGeometry"!==z.type,I=null;if(G){var K=z.name.toLowerCase();if(-1<",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,".indexOf(","+K+",")||-1<K.indexOf("area")||-1<K.indexOf("length")||-1<K.indexOf("shape")||-1<K.indexOf("perimeter")||-1<K.indexOf("objectid")||K.indexOf("_")===K.length-1||K.indexOf("_i")===K.length-2&&1<K.length)G=!1;z.type in x?I={places:0,digitSeparator:!0}:z.type in
E?I={places:2,digitSeparator:!0}:z.type in w&&(I={dateFormat:"shortDateShortTime"})}return H.mixin({},{fieldName:z.name,label:z.alias,isEditable:!0,tooltip:"",visible:G,format:I,stringFieldOption:"textbox"})}));return{title:A?"{"+A+"}":"",fieldInfos:B,description:null,showAttachments:!1,mediaInfos:[]}},_getSeparator:c,_isValidDate:g,_processCsvData:n,_projectGeometries:q,_sameSpatialReference:v,_projectFeatureSet:u};r("extend-esri")&&H.setObject("arcgis.csv",D,b);return D})},"dojox/data/CsvStore":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/xhr dojo/_base/kernel dojo/data/util/filter dojo/data/util/simpleFetch".split(" "),
function(H,k,p,r,m,l){k=k("dojox.data.CsvStore",null,{constructor:function(b){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=!1;b.url&&(this.url=b.url);this._csvData=b.data;b.label?this.label=b.label:""===this.label&&(this.label=void 0);this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._loadInProgress=!1;this._queuedFetches=[];this.identifier=b.identifier;""===this.identifier?
delete this.identifier:this._idMap={};"separator"in b&&(this.separator=b.separator);"urlPreventCache"in b&&(this.urlPreventCache=b.urlPreventCache?!0:!1)},url:"",label:"",identifier:"",separator:",",urlPreventCache:!1,_assertIsItem:function(b){if(!this.isItem(b))throw Error(this.declaredClass+": a function was passed an item argument that was not an item");},_getIndex:function(b){b=this.getIdentity(b);this.identifier&&(b=this._idMap[b]);return b},getValue:function(b,a,d){this._assertIsItem(b);var f=
d;if("string"===typeof a)a=this._attributeIndexes[a],null!=a&&(f=this._dataArray[this._getIndex(b)][a]||d);else throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");return f},getValues:function(b,a){return(b=this.getValue(b,a))?[b]:[]},getAttributes:function(b){this._assertIsItem(b);var a=[];b=this._dataArray[this._getIndex(b)];for(var d=0;d<b.length;d++)""!==b[d]&&a.push(this._attributes[d]);return a},hasAttribute:function(b,a){this._assertIsItem(b);
if("string"===typeof a)return a=this._attributeIndexes[a],b=this._dataArray[this._getIndex(b)],"undefined"!==typeof a&&a<b.length&&""!==b[a];throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");},containsValue:function(b,a,d){var f=void 0;"string"===typeof d&&(f=m.patternToRegExp(d,!1));return this._containsValue(b,a,d,f)},_containsValue:function(b,a,d,f){b=this.getValues(b,a);for(a=0;a<b.length;++a){var e=b[a];if("string"===typeof e&&f)return null!==
e.match(f);if(d===e)return!0}return!1},isItem:function(b){if(b&&b[this._storeProp]===this)if(b=b[this._idProp],this.identifier){if(this._dataArray[this._idMap[b]])return!0}else if(0<=b&&b<this._dataArray.length)return!0;return!1},isItemLoaded:function(b){return this.isItem(b)},loadItem:function(b){},getFeatures:function(){return this._features},getLabel:function(b){if(this.label&&this.isItem(b))return this.getValue(b,this.label)},getLabelAttributes:function(b){return this.label?[this.label]:null},
_fetchItems:function(b,a,d){var f=this,e=function(n,q){var v=null;if(n.query){var u;v=[];var t=n.queryOptions?n.queryOptions.ignoreCase:!1,y={};for(u in n.query){var D=n.query[u];"string"===typeof D&&(y[u]=m.patternToRegExp(D,t))}for(t=0;t<q.length;++t){var B=!0,E=q[t];for(u in n.query)D=n.query[u],f._containsValue(E,u,D,y[u])||(B=!1);B&&v.push(E)}}else v=q.slice(0,q.length);a(v,n)};if(this._loadFinished)e(b,this._arrayOfAllItems);else if(""!==this.url)if(this._loadInProgress)this._queuedFetches.push({args:b,
filter:e});else{this._loadInProgress=!0;var h=p.get({url:f.url,handleAs:"text",preventCache:f.urlPreventCache});h.addCallback(function(n){try{f._processData(n),e(b,f._arrayOfAllItems),f._handleQueuedFetches()}catch(q){d(q,b)}});h.addErrback(function(n){f._loadInProgress=!1;if(d)d(n,b);else throw n;});var c=null;b.abort&&(c=b.abort);b.abort=function(){var n=h;n&&-1===n.fired&&(n.cancel(),n=null);c&&c.call(b)}}else if(this._csvData)try{this._processData(this._csvData),this._csvData=null,e(b,this._arrayOfAllItems)}catch(n){d(n,
b)}else{var g=Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(d)d(g,b);else throw g;}},close:function(b){},_getArrayOfArraysFromCsvFileContents:function(b){if(H.isString(b)){var a=/^\s+/g,d=/\s+$/g,f=/""/g,e=[],h=this._splitLines(b);for(b=0;b<h.length;++b){var c=h[b];if(0<c.length){c=c.split(this.separator);for(var g=0;g<c.length;){var n=c[g].replace(a,""),q=n.replace(d,""),v=q.charAt(0),u=q.charAt(q.length-1),t=q.charAt(q.length-2),y=q.charAt(q.length-
3);if(2===q.length&&'""'==q)c[g]="";else if('"'==v&&('"'!=u||'"'==u&&'"'==t&&'"'!=y)){if(g+1===c.length)return;c[g]=n+this.separator+c[g+1];c.splice(g+1,1)}else'"'==v&&'"'==u&&(q=q.slice(1,q.length-1),q=q.replace(f,'"')),c[g]=q,g+=1}e.push(c)}}this._attributes=e.shift();for(b=0;b<this._attributes.length;b++)this._attributeIndexes[this._attributes[b]]=b;this._dataArray=e}},_splitLines:function(b){var a=[],d,f="",e=!1;for(d=0;d<b.length;d++){var h=b.charAt(d);switch(h){case '"':e=!e;f+=h;break;case "\r":e?
f+=h:(a.push(f),f="",d<b.length-1&&"\n"==b.charAt(d+1)&&d++);break;case "\n":e?f+=h:(a.push(f),f="");break;default:f+=h}}""!==f&&a.push(f);return a},_processData:function(b){this._getArrayOfArraysFromCsvFileContents(b);this._arrayOfAllItems=[];if(this.identifier&&void 0===this._attributeIndexes[this.identifier])throw Error(this.declaredClass+": Identity specified is not a column header in the data set.");for(b=0;b<this._dataArray.length;b++){var a=b;this.identifier&&(a=this._dataArray[b][this._attributeIndexes[this.identifier]],
this._idMap[a]=b);this._arrayOfAllItems.push(this._createItemFromIdentity(a))}this._loadFinished=!0;this._loadInProgress=!1},_createItemFromIdentity:function(b){var a={};a[this._storeProp]=this;a[this._idProp]=b;return a},getIdentity:function(b){return this.isItem(b)?b[this._idProp]:null},fetchItemByIdentity:function(b){var a=b.scope?b.scope:r.global;if(this._loadFinished){var d=this._createItemFromIdentity(b.identity);this.isItem(d)||(d=null);b.onItem&&b.onItem.call(a,d)}else{var f=this;if(""!==
this.url)this._loadInProgress?this._queuedFetches.push({args:b}):(this._loadInProgress=!0,d=p.get({url:f.url,handleAs:"text"}),d.addCallback(function(e){try{f._processData(e);var h=f._createItemFromIdentity(b.identity);f.isItem(h)||(h=null);b.onItem&&b.onItem.call(a,h);f._handleQueuedFetches()}catch(c){b.onError&&b.onError.call(a,c)}}),d.addErrback(function(e){this._loadInProgress=!1;b.onError&&b.onError.call(a,e)}));else if(this._csvData)try{f._processData(f._csvData),f._csvData=null,d=f._createItemFromIdentity(b.identity),
f.isItem(d)||(d=null),b.onItem&&b.onItem.call(a,d)}catch(e){b.onError&&b.onError.call(a,e)}}},getIdentityAttributes:function(b){return this.identifier?[this.identifier]:null},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var b=0;b<this._queuedFetches.length;b++){var a=this._queuedFetches[b],d=a.filter,f=a.args;d?d(f,this._arrayOfAllItems):this.fetchItemByIdentity(a.args)}this._queuedFetches=[]}}});H.extend(k,l);return k})},"esri/dijit/analysis/ProjectExtent":function(){define(["dojo/_base/array",
"esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/geometry/Polygon","esri/tasks/GeometryService"],function(H,k,p,r,m){function l(b,a){if(b&&a.xmin>a.xmax){var d=b.valid[1]-a.xmin,f=a.xmax-b.valid[0];d>f?a.xmax=b.valid[1]+f:a.xmin=b.valid[0]-d}}return function(b,a,d,f,e,h){var c=[102113,102100,3857],g=b.spatialReference.wkid;if(g===a.wkid)return d([b],null);if(4326==g&&-1<H.indexOf(c,a.wkid))return b.ymin=Math.max(b.ymin,-89.99),b.ymax=Math.min(b.ymax,89.99),b=p.geographicToWebMercator(b),
e=b.spatialReference._getInfo(),l(e,b),b.spatialReference.wkid=a.wkid,d([b],null);if(-1<H.indexOf(c,g)&&4326==a.wkid)return b=p.webMercatorToGeographic(b),e=b.spatialReference._getInfo(),l(e,b),d([b],null);h||(h=new m(window.esriGeowConfig.self.helperServices.geometry.url));if(e&&e.wrapAround180&&"extent"===b.type){var n=b;b=r.fromExtent(b)}h.project([b],a,function(q,v){if(!(q&&0<q.length&&q[0]&&"extent"==q[0].type)||isNaN(q[0].xmin)||isNaN(q[0].ymin)||isNaN(q[0].xmax)||isNaN(q[0].ymax)){if(q&&0<
q.length&&q[0]&&"point"==q[0].type&&!isNaN(q[0].x)&&!isNaN(q[0].y))return d(q,v);if(n&&"polygon"===q[0].type){if(1===q[0].rings.length)q[0]=new k(q[0].getExtent());else{var u=(new r(q[0].spatialReference.toJson())).addRing(q[0].rings[0]).getExtent(),t=(new r(q[0].spatialReference.toJson())).addRing(q[0].rings[1]).getExtent();q[0]=t;q[0].xmin=t.xmin-u.getWidth();q[0].ymin=Math.min(t.ymin,u.ymin);q[0].ymax=Math.max(t.ymax,u.ymax)}return d(q,v)}if(f)return f()}else return d(q,v)},f)}})},"esri/dijit/analysis/mixins/browselayers/configs/AGOLBrowseItem":function(){define(["dojo/_base/lang",
"dojo/has","../../../../../kernel","./EnterpriseBrowseItem","../../../ItemTypes"],function(H,k,p,r,m){var l={getConfig:function(b){var a=r.getConfig(b);a.baseSections.push("all");a.baseSections.push("subscription");(-1<b.allowedItemTypes.indexOf(m.RFT)||-1<b.allowedItemTypes.indexOf(m.DLPK))&&a.baseSections.push("livingAtlas");return a}};k("extend-esri")&&H.setObject("dijit.analysis.mixins.browselayers.configs.AGOLBrowseItem",l,p);return l})},"esri/dijit/analysis/mixins/browselayers/configs/EnterpriseBrowseItem":function(){define("dojo/_base/lang dojo/has dojox/lang/functional/object ../../../../../kernel ./Common ../../../AnalysisRegistry ../../../ItemTypes dojo/i18n!../../../nls/BrowseLayerMixin".split(" "),
function(H,k,p,r,m,l,b,a){var d={getConfig:function(f){var e=f.disableLAAL?{customSections:[]}:{customSections:m.getLAALCustomSection(f)};!f.disableBoundary&&f.portal.EsriBoundaryLayersGroupQuery&&e.customSections.push(m.getBoundaryLayersSection(f));-1<f.allowedItemTypes.indexOf(b.RFT)&&f.showRFTSystemSection&&e.customSections.push(m.getSystemRFTSection(f));e=H.mixin({dialogTitle:f.title||a.customAnalysisLayerTitle,allowedItemTypes:f.allowedItemTypes,availableItemTypeFilters:f.availableItemTypeFilters,
baseSections:["myContent","myFavorites","myGroups","myOrganization"],resultsPerQuery:m.getNumberOfPages(),layoutMode:"fullscreen",staticFilters:m.getStaticFilters(f.customQueryTags),mainActionTitle:a.mainActionTitle,customActions:[m.getAddtoMapActions(f.onActionSubLayer)],showSubResources:this._getSubResourcesForPortal(f),disabledSubResources:f.disabledSubResources,addQueryParameters:f.addQueryParameters,enableMapAreaFilter:f.enableMapAreaFilter},e);f.showRFTEditCustomAction&&e.customActions.push(m.getEditRFTActions(f.onEditRFT));
return e},_getSubResourcesForPortal:function(f){var e={};-1<f.allowedItemTypes.indexOf(b.FS)&&(e[b.FS]={allowed:function(h){return this.allowedItemsForTypes(h,f.customQueryTags)}.bind(this),onSelect:f.onSelectSubLayer,customActions:[m.getAddtoMapActions(f.onActionSubLayer)],filters:this._getFilterforSubLayer(!1,f.customQueryTags)});-1<f.allowedItemTypes.indexOf(b.MS)&&(e[b.MS]={allowed:function(h){return this.allowedItemsForTypes(h,f.customQueryTags)}.bind(this),onSelect:f.onSelectSubLayer,customActions:[m.getAddtoMapActions(f.onActionSubLayer)],
filters:this._getFilterforSubLayer(!1,f.customQueryTags)});-1<f.allowedItemTypes.indexOf(b.BIGDATA)&&(e[b.BIGDATA]={allowed:function(h){return this.allowedItemsForTypes(h,f.customQueryTags)}.bind(this),onSelect:f.onSelectSubLayer,filters:this._getFilterforSubLayer(!0,f.customQueryTags)});-1<f.allowedItemTypes.indexOf(b.GPSERVICE)&&(e[b.GPSERVICE]={allowed:function(){return!0},onSelect:f.onSelectGPTool,filters:[]});return e},_getFilterforSubLayer:function(f,e){var h=[];h.push(this.getGeometryFilter(e.geometryTypes));
e.layerTypes&&(f?h.push(this.getFilterForLayerTypesForBigData(e.layerTypes)):h.push(this.getFilterForLayerTypesForFS(e.layerTypes)));e.timeTypes&&h.push(this.getTimeFilter(e.timeTypes));return h},getGeometryFilter:function(f){var e=[];(f&&0<f.length?f:p.values(l.GeometryTypes)).forEach(function(h){switch(h){case l.GeometryTypes.Point:e.push({displayName:a.pointFilterName,allowed:this.filters.geometryTypes[l.GeometryTypes.Point],value:"point"});break;case l.GeometryTypes.Polygon:e.push({displayName:a.polygonFilterName,
allowed:this.filters.geometryTypes[l.GeometryTypes.Polygon],value:"polygon"});break;case l.GeometryTypes.Line:e.push({displayName:a.lineFilterName,allowed:this.filters.geometryTypes[l.GeometryTypes.Line],value:"line"});break;case l.GeometryTypes.MultiPoint:e.push({displayName:a.multiPointFilterName,allowed:this.filters.geometryTypes[l.GeometryTypes.MultiPoint],value:"multipoint"})}},this);return{allowed:function(){return!0},displayName:a.geometryFilterName,value:"geometry",children:e}},getFilterForLayerTypesForFS:function(f){var e=
[];(f?0<f.length?f:[b.FLAYER,b.TABLE]:[]).forEach(function(h){switch(h){case b.FLAYER:e.push({displayName:a.featureLayerName,allowed:this.filters.layerTypes[b.FLAYER],value:"featurelayer"});break;case b.TABLE:e.push({displayName:a.tableLayerName,allowed:this.filters.layerTypes[b.TABLE],value:"ftable"})}},this);return{allowed:function(){return!0},displayName:a.itemTypeFilterName,value:"itemtype",children:e}},getFilterForLayerTypesForBigData:function(f){var e=[];(f?0<f.length?f:[b.BDATAFEATURE,b.BTABLE]:
[]).forEach(function(h){switch(h){case b.BDATAFEATURE:e.push({displayName:a.featureLayerName,allowed:this.filters.layerTypes[b.BDATAFEATURE],value:"bfeaturelayer"});break;case b.BTABLE:e.push({displayName:a.tableLayerName,allowed:this.filters.layerTypes[b.BTABLE],value:"btable"})}},this);return{allowed:function(){return!0},displayName:a.featureLayerName,value:"itemtype",children:e}},getTimeFilter:function(f){var e=[];(f?0<f.length?f:[l.TimeTypes.Instant,l.TimeTypes.Interval]:[]).forEach(function(h){switch(h){case l.TimeTypes.Instant:e.push({displayName:a.instantFilterName,
allowed:this.filters.timeTypes[l.TimeTypes.Instant].bind(this),value:"instant"});break;case l.TimeTypes.Interval:e.push({displayName:a.intervalFilterName,allowed:this.filters.timeTypes[l.TimeTypes.Interval].bind(this),value:"interval"})}},this);return{allowed:function(){return!0},displayName:a.timeFilterName,value:"time",children:e}},allowedItemsForTypes:function(f,e){var h=!0,c=e.layerTypes||[b.FLAYER,b.BDATAFEATURE];e.geometryTypes&&f.geometryType&&(e.geometryTypes=0<e.geometryTypes.length?e.geometryTypes:
p.values(l.GeometryTypes),h=h&&-1!==e.geometryTypes.indexOf(f.geometryType));c&&f.type&&(c=0<c.length?c:[b.FLAYER,b.BDATAFEATURE,b.BTABLE,b.TABLE],h=h&&-1!==c.indexOf(f.type));e.timeTypes&&(e.timeTypes=0<e.timeTypes.length?e.timeTypes:[l.TimeTypes.Instant,l.TimeTypes.Interval],h=h&&-1!==e.timeTypes.indexOf(this.getTimeType(f)));e.customCheck&&e.customCheck.customCheckHandler&&(h=h&&e.customCheck.customCheckHandler(f));return h&&f},getTimeType:function(f){return f?this.isDefined(f.timeInfo)&&this.isDefined(f.timeInfo.startTimeField)&&
!this.isDefined(f.timeInfo.endTimeField)?l.TimeTypes.Instant:this.isDefined(f.timeInfo)&&this.isDefined(f.timeInfo.startTimeField)&&this.isDefined(f.timeInfo.endTimeField)?l.TimeTypes.Interval:this.isDefined(f.time)&&this.isDefined(f.time.timeType)?f.time.timeType:!1:!1},isDefined:function(f){return void 0!==f&&null!==f},filters:{layerTypes:{"Feature Layer":function(f){return f.type===b.FLAYER},Table:function(f){return f.type===b.TABLE},featureClass:function(f){return f.type===b.BDATAFEATURE},table:function(f){return f.type===
b.BTABLE}},geometryTypes:{esriGeometryMultipoint:function(f){return f.geometryType===l.GeometryTypes.MultiPoint},esriGeometryPolyline:function(f){return f.geometryType===l.GeometryTypes.Line},esriGeometryPolygon:function(f){return f.geometryType===l.GeometryTypes.Polygon},esriGeometryPoint:function(f){return f.geometryType===l.GeometryTypes.Point}},timeTypes:{instant:function(f){return this.getTimeType(f)===l.TimeTypes.Instant},interval:function(f){return this.getTimeType(f)===l.TimeTypes.Interval}}}};
k("extend-esri")&&H.setObject("dijit.analysis.mixins.browselayers.configs.EnterpriseBrowseItem",d,r);return d})},"esri/dijit/analysis/mixins/browselayers/configs/Common":function(){define(["dojo/_base/lang","dojo/has","../../../../../kernel","dojo/i18n!../../../nls/BrowseLayerMixin","../../../ItemTypes"],function(H,k,p,r,m){var l={getLAALCustomSection:function(b){var a=this._isCustomAnalysisQuery(b.portal,b.isPortal),d=[{name:r.customeSectionName,baseQuery:this._getLAALBaseQuery(b.customQueryTags,
b.portal,b.isPortal),filters:[{fetchGroupIdByQuery:this._getDefaultQueryString(b.isPortal),name:r.Categories,type:"group",path:["categories"],staticSchema:this._getStaticLAALSchema(b.portal,b.isPortal)}].concat(this._getFilters(b.isPortal)),disableSubResources:!0}];a&&d.push({name:r.customAnalysisGroupName,baseQuery:"",filters:[{id:this._getAnalysisGroupQuery(b.portal,b.isPortal).split(":")[1],name:r.Categories,type:"group",path:["categories"],staticSchema:void 0}].concat(this._getFilters(b.isPortal)),
disableSubResources:!1});return d},getAddtoMapActions:function(b){return{allowed:function(a){return a.type!==m.RFT&&a.type!==m.XLS&&a.type!==m.CSV&&a.type!==m.DLPK},asynchronous:!1,onAction:b,name:r.customActionName}},getEditRFTActions:function(b){return{allowed:function(a){return a.type===m.RFT&&!a.rfxTemplateData},asynchronous:!1,onAction:b,name:r.edit}},getSystemRFTSection:function(b){var a='(group:"'+(b.rftGroupId&&b.rftGroupId.id)+'") -type:"Attachment" -tags:"mature support"';b.isPortal||(a+=
' -typekeywords:"categoryname#distance (legacy)system_rft"');return{name:"System",baseQuery:a,filters:[].concat(this._getFilters(b.isPortal)),addToFront:!1,sortField:"title"}},getStaticFilters:function(b){if((b=b.tags)&&0!==b.length){var a=[];b.forEach(function(d){a.push(r[d]?r[d]:d)});return a}},getBoundaryLayersSection:function(b){return{name:r.boundaryLayers,baseQuery:"("+b.portal.EsriBoundaryLayersGroupQuery.split("AND")[1].trim()+')-type:"Attachment" -tags:"mature support"',filters:this._getFilters(b.isPortal),
addToFront:!1,disableSubResources:!1}},getNumberOfPages:function(){return 16},_getLAALBaseQuery:function(b,a,d){d=['typekeywords:"Analysis Ready"'];(a||a.user||!a.user.demographics)&&d.push('-typekeywords:"Requires Credits"');d.push('-type:"Attachment" -tags:"mature support"');d.push(this._queryTagsForLivingAtlasItemBrowser(b));return d.join(" ")},_queryTagsForLivingAtlasItemBrowser:function(b){b=b.tags;var a=[];if(!b||0===b.length)return"";if(1===b.length)return"tags: ("+b[0]+")";b.forEach(function(d){a.push(d)});
return"tags: ("+a.join(" OR ")+")"},_getAnalysisGroupQuery:function(b,a){return this._isCustomAnalysisQuery(b,a)},_getDefaultQueryString:function(b){var a='title:"Living Atlas Analysis Layers" AND owner:esri';b&&(a='title:"Living Atlas Analysis Layers" AND owner:esri_livingatlas');return a},_isCustomAnalysisQuery:function(b,a){return b&&b.analysisLayersGroupQuery&&b.analysisLayersGroupQuery!==this._getDefaultQueryString(a)?b.analysisLayersGroupQuery:!1},_getStaticLAALSchema:function(b,a){return[{title:"categories",
categories:[{title:"boundaries and places",categories:[{title:"boundaries",categories:[],displayName:r.boundaries},{title:"places",categories:[],displayName:r.places}],displayName:r.boundariesAndPlaces},{title:"hexbins",categories:[],displayName:r.hexbins},{title:"transportation",categories:[],displayName:r.transportation}]}]},_getFilters:function(b){return["tags"]}};k("extend-esri")&&H.setObject("dijit.analysis.mixins.browselayers.configs.Common",l,p);return l})},"esri/dijit/analysis/mixins/FilterAndSelection":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has dojo/dom-construct dojo/dom-class ../../../kernel dojo/aspect ../components/FilterAndSelection/FilterAndSelection".split(" "),
function(H,k,p,r,m,l,b,a,d,f){H=H([],{showFilterAndSelection:!1,filterAndSelections:[],aspectsForFilters:[],_updateJobFilterAndSelection:function(e){this.showFilterAndSelection&&this.filterObjects&&this.filterObjects.forEach(function(h){var c=e[h.layer]||e[h.jobParamLayer],g=this.filterAndSelections[h.layer];if((c="string"===typeof c?r.fromJson(c):c)&&g){var n=g.get("inputQuery");n&&(c.filter=c.filter?c.filter+" AND "+n:n,e[h.layer]=r.toJson(c),e[h.jobParamLayer]&&(e[h.jobParamLayer]=r.toJson(c)),
g.get("expression")&&(e[h.expressionObj]=r.toJson(g.get("expression"))))}}.bind(this));return e},clearFilterAndSelection:function(){p.forEach(this.aspectsForFilters,function(e){e.remove()});p.forEach(Object.keys(this.filterAndSelections),function(e){this.filterAndSelections[e].clear()},this)},_createFilterAndSelections:function(){this.filterAndSelections={};this.showFilterAndSelection&&p.forEach(this.filterObjects,function(e){this.filterAndSelections[e.layer]=this._createFilterAndSelection(e)},this)},
_createFilterAndSelection:function(e){b.add(e.select.domNode,"with-filter");var h=e.layerForTool||e.layer,c={map:this.map,layer:this[e.layer]||this[e.layerForTool]||e.layers&&e.layers[e.select.get("value")],expression:this[e.expressionObj]};c=this.constructDomForFilter(c,e.select);this.aspectsForFilters.push(d.after(e.select,"onChange",function(g){0<=parseInt(g)&&(g=e.layers&&e.layers[g]||this[h],this.filterAndSelections[e.layer]&&this.filterAndSelections[e.layer].set("layer",g))}.bind(this),!0));
this.aspectsForFilters.push(d.after(this,"_onClose",this.clearFilterAndSelection.bind(this)));return c},constructDomForFilter:function(e,h){h=h.domNode.parentNode;var c=l.create("div",null,h);e.msgContainer=l.create("div",{class:"esriLeadingMargin1 paddingTop1"},h);return new f(e,c)}});m("extend-esri")&&k.setObject("dijit.analysis.mixins.FilterAndSelection.FilterAndSelection",H,a);return H})},"esri/dijit/analysis/components/FilterAndSelection/FilterAndSelection":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Color dojo/_base/connect dojo/has dojo/string dojo/dom-attr dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/Button dijit/form/ToggleButton dijit/Dialog ../../../../kernel ../../../../lang ../../../../layers/FeatureLayer ../../ExpressionForm ../../../../geometry/Extent ../../../../geometry/ScreenPoint ../../../../symbols/CartographicLineSymbol ../../../../symbols/SimpleMarkerSymbol ../../../../symbols/SimpleLineSymbol ../../../../symbols/SimpleFillSymbol ../../../../tasks/query ../../ItemTypes ../../AnalysisRegistry dojo/i18n!../../../../nls/jsapi dojo/text!./FilterAndSelection.html".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x,w,A,z,G,I){H=H([d,f,e],{declaredClass:"esri.dijit.analysis.components.FilterAndSelection.FilterAndSelection",templateString:I,_pbConnects:[],i18n:{},map:{},layer:{},msgContainer:null,expression:{},inputQuery:"",postMixInProperties:function(){this.inherited(arguments);k.mixin(this.i18n,G.expressionGrid);k.mixin(this.i18n,G.common)},destroy:function(){this.inherited(arguments);p.forEach(this._pbConnects,m.disconnect);delete this._pbConnects},
postCreate:function(){this.inherited(arguments);this.own(this._expressionForm.on("add-expression",k.hitch(this,this._handleExpressionFormAdd)));this.own(this._expressionForm.on("cancel-expression",k.hitch(this,this._handleExpressionFormCancel)))},startup:function(){},_handleSelectionButtonClick:function(K){K&&!this._mapClickHandle?(this._mapClickHandle=this.map.on("click",k.hitch(this,this._handleMapClick)),this.emit("selecttool-activate",{}),this.set("expression",void 0)):(this._mapClickHandle&&
(this._mapClickHandle.remove(),this._mapClickHandle=null),this.emit("selecttool-deactivate",{}))},_setInputQueryForRerun:function(){var K=this.layer&&(this.layer.type===A.BDATAFEATURE||this.layer.type===A.BTABLE);this.layer&&this.layer.filter&&-1!==this.layer.filter.indexOf(" AND ")?(this.set("inputQuery",this.layer.filter.substring(this.layer.filter.indexOf(" AND ")+5)),K||this.layer.setDefinitionExpression(this.layer.filter.substring(0,this.layer.filter.indexOf(" AND ")))):this.layer&&this.layer.filter&&
-1===this.layer.filter.indexOf(" AND ")&&(this.set("inputQuery",this.layer.filter),K||this.layer.setDefinitionExpression(null));this.inputQuery===(this.expression&&this.expression.expression.where)?a.set(this.msgContainer,"innerHTML",this.expression.expression._attributeText):0===this._getObjectIds().length&&a.set(this.msgContainer,"innerHTML","")},_handleQueryButtonClick:function(){this._expDialog.set("title",this.i18n.queryLabel);this._selectBtn.set("checked",!1);this._isAttrFlag=!0;this._expressionForm.set("showUnique",
!(this.layer&&(this.layer.type===A.BDATAFEATURE||this.layer.type===A.TABLE||this.layer.type===A.BTABLE)));this.expression?(this._expressionForm.set("action","edit"),this._expressionForm.set("expression",this.expression.expression)):this._expressionForm.set("action","add");this._expDialog.show()},_handleExpressionFormAdd:function(K){this.selectionLayer&&this.selectionLayer.clearSelection();if("add"===K.action||"edit"===K.action)this.set("expression",K),this.set("inputQuery",K.expression&&K.expression.where||
""),K=this._getQuery(),this.selectionLayer&&this.selectionLayer.selectFeatures(K,v.SELECTION_ADD);this._expDialog.hide()},_handleExpressionFormCancel:function(){this._expDialog.hide()},clear:function(){this.selectionLayer&&(this.selectionLayer.clearSelection(),this.map.removeLayer(this.selectionLayer),this.selectionLayer=null,this.set("inputQuery",""));this._mapClickHandle&&(this._mapClickHandle.remove(),delete this._mapClickHandle)},_handleMapClick:function(K){var R;!this._isAttrFlag&&this.expression&&
this.selectionLayer.clearSelection();var U=6;if((R=this.layer.renderer)&&"esri.renderer.SimpleRenderer"===R.declaredClass){var ba=R.symbol;ba.xoffset&&(U=Math.max(U,Math.abs(ba.xoffset)));ba.yoffset&&(U=Math.max(U,Math.abs(ba.yoffset)))}else!R||"esri.renderer.UniqueValueRenderer"!==R.declaredClass&&"esri.renderer.ClassBreaksRenderer"!==R.declaredClass||p.forEach(R.infos,function(ca){ba=ca.symbol;ba.xoffset&&(U=Math.max(U,Math.abs(ba.xoffset)));ba.yoffset&&(U=Math.max(U,Math.abs(ba.yoffset)))});R=
K.screenPoint;K=this.map.toMap(new y(R.x-U,R.y+U));R=this.map.toMap(new y(R.x+U,R.y-U));K=new t(K.x,K.y,R.x,R.y,this.map.spatialReference);K=this._getQuery({extent:K});this.layer.getDefinitionExpression&&(K.where=this.layer.getDefinitionExpression());this.layer.queryFeatures(K).then(k.hitch(this,function(ca){if(ca){var da=[],ja=[],ea=[];this.selectionLayer&&0<this.selectionLayer.getSelectedFeatures().length&&(ja=p.map(this.selectionLayer.getSelectedFeatures(),function(L){return L.attributes[this.selectionLayer.objectIdField]},
this));p.forEach(ca.features,function(L){0===ja.length?da.push(L.attributes[this.selectionLayer.objectIdField]):-1===p.indexOf(ja,L.attributes[this.selectionLayer.objectIdField])?da.push(L.attributes[this.selectionLayer.objectIdField]):ea.push(L.attributes[this.selectionLayer.objectIdField])},this);0<da.length&&(ca=this._getQuery({oids:da}),this.selectionLayer.selectFeatures(ca,v.SELECTION_ADD));0<ea.length&&(ca=this._getQuery({oids:ea}),this.selectionLayer.selectFeatures(ca,v.SELECTION_SUBTRACT))}}))},
_handleLayerSelectionComplete:function(){var K=this.selectionLayer.getSelectedFeatures();if(!this._isAttrFlag&&0<K.length){var R="";p.forEach(K,function(U){R+=this.selectionLayer.objectIdField+" \x3d "+U.attributes[this.selectionLayer.objectIdField]+" OR ";return U.attributes[this.selectionLayer.objectIdField]},this);R=R.substring(0,R.lastIndexOf(" OR "));this.set("inputQuery",R);a.set(this.msgContainer,"innerHTML",b.substitute(this.i18n.selectedFeaturesLabel,{total:K.length}))}this._isAttrFlag||
0!==K.length||(a.set(this.msgContainer,"innerHTML",""),this.set("inputQuery",""))},_onSelectionLayerLoad:function(K,R){R.setScaleRange(K.minScale,K.maxScale);this._connect(K,"onScaleRangeChange",k.hitch(this,function(U,ba){U.setScaleRange(ba.minScale,ba.maxScale)},R,K));this.map.addLayer(R);R.geometryType===z.GeometryTypes.Point||"esriGeometryMultPoint"===R.geometryType?(K=new B,K.setStyle(B.STYLE_TARGET),K._setDim(16,16,0),K.setOutline(new D(E.STYLE_SOLID,new r([0,255,255]),2,D.CAP_ROUND,D.JOIN_ROUND)),
K.setColor(new r([0,0,0,0])),R.setSelectionSymbol(K)):R.geometryType===z.GeometryTypes.Line?R.setSelectionSymbol(new E(E.STYLE_SOLID,new r([0,255,255]),2)):R.geometryType===z.GeometryTypes.Polygon&&R.setSelectionSymbol(new x(x.STYLE_NULL,new E(E.STYLE_SOLID,new r([0,255,255]),2),new r([0,0,0,0])));this.selectionLayer&&this.inputQuery&&(this.inputQuery.match(/ OR /g)||!this.expression?this._isAttrFlag=!1:(this._isAttrFlag=!0,this.set("expression",{action:"edit",expression:this.expression.expression})),
R=this._getQuery(),this.selectionLayer.selectFeatures(R,v.SELECTION_ADD))},_isLayerPresentInMap:function(K){var R=!1;this.map.getLayersVisibleAtScale().forEach(function(U){R=R||U.url===K.url});return R},_getObjectIds:function(){var K=this.get("inputQuery");K=K?K.split(" OR "):[];K=p.map(K,function(R){return R.split(" \x3d ")[1]});a.set(this.msgContainer,"innerHTML",b.substitute(this.i18n.selectedFeaturesLabel,{total:K.length}));return K},_getQuery:function(K){var R=new w;R.returnGeometry=!0;if(!K)return this._isAttrFlag?
R.where=this.get("inputQuery"):R.objectIds=this._getObjectIds(),R;K.extent&&(R.geometry=K.extent);K.oids&&(R.objectIds=K.oids);return R},_setMapAttr:function(K){this.map=K},_getMapAttr:function(){return this.map},_getInputQueryAttr:function(){return this.inputQuery},_setInputQueryAttr:function(K){this.inputQuery=K},_getLayerAttr:function(){return this.selectionLayer},_setLayerAttr:function(K){if(K&&K.url){var R=this.layer&&(this.layer.type===A.BDATAFEATURE||this.layer.type===A.BTABLE||this.layer.type===
A.TABLE);this.layer=K;this.set("inputQuery","");this.selectionLayer&&this.clear();this._selectBtn.set("checked",!1);this._expressionForm.set("showUnique",!R);this._expressionForm.set("showFirstRow",!1);this._expressionForm.set("firstOperands",[K]);this._expressionForm.set("inputOperands",[K]);this._expressionForm.set("selectedFirstOperand",K);this._expressionForm.init();this._queryBtn.set("disabled",!1);this._setInputQueryForRerun();if(this._isLayerPresentInMap(K))if(this._selectBtn.set("disabled",
!1),this.selectionLayer=new v(K.url&&!K._collection?K.url:this.layer.toJson(),{outFields:["*"],mode:K.url&&!K._collection?v.MODE_SELECTION:v.MODE_SNAPSHOT}),this.selectionLayer.setRenderer(null),this.selectionLayer.on("selection-complete",k.hitch(this,this._handleLayerSelectionComplete)),this.selectionLayer.loaded)this._onSelectionLayerLoad(K,this.selectionLayer);else this.selectionLayer.on("load",k.hitch(this,this._onSelectionLayerLoad,K,this.selectionLayer));else this._selectBtn.set("disabled",
!0)}else this._selectBtn.set("disabled",!0),this._queryBtn.set("disabled",!0)},_setExpressionAttr:function(K){K?(this._isAttrFlag=!0,this.expression=K,this.expression.expression&&(a.set(this.msgContainer,"innerHTML",this.expression.expression._attributeText),this.set("inputQuery",this.expression.expression.where))):(this._isAttrFlag=!1,this.expression=void 0)},_getExpressionAttr:function(){return this.expression},_connect:function(K,R,U){this._pbConnects.push(m.connect(K,R,U))}});l("extend-esri")&&
k.setObject("dijit.analysis.components.FilterAndSelection.FilterAndSelection",H,n);return H})},"esri/dijit/analysis/ExpressionForm":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/fx dojo/has dojo/json dojo/string dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/_base/event dojo/Evented dojo/fx/easing dojo/number dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/Button dijit/form/CheckBox dijit/form/Form dijit/form/Select dijit/form/TextBox dijit/form/ValidationTextBox dijit/layout/ContentPane dijit/form/FilteringSelect dijit/Dialog dijit/Tooltip ../../kernel ../../lang ./utils ../SingleFilter dojo/i18n!../../nls/jsapi dojo/text!./templates/ExpressionForm.html".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x,w,A,z,G,I,K,R,U,ba,ca,da,ja,ea,L,O,S,T){H=k([y,D,B,E,x,v],{declaredClass:"esri.dijit.analysis.ExpressionForm",templateString:T,widgetsInTemplate:!0,firstOperands:null,defaultUnits:"english",showFirstRow:!0,showUnique:!0,operator:null,isServerAdvanceLicensed:!0,allLayersOpertors:["intersects","notIntersects","withinDistance","notWithinDistance","nearest"],constructor:function(J){J.containerNode&&(this.container=J.containerNode);this._setClasses(J)},
_setClasses:function(J){this._addBtnClass=J.primaryActionButttonClass||"esriAnalysisSubmitButton"},destroy:function(){this.inherited(arguments);r.forEach(this._pbConnects,m.disconnect);delete this._pbConnects},postMixInProperties:function(){this.inherited(arguments);this.i18n={};p.mixin(this.i18n,S.common);p.mixin(this.i18n,S.expressionGrid);p.mixin(this.i18n,S.expressionForm)},postCreate:function(){this.inherited(arguments);this.attributeChangeHandler=m.subscribe("filter-expression-change",p.hitch(this,
this._handleAttributeFilterChange));this._distanceInput.set("validator",p.hitch(this,this._validateDistance));this.set("action","add");e.set(this._firstRow,"display",this.showFirstRow?"":"none");this.isServerAdvanceLicensed||this._operatorSelect.removeOption("nearest");this.own(this.watch("showUnique",p.hitch(this,function(J,N,C){this._attributeFilter&&this._attributeFilter.set("showUnique",C)})))},init:function(){this.isServerAdvanceLicensed||this._operatorSelect.removeOption("nearest");this.showReadyToUseLayers&&
this.owningWidget&&!this._browseTitle&&(this._browseTitle=L._isCustomAnalysisQuery(this.owningWidget)?this.i18n.browseAnalysisLayers:this.i18n.browseAnalysisTitle);if(this._firstOperandSelect&&this.firstOperands&&this.inputOperands){this._firstOperandSelect.getOptions()&&this._firstOperandSelect.removeOption(this._firstOperandSelect.getOptions());var J,N,C=this.inputOperands.length,P=this.firstOperands.length,Q=[];for(J=0;J<C;J+=1)for(N=0;N<P;N+=1)ea.isDefined(this.inputOperands[J].id)&&ea.isDefined(this.firstOperands[N].id)&&
this.inputOperands[J].id===this.firstOperands[N].id?Q[this.firstOperands[N].id]=J.toString():ea.isDefined(this.inputOperands[J].name)&&ea.isDefined(this.firstOperands[N].name)&&this.inputOperands[J].name===this.firstOperands[N].name&&(Q[this.firstOperands[N].name]=J.toString());r.forEach(this.firstOperands,function(Y,fa){ea.isDefined(Y)&&this._firstOperandSelect.addOption({value:Q[Y.id||Y.name],label:Y.name})},this);this.selectedFirstOperand&&(ea.isDefined(this.selectedFirstOperand.id)||(this.selectedFirstOperand.id=
this.selectedFirstOperand.name),this._firstOperandSelect.set("value",Q[this.selectedFirstOperand.id]));(this.get("showReadyToUseLayers")||this.get("showReadyLayersForFirst"))&&this._firstOperandSelect.addOption({type:"separator",value:""});this.get("showReadyToUseLayers")&&this.get("showReadyLayersForFirst")&&this._firstOperandSelect.addOption({value:"browse",label:this._browseTitle});this.get("showBrowseLayers")&&this.get("showReadyLayersForFirst")&&this._firstOperandSelect.addOption({value:"browselayers",
label:this.i18n.browseLayers});1===C&&!this.get("showReadyToUseLayers")&&!this.get("showBrowseLayers")&&this._operatorSelect&&this._operatorSelect.getOptions()&&(this._operatorSelect.removeOption(this._operatorSelect.getOptions()),this._operatorSelect.addOption({value:"where",label:this.i18n.where}))}"add"===this.get("action")&&(this._operatorSelect.set("value","where"),this._handleOperatorChange("where"),this._distanceInput.set("value",""),"metric"===this.defaultUnits?this._distanceUnitsSelect.set("value",
"Kilometers"):this._distanceUnitsSelect.set("value","Miles"))},startup:function(){},clear:function(){this.init()},_validateDistance:function(J){var N=this._operatorSelect.get("value");return-1===r.indexOf(["withinDistance","notWithinDistance"],N)?!0:(J=t.parse(J))&&0<parseFloat(J,10)&&Infinity>parseFloat(J,10)},_handleAttributeFilterChange:function(){if(this._attributeFilter){var J=this._attributeFilter.toJson();J=this._attributeFilter.builtSingleFilterString(J);J.whereClause?this._addBtn.set("disabled",
!1):this._addBtn.set("disabled",!0)}},_handleSecondOperandChange:function(J){if("browse"===J||"browselayers"===J)this.owningWidget.layersSelect=this._secondOperandSelect,this.owningWidget.showReadyToUseLayersDialog(!1,J)},_handleFirstOperandChange:function(J){"browse"!==J&&"browselayers"!==J||!this.get("showReadyLayersForFirst")?this._handleOperatorChange("where"):(this.owningWidget.layersSelect=this._firstOperandSelect,this.owningWidget.showReadyToUseLayersDialog(!0,J))},_handleDistanceInputChange:function(J){this._addBtn.set("disabled",
!this._distanceInput.validate())},_handleOperatorChange:function(J){var N=this.get("operator");this.set("operator",J);-1===r.indexOf(["where","withinDistance","notWithinDistance"],J)?!0!==this._checkBetweenPairs(J,N)&&this._buildSpatialExpression(J,N):"where"===J?this._buildAttributeExpression(J):-1!==r.indexOf(["withinDistance","notWithinDistance"],J)&&this._buildDistanceExpression(J,N)},_checkBetweenPairs:function(J,N){return r.some([["contains","notContains"],["within","notWithin"]],function(C){if(J===
C[0]&&N===C[1]||J===C[1]&&N===C[0])return!0})},_isValidSecondOperand:function(J,N,C){var P=!1;"contains"===J||"notContains"===J?"esriGeometryPoint"!==N&&"esriGeometryMultipoint"!==N||"esriGeometryPoint"!==C&&"esriGeometryMultipoint"!==C?"esriGeometryPolyline"!==N||"esriGeometryPoint"!==C&&"esriGeometryPolyline"!==C&&"esriGeometryMultipoint"!==C?"esriGeometryPolygon"===N&&(P=!0):P=!0:P=!0:"within"===J||"notWithin"===J?"esriGeometryPoint"===N||"esriGeometryMultipoint"===N?P=!0:"esriGeometryPolyline"!==
N||"esriGeometryPolygon"!==C&&"esriGeometryPolyline"!==C?"esriGeometryPolygon"===N&&"esriGeometryPolygon"===C&&(P=!0):P=!0:P=!0;return P},_isValidFirstOperand:function(J){var N=!0;J&&J.fields?J.fields&&1===J.fields.length&&"esriFieldTypeOID"===J.fields[0].type&&(this._showMessages(f.substitute(this.i18n.inValidAttributeFilterMessage,{layername:J.name})),N=!1):N=!1;return N},_addBrowseAndBrowseLayerOptions:function(J){if(!J)return!1;(this.get("showReadyToUseLayers")||this.get("showBrowseLayers"))&&
J.addOption({type:"separator",value:""});this.get("showReadyToUseLayers")&&J.addOption({value:"browse",label:this._browseTitle});this.get("showBrowseLayers")&&J.addOption({value:"browselayers",label:this.i18n.browseLayers});return!0},_buildSpatialExpression:function(J,N){var C=parseInt(this._firstOperandSelect.get("value"),10);var P=this.inputOperands[C].geometryType;this._addBtn.set("disabled",!1);this._distanceInput.set("required",!1);e.set(this._attrFilterDiv,"display","none");e.set(this._secondOperandSelect.domNode,
"display","");this._secondOperandSelect&&(-1===this.allLayersOpertors.indexOf(N)&&(this._secondOperandSelect.getOptions()&&this._secondOperandSelect.removeOption(this._secondOperandSelect.getOptions()),r.forEach(this.inputOperands,function(Q,Y){Y.toString()!==this._firstOperandSelect.get("value")&&this._isValidSecondOperand(J,P,Q.geometryType)&&(this._secondOperandSelect.addOption({value:Y.toString(),label:Q.name}),""!==this._secondOperandSelect.get("value")&&this._secondOperandSelect.get("value")||
this._secondOperandSelect.set("value",Y.toString()))},this),this._addBrowseAndBrowseLayerOptions(this._secondOperandSelect)),e.set(this._secondRow,"display",""),e.set(this._secondExpressionDiv,"display","none"),e.set(this._secondOperandSelect,{display:"",width:"75%"}))},_buildAttributeExpression:function(J){this._distanceInput.set("required",!1);e.set(this._secondExpressionDiv,"display","none");this._secondOperandSelect&&this._secondOperandSelect.getOptions()&&this._secondOperandSelect.removeOption(this._secondOperandSelect.getOptions());
e.set(this._secondOperandSelect.domNode,"display","none");J=parseInt(this._firstOperandSelect.get("value"),10);J=this.inputOperands[J];this._isValidFirstOperand(J)?(this._addBtn.set("disabled",!0),e.set(this._secondRow,"display",""),e.set(this._attrFilterDiv,"display",""),this._attributeFilter&&(this._attributeFilter.init({mapLayer:J,version:J.version,fields:J.fields,allowAllDateTypes:!0,part:"edit"===this.get("action")&&this.expression&&this.expression._attributeExprObj?this.expression._attributeExprObj:
null}),this._attributeFilter.set("showUnique",this.showUnique)),this._attributeFilter||(this._attributeFilter=new O({"class":"filterSegment",mapLayer:J,version:J.version,fields:J.fields,part:"edit"===this.get("action")&&this.expression&&this.expression._attributeExprObj?this.expression._attributeExprObj:null,enableEvents:!0,isEnableInteractiveFilter:!1,allowAllDateTypes:!0,showUnique:this.showUnique},c.create("div",{},this._attrFilterDiv)),this._attributeFilter.fillFieldsList(this._attributeFilter.fieldsStore))):
(e.set(this._secondRow,"display","none"),e.set(this._attrFilterDiv,"display","none"),this._addBtn.set("disabled",!0))},_buildDistanceExpression:function(J,N){this._addBtn.set("disabled",!this._distanceInput.validate());this._distanceInput.set("required",!0);e.set(this._secondRow,"display","");e.set(this._secondOperandSelect.domNode,"display","");e.set(this._secondExpressionDiv,{display:"",width:"75%"});e.set(this._secondOperandSelect,{display:"",width:"75%"});e.set(this._attrFilterDiv,"display","none");
this._secondOperandSelect&&this._secondOperandSelect.getOptions()&&-1===this.allLayersOpertors.indexOf(N)&&(this._secondOperandSelect.removeOption(this._secondOperandSelect.getOptions()),r.forEach(this.inputOperands,function(C,P){P.toString()!==this._firstOperandSelect.get("value")&&this._secondOperandSelect.addOption({value:P.toString(),label:C.name})},this),this._addBrowseAndBrowseLayerOptions(this._secondOperandSelect))},_handleAddButtonClick:function(J){q.stop(J);this._expressionForm&&!this._expressionForm.validate()?
this.emit("cancel-expression",{}):(this.set("expression"),this.emit("add-expression",{expression:this.get("expression"),text:this.get("text"),displayText:this.get("displayText"),action:this.get("action")}))},_handleCloseButtonClick:function(J){q.stop(J);this.emit("cancel-expression",{})},_setInputOperandsAttr:function(J){this.inputOperands=J},_getInputOperandsAttr:function(){return this.inputOperands},_setFirstOperandsAttr:function(J){this.firstOperands=J},_getFirstOperandsAttr:function(J){return this.firstOperands},
_setSelectedFirstOperandAttr:function(J){this.selectedFirstOperand=J},_getExpressionAttr:function(J){return this.expression},_setExpressionAttr:function(J){var N=!1;if(J)this._operatorSelect&&(this._firstOperandSelect.set("value",J.layer),this._operatorSelect.set("value",J.spatialRel?J.spatialRel:"where"),"where"===this._operatorSelect.get("value")?N=!0:(-1!==r.indexOf(["withinDistance","notWithinDistance"],this._operatorSelect.get("value"))&&(this._distanceInput.set("value",J.distance),this._distanceUnitsSelect.set("value",
J.units)),setTimeout(p.hitch(this,function(){this._secondOperandSelect.set("value",J.selectingLayer)}),100)));else if(J={},this._operatorSelect)if(J.layer=parseInt(this._firstOperandSelect.get("value"),10),"where"===this._operatorSelect.get("value")){var C=this._attributeFilter.toJson();var P=this._attributeFilter.builtSingleFilterString(C);J._attributeFilter=P;J._attributeExprObj=C;J._attributeText=this._attributeFilter.buildFriendlyTextExpr(C);J.where=P.whereClause}else J.selectingLayer=parseInt(this._secondOperandSelect.get("value"),
10),J.spatialRel=this._operatorSelect.get("value"),-1!==r.indexOf(["withinDistance","notWithinDistance"],this._operatorSelect.get("value"))&&(J.distance=this._distanceInput.get("value"),J.units=this._distanceUnitsSelect.get("value"));this.expression=J;N&&this._handleOperatorChange("where")},_showMessages:function(J){h.set(this._bodyNode,"innerHTML",J);b.fadeIn({node:this._errorMessagePane,easing:u.quadIn,onEnd:p.hitch(this,function(){e.set(this._errorMessagePane,{display:""})})}).play()},_handleCloseMsg:function(J){J&&
J.preventDefault();b.fadeOut({node:this._errorMessagePane,easing:u.quadOut,onEnd:p.hitch(this,function(){e.set(this._errorMessagePane,{display:"none"})})}).play()},_setActionAttr:function(J){this.action=J},_getActionAttr:function(){return this.action},_setTextAttr:function(J){this.text=J},_getTextAttr:function(){var J="";this.expression&&(J=this.inputOperands[this.expression.layer].name);this.expression.spatialRel?(J+=" "+this.i18n[this.expression.spatialRel],this.expression.distance&&(J+=" "+this.expression.distance+
" "+this.expression.units+" "+this.i18n.from),J+=" "+this.inputOperands[this.expression.selectingLayer].name):J+=" "+this.i18n.whereLabel+" "+this.expression._attributeText;return J},_getDisplayTextAttr:function(){var J="";if(this.expression){var N=this.inputOperands[this.expression.layer].name;J+=this.shortenString(N)}this.expression.spatialRel?(J+=" \x3clabel style\x3d'font-style: italic;'\x3e"+this.i18n[this.expression.spatialRel],this.expression.distance&&(J+=" "+this.expression.distance+" "+
this.expression.units+" "+this.i18n.from),N=this.inputOperands[this.expression.selectingLayer].name,J=J+"\x3c/label\x3e "+this.shortenString(N)):J+=" \x3clabel style\x3d'font-style: italic;'\x3e"+this.i18n.whereLabel+" "+this.expression._attributeText+"\x3c/label";return J+"\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e"},shortenString:function(J){return"\x3clabel style\x3d'overflow: hidden;text-overflow: ellipsis'\x3e"+J+"\x3c/label\x3e\x3c/td\x3e"},_setPrimaryActionButttonClassAttr:function(J){this.primaryActionButttonClass=
J},_getPrimaryActionButttonClassAttr:function(){return this.primaryActionButttonClass},_setShowFirstRowAttr:function(J){this.showFirstRow=J},_getShowFirstRowAttr:function(){return this.showFirstRow},_setShowReadyToUseLayersAttr:function(J){this._set("showReadyToUseLayers",J)},_setShowReadyLayersForFirstAttr:function(J){this._set("showReadyLayersForFirst",J)},_setShowBrowseLayersAttr:function(J){this._set("showBrowseLayers",J)},_setOwningWidgetAttr:function(J){this._set("owningWidget",J)}});a("extend-esri")&&
p.setObject("dijit.analysis.ExpressionForm",H,ja);return H})},"esri/dijit/analysis/CreditEstimator":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/_base/kernel dojo/has dojo/dom-construct dojo/dom-class dojo/dom-attr dojo/dom-style dojo/string dojo/number dijit/_WidgetBase dijit/_TemplatedMixin dijit/_OnDijitClickMixin dijit/_FocusMixin ../../kernel ../../lang dojo/i18n!../../nls/jsapi dojo/text!./templates/CreditEstimator.html".split(" "),function(H,
k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D){H=k([g,n,q,v],{declaredClass:"esri.dijit.analysis.CreditEstimator",i18n:null,templateString:D,postMixInProperties:function(){this.inherited(arguments);this.i18n={};p.mixin(this.i18n,y.common);p.mixin(this.i18n,y.analysisMsgCodes);p.mixin(this.i18n,y.creditEstimator)},postCreate:function(){this.inherited(arguments)},_setContentAttr:function(B){var E="";B.code&&!B.messageCode&&(B.messageCode=B.code);B.messageCode?(E=t.isDefined(this.i18n[B.messageCode])?this.i18n[B.messageCode]:
B.message,E=t.isDefined(B.params)?h.substitute(E,B.params):E,f.set(this._messageDiv,"display","block"),f.set(this._messageDiv,"innerHTML",E),e.set(this._table,"display","none")):(e.set(this._table,"display","table"),f.set(this._messageDiv,"display",t.isDefined(B.infoMessage)?"block":"none"),f.set(this._messageDiv,"innerHTML",t.isDefined(B.infoMessage)?B.infoMessage:""),t.isDefined(B.infoMessage)&&e.set(this._messageDiv,"margin-top","1em"),E=t.isDefined(B.cost)?B.cost:B.maximumCost,B.maximumCost&&
f.set(this._costLabelNode,"innerHTML",this.i18n.maxCreditsLabel),B.totalRecords?f.set(this._totalRecordsNode,"innerHTML",c.format(B.totalRecords,{locale:l.locale})):e.set(this._totalRecordsLabelNode,"display","none"),f.set(this._creditsReqNode,"innerHTML",c.format(E,{locale:l.locale})))},_setErrorContentAttr:function(B){e.set(this._table,"display","none");f.set(this._messageDiv,"innerHTML",B)}});b("extend-esri")&&p.setObject("dijit.analysis.CreditEstimator",H,u);return H})},"widgets/Visibility/js/geometryUtils":function(){define("esri/geometry/Point esri/geometry/Polyline esri/geometry/webMercatorUtils dojo/Deferred dojo/_base/array dojo/_base/lang esri/SpatialReference".split(" "),
function(H,k,p,r,m,l,b){var a={getProjectedGeometry:function(d,f,e){var h=new r;if(p.canProject(d,f)){var c=p.project(d,f);h.resolve(c)}else e.project([d],f,function(g){c=g[0];h.resolve(c)});return h.promise},getDestinationPoint:function(d,f,e){var h=d.x*Math.PI/180,c=f*Math.PI/180;f=Math.sin(c);c=Math.cos(c);var g=.9966471893352243*Math.tan(d.y*Math.PI/180);d=1/Math.sqrt(1+g*g);var n=g*d,q=Math.atan2(g,c);g=d*f;var v=1-g*g,u=2.7233160610984375E11*v/4.040829998465916E13,t=1+u/16384*(4096+u*(-768+
u*(320-175*u))),y=u/1024*(256+u*(-128+u*(74-47*u))),D=e/(6356752.314245*t),B=0;do{u=Math.cos(2*q+D);var E=Math.sin(D);var x=Math.cos(D);var w=y*E*(u+y/4*(x*(-1+2*u*u)-y/6*u*(-3+4*E*E)*(-3+4*u*u)));var A=D;D=e/(6356752.314245*t)+w}while(1E-12<Math.abs(D-A)&&200>++B);if(200<=B)return console.log("Formula failed to converge"),null;e=n*E-d*x*c;e=Math.atan2(n*x+d*E*c,.9966471893352243*Math.sqrt(g*g+e*e));v=2.0955066654848088E-4*v*(4+.003352810664775694*(4-3*v));h=(h+(Math.atan2(E*f,d*x-n*E*c)-.003352810664775694*
(1-v)*g*(D+v*E*(u+v*x*(-1+2*u*u))))+3*Math.PI)%(2*Math.PI)-Math.PI;e=180*e/Math.PI;h=180*h/Math.PI;return new H(h,e,new b(4326))},getInverseCalculations:function(d,f){var e=f.x*Math.PI/180-d.x*Math.PI/180,h=.9966471893352243*Math.tan(d.y*Math.PI/180);d=1/Math.sqrt(1+h*h);h*=d;var c=.9966471893352243*Math.tan(f.y*Math.PI/180);f=1/Math.sqrt(1+c*c);c*=f;var g=e,n=0;do{var q=Math.sin(g);var v=Math.cos(g);var u=f*q*f*q+(d*c-h*f*v)*(d*c-h*f*v);u=Math.sqrt(u);if(0==u)return{distance:0,initialBearing:0,finalBearing:0};
var t=h*c+d*f*v;var y=Math.atan2(u,t);var D=d*f*q/u;var B=1-D*D;var E=t-2*h*c/B;isNaN(E)&&(E=0);var x=2.0955066654848088E-4*B*(4+.003352810664775694*(4-3*B));var w=g;g=e+.003352810664775694*(1-x)*D*(y+x*u*(E+x*t*(-1+2*E*E)))}while(1E-12<Math.abs(g-w)&&200>++n);if(200<=n)return null;g=2.7233160610984375E11*B/4.040829998465916E13;n=g/1024*(256+g*(-128+g*(74-47*g)));e=Math.atan2(f*q,d*c-h*f*v);d=Math.atan2(d*q,-h*f+d*c*v);e=(e+2*Math.PI)%(2*Math.PI);d=(d+2*Math.PI)%(2*Math.PI);h=Number((6356752.314245*
(1+g/16384*(4096+g*(-768+g*(320-175*g))))*(y-n*u*(E+n/4*(t*(-1+2*E*E)-n/6*E*(-3+4*u*u)*(-3+4*E*E))))).toFixed(3));e=180*e/Math.PI;d=180*d/Math.PI;return{distance:h,initialBearing:e,finalBearing:d}},getLineBetweenPoints:function(d){var f,e=[];m.forEach(d,l.hitch(this,function(h){e.push([a.removeNegativeExponents(h.x),a.removeNegativeExponents(h.y)])}));0<e.length&&(f=new k({paths:[e],spatialReference:{wkid:4326}}));return f},getAngleBetweenPoints:function(d,f){d=a.getInverseCalculations(d,f);return null===
d?0:d.initialBearing},getDistanceBetweenPoints:function(d,f){d=a.getInverseCalculations(d,f);return null===d?0:d.distance},getPointsForArc:function(d,f,e,h){var c=[];var g=f-d;f=parseInt(g,10);0>=f&&(f=1);var n=Math.abs(g)/Math.abs(f);if(0<n)for(g=0;g<Math.abs(f)+1;g++){var q=d+n*g;(q=a.getDestinationPoint(e,q,Math.abs(h)))&&c.push(q)}return c},removeNegativeExponents:function(d){return 1<d.toString().toLowerCase().split("e-").length?0:d}};return a})},"jimu/dijit/CoordinateControl":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang jimu/utils dojo/on dojo/has dojo/query dojo/dom-attr dojo/dom-class dojo/dom-style dojo/string dojo/topic dojo/keys dojo/Deferred dojo/Evented dojo/dom dojo/dom-construct dojo/aspect jimu/BaseWidget dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/registry dijit/Tooltip dijit/TooltipDialog dijit/popup dojo/text!./templates/CoordinateControl.html esri/geometry/webMercatorUtils esri/graphic esri/geometry/Point esri/request esri/SpatialReference esri/tasks/GeometryService esri/tasks/ProjectParameters esri/toolbars/draw jimu/dijit/Message ./_CoordinateControlFormatNotation ./_CoordinateControlConfirmNotation dojo/_base/sniff dijit/form/TextBox dijit/form/Textarea dijit/form/Select dijit/InlineEditBox".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x,w,A,z,G,I,K,R,U,ba,ca,da,ja,ea){return H([t,y,D,n],{templateString:A,baseClass:"jimu-coordinate-control",parentWidget:null,input:!0,label:null,showCopyButton:!1,showFormatButton:!1,zoomScale:null,showDeleteButton:!0,showExpandButton:!0,showDrawPoint:!0,drawButtonLabel:null,drawToolTip:null,graphicsLayer:null,type:"DD",inputFromText:!0,addSign:!1,hasCustomLabel:!1,numberOfDecimals:null,postMixInProperties:function(){this.nls=window.jimuNls.coordinateControl;
this.isRenderIdForAttrs=!0},constructor:function(L){H.safeMixin(this,L);this.uid=L.id||B.getUniqueId("cc");null===this.parentWidget&&console.error("No parentWidget parameter supplied: Parameter is mandatory");null===this.label&&console.info("No label parameter supplied (optional): Coordinate Control will have no label");null===this.zoomScale&&console.info("No zoomScale parameter supplied (optional): Coordinate Control will have no zoom button");null===this.drawButtonLabel&&console.info("No drawButtonLabel parameter supplied (optional): Coordinate Control will have no draw button");
null===this.graphicsLayer&&console.info("No graphicsLayer parameter supplied: Input graphics will not be shown on map")},postCreate:function(){this._frmtdlg=new x({id:this.uid+"_formatCoordinateTooltip",content:new ja({nls:this.nls,ct:this.type}),style:"width: 400px",onClose:p.hitch(this,this.popupDidClose)});u.after(this._frmtdlg,"onShow",p.hitch(this,function(){null!==this.numberOfDecimals?this._frmtdlg.content.significantDigitTextbox.set("value",this.numberOfDecimals):this._frmtdlg.content.significantDigitTextbox.set("value",
2);this._frmtdlg.content.frmtSelect.focus()}));u.after(this._frmtdlg,"onClose",p.hitch(this,function(){this.formatButton.focus()}));this.own(m(this._frmtdlg,"keydown",p.hitch(this,function(L){L.keyCode===c.ESCAPE&&w.close(this._frmtdlg)})));"DartTheme"===this.parentWidget.appConfig.theme.name&&d.add(this._frmtdlg.domNode,"coordinateControlDialog");this.defaultFormat&&(this._frmtdlg.content.formats[this.type].defaultFormat=this.defaultFormat);this.geomsrvc=new U(this.parentWidget.appConfig.geometryService);
this.dt=new ca(this.parentWidget.map);this.initUI();this.setUIListeners()},initUI:function(){null===this.label?this.setHidden(this.coordNameContainer,!1):this.coordName.setValue(this.label);this.input?(this.zoomButton.parentNode.style.display="none",this.setHidden(this.expandButton,!0),this.setHidden(this.removeControlBtn,!0),this.coordName.set("disabled","disabled"),this.coordName.set("value",this.label+" ("+this._frmtdlg.content.ct+")"),this.showDrawPoint?(this.drawPointButton.title=this.drawButtonLabel,
null===this.drawToolTip&&(this.drawToolTip=this.nls.tooltip)):this.setHidden(this.drawPointButton,!0)):(this.coordtext.disabled=!0,this.coordtext.placeholder="",this.setHidden(this.drawPointButton,!0),this.showExpandButton||(this.setHidden(this.expandButton,!0),d.remove(this.domNode,"coordinateContainer"),d.add(this.domNode,"outputCoordinateContainer"),d.add(this.cpbtn,"outputCopyBtn"),this.coordtext.readOnly=!0),this.showDeleteButton||this.setHidden(this.removeControlBtn,!0));this.showCopyButton||
(this.setHidden(this.cpbtn,!0),d.add(this.cpbtn,"inputCopyBtn"),a.set(this.cpbtn,"title",this.nls.copyAll));this.showFormatButton||this.setHidden(this.formatButton,!0);null===this.zoomScale&&this.setHidden(this.zoomButton,!0);this.formatButton.title=this.input?this.nls.formatInput:this.nls.formatOutput;a.set(this.formatButton,"aria-label",this.formatButton.title)},setUIListeners:function(){this.input||h.subscribe("INPUTPOINTDIDCHANGE",p.hitch(this,this.mapWasClicked));h.subscribe("INPUTERROR",p.hitch(this,
this.inputError));h.subscribe("VALIDINPUT",p.hitch(this,function(L){this.toggleZoomButton(L)}));this.own(m(this.expandButton,"click",p.hitch(this,this.expandButtonWasClicked)));this.own(m(this.expandButton,"keydown",p.hitch(this,function(L){if(L.keyCode===c.ENTER||L.keyCode===c.SPACE)this.expandButtonWasClicked(L),L.preventDefault()})));this.own(m(this.zoomButton,"click",p.hitch(this,this.zoomButtonWasClicked)));this.own(m(this.zoomButton,"keydown",p.hitch(this,function(L){L.keyCode!==c.ENTER&&L.keyCode!==
c.SPACE||this.zoomButtonWasClicked(L)})));this.own(m(this.coordName,"change",p.hitch(this,this.coordNameDidChange)));this.cpbtn.addEventListener("click",p.hitch(this,this.cpBtnWasClicked));this.own(m(this.cpbtn,"keydown",p.hitch(this,function(L){L.keyCode!==c.ENTER&&L.keyCode!==c.SPACE||this.cpBtnWasClicked(L)})));this.subVal1CpBtn.addEventListener("click",p.hitch(this,this.cpSubBtnWasClicked));this.own(m(this.subVal1CpBtn,"keydown",p.hitch(this,function(L){L.keyCode!==c.ENTER&&L.keyCode!==c.SPACE||
this.cpSubBtnWasClicked(L)})));this.subVal2CpBtn.addEventListener("click",p.hitch(this,this.cpSubBtnWasClicked));this.own(m(this.subVal2CpBtn,"keydown",p.hitch(this,function(L){L.keyCode!==c.ENTER&&L.keyCode!==c.SPACE||this.cpSubBtnWasClicked(L)})));this.subVal3CpBtn.addEventListener("click",p.hitch(this,this.cpSubBtnWasClicked));this.own(m(this.subVal3CpBtn,"keydown",p.hitch(this,function(L){L.keyCode!==c.ENTER&&L.keyCode!==c.SPACE||this.cpSubBtnWasClicked(L)})));this.subVal4CpBtn.addEventListener("click",
p.hitch(this,this.cpSubBtnWasClicked));this.own(m(this.subVal4CpBtn,"keydown",p.hitch(this,function(L){L.keyCode!==c.ENTER&&L.keyCode!==c.SPACE||this.cpSubBtnWasClicked(L)})));this.own(m(this.formatButton,"click",p.hitch(this,this.formatButtonWasClicked)));this.own(m(this.formatButton,"keydown",p.hitch(this,function(L){L.keyCode!==c.ENTER&&L.keyCode!==c.SPACE||this.formatButtonWasClicked(L)})));this.own(m(this.drawPointButton,"click",p.hitch(this,this.drawPointButtonWasClicked)));this.own(m(this.drawPointButton,
"keydown",p.hitch(this,function(L){L.keyCode!==c.ENTER&&L.keyCode!==c.SPACE||this.drawPointButtonWasClicked(L)})));this.own(m(this.removeControlBtn,"keydown",p.hitch(this,function(L){L.keyCode!==c.ENTER&&L.keyCode!==c.SPACE||this.remove()})));this.own(m(this._frmtdlg.content.applyButton,"click",p.hitch(this,this.formatDialogApplyButtonClicked)));this.own(m(this._frmtdlg.content.applyButton,"keydown",p.hitch(this,function(L){L.keyCode!==c.ENTER&&L.keyCode!==c.SPACE||this.formatDialogApplyButtonClicked()})));
this.own(m(this._frmtdlg.content.cancelButton,"click",p.hitch(this,function(){w.close(this._frmtdlg)})));this.own(m(this._frmtdlg.content.cancelButton,"keydown",p.hitch(this,function(L){L.keyCode!==c.ENTER&&L.keyCode!==c.SPACE||w.close(this._frmtdlg)})));this.own(m(this.coordtext,"keydown",p.hitch(this,this.coordTextInputKeyWasPressed)));this.own(m(this.coordtext,"input",p.hitch(this,function(){this.currentClickPointDD=null;this.zoomButton.parentNode&&(this.zoomButton.parentNode.style.display="none");
this.emit("coordinates-deleted",{})})));this.own(this.geomsrvc.on("error",p.hitch(this,this.geomSrvcDidFail)));this.own(m(this.dt,"draw-complete",p.hitch(this,this.drawComplete)));this.own(u.after(this.parentWidget,"onClose",p.hitch(this,function(){this.input&&d.contains(this.drawPointButton,"drawPointBtn-active")&&this.deactivateDrawTool();this._frmtdlg&&this._frmtdlg.domNode.offsetParent&&"closed"===this.parentWidget.state&&w.close(this._frmtdlg)})));this.own(u.after(this.parentWidget,"onOpen",
p.hitch(this,function(){var L=this.parentWidget.getParent().getParent().domNode;this.own(m(L,"click",p.hitch(this,function(O){"settingBtn"!==O.target.className&&this._frmtdlg&&this._frmtdlg.domNode.offsetParent&&"active"===this.parentWidget.state&&w.close(this._frmtdlg)})))})))},formatDialogApplyButtonClicked:function(){this._frmtdlg.content.significantDigitTextbox.isValid()?(this.type=this._frmtdlg.content.ct,this.updateDisplay(),this.input?this.coordName.set("value",this.label+" ("+this._frmtdlg.content.ct+
")"):this.hasCustomLabel&&this.coordName.set("value",this.label),w.close(this._frmtdlg)):this._frmtdlg.content.significantDigitTextbox.focus()},popupDidClose:function(){if(this._frmtdlg.content.isCanceled)this.addSign!==this._frmtdlg.content.addSignChkBox.checked&&this._frmtdlg.content.addSignChkBox.setValue(this.addSign);else{this.addSign=this._frmtdlg.content.addSignChkBox.checked;this.numberOfDecimals=this._frmtdlg.content.significantDigitTextbox.value;var L=this._frmtdlg.content.ct;this.type!==
L&&(this.type=L,this.updateDisplay())}},coordNameDidChange:function(){this.hasCustomLabel=!0},cpSubBtnWasClicked:function(L){this[L.currentTarget.id.split("~")[0]].select();try{var O=document.execCommand("copy")}catch(S){O=!1}this.showToolTip(L.currentTarget.id,O?this.nls.copySuccessful:this.nls.copyFailed)},cpBtnWasClicked:function(L){L.preventDefault();if(this.input){L=B.toArray().filter(function(T){return"jimu-coordinate-control"===T.baseClass&&!T.input});var O=L.map(function(T){if(T.coordtext)return T.coordtext.value}).join("\r\n");
L=this.coordtext.value;this.coordtext.value=L+"\r\n"+O;this.selectText(this.coordtext);try{var S=document.execCommand("copy")}catch(T){S=!1}this.coordtext.value=L}else{this.selectText(this.coordtext);try{S=document.execCommand("copy")}catch(T){S=!1}}this.showToolTip(this.cpbtn.id,S?this.nls.copySuccessful:this.nls.copyFailed)},selectText:function(L){var O=document.getSelection();O.removeAllRanges();L.focus();var S=/Edge/.test(navigator.userAgent),T=!!window.MSInputMethodContext&&!!document.documentMode;
if(l("ff")||l("chrome")||l("safari"))!this.input&&this.coordtext.disabled?(this.coordtext.disabled=!1,L.select(),this.coordtext.disabled=!0):L.select();S&&L.select();T&&(S=document.createRange(),S.selectNode(L),O.addRange(S))},showToolTip:function(L,O){var S=q.byId(L);E.show(O,S);setTimeout(function(){E.hide(S)},1E3)},geomSrvcDidComplete:function(L){0>=L[0].length?(new da({message:this.nls.parseCoordinatesError}),h.publish("INPUTERROR")):(this.currentClickPointDD=this.currentClickPoint=new I(L[0][0],
L[0][1],new R({wkid:4326})),this.input&&(this.currentClickPoint.spatialReference.equals(this.parentWidget.map.spatialReference)?this.parentWidget.map.centerAt(this.currentClickPoint):this.getProjectedPoint(this.currentClickPoint).then(p.hitch(this,function(O){this.currentClickPoint=O;this.parentWidget.map.centerAt(this.currentClickPoint)}),p.hitch(this,function(O){console.error(O);h.publish("INPUTERROR")})),this.updateDisplay(),h.publish("INPUTPOINTDIDCHANGE",{mapPoint:this.currentClickPointDD,inputFromText:!0}),
h.publish("VALIDINPUT",{show:!0})))},geomSrvcDidFail:function(){new da({message:this.nls.parseCoordinatesError});h.publish("INPUTERROR")},coordTextInputKeyWasPressed:function(L){if(L.keyCode===c.ENTER){L.preventDefault();var O=this.getCleanInput(L.currentTarget.value);this.inputFromText=!1;this.getCoordinateType(O).then(p.hitch(this,function(S){if(S)if(1===S.length){var T=this.processCoordTextInput(O,S[0],!1);this.getXYNotation(T,S[0].conversionType).then(p.hitch(this,function(J){0<J[0].length?this.geomSrvcDidComplete(J):
this.geomSrvcDidFail()}))}else this.confirmNotationDialog||(this.confirmNotationDialog=new ea({title:this.nls.comfirmInputNotation,nls:this.nls,options:S,style:"width: 400px",hasSkipCheckBox:!1,theme:this.parentWidget.appConfig.theme.name})),this.confirmNotationDialog.show().then(p.hitch(this,function(){var J=k.filter(S,function(C){return C.name===this.confirmNotationDialog.comboOptions.get("value")},this),N=this.processCoordTextInput(O,J[0],!1);this.getXYNotation(N,J[0].conversionType).then(p.hitch(this,
function(C){0<C[0].length?this.geomSrvcDidComplete(C):this.geomSrvcDidFail()}))},function(){}));else new da({message:this.nls.parseCoordinatesError}),h.publish("INPUTERROR")}));a.set(this.coordtext,"value",O);this.emit("get-coordinate-complete",O);this.currentClickPoint=null}if(L.keyCode===c.BACKSPACE||L.keyCode===c.DELETE)this.currentClickPointDD=null,this.zoomButton&&this.zoomButton.parentNode&&(this.zoomButton.parentNode.style.display="none"),this.emit("coordinates-deleted",{})},getFormattedCoordinateText:function(){return this.coordtext.value},
getCurrentMapCoordinate:function(){return this.currentClickPoint},getMapCoordinateDD:function(){return this.currentClickPointDD},deactivateDrawTool:function(){this.dt.deactivate();d.remove(this.drawPointButton,"drawPointBtn-active")},processCoordTextInput:function(L,O,S){var T=O.pattern.exec(L),J=!1,N=O.name;switch(O.name){case "DD":var C=T[2];var P=T[7];var Q=T[10];var Y=T[16];var fa=T[3].replace(/[,:]/,".");var na=T[11].replace(/[,:]/,".");N="DD";break;case "DDrev":C=T[11];P=T[16];Q=T[2];Y=T[8];
fa=T[12].replace(/[,:]/,".");na=T[3].replace(/[,:]/,".");N="DD";break;case "DDM":C=T[2];P=T[7];Q=T[10];Y=T[15];fa=T[3];var la=T[4].replace(/[,:]/,".");na=T[11];var W=T[12].replace(/[,:]/,".");N="DDM";break;case "DDMrev":C=T[10];P=T[15];Q=T[2];Y=T[7];fa=T[11];la=T[12].replace(/[,:]/,".");na=T[3];W=T[4].replace(/[,:]/,".");N="DDM";break;case "DMS":C=T[2];P=T[8];Q=T[11];Y=T[17];fa=T[3];la=T[4];var aa=T[5].replace(/[,:]/,".");na=T[12];W=T[13];var oa=T[14].replace(/[,:]/,".");N="DMS";break;case "DMSrev":C=
T[11],P=T[17],Q=T[2],Y=T[8],fa=T[12],la=T[13],aa=T[14].replace(/[,:]/,"."),na=T[3],W=T[4],oa=T[5].replace(/[,:]/,"."),N="DMS"}C&&P?(J=!0,C=(new RegExp(/[Ss-]/)).test(C)?"-":"+"):C=C&&(new RegExp(/[Ss-]/)).test(C)?"-":P&&(new RegExp(/[Ss-]/)).test(P)?"-":"+";Q&&Y?(J=!0,Q=(new RegExp(/[Ww-]/)).test(Q)?"-":"+"):Q=Q&&(new RegExp(/[Ww-]/)).test(Q)?"-":Y&&(new RegExp(/[Ww-]/)).test(Y)?"-":"+";J&&(S||new da({message:this.nls.latLongWarningMessage}));switch(N){case "DD":L=C+fa+","+Q+na;break;case "DDM":L=
C+fa+" "+la+","+Q+na+" "+W;break;case "DMS":L=C+fa+" "+la+" "+aa+","+Q+na+" "+W+" "+oa}return L},zoomButtonWasClicked:function(){this.currentClickPoint&&(this.parentWidget.map.getZoom()<this.zoomScale?this.parentWidget.map.centerAt(this.currentClickPoint).then(p.hitch(this,function(){this.parentWidget.map.setScale(this.zoomScale)})):this.parentWidget.map.centerAt(this.currentClickPoint))},setHidden:function(L,O){f.set(L,"display","none");O&&v.destroy(L.parentNode)},setVisible:function(L){f.set(L,
"display","inline-flex")},remove:function(){this._frmtdlg&&this._frmtdlg.domNode.offsetParent&&w.close(this._frmtdlg);this.destroyRecursive();this.emit("removeCoordsControl")},mapWasClicked:function(L){this.currentClickPoint=L.mapPoint;this.getDDPoint(L.mapPoint).then(p.hitch(this,function(O){this.currentClickPointDDDD=this.currentClickPointDD=O;this.inputFromText=L.inputFromText?!0:!1;this.updateDisplay()}),p.hitch(this,function(O){console.error(O)}))},getDDPoint:function(L){var O=new g,S=new R(3857);
z.canProject(L,S)?O.resolve(z.webMercatorToGeographic(z.project(L,S))):(S={url:this.geomsrvc.url+"/findTransformations",content:{f:"json",inSR:JSON.stringify(L.spatialReference.toJson()),outSR:4326,extentOfInterest:JSON.stringify(this.parentWidget.map.extent)},handleAs:"json",callbackParamName:"callback"},(new K(S,{usePost:!1})).then(p.hitch(this,function(T){T=(T=T&&T.transformations?T.transformations:void 0)&&0<T.length?T[0].wkid:void 0;var J=new ba;J.outSR=new R(4326);J.geometries=[L];J.transformForward=
!0;J.transformation=T;this.geomsrvc.project(J,p.hitch(this,function(N){O.resolve(N[0])}),function(N){O.reject(N)})}),p.hitch(this,function(T){O.reject(T)})));return O},getProjectedPoint:function(L){var O=new g;if(z.canProject(L,this.parentWidget.map))O.resolve(z.geographicToWebMercator(L));else{var S={url:this.geomsrvc.url+"/findTransformations",content:{f:"json",inSR:4326,outSR:JSON.stringify(this.parentWidget.map.spatialReference.toJson()),extentOfInterest:JSON.stringify(this.parentWidget.map.extent)},
handleAs:"json",callbackParamName:"callback"};(new K(S,{usePost:!1})).then(p.hitch(this,function(T){T=(T=T&&T.transformations?T.transformations:void 0)&&0<T.length?T[0].geoTransforms[0].wkid:void 0;var J=new ba;J.outSR=new R(this.parentWidget.map.spatialReference);J.geometries=[L];J.transformForward=!0;J.transformation=T;this.geomsrvc.project(J,p.hitch(this,function(N){O.resolve(N[0])}),function(N){O.reject(N)})}),p.hitch(this,function(T){O.reject(T)}))}return O},expandButtonWasClicked:function(){d.toggle(this.coordcontrols,
"expanded");d.contains(this.coordcontrols,"expanded")?(d.remove(this.expandButton,"expandBtn"),d.add(this.expandButton,"collapseBtn"),a.set(this.expandButton,"aria-expanded","true")):(d.remove(this.expandButton,"collapseBtn"),d.add(this.expandButton,"expandBtn"),a.set(this.expandButton,"aria-expanded","false"));this.setSubCoordUI(d.contains(this.coordcontrols,"expanded"));this._setCoordControlsTabindex(d.contains(this.coordcontrols,"expanded"));this.emit("expandButtonClicked",d.contains(this.coordcontrols,
"expanded"))},_setCoordControlsTabindex:function(L){var O=[];if(L){var S=0;L=-1}else S=-1,L=0;O=b("input[tabindex\x3d'"+L+"']",this.coordcontrols);O=O.concat(b("span[tabindex\x3d'"+L+"']",this.coordcontrols));k.forEach(O,p.hitch(this,function(T){a.set(T,"tabindex",S)}))},formatButtonWasClicked:function(){this._frmtdlg.content.setCt(this.type);w.open({popup:this._frmtdlg,around:this.formatButton})},drawPointButtonWasClicked:function(){if(d.contains(this.drawPointButton,"drawPointBtn-active"))this.dt.deactivate(),
this.parentWidget.map.enableMapNavigation();else{this.parentWidget.map.disableMapNavigation();this.dt.activate(ca.POINT);var L=this.dt._tooltip;L&&(L.innerHTML=this.drawToolTip)}d.toggle(this.drawPointButton,"drawPointBtn-active")},drawComplete:function(L){var O={};O.mapPoint=L.geometry;this.parentWidget.map.enableMapNavigation();this.mapWasClicked(O)},setSubCoordUI:function(L){if(L){L="165px";switch(this.type){case "DD":case "DMS":case "DDM":this.sub1label.innerHTML="Lat";this.sub2label.innerHTML=
"Lon";this.setHidden(this.sub3,!1);this.setHidden(this.sub4,!1);L="90px";break;case "GARS":this.sub1label.innerHTML="Lon";this.sub2label.innerHTML="Lat";this.sub3label.innerHTML="Quadrant";this.sub4label.innerHTML="Key";this.setVisible(this.sub3);this.setVisible(this.sub4);break;case "GEOREF":this.sub1label.innerHTML="15\u00b0 Quad";this.sub2label.innerHTML="1\u00b0 Quad";this.sub3label.innerHTML="Easting";this.setVisible(this.sub3);this.sub4label.innerHTML="Northing";this.setVisible(this.sub4);break;
case "USNG":case "MGRS":this.sub1label.innerHTML="GZD";this.sub2label.innerHTML="Grid Sq";this.sub3label.innerHTML="Easting";this.sub4label.innerHTML="Northing";this.setVisible(this.sub3);this.setVisible(this.sub4);break;case "UTM":this.sub1label.innerHTML="Zone";this.sub2label.innerHTML="Band";this.sub3label.innerHTML="Easting";this.sub4label.innerHTML="Northing";this.setVisible(this.sub3);this.setVisible(this.sub4);break;case "UTM_H":this.sub1label.innerHTML="Zone",this.sub2label.innerHTML="Hemisphere",
this.sub3label.innerHTML="Easting",this.sub4label.innerHTML="Northing",this.setVisible(this.sub3),this.setVisible(this.sub4)}f.set(this.coordcontrols,"display","block");f.set(this.coordcontrols,"height",L);f.set(this.coordcontrols,"width","300px")}else f.set(this.coordcontrols,"display","none"),f.set(this.coordcontrols,"height","0px");L=this.uid.split("_")[1];a.set(this["cc_"+L+"sub1val"],"aria-label",this.sub1label.innerHTML);a.set(this["cc_"+L+"sub2val"],"aria-label",this.sub2label.innerHTML);a.set(this["cc_"+
L+"sub3val"],"aria-label",this.sub3label.innerHTML);a.set(this["cc_"+L+"sub4val"],"aria-label",this.sub4label.innerHTML)},setCoordUI:function(L){if(L){var O=this.uid.split("_")[1];if(!this["cc_"+O+"sub1val"]||this.input&&this.inputFromText)return;var S=this._frmtdlg.content.formats[this.type];S=S.useCustom?S.customFormat:S.defaultFormat;switch(this.type){case "DD":L=this.getFormattedDDStr(L,S,this.addSign);this["cc_"+O+"sub1val"].value=e.substitute("${xcrd}",{xcrd:L.latdeg});this["cc_"+O+"sub2val"].value=
e.substitute("${ycrd}",{ycrd:L.londeg});var T=L.formatResult;break;case "DDM":L=this.getFormattedDDMStr(L,S,this.addSign);this["cc_"+O+"sub1val"].value=e.substitute("${latd} ${latm}",{latd:L.latdeg,latm:L.latmin});this["cc_"+O+"sub2val"].value=e.substitute("${lond} ${lonm}",{lond:L.londeg,lonm:L.lonmin});T=L.formatResult;break;case "DMS":L=this.getFormattedDMSStr(L,S,this.addSign);this["cc_"+O+"sub1val"].value=e.substitute("${latd} ${latm} ${lats}",{latd:L.latdeg,latm:L.latmin,lats:L.latsec});this["cc_"+
O+"sub2val"].value=e.substitute("${lond} ${lonm} ${lons}",{lond:L.londeg,lonm:L.lonmin,lons:L.lonsec});T=L.formatResult;break;case "USNG":L=this.getFormattedUSNGStr(L,S,!1);this["cc_"+O+"sub1val"].value=L.gzd;this["cc_"+O+"sub2val"].value=L.grdsq;this["cc_"+O+"sub3val"].value=L.easting;this["cc_"+O+"sub4val"].value=L.northing;T=L.formatResult;break;case "MGRS":L=this.getFormattedMGRSStr(L,S,!1);this["cc_"+O+"sub1val"].value=L.gzd;this["cc_"+O+"sub2val"].value=L.grdsq;this["cc_"+O+"sub3val"].value=
L.easting;this["cc_"+O+"sub4val"].value=L.northing;T=L.formatResult;break;case "GARS":L=this.getFormattedGARSStr(L,S,!1);this["cc_"+O+"sub1val"].value=L.lon;this["cc_"+O+"sub2val"].value=L.lat;this["cc_"+O+"sub3val"].value=L.quadrant;this["cc_"+O+"sub4val"].value=L.key;T=L.formatResult;break;case "GEOREF":L=this.getFormattedGEOREFStr(L,S,!1);this["cc_"+O+"sub1val"].value=L.lon+L.lat;this["cc_"+O+"sub2val"].value=L.quadrant15lon+L.quadrant15lat;this["cc_"+O+"sub3val"].value=L.quadrant1lon;this["cc_"+
O+"sub4val"].value=L.quadrant1lat;T=L.formatResult;break;case "UTM":L=this.getFormattedUTMStr(L,S,!1);L.bandLetter.match(/^[AaBbYyZz]/)?(this["cc_"+O+"sub1val"].value="",this["cc_"+O+"sub2val"].value="",this["cc_"+O+"sub3val"].value="",this["cc_"+O+"sub4val"].value="",L.formatResult=""):(this["cc_"+O+"sub1val"].value=L.zone,this["cc_"+O+"sub2val"].value=L.bandLetter,this["cc_"+O+"sub3val"].value=L.easting,this["cc_"+O+"sub4val"].value=L.westing);T=L.formatResult;break;case "UTM_H":L=this.getFormattedUTMHStr(L,
S,!1),L.hemisphere.match(/^[AaBbYyZz]/)?(this["cc_"+O+"sub1val"].value="",this["cc_"+O+"sub2val"].value="",this["cc_"+O+"sub3val"].value="",this["cc_"+O+"sub4val"].value="",L.formatResult=""):(this["cc_"+O+"sub1val"].value=L.zone,this["cc_"+O+"sub2val"].value=L.hemisphere,this["cc_"+O+"sub3val"].value=L.easting,this["cc_"+O+"sub4val"].value=L.westing),T=L.formatResult}}else T="";this.coordcontrols&&this.setSubCoordUI(d.contains(this.coordcontrols,"expanded"));this.coordtext&&(a.set(this.coordtext,
"value",T),this.emit("get-coordinate-complete",T))},getFormattedCoordinates:function(){this.getCoordValues(this.currentClickPointDD,this.type,4).then(p.hitch(this,function(L){this.setCoordUI(L)}),p.hitch(this,function(L){console.log(L)}))},updateDisplay:function(){this.currentClickPoint&&(this.currentClickPointDD||(this.currentClickPointDD=this.currentClickPoint),this.getFormattedCoordinates(this.currentClickPointDD),this.input&&(null!==this.graphicsLayer&&(this.graphicsLayer.clear(),this.currentClickPoint.spatialReference.equals(this.parentWidget.map.spatialReference)?
this.graphicsLayer.add(new G(this.currentClickPoint)):this.getProjectedPoint(this.currentClickPointDD).then(p.hitch(this,function(L){this.graphicsLayer.add(new G(L))}),p.hitch(this,function(L){console.error(L)}))),h.publish("INPUTPOINTDIDCHANGE",{mapPoint:this.currentClickPointDD,inputFromText:!0}),h.publish("VALIDINPUT",{show:!0})))},clear:function(){this.coordtext.value="";this.currentClickPointDDDD=this.currentClickPointDD=this.currentClickPoint=null;this.graphicsLayer.clear()},inputError:function(){this.setCoordUI();
this.toggleZoomButton(!1)},toggleZoomButton:function(L){this.zoomButton&&this.zoomButton.parentNode&&(this.zoomButton.parentNode.style.display=L?"inline-block":"none")},getCleanInput:function(L){L=L.replace(/\n/g,"");L=L.replace(/\s+/g," ").trim();return L.toUpperCase()},getCoordValues:function(L,O,S){var T=new g;L={sr:4326,coordinates:[[L.x,L.y]],conversionType:O.name?O.name:O,numOfDigits:S||6,rounding:!0,addSpaces:!1};switch(O){case "DD":L.numOfDigits=6;break;case "USNG":L.numOfDigits=5;break;case "MGRS":L.conversionMode=
"mgrsDefault";L.numOfDigits=5;break;case "UTM_H":L.conversionType="utm";L.conversionMode="utmNorthSouth";L.addSpaces=!0;break;case "UTM":L.conversionType="utm";L.conversionMode="utmDefault";L.addSpaces=!0;break;case "GARS":L.conversionMode="garsDefault"}this.geomsrvc.toGeoCoordinateString(L).then(function(J){T.resolve(J)},function(){T.resolve(null)});return T.promise},getXYNotation:function(L,O){var S=new g;var T=O.name?O.name:O;O={sr:4326,conversionType:T,strings:[]};switch(T){case "DD":case "DDM":case "DMS":O.numOfDigits=
2;L=L.replace(/[\u00b0\u02da\u00ba^~*"'\u2032\u00a8\u02dd]/g,"");O.strings.push(L);break;case "DDrev":O.conversionType="DD";O.numOfDigits=2;L=L.replace(/[\u00b0\u02da\u00ba^~*"'\u2032\u00a8\u02dd]/g,"");O.strings.push(L);break;case "DDMrev":O.conversionType="DDM";O.numOfDigits=2;L=L.replace(/[\u00b0\u02da\u00ba^~*"'\u2032\u00a8\u02dd]/g,"");O.strings.push(L);break;case "DMSrev":O.conversionType="DMS";O.numOfDigits=2;L=L.replace(/[\u00b0\u02da\u00ba^~*"'\u2032\u00a8\u02dd]/g,"");O.strings.push(L);
break;case "USNG":O.strings.push(L);O.addSpaces="false";break;case "MGRS":O.conversionMode="mgrsNewStyle";O.strings.push(L);O.addSpaces="false";break;case "UTM_H":O.conversionType="utm";O.conversionMode="utmNorthSouth";O.strings.push(L);break;case "UTM":O.conversionType="utm";O.conversionMode="utmDefault";O.strings.push(L);break;case "GARS":O.conversionMode="garsCenter";O.strings.push(L);break;case "GEOREF":O.strings.push(L)}this.geomsrvc.fromGeoCoordinateString(O).then(function(J){S.resolve(J)},
function(){S.resolve(null)});return S.promise},getNotations:function(){return[{name:"DD",pattern:new RegExp([/^(([NS\+\-\s])*([0-8]?\d([,.]\d*)?|90([,.]0*)?)([\u00b0\u02da\u00ba^~*]*)([NS\+\-\s])*)([,:;\s|\/\\]+)/,/(([EW\+\-\s])*([0]?\d?\d([,.]\d*)?|1[0-7]\d([,.]\d*)?|180([,.]0*)?)([\u00b0\u02da\u00ba^~*]*)([EW\+\-\s])*)$/].map(function(L){return L.source}).join("")),notationType:this.nls.DDLatLongNotation,conversionType:"DD"},{name:"DDrev",pattern:new RegExp([/^(([EW\+\-\s])*([0]?\d?\d([,.]\d*)?|1[0-7]\d([,.]\d*)?|180([,.]0*)?)([\u00b0\u02da\u00ba^~*]*)([EW\+\-\s])*)/,
/([,:;\s|\/\\]+)(([NS\+\-\s])*([0-8]?\d([,.]\d*)?|90([,.]0*)?)([\u00b0\u02da\u00ba^~*]*)([NS\+\-\s])*)$/].map(function(L){return L.source}).join("")),notationType:this.nls.DDLongLatNotation,conversionType:"DD"},{name:"DDM",pattern:new RegExp([/^(([NS\+\-\s])*([0-8]?\d|90)[\u00b0\u02da\u00ba^~*\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)['\u2032\s_]*([NS\+\-\s])*)/,/([,:;\s|\/\\]+)/,/(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[\u00b0\u02da\u00ba^~*\s\-_]+(([0-5]\d|\d)([,.]\d*)?)['\u2032\s_]*([EW\+\-\s])*)/,/[\s]*$/].map(function(L){return L.source}).join("")),
notationType:this.nls.DDMLatLongNotation,conversionType:"DDM"},{name:"DDMrev",pattern:new RegExp([/^(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[\u00b0\u02da\u00ba^~*\s\-_]+(([0-5]\d|\d)([,.]\d*)?)['\u2032\s_]*([EW\+\-\s])*)/,/([,:;\s|\/\\]+)/,/(([NS\+\-\s])*([0-8]?\d|90)[\u00b0\u02da\u00ba^~*\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)['\u2032\s_]*([NS\+\-\s])*)[\s]*$/].map(function(L){return L.source}).join("")),notationType:this.nls.DDMLongLatNotation,conversionType:"DDM"},{name:"DMS",pattern:new RegExp([/^(([NS\+\-\s])*([0-8]?\d|90)[\u00b0\u02da\u00ba^~*\s\-_]+([0-5]?\d|\d)['\u2032\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["\u00a8\u02dd\s_]*([NS\+\-\s])*)/,
/([,:;\s|\/\\]+)/,/(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[\u00b0\u02da\u00ba^~*\s\-_]+([0-5]\d|\d)['\u2032\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["\u00a8\u02dd\s_]*([EW\+\-\s])*)[\s]*$/].map(function(L){return L.source}).join("")),notationType:this.nls.DMSLatLongNotation,conversionType:"DMS"},{name:"DMSrev",pattern:new RegExp([/^(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[\u00b0\u02da\u00ba^~*\s\-_]+([0-5]\d|\d)['\u2032\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["\u00a8\u02dd\s_]*([EW\+\-\s])*)/,/([,:;\s|\/\\]+)/,/(([NS\+\-\s])*([0-8]?\d|90)[\u00b0\u02da\u00ba^~*\s\-_]+([0-5]?\d|\d)['\u2032\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["\u00a8\u02dd\s_]*([NS\+\-\s])*)[\s]*$/].map(function(L){return L.source}).join("")),
notationType:this.nls.DMSLongLatNotation,conversionType:"DMS"},{name:"GARS",pattern:/^\d{3}[a-zA-Z]{2}[1-4]?[1-9]?$/,notationType:this.nls.GARSNotation,conversionType:"GARS"},{name:"GEOREF",pattern:/^[a-zA-Z]{4}\d{1,8}$/,notationType:this.nls.GEOREFNotation,conversionType:"GEOREF"},{name:"MGRS",pattern:new RegExp([/^\d{1,2}[-,;:\s]*[C-HJ-NP-X][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*/,/(\d[-,;:\s]+\d|\d{2}[-,;:\s]+\d{2}|\d{3}[-,;:\s]+\d{3}|\d{4}[-,;:\s]+\d{4}|\d{5}[-,;:\s]+\d{5})/,/$|^(\d{1,2}[-,;:\s]*[C-HJ-NP-X][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*)/,
/(\d{2}|\d{4}|\d{6}|\d{8}|\d{10})?$|^[ABYZ][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*/,/(\d[-,;:\s]+\d|\d{2}[-,;:\s]+\d{2}|\d{3}[-,;:\s]+\d{3}|\d{4}[-,;:\s]+\d{4}|\d{5}[-,;:\s]+\d{5})/,/$|^[ABYZ][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*(\d{2}|\d{4}|\d{6}|\d{8}|\d{10})?$/].map(function(L){return L.source}).join("")),notationType:this.nls.MGRSNotation,conversionType:"MGRS"},{name:"UTM",pattern:new RegExp([/^\d{1,2}[-,;:\s]*[c-hj-np-xC-HJ-NP-X][-,;:\s]*\d{1,6}\.?\d*[mM]?[-,;:\s]?\d{1,7}\.?\d*[mM]?$/].map(function(L){return L.source}).join("")),
notationType:this.nls.UTMBandNotation,conversionType:"UTM"},{name:"UTM (H)",pattern:new RegExp([/^\d{1,2}[-,;:\s]*[NnSs][-,;:\s]*\d{1,6}\.?\d*[mM]?[-,;:\s]+\d{1,7}\.?\d*[mM]?$/].map(function(L){return L.source}).join("")),notationType:this.nls.UTMHemNotation,conversionType:"UTM_H"}]},getCoordinateType:function(L){var O=this.getCleanInput(L);L=new g;var S=this.getNotations();O=k.filter(S,function(T){return T.pattern.test(this.v)},{v:O});0<O.length?L.resolve(O):L.resolve(null);return L.promise},getFormattedDDStr:function(L,
O,S){var T={};T.sourceValue=L;T.sourceFormatString=O;L=L[0].split(/[ ,]+/);T.latdeg=L[0].replace(/[nNsS]/,"");T.londeg=L[1].replace(/[eEwW]/,"");null!==this.numberOfDecimals?(T.latdeg=r.localizeNumber(parseFloat(T.latdeg),{places:this.numberOfDecimals}),T.londeg=r.localizeNumber(parseFloat(T.londeg),{places:this.numberOfDecimals})):(T.latdeg=r.localizeNumber(parseFloat(T.latdeg)),T.londeg=r.localizeNumber(parseFloat(T.londeg)));S&&("N"===L[0].slice(-1)?T.latdeg="+"+T.latdeg:T.latdeg="-"+T.latdeg,
"W"===L[1].slice(-1)?T.londeg="-"+T.londeg:T.londeg="+"+T.londeg);O=O.replace(/X/,T.londeg);O=O.replace(/[eEwW]/,L[1].slice(-1));O=O.replace(/[nNsS]/,L[0].slice(-1));O=O.replace(/Y/,T.latdeg);T.formatResult=O;return T},getFormattedDDMStr:function(L,O,S){var T={};T.sourceValue=L;T.sourceFormatString=O;T.parts=L[0].split(/[ ,]+/);T.latdeg=T.parts[0];T.latmin=T.parts[1].replace(/[nNsS]/,"");T.londeg=T.parts[2];T.lonmin=T.parts[3].replace(/[eEwW]/,"");null!==this.numberOfDecimals?(T.latmin=r.localizeNumber(parseFloat(T.latmin),
{places:this.numberOfDecimals}),T.lonmin=r.localizeNumber(parseFloat(T.lonmin),{places:this.numberOfDecimals})):(T.latmin=r.localizeNumber(parseFloat(T.latmin)),T.lonmin=r.localizeNumber(parseFloat(T.lonmin)));S&&("N"===T.parts[1].slice(-1)?T.latdeg="+"+T.latdeg:T.latdeg="-"+T.latdeg,"W"===T.parts[3].slice(-1)?T.londeg="-"+T.londeg:T.londeg="+"+T.londeg);L=O.replace(/[EeWw]/,T.parts[3].slice(-1));L=L.replace(/Y/,T.lonmin);L=L.replace(/X/,T.londeg);L=L.replace(/[NnSs]/,T.parts[1].slice(-1));L=L.replace(/B/,
T.latmin);L=L.replace(/A/,T.latdeg);T.formatResult=L;return T},getFormattedDMSStr:function(L,O,S){var T={};T.sourceValue=L;T.sourceFormatString=O;T.parts=L[0].split(/[ ,]+/);T.latdeg=T.parts[0];T.latmin=T.parts[1];T.latsec=T.parts[2].replace(/[NnSs]/,"");T.londeg=T.parts[3];T.lonmin=T.parts[4];T.latsec=null!==this.numberOfDecimals?r.localizeNumber(parseFloat(T.latsec),{places:this.numberOfDecimals}):r.localizeNumber(parseFloat(T.latsec));T.parts[5]&&(T.lonsec=T.parts[5].replace(/[EWew]/,""),T.lonsec=
null!==this.numberOfDecimals?r.localizeNumber(parseFloat(T.lonsec),{places:this.numberOfDecimals}):r.localizeNumber(parseFloat(T.lonsec)));S&&("N"===T.parts[2].slice(-1)?T.latdeg="+"+T.latdeg:T.latdeg="-"+T.latdeg,"W"===T.parts[5].slice(-1)?T.londeg="-"+T.londeg:T.londeg="+"+T.londeg);L=O.replace(/A/,T.latdeg);L=L.replace(/B/,T.latmin);L=L.replace(/C/,T.latsec);L=L.replace(/X/,T.londeg);L=L.replace(/Y/,T.lonmin);L=L.replace(/Z/,T.lonsec);L=L.replace(/[NnSs]/,T.parts[2].slice(-1));T.parts[5]&&(L=L.replace(/[EeWw]/,
T.parts[5].slice(-1)));T.formatResult=L;return T},getFormattedUSNGStr:function(L,O){var S={};S.sourceValue=L;S.sourceFormatString=O;L[0].match(/^[ABYZ]/)?S.gzd=L[0].match(/[ABYZ]/)[0].trim():S.gzd=L[0].match(/\d{1,2}[C-HJ-NP-X]/)[0].trim();L[0].replace(S.gzd,"").match(/[a-hJ-zA-HJ-Z]{2}/)&&(S.grdsq=L[0].replace(S.gzd,"").match(/[a-hJ-zA-HJ-Z]{2}/)[0].trim());L[0].replace(S.gzd+S.grdsq,"").match(/^\d{1,5}/)&&(S.easting=L[0].replace(S.gzd+S.grdsq,"").match(/^\d{1,5}/)[0].trim());L[0].replace(S.gzd+
S.grdsq,"").match(/\d{1,5}$/)&&(S.northing=L[0].replace(S.gzd+S.grdsq,"").match(/\d{1,5}$/)[0].trim());L=O.replace(/Y/,S.northing);L=L.replace(/X/,S.easting);L=L.replace(/S/,S.grdsq);L=L.replace(/Z/,S.gzd);S.formatResult=L;return S},getFormattedMGRSStr:function(L,O){var S={};S.sourceValue=L;S.sourceFormatString=O;L[0].match(/^[ABYZ]/)?S.gzd=L[0].match(/[ABYZ]/)[0].trim():S.gzd=L[0].match(/\d{1,2}[C-HJ-NP-X]/)[0].trim();S.grdsq=L[0].replace(S.gzd,"").match(/[a-hJ-zA-HJ-Z]{2}/)[0].trim();S.easting=
L[0].replace(S.gzd+S.grdsq,"").match(/^\d{1,5}/)[0].trim();S.northing=L[0].replace(S.gzd+S.grdsq,"").match(/\d{1,5}$/)[0].trim();L=O.replace(/Y/,S.northing);L=L.replace(/X/,S.easting);L=L.replace(/S/,S.grdsq);L=L.replace(/Z/,S.gzd);S.formatResult=L;return S},getFormattedGARSStr:function(L,O){var S={};S.sourceValue=L;S.sourceFormatString=O;S.lon=L[0].match(/\d{3}/);S.lat=L[0].match(/[a-zA-Z]{2}/);L=L[0].match(/\d*$/);S.quadrant=L[0][0];S.key=L[0][1];O=O.replace(/K/,S.key);O=O.replace(/Q/,S.quadrant);
O=O.replace(/Y/,S.lat);O=O.replace(/X/,S.lon);S.formatResult=O;return S},getFormattedGEOREFStr:function(L,O){var S={};S.sourceValue=L;S.sourceFormatString=O;S.lon=L[0].match(/[a-zA-Z]{1}/)[0].trim();S.lat=L[0].replace(S.lon,"").match(/[a-zA-Z]{1}/)[0].trim();S.quadrant15lon=L[0].replace(S.lon+S.lat,"").match(/[a-zA-Z]{1}/)[0].trim();S.quadrant15lat=L[0].replace(S.lon+S.lat+S.quadrant15lon,"").match(/[a-zA-Z]{1}/)[0].trim();L=L[0].replace(S.lon+S.lat+S.quadrant15lon+S.quadrant15lat,"");S.quadrant1lon=
L.substr(0,L.length/2);S.quadrant1lat=L.substr(L.length/2,L.length);O=O.replace(/Y/,S.quadrant1lat);O=O.replace(/X/,S.quadrant1lon);O=O.replace(/D/,S.quadrant15lat);O=O.replace(/C/,S.quadrant15lon);O=O.replace(/B/,S.lat);O=O.replace(/A/,S.lon);S.formatResult=O;return S},getFormattedUTMStr:function(L,O){var S={};S.sourceValue=L;S.sourceFormatString=O;S.parts=L[0].split(/[ ,]+/);S.zone=S.parts[0].replace(/[A-Z]/,"");S.bandLetter=S.parts[0].slice(-1);S.easting=S.parts[1];S.westing=S.parts[2];L=O.replace(/Y/,
S.westing);L=L.replace(/X/,S.easting);L=L.replace(/B/,S.bandLetter);L=L.replace(/Z/,S.zone);S.formatResult=L;return S},getFormattedUTMHStr:function(L,O){var S={};S.sourceValue=L;S.sourceFormatString=O;S.parts=L[0].split(/[ ,]+/);S.zone=S.parts[0].replace(/[A-Z]/,"");S.hemisphere=S.parts[0].slice(-1);S.easting=S.parts[1];S.westing=S.parts[2];L=O.replace(/Y/,S.westing);L=L.replace(/X/,S.easting);L=L.replace(/H/,S.hemisphere);L=L.replace(/Z/,S.zone);S.formatResult=L;return S}})})},"jimu/dijit/_CoordinateControlFormatNotation":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-style dojo/on dojo/dom-attr dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin jimu/dijit/formSelect jimu/dijit/CheckBox dijit/form/NumberSpinner".split(" "),
function(H,k,p,r,m,l,b,a){return H([l,b,a],{baseClass:"jimu-coordinate-control",templateString:'\x3cdiv\x3e\x3cspan class\x3d"formatText"\x3e${nls.editCoordinateDialogTitle}\x3c/span\x3e\x3cdiv class\x3d"controlContainer"\x3e\x3cselect tabindex\x3d"0" class\x3d"selectFormat" data-dojo-attach-point\x3d"frmtSelect" aria-label\x3d"${nls.editCoordinateDialogTitle}" data-dojo-type\x3d"jimu/dijit/formSelect"\x3e\x3c/select\x3e\x3cinput tabindex\x3d"0" type\x3d"text" data-dojo-attach-point\x3d"frmtVal" class\x3d"formatInput"\x3e\x3c/input\x3e\x3cdiv class\x3d"settingsContainer" data-dojo-attach-point\x3d"prefixContainer"\x3e\x3cdiv class \x3d "esriCTSignificantDigitNode"\x3e\x3cdiv class\x3d"formatText esriCTSignificantDigitLabel"title \x3d"${nls.significantDigitLabel}"\x3e${nls.significantDigitLabel}\x3c/div\x3e\x3cdiv data-dojo-attach-point\x3d"significantDigitTextbox" value\x3d"2" data-dojo-type\x3d"dijit/form/NumberSpinner" data-dojo-props\x3d"constraints:{min:0,max:100,places:0}" aria-label\x3d"${nls.significantDigitLabel} style\x3d"width:50%"\x3e\x3c/div\x3e\x3c/div\x3e \x3cdiv class\x3d"formatText" data-dojo-attach-point\x3d"addSignChkBox" label\x3d"${nls.posNegPrefixLabel}" data-dojo-type\x3d"jimu/dijit/CheckBox"/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"btnContainer"\x3e\x3cdiv tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.applyButtonLabel}" data-dojo-attach-point\x3d"applyButton" class\x3d"jimu-btn"\x3e${nls.applyButtonLabel}\x3c/div\x3e\x3cdiv data-dojo-attach-point\x3d"cancelButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.cancelButtonLabel}" class\x3d"jimu-btn formatCoordCancelButton"\x3e${nls.cancelButtonLabel}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
isCanceled:!1,formats:{},setCt:function(d){this.ct=d;this.frmtSelect.set("value",this.ct)},postCreate:function(){this.formats={DD:{defaultFormat:"YN XE",customFormat:null,useCustom:!1},DDM:{defaultFormat:"A\u00b0 B'N X\u00b0 Y'E",customFormat:null,useCustom:!1},DMS:{defaultFormat:"A\u00b0 B' C\"N X\u00b0 Y' Z\"E",customFormat:null,useCustom:!1},GARS:{defaultFormat:"XYQK",customFormat:null,useCustom:!1},GEOREF:{defaultFormat:"ABCDXY",customFormat:null,useCustom:!1},MGRS:{defaultFormat:"ZSXY",customFormat:null,
useCustom:!1},USNG:{defaultFormat:"ZSXY",customFormat:null,useCustom:!1},UTM:{defaultFormat:"ZB X Y",customFormat:null,useCustom:!1},UTM_H:{defaultFormat:"ZH X Y",customFormat:null,useCustom:!1}};var d=[],f;for(f in this.formats){var e={value:f,label:this.nls.notations[f]};d.push(e)}this.frmtSelect.addOption(d);m.set(this.frmtVal,"value",this.formats[this.ct].defaultFormat);this.own(r(this.frmtSelect,"change",k.hitch(this,this.frmtSelectValueDidChange)));this.own(r(this.frmtVal,"change",k.hitch(this,
this.formatValDidChange)));this.own(r(this.cancelButton,"click",k.hitch(this,function(){this.isCanceled=!0})));this.own(r(this.applyButton,"click",k.hitch(this,function(){this.isCanceled=!1})));this.displayPrefixContainer()},formatValDidChange:function(){var d=m.get(this.frmtVal,"value"),f=this.frmtSelect.get("value");this.formats[f].customFormat=d;this.formats[f].useCustom=!0},frmtSelectValueDidChange:function(d){var f=this.formats[d].useCustom?this.formats[d].customFormat:this.formats[d].defaultFormat;
this.ct=d;m.set(this.frmtVal,"value",f);this.displayPrefixContainer()},displayPrefixContainer:function(){switch(this.ct){case "DD":case "DDM":case "DMS":p.set(this.prefixContainer,{display:""});break;default:p.set(this.prefixContainer,{display:"none"})}}})})},"jimu/dijit/_CoordinateControlConfirmNotation":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/aspect dojo/keys dojo/query dijit/Dialog dijit/form/Select dojo/_base/lang".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e){return H([d],{baseClass:"jimu-coordinate-control",numberOfInputs:0,selectOptions:{},comboOptions:{},dfd:null,constructor:function(h){e.mixin(this,h);this.numberOfInputs=h.options.length;this.selectOptions=h.options},postCreate:function(){this.inherited("postCreate",arguments);this.closable=!1;this.closeButtonNode.style.display="none";"DartTheme"===this.theme&&m.add(this.containerNode,"coordinateControlDialog");this.message=r.create("div",{style:"margin-bottom: 5px"},
this.containerNode,"first");this.message.innerHTML=this.numberOfInputs+" "+this.nls.multipleNotationLabel;this.comboOptions=new f({style:{width:"99%"},"aria-label":this.numberOfInputs+" "+this.nls.multipleNotationLabel},r.create("div",{},this.containerNode,"last"));this.own(l.after(this.comboOptions,"onChange",p.hitch(this,this._onComboOptionsChanged)));for(var h=0;h<this.selectOptions.length;h++)this.comboOptions.addOption({value:this.selectOptions[h].name,label:this.selectOptions[h].notationType});
this.buttonDiv=r.create("div",{"class":"buttonContainer",style:"margin-top:10px;"+(window.isRTL?"text-align:left":"text-align:right")},this.containerNode,"last");this.okButton=r.create("div",{innerHTML:this.nls.applyButtonLabel,"class":"jimu-btn",role:"button",tabindex:"0","aria-label":this.nls.applyButtonLabel,onclick:e.hitch(this,function(){this.hide();this.dfd.resolve()}),onkeypress:e.hitch(this,function(c){if(c.keyCode===b.ENTER||c.keyCode===b.SPACE)this.hide(),this.dfd.resolve()})},this.buttonDiv,
"first");this.cancelButton=r.create("div",{innerHTML:this.nls.cancelButtonLabel,"class":"jimu-btn",style:"margin: 0 5px 0 5px",role:"button",tabindex:"0","aria-label":this.nls.cancelButtonLabel,onclick:e.hitch(this,function(){this.hide();this.dfd.cancel()}),onkeypress:e.hitch(this,function(c){if(c.keyCode===b.ENTER||c.keyCode===b.SPACE)this.hide(),this.dfd.cancel()})},this.buttonDiv,"last")},show:function(){this.inherited("show",arguments);this.dfd=new k;var h=this._getDOMElement(".dijitSelectLabel",
this.comboOptions.domNode);h&&m.add(h,"dijitSelectLabelConfirmNotation");return this.dfd},_onComboOptionsChanged:function(){var h=this._getDOMElement(".dijitSelectLabel",this.comboOptions.domNode);h&&m.add(h,"dijitSelectLabelConfirmNotation")},_getDOMElement:function(h,c){return(h=a(h,c))&&1===h.length?h[0]:null}})})},"dijit/form/Textarea":function(){define(["dojo/_base/declare","dojo/dom-style","./_ExpandingTextAreaMixin","./SimpleTextarea"],function(H,k,p,r){return H("dijit.form.Textarea",[r,p],
{baseClass:"dijitTextBox dijitTextArea dijitExpandingTextArea",cols:"",buildRendering:function(){this.inherited(arguments);k.set(this.textbox,{overflowY:"hidden",overflowX:"auto",boxSizing:"border-box",MsBoxSizing:"border-box",WebkitBoxSizing:"border-box",MozBoxSizing:"border-box"})}})})},"dijit/form/_ExpandingTextAreaMixin":function(){define("dojo/_base/declare dojo/dom-construct dojo/has dojo/_base/lang dojo/on dojo/_base/window ../Viewport".split(" "),function(H,k,p,r,m,l,b){p.add("textarea-needs-help-shrinking",
function(){var a=l.body(),d=k.create("textarea",{rows:"5",cols:"20",value:" ",style:{zoom:1,fontSize:"12px",height:"96px",overflow:"hidden",visibility:"hidden",position:"absolute",border:"5px solid white",margin:"0",padding:"0",boxSizing:"border-box",MsBoxSizing:"border-box",WebkitBoxSizing:"border-box",MozBoxSizing:"border-box"}},a,"last"),f=d.scrollHeight>=d.clientHeight;a.removeChild(d);return f});return H("dijit.form._ExpandingTextAreaMixin",null,{_setValueAttr:function(){this.inherited(arguments);
this.resize()},postCreate:function(){this.inherited(arguments);var a=this.textbox;a.style.overflowY="hidden";this.own(m(a,"focus, resize",r.hitch(this,"_resizeLater")))},startup:function(){this.inherited(arguments);this.own(b.on("resize",r.hitch(this,"_resizeLater")));this._resizeLater()},_onInput:function(a){this.inherited(arguments);this.resize()},_estimateHeight:function(){var a=this.textbox;a.rows=(a.value.match(/\n/g)||[]).length+1},_resizeLater:function(){this.defer("resize")},resize:function(){function a(){var q=
!1;""===d.value&&(d.value=" ",q=!0);var v=d.scrollHeight;q&&(d.value="");return v}var d=this.textbox;"hidden"==d.style.overflowY&&(d.scrollTop=0);if(!this.busyResizing){this.busyResizing=!0;if(a()||d.offsetHeight){var f=a()+Math.max(d.offsetHeight-d.clientHeight,0),e=f+"px";e!=d.style.height&&(d.style.height=e,d.rows=1);if(p("textarea-needs-help-shrinking")){var h=a(),c=d.style.minHeight,g=4,n=d.scrollTop;d.style.minHeight=e;for(d.style.height="auto";0<f;){d.style.minHeight=Math.max(f-g,4)+"px";e=
a();h-=e;f-=h;if(h<g)break;h=e;g<<=1}d.style.height=f+"px";d.style.minHeight=c;d.scrollTop=n}d.style.overflowY=a()>d.clientHeight?"auto":"hidden";"hidden"==d.style.overflowY&&(d.scrollTop=0)}else this._estimateHeight();this.busyResizing=!1}}})})},"dijit/InlineEditBox":function(){define("require dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojo/i18n dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/when ./a11yclick ./focus ./_Widget ./_TemplatedMixin ./_WidgetsInTemplateMixin ./_Container ./form/Button ./form/_TextBoxMixin ./form/TextBox dojo/text!./templates/InlineEditBox.html dojo/i18n!./nls/common".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x,w){t=r("dijit._InlineEditor",[u,t,y],{templateString:w,contextRequire:H,postMixInProperties:function(){this.inherited(arguments);this.messages=d.getLocalization("dijit","common",this.lang);k.forEach(["buttonSave","buttonCancel"],function(A){this[A]||(this[A]=this.messages[A])},this)},buildRendering:function(){this.inherited(arguments);var A="string"==typeof this.editor?h.getObject(this.editor)||H(this.editor):this.editor,z=this.sourceStyle,
G="line-height:"+z.lineHeight+";",I=a.getComputedStyle(this.domNode);k.forEach(["Weight","Family","Size","Style"],function(R){I["font"+R]!=z["font"+R]&&(G+="font-"+R+":"+z["font"+R]+";")},this);k.forEach("marginTop marginBottom marginLeft marginRight position left top right bottom float clear display".split(" "),function(R){this.domNode.style[R]=z[R]},this);var K=this.inlineEditBox.width;"100%"==K?(G+="width:100%;",this.domNode.style.display="block"):G+="width:"+(K+(Number(K)==K?"px":""))+";";K=h.delegate(this.inlineEditBox.editorParams,
{style:G,dir:this.dir,lang:this.lang,textDir:this.textDir});this.editWidget=new A(K,this.editorPlaceholder);this.inlineEditBox.autoSave&&(this.saveButton.destroy(),this.cancelButton.destroy(),this.saveButton=this.cancelButton=null,b.destroy(this.buttonContainer))},postCreate:function(){this.inherited(arguments);var A=this.editWidget;this.inlineEditBox.autoSave?this.own(p.after(A,"onChange",h.hitch(this,"_onChange"),!0),c(A,"keydown",h.hitch(this,"_onKeyDown"))):"intermediateChanges"in A&&(A.set("intermediateChanges",
!0),this.own(p.after(A,"onChange",h.hitch(this,"_onIntermediateChange"),!0)),this.saveButton.set("disabled",!0))},startup:function(){this.editWidget.startup();this.inherited(arguments)},_onIntermediateChange:function(){this.saveButton.set("disabled",this.getValue()==this._resetValue||!this.enableSave())},destroy:function(){this.editWidget.destroy(!0);this.inherited(arguments)},getValue:function(){var A=this.editWidget;return String(A.get("displayedValue"in A||"_getDisplayedValueAttr"in A?"displayedValue":
"value"))},_onKeyDown:function(A){this.inlineEditBox.autoSave&&this.inlineEditBox.editing&&!A.altKey&&!A.ctrlKey&&(A.keyCode==e.ESCAPE?(A.stopPropagation(),A.preventDefault(),this.cancel(!0)):A.keyCode==e.ENTER&&"INPUT"==A.target.tagName&&(A.stopPropagation(),A.preventDefault(),this._onChange()))},_onBlur:function(){this.inherited(arguments);this.inlineEditBox.autoSave&&this.inlineEditBox.editing&&(this.getValue()==this._resetValue?this.cancel(!1):this.enableSave()&&this.save(!1))},_onChange:function(){this.inlineEditBox.autoSave&&
this.inlineEditBox.editing&&this.enableSave()&&v.focus(this.inlineEditBox.displayNode)},enableSave:function(){return this.editWidget.isValid?this.editWidget.isValid():!0},focus:function(){this.editWidget.focus();this.editWidget.focusNode&&(v._onFocusNode(this.editWidget.focusNode),"INPUT"==this.editWidget.focusNode.tagName&&this.defer(function(){E.selectInputText(this.editWidget.focusNode)}))}});u=r("dijit.InlineEditBox"+(g("dojo-bidi")?"_NoBidi":""),u,{editing:!1,autoSave:!0,buttonSave:"",buttonCancel:"",
renderAsHtml:!1,editor:x,editorWrapper:t,editorParams:{},disabled:!1,onChange:function(){},onCancel:function(){},width:"100%",value:"",noValueIndicator:6>=g("ie")?"\x3cspan style\x3d'font-family: wingdings; text-decoration: underline;'\x3e\x26#160;\x26#160;\x26#160;\x26#160;\x26#x270d;\x26#160;\x26#160;\x26#160;\x26#160;\x3c/span\x3e":"\x3cspan style\x3d'text-decoration: underline;'\x3e\x26#160;\x26#160;\x26#160;\x26#160;\x26#x270d;\x26#160;\x26#160;\x26#160;\x26#160;\x3c/span\x3e",constructor:function(){this.editorParams=
{}},postMixInProperties:function(){this.inherited(arguments);this.displayNode=this.srcNodeRef;this.own(c(this.displayNode,q,h.hitch(this,"_onClick")),c(this.displayNode,"mouseover, focus",h.hitch(this,"_onMouseOver")),c(this.displayNode,"mouseout, blur",h.hitch(this,"_onMouseOut")));this.displayNode.setAttribute("role","button");this.displayNode.getAttribute("tabIndex")||this.displayNode.setAttribute("tabIndex",0);this.value||"value"in this.params||(this.value=h.trim(this.renderAsHtml?this.displayNode.innerHTML:
this.displayNode.innerText||this.displayNode.textContent||""));this.value||(this.displayNode.innerHTML=this.noValueIndicator);l.add(this.displayNode,"dijitInlineEditBoxDisplayMode")},setDisabled:function(A){f.deprecated("dijit.InlineEditBox.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",A)},_setDisabledAttr:function(A){this.domNode.setAttribute("aria-disabled",A?"true":"false");A?this.displayNode.removeAttribute("tabIndex"):this.displayNode.setAttribute("tabIndex",
0);l.toggle(this.displayNode,"dijitInlineEditBoxDisplayModeDisabled",A);this._set("disabled",A)},_onMouseOver:function(){this.disabled||l.add(this.displayNode,"dijitInlineEditBoxDisplayModeHover")},_onMouseOut:function(){l.remove(this.displayNode,"dijitInlineEditBoxDisplayModeHover")},_onClick:function(A){this.disabled||(A&&(A.stopPropagation(),A.preventDefault()),this._onMouseOut(),this.defer("edit"))},edit:function(){if(!this.disabled&&!this.editing){this._set("editing",!0);this._savedTabIndex=
m.get(this.displayNode,"tabIndex")||"0";if(!this.wrapperWidget){var A=b.create("span",null,this.domNode,"before");this.wrapperWidget=new ("string"==typeof this.editorWrapper?h.getObject(this.editorWrapper):this.editorWrapper)({value:this.value,buttonSave:this.buttonSave,buttonCancel:this.buttonCancel,dir:this.dir,lang:this.lang,tabIndex:this._savedTabIndex,editor:this.editor,inlineEditBox:this,sourceStyle:a.getComputedStyle(this.displayNode),save:h.hitch(this,"save"),cancel:h.hitch(this,"cancel"),
textDir:this.textDir},A);this.wrapperWidget._started||this.wrapperWidget.startup();this._started||this.startup()}var z=this.wrapperWidget;l.add(this.displayNode,"dijitOffScreen");l.remove(z.domNode,"dijitOffScreen");a.set(z.domNode,{visibility:"visible"});m.set(this.displayNode,"tabIndex","-1");var G=z.editWidget,I=this;n(G.onLoadDeferred,h.hitch(z,function(){G.set("displayedValue"in G||"_setDisplayedValueAttr"in G?"displayedValue":"value",I.value);this.defer(function(){z.saveButton&&z.saveButton.set("disabled",
"intermediateChanges"in G);this.focus();this._resetValue=this.getValue()})}))}},_onBlur:function(){this.inherited(arguments)},destroy:function(){this.wrapperWidget&&!this.wrapperWidget._destroyed&&(this.wrapperWidget.destroy(),delete this.wrapperWidget);this.inherited(arguments)},_showText:function(A){var z=this.wrapperWidget;a.set(z.domNode,{visibility:"hidden"});l.add(z.domNode,"dijitOffScreen");l.remove(this.displayNode,"dijitOffScreen");m.set(this.displayNode,"tabIndex",this._savedTabIndex);A&&
v.focus(this.displayNode)},save:function(A){if(!this.disabled&&this.editing){this._set("editing",!1);var z=this.wrapperWidget.getValue();this.set("value",z);this._showText(A)}},setValue:function(A){f.deprecated("dijit.InlineEditBox.setValue() is deprecated.  Use set('value', ...) instead.","","2.0");return this.set("value",A)},_setValueAttr:function(A){A=h.trim(A);var z=this.renderAsHtml?A:A.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;").replace(/\n/g,
"\x3cbr\x3e");this.displayNode.innerHTML=this.editorParams&&"password"===this.editorParams.type?"********":z||this.noValueIndicator;this._set("value",A);this._started&&this.defer(function(){this.onChange(A)})},getValue:function(){f.deprecated("dijit.InlineEditBox.getValue() is deprecated.  Use get('value') instead.","","2.0");return this.get("value")},cancel:function(A){!this.disabled&&this.editing&&(this._set("editing",!1),this.defer("onCancel"),this._showText(A))}});g("dojo-bidi")&&(u=r("dijit.InlineEditBox",
u,{_setValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.displayNode)}}));u._InlineEditor=t;return u})},"widgets/Visibility/js/util":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/Deferred","esri/tasks/GeometryService"],function(H,k,p,r){return H(null,{constructor:function(m){this.appConfig=m.appConfig;this.nls=m.nls;(m=this.appConfig.geometryService)||(m="//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer");this.geomService=new r(m)},
getCleanInput:function(m){m=m.replace(/\n/g,"");m=m.replace(/\s+/g," ").trim();return m.toUpperCase()},getCoordValues:function(m,l,b){var a=new p;m={sr:4326,coordinates:[[m.x,m.y]],conversionType:l.name?l.name:l,numOfDigits:b||6,rounding:!0,addSpaces:!1};switch(l){case "DD":m.numOfDigits=6;break;case "USNG":m.numOfDigits=5;break;case "MGRS":m.conversionMode="mgrsDefault";m.numOfDigits=5;break;case "UTM (H)":m.conversionType="utm";m.conversionMode="utmNorthSouth";m.addSpaces=!0;break;case "UTM":m.conversionType=
"utm";m.conversionMode="utmDefault";m.addSpaces=!0;break;case "GARS":m.conversionMode="garsDefault"}this.geomService.toGeoCoordinateString(m).then(function(d){a.resolve(d)},function(){a.resolve(null)});return a.promise},getXYNotation:function(m,l){var b=new p;var a=l.name?l.name:l;l={sr:4326,conversionType:a,strings:[]};switch(a){case "DD":case "DDM":case "DMS":l.numOfDigits=2;m=m.replace(/[\u00b0\u02da\u00ba^~*"'\u2032\u00a8\u02dd]/g,"");l.strings.push(m);break;case "USNG":l.strings.push(m);l.addSpaces=
"false";break;case "MGRS":l.conversionMode="mgrsNewStyle";l.strings.push(m);l.addSpaces="false";break;case "UTM (H)":l.conversionType="utm";l.conversionMode="utmNorthSouth";l.strings.push(m);break;case "UTM":l.conversionType="utm";l.conversionMode="utmDefault";l.strings.push(m);break;case "GARS":l.conversionMode="garsCenter";l.strings.push(m);break;case "GEOREF":l.strings.push(m)}this.geomService.fromGeoCoordinateString(l).then(function(d){b.resolve(d)},function(){b.resolve(null)});return b.promise},
getNotations:function(){return[{name:"DD",pattern:new RegExp([/^(([NS\+\-\s])*([0-8]?\d([,.]\d*)?|90([,.]0*)?)([\u00b0\u02da\u00ba^~*]*)([NS\+\-\s])*)([,:;\s|\/\\]+)/,/(([EW\+\-\s])*([0]?\d?\d([,.]\d*)?|1[0-7]\d([,.]\d*)?|180([,.]0*)?)([\u00b0\u02da\u00ba^~*]*)([EW\+\-\s])*)$/].map(function(m){return m.source}).join("")),notationType:this.nls.DDLatLongNotation,conversionType:"DD"},{name:"DDrev",pattern:new RegExp([/^(([EW\+\-\s])*([0]?\d?\d([,.]\d*)?|1[0-7]\d([,.]\d*)?|180([,.]0*)?)([\u00b0\u02da\u00ba^~*]*)([EW\+\-\s])*)/,
/([,:;\s|\/\\]+)(([NS\+\-\s])*([0-8]?\d([,.]\d*)?|90([,.]0*)?)([\u00b0\u02da\u00ba^~*]*)([NS\+\-\s])*)$/].map(function(m){return m.source}).join("")),notationType:this.nls.DDLongLatNotation,conversionType:"DD"},{name:"DDM",pattern:new RegExp([/^(([NS\+\-\s])*([0-8]?\d|90)[\u00b0\u02da\u00ba^~*\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)['\u2032\s_]*([NS\+\-\s])*)/,/([,:;\s|\/\\]+)/,/(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[\u00b0\u02da\u00ba^~*\s\-_]+(([0-5]\d|\d)([,.]\d*)?)['\u2032\s_]*([EW\+\-\s])*)/,/[\s]*$/].map(function(m){return m.source}).join("")),
notationType:this.nls.DDMLatLongNotation,conversionType:"DDM"},{name:"DDMrev",pattern:new RegExp([/^(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[\u00b0\u02da\u00ba^~*\s\-_]+(([0-5]\d|\d)([,.]\d*)?)['\u2032\s_]*([EW\+\-\s])*)/,/([,:;\s|\/\\]+)/,/(([NS\+\-\s])*([0-8]?\d|90)[\u00b0\u02da\u00ba^~*\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)['\u2032\s_]*([NS\+\-\s])*)[\s]*$/].map(function(m){return m.source}).join("")),notationType:this.nls.DDMLongLatNotation,conversionType:"DDM"},{name:"DMS",pattern:new RegExp([/^(([NS\+\-\s])*([0-8]?\d|90)[\u00b0\u02da\u00ba^~*\s\-_]+([0-5]?\d|\d)['\u2032\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["\u00a8\u02dd\s_]*([NS\+\-\s])*)/,
/([,:;\s|\/\\]+)/,/(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[\u00b0\u02da\u00ba^~*\s\-_]+([0-5]\d|\d)['\u2032\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["\u00a8\u02dd\s_]*([EW\+\-\s])*)[\s]*$/].map(function(m){return m.source}).join("")),notationType:this.nls.DMSLatLongNotation,conversionType:"DMS"},{name:"DMSrev",pattern:new RegExp([/^(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[\u00b0\u02da\u00ba^~*\s\-_]+([0-5]\d|\d)['\u2032\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["\u00a8\u02dd\s_]*([EW\+\-\s])*)/,/([,:;\s|\/\\]+)/,/(([NS\+\-\s])*([0-8]?\d|90)[\u00b0\u02da\u00ba^~*\s\-_]+([0-5]?\d|\d)['\u2032\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["\u00a8\u02dd\s_]*([NS\+\-\s])*)[\s]*$/].map(function(m){return m.source}).join("")),
notationType:this.nls.DMSLongLatNotation,conversionType:"DMS"},{name:"GARS",pattern:/^\d{3}[a-zA-Z]{2}[1-4]?[1-9]?$/,notationType:this.nls.GARSNotation,conversionType:"GARS"},{name:"GEOREF",pattern:/^[a-zA-Z]{4}\d{1,8}$/,notationType:this.nls.GEOREFNotation,conversionType:"GEOREF"},{name:"MGRS",pattern:new RegExp([/^\d{1,2}[-,;:\s]*[C-HJ-NP-X][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*/,/(\d[-,;:\s]+\d|\d{2}[-,;:\s]+\d{2}|\d{3}[-,;:\s]+\d{3}|\d{4}[-,;:\s]+\d{4}|\d{5}[-,;:\s]+\d{5})/,/$|^(\d{1,2}[-,;:\s]*[C-HJ-NP-X][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*)/,
/(\d{2}|\d{4}|\d{6}|\d{8}|\d{10})?$|^[ABYZ][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*/,/(\d[-,;:\s]+\d|\d{2}[-,;:\s]+\d{2}|\d{3}[-,;:\s]+\d{3}|\d{4}[-,;:\s]+\d{4}|\d{5}[-,;:\s]+\d{5})/,/$|^[ABYZ][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*(\d{2}|\d{4}|\d{6}|\d{8}|\d{10})?$/].map(function(m){return m.source}).join("")),notationType:this.nls.MGRSNotation,conversionType:"MGRS"},{name:"UTM",pattern:new RegExp([/^\d{1,2}[-,;:\s]*[c-hj-np-xC-HJ-NP-X][-,;:\s]*\d{1,6}\.?\d*[mM]?[-,;:\s]?\d{1,7}\.?\d*[mM]?$/].map(function(m){return m.source}).join("")),
notationType:this.nls.UTMBandNotation,conversionType:"UTM"},{name:"UTM (H)",pattern:new RegExp([/^\d{1,2}[-,;:\s]*[NnSs][-,;:\s]*\d{1,6}\.?\d*[mM]?[-,;:\s]+\d{1,7}\.?\d*[mM]?$/].map(function(m){return m.source}).join("")),notationType:this.nls.UTMHemNotation,conversionType:"UTM (H)"}]},getCoordinateType:function(m){var l=this.getCleanInput(m);m=new p;var b=this.getNotations();l=k.filter(b,function(a){return a.pattern.test(this.v)},{v:l});0<l.length?m.resolve(l):m.resolve(null);return m.promise},getFormattedDDStr:function(m,
l,b){var a={};a.sourceValue=m;a.sourceFormatString=l;m=m[0].split(/[ ,]+/);a.latdeg=m[0].replace(/[nNsS]/,"");a.londeg=m[1].replace(/[eEwW]/,"");b&&(a.latdeg="N"===m[0].slice(-1)?"+"+a.latdeg:"-"+a.latdeg,a.londeg="W"===m[1].slice(-1)?"-"+a.londeg:"+"+a.londeg);l=l.replace(/X/,a.londeg);l=l.replace(/[eEwW]/,m[1].slice(-1));l=l.replace(/[nNsS]/,m[0].slice(-1));l=l.replace(/Y/,a.latdeg);a.formatResult=l;return a},getFormattedDDMStr:function(m,l,b){var a={};a.sourceValue=m;a.sourceFormatString=l;a.parts=
m[0].split(/[ ,]+/);a.latdeg=a.parts[0];a.latmin=a.parts[1].replace(/[nNsS]/,"");a.londeg=a.parts[2];a.lonmin=a.parts[3].replace(/[eEwW]/,"");b&&(a.latdeg="N"===a.parts[1].slice(-1)?"+"+a.latdeg:"-"+a.latdeg,a.londeg="W"===a.parts[3].slice(-1)?"-"+a.londeg:"+"+a.londeg);m=l.replace(/[EeWw]/,a.parts[3].slice(-1));m=m.replace(/Y/,a.lonmin);m=m.replace(/X/,a.londeg);m=m.replace(/[NnSs]/,a.parts[1].slice(-1));m=m.replace(/B/,a.latmin);m=m.replace(/A/,a.latdeg);a.formatResult=m;return a},getFormattedDMSStr:function(m,
l,b){var a={};a.sourceValue=m;a.sourceFormatString=l;a.parts=m[0].split(/[ ,]+/);a.latdeg=a.parts[0];a.latmin=a.parts[1];a.latsec=a.parts[2].replace(/[NnSs]/,"");a.londeg=a.parts[3];a.lonmin=a.parts[4];a.lonsec=a.parts[5].replace(/[EWew]/,"");b&&(a.latdeg="N"===a.parts[2].slice(-1)?"+"+a.latdeg:"-"+a.latdeg,a.londeg="W"===a.parts[5].slice(-1)?"-"+a.londeg:"+"+a.londeg);m=l.replace(/A/,a.latdeg);m=m.replace(/B/,a.latmin);m=m.replace(/C/,a.latsec);m=m.replace(/X/,a.londeg);m=m.replace(/Y/,a.lonmin);
m=m.replace(/Z/,a.lonsec);m=m.replace(/[NnSs]/,a.parts[2].slice(-1));m=m.replace(/[EeWw]/,a.parts[5].slice(-1));a.formatResult=m;return a},getFormattedUSNGStr:function(m,l){var b={};b.sourceValue=m;b.sourceFormatString=l;m[0].match(/^[ABYZ]/)?b.gzd=m[0].match(/[ABYZ]/)[0].trim():b.gzd=m[0].match(/\d{1,2}[C-HJ-NP-X]/)[0].trim();b.grdsq=m[0].replace(b.gzd,"").match(/[a-hJ-zA-HJ-Z]{2}/)[0].trim();b.easting=m[0].replace(b.gzd+b.grdsq,"").match(/^\d{1,5}/)[0].trim();b.northing=m[0].replace(b.gzd+b.grdsq,
"").match(/\d{1,5}$/)[0].trim();m=l.replace(/Y/,b.northing);m=m.replace(/X/,b.easting);m=m.replace(/S/,b.grdsq);m=m.replace(/Z/,b.gzd);b.formatResult=m;return b},getFormattedMGRSStr:function(m,l){var b={};b.sourceValue=m;b.sourceFormatString=l;m[0].match(/^[ABYZ]/)?b.gzd=m[0].match(/[ABYZ]/)[0].trim():b.gzd=m[0].match(/\d{1,2}[C-HJ-NP-X]/)[0].trim();b.grdsq=m[0].replace(b.gzd,"").match(/[a-hJ-zA-HJ-Z]{2}/)[0].trim();b.easting=m[0].replace(b.gzd+b.grdsq,"").match(/^\d{1,5}/)[0].trim();b.northing=m[0].replace(b.gzd+
b.grdsq,"").match(/\d{1,5}$/)[0].trim();m=l.replace(/Y/,b.northing);m=m.replace(/X/,b.easting);m=m.replace(/S/,b.grdsq);m=m.replace(/Z/,b.gzd);b.formatResult=m;return b},getFormattedGARSStr:function(m,l){var b={};b.sourceValue=m;b.sourceFormatString=l;b.lon=m[0].match(/\d{3}/);b.lat=m[0].match(/[a-zA-Z]{2}/);m=m[0].match(/\d*$/);b.quadrant=m[0][0];b.key=m[0][1];l=l.replace(/K/,b.key);l=l.replace(/Q/,b.quadrant);l=l.replace(/Y/,b.lat);l=l.replace(/X/,b.lon);b.formatResult=l;return b},getFormattedGEOREFStr:function(m,
l){var b={};b.sourceValue=m;b.sourceFormatString=l;b.lon=m[0].match(/[a-zA-Z]{1}/)[0].trim();b.lat=m[0].replace(b.lon,"").match(/[a-zA-Z]{1}/)[0].trim();b.quadrant15lon=m[0].replace(b.lon+b.lat,"").match(/[a-zA-Z]{1}/)[0].trim();b.quadrant15lat=m[0].replace(b.lon+b.lat+b.quadrant15lon,"").match(/[a-zA-Z]{1}/)[0].trim();m=m[0].replace(b.lon+b.lat+b.quadrant15lon+b.quadrant15lat,"");b.quadrant1lon=m.substr(0,m.length/2);b.quadrant1lat=m.substr(m.length/2,m.length);l=l.replace(/Y/,b.quadrant1lat);l=
l.replace(/X/,b.quadrant1lon);l=l.replace(/D/,b.quadrant15lat);l=l.replace(/C/,b.quadrant15lon);l=l.replace(/B/,b.lat);l=l.replace(/A/,b.lon);b.formatResult=l;return b},getFormattedUTMStr:function(m,l){var b={};b.sourceValue=m;b.sourceFormatString=l;b.parts=m[0].split(/[ ,]+/);b.zone=b.parts[0].replace(/[A-Z]/,"");b.bandLetter=b.parts[0].slice(-1);b.easting=b.parts[1];b.westing=b.parts[2];m=l.replace(/Y/,b.westing);m=m.replace(/X/,b.easting);m=m.replace(/B/,b.bandLetter);m=m.replace(/Z/,b.zone);b.formatResult=
m;return b},getFormattedUTMHStr:function(m,l){var b={};b.sourceValue=m;b.sourceFormatString=l;b.parts=m[0].split(/[ ,]+/);b.zone=b.parts[0].replace(/[A-Z]/,"");b.hemisphere=b.parts[0].slice(-1);b.easting=b.parts[1];b.westing=b.parts[2];m=l.replace(/Y/,b.westing);m=m.replace(/X/,b.easting);m=m.replace(/H/,b.hemisphere);m=m.replace(/Z/,b.zone);b.formatResult=m;return b},convertMetersToUnits:function(m,l){var b=0;switch(l.toLowerCase()){case "meters":b=m;break;case "feet":b=3.28084*m;break;case "kilometers":b=
.001*m;break;case "miles":b=6.21371E-4*m;break;case "nauticalMiles":b=5.39957E-4*m;break;case "yards":b=1.09361*m}return b},convertToMeters:function(m,l){var b=m;switch(l){case "meters":b=m;break;case "feet":b=.3048*m;break;case "kilometers":b=1E3*m;break;case "miles":b=1609.34*m;break;case "nauticalMiles":b=1852.001376036*m;break;case "yards":b=.9144*m}return b}})})},"widgets/Visibility/js/portal-publish":function(){define("dojo/_base/declare jimu/BaseWidget dijit/_WidgetsInTemplateMixin jimu/dijit/CheckBox dojo/_base/array dojo/_base/lang dojo/json dojo/text!../templates/portal-publish.html dojo/dom-construct dojo/on dojo/dom-class dojo/dom-style esri/arcgis/Portal dojo/Evented ./portal-utils jimu/LayerInfos/LayerInfos esri/layers/FeatureLayer esri/graphic esri/dijit/util/busyIndicator jimu/utils dojo/keys dijit/focus dojo/query dojo/topic dijit/form/ValidationTextBox jimu/dijit/formSelect".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q,v,u,t,y,D,B,E,x){return H([k,p,g],{templateString:a,baseClass:"jimu-widget-visibility-publish",publishNewLayer:null,busyIndicator:null,fieldsObj:null,postCreate:function(){String.prototype.format||(String.prototype.format=function(){var w=arguments;return this.replace(/{(\d+)}/g,function(A,z){return"undefined"!==typeof w[z]?w[z]:A})});this.addLayerNameArea&&(this.addLayerNameArea.invalidMessage=this.nls.invalidLayerName,this.addLayerNameArea.missingMessage=
this.nls.missingLayerNameMessage);this.fieldsObj={RegionType:{value:"",dataType:"esriFieldTypeInteger"},CenterPoint:{value:this.centerPoint,dataType:"esriFieldTypeString"},ObservationHeight:{value:this.observerHeight,dataType:"esriFieldTypeDouble"},HeightUnit:{value:this.observerHeightDD,dataType:"esriFieldTypeString"},MinObservationDistance:{value:this.minObsRange,dataType:"esriFieldTypeDouble"},MaxObservationDistance:{value:this.maxObsRange,dataType:"esriFieldTypeDouble"},DistanceUnit:{value:this.distanceUnitDD,
dataType:"esriFieldTypeString"},FOVStartAngle:{value:this.fovStartAngle,dataType:"esriFieldTypeDouble"},FOVEndAngle:{value:this.fovEndAngle,dataType:"esriFieldTypeDouble"},AngleUnits:{value:this.angleUnits,dataType:"esriFieldTypeString"}};this.fields={RegionType:"",CenterPoint:this.centerPoint,ObservationHeight:this.observerHeight,HeightUnit:this.observerHeightDD,MinObservationDistance:this.minObsRange,MaxObservationDistance:this.maxObsRange,DistanceUnit:this.distanceUnitDD,FOVStartAngle:this.fovStartAngle,
FOVEndAngle:this.fovEndAngle,AngleUnits:this.angleUnits};this.publishNewLayer=new r({checked:!1,label:this.nls.publishToNewLayer},d.create("div",{},this.checkBoxParentContainer));this.own(f(this.publishNewLayer,"change",l.hitch(this,this._onCheckboxClicked)));this._populateSelectList(this.featureLayerList,this._layerList,!0);0===this.featureLayerList.options.length&&(this.publishNewLayer.setValue(!0),e.add(this.checkBoxParentContainer,"esriCTHidden"));!this.config.hasOwnProperty("operationalLayer")||
this.config.hasOwnProperty("operationalLayer")&&this.config.operationalLayer.hasOwnProperty("name")&&""===this.config.operationalLayer.name?(e.add(this.featureLayerList.domNode,"esriCTHidden"),this.publishNewLayer.setValue(!0),e.remove(this.addLayerNameArea.domNode,"esriCTHidden")):(e.remove(this.featureLayerList.domNode,"esriCTHidden"),this.publishNewLayer.setValue(!1),e.add(this.addLayerNameArea.domNode,"esriCTHidden"));this.own(f(this.resultsPanelBackButton,"click",l.hitch(this,function(){this.emit("displayMainPageOnBack")})));
this.own(f(this.resultsPanelBackButton,"keydown",l.hitch(this,function(w){w.keyCode!==D.ENTER&&w.keyCode!==D.SPACE||this.emit("displayMainPageOnBack")})));this.own(f(this.publishButton,"click",l.hitch(this,function(){if(this.publishNewLayer.checked&&!this.addLayerNameArea.isValid())this.publishMessage.innerHTML=this.nls.missingLayerNameMessage;else{this.publishMessage.innerHTML="";var w={layerName:this.publishNewLayer.checked?this.addLayerNameArea.value:this.featureLayerList.getValue(),url:"",itemId:"",
serviceItemId:""};if(!this.publishNewLayer.checked){var A=this._layerList.filter(function(z){return z.name===w.layerName},this);1===A.length&&(w.url=A[0].url,w.itemId=A[0].id,w.serviceItemId=b.parse(A[0]._json).serviceItemId)}this._initSaveToPortal(w)}})));this.own(f(this.publishButton,"keydown",l.hitch(this,function(w){if(w.keyCode===D.ENTER||w.keyCode===D.SPACE)if(this.publishNewLayer.checked&&!this.addLayerNameArea.isValid())this.publishMessage.innerHTML=this.nls.missingLayerNameMessage,this._setFirstLastFocusNodes();
else{this.publishMessage.innerHTML="";var A={layerName:this.publishNewLayer.checked?this.addLayerNameArea.value:this.featureLayerList.getValue(),url:"",itemId:"",serviceItemId:"",map:this.map,appConfig:this.appConfig,renderer:this._renderer,publishMessage:this.publishMessage,nls:this.nls,graphics:this.ThreatArea.graphics};this.publishNewLayer.checked||(w=this._layerList.filter(function(z){return z.name===A.layerName},this),1===w.length&&(A.url=w[0].url,A.itemId=w[0].id,A.serviceItemId=b.parse(w[0]._json).serviceItemId));
this._initSaveToPortal(A)}})));this.own(x.subscribe("WIDGET_RESIZE",l.hitch(this,this._onWidgetResize)));this.own(f(this.featureLayerList,"change",l.hitch(this,function(){this._onWidgetResize()})))},startup:function(){this.busyIndicator=t.create({target:this.parentNode.parentNode.parentNode.parentNode,backgroundOpacity:0})},_onWidgetResize:function(){var w=E(".dijitValidationTextBoxLabel",this.featureLayerList.domNode);0<w.length&&h.set(w[0],"width",this.publishButton.clientWidth-53+"px")},_onCheckboxClicked:function(){this.publishNewLayer.checked?
(e.add(this.featureLayerList.domNode,"esriCTHidden"),e.remove(this.addLayerNameArea.domNode,"esriCTHidden"),this.addLayerNameArea.reset(),this.addLayerNameArea.focus()):(e.add(this.addLayerNameArea.domNode,"esriCTHidden"),e.remove(this.featureLayerList.domNode,"esriCTHidden"));this._addLayerToMap=this.publishNewLayer.checked},_containsSupportedCapabilities:function(w){var A=!0;["create","delete","query","update","editing"].forEach(function(z){-1===w.toLowerCase().split(",").indexOf(z)&&(A=!1)});return A},
_populateSelectList:function(w,A,z){var G=[];z&&(G=m.filter(A,function(I){return"esriGeometryPolygon"===I.geometryType},this));A=0<G.length?G:A;m.forEach(A,l.hitch(this,function(I){I.url&&"Feature Layer"===I.type&&this._containsSupportedCapabilities(I.capabilities)&&w.addOption({value:I.name,label:y.sanitizeHTML(I.name),selected:!1,id:I.id})}));this.config.hasOwnProperty("operationalLayer")&&this.config.operationalLayer.hasOwnProperty("name")&&""!==this.config.operationalLayer.name?w.setValue(this.config.operationalLayer.name):
w.setValue("")},_toLowerCaseProps:function(w){for(var A,z=Object.keys(w),G=z.length,I={};G--;)A=z[G],I[A.toLowerCase()]=w[A];return I},_initSaveToPortal:function(w){var A=w.layerName,z=new c.Portal(this.appConfig.portalUrl);this.own(f(z,"load",l.hitch(this,function(){z.signIn().then(l.hitch(this,function(G){var I=G.credential.token,K=G.orgId,R=G.username;if("org_user"===G.role)this.publishMessage.innerHTML=y.sanitizeHTML(this.nls.createService.format(this.nls.userRole)),this._setFirstLastFocusNodes();
else if(w.url){G=new v(w.url+"?token\x3d"+I,{id:w.layerName,outFields:["*"]});G._wabProperties={itemLayerInfo:{portalUrl:this.appConfig.portalUrl,itemId:w.itemId}};this.busyIndicator.show();var U=[];this.graphics.forEach(function(ca){if(void 0!==ca.attributes&&ca.attributes.hasOwnProperty("type")){var da=l.clone(this.fields);da.RegionType="visible"===ca.attributes.regionType?1:0;da=z.isPortal?this._toLowerCaseProps(da):da;U.push(new u(ca.geometry,null,da))}},this);G.applyEdits(U,null,null).then(l.hitch(this,
function(){x.publish("moveMap",!1);this.publishMessage.innerHTML=this.nls.successfullyPublished.format('\x3cbr /\x3e\x3ca href\x3d"'+this.appConfig.portalUrl+"home/item.html?id\x3d"+w.serviceItemId+'" target\x3d"_blank"\x3e')+"\x3c/a\x3e";this._reset()})).otherwise(l.hitch(this,function(ca){this.publishMessage.innerHTML=ca.message;this._reset()}));this.busyIndicator.hide();this._setFirstLastFocusNodes()}else{var ba=this.appConfig.portalUrl+"sharing/content/users/"+R+"/createService";n.isNameAvailable(this.appConfig.portalUrl+
"sharing/rest/portals/"+K+"/isServiceNameAvailable",I,A).then(l.hitch(this,function(ca){ca.available?(this.busyIndicator.show(),n.createFeatureService(ba,I,n.getFeatureServiceParams(A,this.map)).then(l.hitch(this,function(da){if(da.success){var ja=da.serviceurl.replace(/rest/g,"rest/admin")+"/addToDefinition";n.addDefinitionToService(ja,I,n.getLayerParams(A,this.map,this._renderer,this.nls)).then(l.hitch(this,function(ea){if(ea.success){ea=new v(da.serviceurl+"/0?token\x3d"+I,{id:A,outFields:["*"]});
ea._wabProperties={itemLayerInfo:{portalUrl:this.appConfig.portalUrl,itemId:da.itemId}};this.map.addLayer(ea);if(ea.loaded){var L=q.getInstanceSync().getLayerInfoById(A);L.enablePopup()}else ea.on("load",l.hitch(this,function(){L=q.getInstanceSync().getLayerInfoById(A);L.enablePopup()}));var O=[];m.forEach(this.graphics,function(S){if(void 0!==S.attributes&&S.attributes.hasOwnProperty("type")){var T=l.clone(this.fields);T.RegionType="visible"===S.attributes.regionType?1:0;T=z.isPortal?this._toLowerCaseProps(T):
T;O.push(new u(S.geometry,null,T))}},this);ea.applyEdits(O,null,null).then(l.hitch(this,function(){this._reset()})).otherwise(l.hitch(this,function(){this._reset()}));this.busyIndicator.hide();this.publishMessage.innerHTML=this.nls.successfullyPublished.format('\x3cbr /\x3e\x3ca role\x3d"link" tabindex\x3d0 aria-label\x3d"'+this.nls.successfullyPublished+'" href\x3d"'+this.appConfig.portalUrl+"home/item.html?id\x3d"+da.itemId+'" target\x3d"_blank"\x3e')+"\x3c/a\x3e";this._setFirstLastFocusNodes()}}),
l.hitch(this,function(ea){this.busyIndicator.hide();this.publishMessage.innerHTML=y.sanitizeHTML(this.nls.addToDefinition.format(ea.message));this._setFirstLastFocusNodes()}))}else this.busyIndicator.hide(),this.publishMessage.innerHTML=y.sanitizeHTML(this.nls.unableToCreate.format(A)),this._setFirstLastFocusNodes()}),l.hitch(this,function(da){this.busyIndicator.hide();this.publishMessage.innerHTML=y.sanitizeHTML(this.nls.createService.format(da.message));this._setFirstLastFocusNodes()}))):(this.busyIndicator.hide(),
this.publishMessage.innerHTML=this.nls.layerNameExists)}))}}),l.hitch(this,function(G){this.busyIndicator.hide();this.publishMessage.innerHTML=G.message;this._setFirstLastFocusNodes()}))})))},_reset:function(){this.graphicsLayer.clear();this.graphics=[];this.graphicsLayer.refresh()},_setFirstLastFocusNodes:function(){y.initFirstFocusNode(this.parentNode,this.resultsPanelBackButton);B.focus(this.resultsPanelBackButton);y.initLastFocusNode(this.parentNode,this.publishButton);var w=E("a",this.publishMessage)[0];
""!==this.publishMessage.innerHTML&&w?(y.initLastFocusNode(this.parentNode,this.publishMessage),B.focus(w)):""===this.publishMessage.innerHTML&&B.focus(this.resultsPanelBackButton)},_matchLayerFields:function(w,A){var z={},G=Object.keys(this.fieldsObj);m.forEach(A,l.hitch(this,function(I){m.forEach(G,l.hitch(this,function(K){if(I.name.toLowerCase()===K.toLowerCase()&&(I.type===this.fieldsObj[K].dataType||"esriFieldTypeString"===I.type)){var R=this.fieldsObj[K].value;"esriFieldTypeString"===I.type&&
50>I.length&&"string"===typeof this.fieldsObj[K].value&&(R=this.fieldsObj[K].value.substr(0,I.length));z[I.name]="RegionType"===K?w:R}}))}));return z}})})},"widgets/Visibility/js/portal-utils":function(){define(["esri/request","dojo/json"],function(H,k){return{getFeatureServiceParams:function(p,r){return{name:p,serviceDescription:"",hasStaticData:!1,maxRecordCount:1E3,supportedQueryFormats:"JSON",capabilities:"Create,Delete,Query,Update,Editing",tags:"GRG",description:"",copyrightText:"",spatialReference:r.spatialReference.toJson(),
initialExtent:r.extent.toJson(),allowGeometryUpdates:!0,units:"esriMeters",xssPreventionInfo:{xssPreventionEnabled:!0,xssPreventionRule:"InputOnly",xssInputRule:"rejectInvalid"}}},getLayerParams:function(p,r,m,l){return{layers:[{adminLayerInfo:{geometryField:{name:"Shape"},xssTrustedFields:""},id:0,name:p,type:"Feature Layer",displayField:"",description:"",tags:"GRG",copyrightText:"",defaultVisibility:!0,ownershipBasedAccessControlForFeatures:{allowOthersToQuery:!1,allowOthersToDelete:!1,allowOthersToUpdate:!1},
relationships:[],isDataVersioned:!1,supportsCalculate:!0,supportsAttachmentsByUploadId:!0,supportsRollbackOnFailureParameter:!0,supportsStatistics:!0,supportsAdvancedQueries:!0,supportsValidateSql:!0,supportsCoordinatesQuantization:!0,supportsApplyEditsWithGlobalIds:!0,advancedQueryCapabilities:{supportsPagination:!0,supportsQueryWithDistance:!0,supportsReturningQueryExtent:!0,supportsStatistics:!0,supportsOrderBy:!0,supportsDistinct:!0,supportsQueryWithResultType:!0,supportsSqlExpression:!0,supportsReturningGeometryCentroid:!0},
useStandardizedQueries:!1,geometryType:"esriGeometryPolygon",minScale:0,maxScale:0,extent:r.extent,drawingInfo:{renderer:m.toJson(),transparency:0},allowGeometryUpdates:!0,hasAttachments:!1,htmlPopupType:"esriServerHTMLPopupTypeNone",hasM:!1,hasZ:!1,objectIdField:"OBJECTID",globalIdField:"",typeIdField:"",fields:[{name:"OBJECTID",type:"esriFieldTypeOID",actualType:"int",alias:"OBJECTID",sqlType:"sqlTypeOther",nullable:!1,editable:!1,domain:null,defaultValue:null},{name:"RegionType",type:"esriFieldTypeInteger",
alias:l.regionTypeLabel,actualType:"nvarchar",nullable:!0,editable:!0,domain:null,defaultValue:null},{name:"CenterPoint",type:"esriFieldTypeString",alias:l.centerPointLabel,actualType:"nvarchar",nullable:!0,editable:!0,domain:null,defaultValue:null,sqlType:"sqlTypeNVarchar",length:50},{name:"ObservationHeight",type:"esriFieldTypeDouble",alias:l.observationHeightLabel,nullable:!0,editable:!0,domain:null,defaultValue:null},{name:"HeightUnit",type:"esriFieldTypeString",alias:l.heightUnitLabel,actualType:"nvarchar",
nullable:!0,editable:!0,domain:null,defaultValue:null,sqlType:"sqlTypeNVarchar",length:50},{name:"MinObservationDistance",type:"esriFieldTypeDouble",alias:l.minObservationDistanceLabel,nullable:!0,editable:!0,domain:null,defaultValue:null},{name:"MaxObservationDistance",type:"esriFieldTypeDouble",alias:l.maxObservationDistance,nullable:!0,editable:!0,domain:null,defaultValue:null},{name:"DistanceUnit",type:"esriFieldTypeString",alias:l.distanceUnitLabel,actualType:"nvarchar",nullable:!0,editable:!0,
domain:null,defaultValue:null,sqlType:"sqlTypeNVarchar",length:50},{name:"FOVStartAngle",type:"esriFieldTypeDouble",alias:l.fovstartAngleLabel,nullable:!0,editable:!0,domain:null,defaultValue:null},{name:"FOVEndAngle",type:"esriFieldTypeDouble",alias:l.fovEndAngleLabel,nullable:!0,editable:!0,domain:null,defaultValue:null},{name:"AngleUnits",type:"esriFieldTypeString",alias:l.AngleUnits,actualType:"nvarchar",nullable:!0,editable:!0,domain:null,defaultValue:null,sqlType:"sqlTypeNVarchar",length:50}],
indexes:[],types:[],templates:[{name:"New Feature",description:"",drawingTool:"esriFeatureEditToolPolygon",prototype:{attributes:{}}}],supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:1E4,standardMaxRecordCount:4E3,tileMaxRecordCount:4E3,maxRecordCountFactor:1,exceedsLimitFactor:1,capabilities:"Query,Editing,Create,Update,Delete"}]}},isNameAvailable:function(p,r,m){return H({url:p,content:{name:m,type:"Feature Service",token:r,f:"json"},handleAs:"json",callbackParamName:"callback"},{usePost:!0})},
createFeatureService:function(p,r,m){return H({url:p,content:{f:"json",token:r,typeKeywords:"ArcGIS Server,Data,Feature Access,Feature Service,Service,Hosted Service",createParameters:k.stringify(m),outputType:"featureService"},handleAs:"json",callbackParamName:"callback"},{usePost:!0})},addDefinitionToService:function(p,r,m){return H({url:p,content:{token:r,addToDefinition:k.stringify(m),f:"json"},handleAs:"json",callbackParamName:"callback"},{usePost:!0})}}})},"widgets/Visibility/js/symbologySettings":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/on ./ColorPickerEditor jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/text!../templates/symbologySettings.html dojo/_base/lang dojo/Evented dojo/dom-class dojo/dom-attr dojo/query dojo/keys jimu/utils dijit/focus jimu/dijit/formSelect jimu/dijit/SymbolChooser".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n,q){return H([l,b,f],{baseClass:"jimu-widget-visibility-symbologySettings",templateString:a,selectedSettings:{},colorPickerNodes:[],colorPickerObjList:[],constructor:function(v){d.mixin(this,v);this.colorPickerObjList=[];this.colorPickerNodes=[]},startup:function(){if(!this.config.hasOwnProperty("symbology"))var v={visibleSectionOutlineColor:{color:"#000000",transparency:1,type:"esriSLSSolid"},visibleSectionFillColor:{color:"#00ff00",transparency:.5,type:"esriSFSSolid"},
nonVisibleSectionOutlineColor:{color:"#000000",transparency:1,type:"esriSLSSolid"},nonVisibleSectionFillColor:{color:"#ff0000",transparency:.5,type:"esriSFSSolid"}};k.forEach(this.colorPickerNodes,d.hitch(this,function(t){var y=h.get(t,"nodeId");t=new m({nls:this.nls,type:e.contains(t,"Line")?"line":"fill",nodeId:y},t);t.setValues({color:v?v[y].color:this.config.symbology[y].color,transparency:v?v[y].transparency:this.config.symbology[y].transparency});t.startup();t.dropdown.set("value",v?v[y].type:
this.config.symbology[y].type);this.colorPickerObjList.push(t)}));var u=c(".jimu-color-pickerPopup",this.domNode);k.forEach(u,d.hitch(this,function(t){this.own(r(t,"keydown",d.hitch(this,function(y){y.keyCode!==g.ENTER&&y.keyCode!==g.SPACE||y.currentTarget.click()})))}));this.onSettingsChanged()},postCreate:function(){this.inherited(arguments);this.colorPickerObjList=[];this.colorPickerNodes=[];this.colorPickerNodes=c(".colorPicker",this.domNode);this._handleClickEvents();this.visibleSectionSettingsButton.click()},
_handleClickEvents:function(){this.own(r(this.visibleSectionSettingsButton,"click",d.hitch(this,function(){this._openCloseNodes(this.visibleSectionSettingsButton,this.visibleSectionContainer)})));this.own(r(this.nonVisibleSectionSettingsButton,"click",d.hitch(this,function(){this._openCloseNodes(this.nonVisibleSectionSettingsButton,this.nonVisibleSectionContainer)})));this.own(r(this.visibleSectionSettingsButton,"keydown",d.hitch(this,function(v){v.keyCode!==g.ENTER&&v.keyCode!==g.SPACE||this._openCloseNodes(this.visibleSectionSettingsButton,
this.visibleSectionContainer)})));this.own(r(this.nonVisibleSectionSettingsButton,"keydown",d.hitch(this,function(v){v.keyCode!==g.ENTER&&v.keyCode!==g.SPACE||this._openCloseNodes(this.nonVisibleSectionSettingsButton,this.nonVisibleSectionContainer)})))},_openCloseNodes:function(v,u){var t=c(".container",this.domNode),y=c(".esriCTSettingsButtonIcon",this.domNode),D=!1;this.validInputs()&&(v&&e.contains(v,"esriCTLabelSettingsRightButton")&&(D=!0),k.forEach(t,d.hitch(this,function(B){p.addClass(B,"esriCTGroupHidden")})),
k.forEach(y,d.hitch(this,function(B,E){p.removeClass(B,"esriCTLabelSettingsDownButton");p.addClass(B,"esriCTLabelSettingsRightButton");h.set(B,"aria-expanded","false");E===y.length-1&&setTimeout(d.hitch(this,function(){this._setLastFocusNode()}),100)})),D?(p.removeClass(u,"esriCTGroupHidden"),p.removeClass(v,"esriCTLabelSettingsRightButton"),p.addClass(v,"esriCTLabelSettingsDownButton"),h.set(v,"aria-expanded","true"),v=c(".jimu-color-picker",u),v.length&&q.focus(v[0])):q.focus(v))},onClose:function(){if(!this.validInputs())return!1;
this.onSettingsChanged();this._openCloseNodes()},onSettingsChanged:function(){k.forEach(this.colorPickerObjList,d.hitch(this,function(v){var u={color:v.getValues().color,transparency:v.getValues().transparency,type:v.dropdown.getValue()};this.selectedSettings[v.nodeId]=u}));this.emit("settingsChanged",this.selectedSettings)},validInputs:function(){var v=!0;k.some(this.colorPickerObjList,function(u){if(!u.validateSpinner())return v=!1,!0},this);return v},_setLastFocusNode:function(){var v=this.colorPickerObjList.length-
1;this.refDomNode&&(e.contains(this.nonVisibleSectionSettingsButton,"esriCTLabelSettingsDownButton")?n.initLastFocusNode(this.refDomNode,this.colorPickerObjList[v].dropdown.domNode):n.initLastFocusNode(this.refDomNode,this.nonVisibleSectionSettingsButton))}})})},"widgets/Visibility/js/ColorPickerEditor":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/Color dojo/on dojo/query dojo/_base/html dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!../templates/ColorPickerEditor.html dijit/form/HorizontalSlider jimu/dijit/ColorPickerPopup dojo/dom-style dojo/_base/kernel dijit/form/NumberSpinner".split(" "),
function(H,k,p,r,m,l,b,a,d,f,e,h,c,g,n){return H([a,d,f],{_defaultColor:"#485566",templateString:e,nls:null,postCreate:function(){this.colorPicker=new c({color:this._defaultColor,tabindex:0,"aria-label":this.nls.colorPicker},this.colorPicker);this.colorPicker.startup();this.slider=new h({name:"slider",value:100,minimum:0,maximum:100,discreteValues:101,intermediateChanges:!0,showButtons:!1,style:"display: inline-block;","aria-label":this.nls.transparency},this.sliderBar);this.slider.startup();"vi"===
n.locale&&g.set(this.sliderBarLabel.domNode,"white-space","nowrap");var q=[],v,u="esriSLSDash esriSLSDashDot esriSLSDashDotDot esriSLSDot esriSLSLongDash esriSLSLongDashDot esriSLSNull esriSLSShortDash esriSLSShortDashDot esriSLSShortDashDotDot esriSLSShortDot esriSLSSolid".split(" "),t="esriSFSBackwardDiagonal esriSFSCross esriSFSDiagonalCross esriSFSForwardDiagonal esriSFSHorizontal esriSFSNull esriSFSSolid esriSFSVertical".split(" ");"line"===this.type?k.forEach(u,p.hitch(this,function(y){v={value:y,
label:this.nls.lineStyles[y]};q.push(v)})):k.forEach(t,p.hitch(this,function(y){v={value:y,label:this.nls.fillStyles[y]};q.push(v)}));this.dropdown.addOption(q);this.inherited(arguments)},startup:function(){this.own(m(this.slider,"change",p.hitch(this,function(q){!1===this._isSameVal()&&this.spinner.setValue(q)})));this.own(m(this.spinner,"change",p.hitch(this,function(q){q<=this.slider.maximum&&this.slider.setValue(q)})));this._stylePolyfill();this.inherited(arguments)},_isSameVal:function(){return this.slider.getValue()===
this.spinner.getValue()},getValues:function(){var q=null,v=null;(v=this.colorPicker.getColor())&&v.toHex&&(q=v.toHex());v=this.spinner.getValue()/100;return{color:q,transparency:v}},setValues:function(q){if("object"===typeof q||"string"===typeof q)this.colorPicker.setColor(new r(q.color)),q.transparency="undefined"===typeof q.transparency?0:100*q.transparency,this.slider.setValue(q.transparency),this.spinner.setValue(q.transparency)},_stylePolyfill:function(){var q=l(".dijitSliderLeftBumper",this.domNode)[0];
q&&q.parentNode&&b.setStyle(q.parentNode,"background-color","#24b5cc")},validateSpinner:function(){var q=!0;this.spinner.isValid()||(this._shake(this.spinner.domNode,16),this.spinner.focus(),q=!1);return q},_shake:function(q,v){function u(){if(15>t){q.style.transform="translate(0px, 0px)";v-=y;var E=D(-v,v),x=D(-v,v);q.style.transform="translate("+E+"px, "+x+"px)";t+=1;requestAnimationFrame(u)}15<=t&&(q.style.transform="translate(0, 0)",B._shakingElements.splice(B._shakingElements.indexOf(q),1))}
var t=1,y=v/15,D=function(E,x){return Math.floor(Math.random()*(x-E+1))+E};this._shakingElements||(this._shakingElements=[]);if(-1===this._shakingElements.indexOf(q)){this._shakingElements.push(q);var B=this;u()}}})})},"jimu/dijit/ColorPickerPopup":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dijit/TooltipDialog dijit/popup jimu/dijit/ColorPalette jimu/utils".split(" "),function(H,k,p,r,m,l,b,a,d,f,e){return H([k,
p],{baseClass:"jimu-color-pickerPopup",declaredClass:"jimu.dijit.ColorPickerPopup",templateString:'\x3cdiv class\x3d"jimu-color-picker"\x3e\x3c/div\x3e',_isTooltipDialogOpened:!1,color:null,showLabel:!1,around:null,_ENABLE:!0,recordUID:"",postCreate:function(){this.inherited(arguments);this._createTooltipDialog(this.domNode);this._hideTooltipDialog()},destroy:function(){d.close(this.tooltipDialog);this.picker.destroy();this.tooltipDialog.destroy();this.inherited(arguments)},enable:function(){this._ENABLE=
!0;m.removeClass(this.domNode,"disable")},disable:function(){this._ENABLE=!1;m.addClass(this.domNode,"disable")},isPartOfPopup:function(h){var c=this.tooltipDialog.domNode;return h===c||m.isDescendant(h,c)},hideTooltipDialog:function(){this._hideTooltipDialog()},showTooltipDialog:function(){this._showTooltipDialog()},initUI:function(){this.picker.initUI()},isOpen:function(){return this._isTooltipDialogOpened},_showTooltipDialog:function(){d.open({parent:this.getParent(),popup:this.tooltipDialog,around:this.around?
this.around:this.domNode,orient:this.orient});this._isTooltipDialogOpened=!0},_hideTooltipDialog:function(){d.hide(this.tooltipDialog);this._isTooltipDialogOpened=!1},_createTooltipDialog:function(){var h=m.create("div");this.tooltipDialog=new a({content:h});m.addClass(this.tooltipDialog.domNode,"jimu-color-picker-popup-dialog");var c=new f({appearance:{showTransparent:!1,showColorPalette:!0,showCoustom:!0,showColorPickerOK:!0,showColorPickerApply:!0,showCoustomRecord:!0,closeDialogWhenChange:!0},
recordUID:this.recordUID,onChange:r.hitch(this,function(g){g&&(g=new b(g),this.setColor(g),this.onChange(g))})});c.placeAt(h);c.startup();this.own(l(c,"close",r.hitch(this,function(){this._hideTooltipDialog()})));this.own(l(c,"change-style",r.hitch(this,function(){this._hideTooltipDialog();this._showTooltipDialog()})));this.own(l(this.domNode,"click",r.hitch(this,function(g){g.stopPropagation();g.preventDefault();this._isTooltipDialogOpened?this._hideTooltipDialog():!1!==this._ENABLE&&this._showTooltipDialog()})));
this.own(l(document,"click",r.hitch(this,function(g){this.isPartOfPopup(g.srcElement||g.target)||this._hideTooltipDialog()})));this.picker=c},setColor:function(h){if(h instanceof b){null===this.color&&!0===this.showLabel&&this._changeLabel(h);var c=h.toHex();this.color=h;m.setStyle(this.domNode,"backgroundColor",c);this.picker&&(this.picker.refreshRecords(),this.picker.setColor(c,!1,!0));this.showLabel&&this._changeLabel(this.color)}},getColor:function(){return this.color},_changeLabel:function(h){m.empty(this.domNode);
m.create("span",{innerHTML:h.toHex(),className:"color-label",style:{color:e.invertColor(h.toHex())}},this.domNode)},onChange:function(h){h&&this.showLabel&&this._changeLabel(h)},changeColor:function(){this.picker&&this.picker.changeColor();this.showLabel&&this._changeLabel(this.color)},setTitle:function(h){this.domNode.title=h},getTooltipDialog:function(){return this.tooltipDialog||null}})})},"widgets/Visibility/js/jquery.knob.min":function(){define(["jimu/loaderplugins/jquery-loader! ./libs/jquery/jquery-1-11-1.js"],
function(H){var k=Math.max,p=Math.min;var r=void 0;r=H(document);var m=function(){var b=this;this.cv=this.v=this.g=this.i=this.$=this.o=null;this.h=this.w=this.y=this.x=0;this.c=this.$c=null;this.t=0;this.isInit=!1;this.rH=this.eH=this.cH=this.dH=this.pColor=this.fgColor=null;this.scale=1;this.relativeHeight=this.relativeWidth=this.relative=!1;this.$div=null;this.run=function(){var a=function(d,f){for(var e in f)b.o[e]=f[e];b._carve().init();b._configure()._draw()};if(!this.$.data("kontroled")){this.$.data("kontroled",
!0);this.extend();this.o=H.extend({min:void 0!==this.$.data("min")?this.$.data("min"):0,max:void 0!==this.$.data("max")?this.$.data("max"):100,stopper:!0,readOnly:this.$.data("readonly")||"readonly"===this.$.attr("readonly"),cursor:!0===this.$.data("cursor")&&90||this.$.data("cursor")||0,thickness:this.$.data("thickness")&&Math.max(Math.min(this.$.data("thickness"),1),.01)||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null===
this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#999",inputColor:this.$.data("inputcolor"),font:this.$.data("font")||"Arial",fontWeight:this.$.data("font-weight")||"bold",inline:!1,step:this.$.data("step")||1,rotation:this.$.data("rotation"),units:"degrees",milsValue:0,draw:null,change:null,cancel:null,release:null,format:function(d){return d},parse:function(d){return d}},this.o);this.o.flip="anticlockwise"===
this.o.rotation||"acw"===this.o.rotation;this.o.inputColor||(this.o.inputColor=this.o.fgColor);this.i=this.$;this.v=this.o.parse(this.$.val());this.$.bind("change blur",function(){"mils"===b.o.units&&(b.o.milsValue=b.$.val());b.val(b._validate(b.o.parse("degrees"===b.o.units?b.$.val():b.$.val()/17.777777777778)));b.o.cursor="degrees"===b.o.units?b.$.val():b.$.val()/17.777777777778;b.o.inputColor=0!==b.$.val()?"#ccc":"#f37371";b._carve().init();b._draw()});this.$c=H(document.createElement("canvas")).attr({width:this.o.width,
height:this.o.height});this.$div=H('\x3cdiv style\x3d"'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"\x3e\x3c/div\x3e');this.$.wrap(this.$div).before(this.$c);this.$div=this.$.parent();"undefined"!==typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.$c[0]);this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null;if(!this.c)throw{name:"CanvasNotSupportedException",message:"Canvas not supported. Please use excanvas on IE8.0.",toString:function(){return this.name+
": "+this.message}};this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1);this.relativeWidth=0!==this.o.width%1&&this.o.width.indexOf("%");this.relativeHeight=0!==this.o.height%1&&this.o.height.indexOf("%");this.relative=this.relativeWidth||this.relativeHeight;this._carve();this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=
this.v;this.$.bind("configure",a).parent().bind("configure",a);this._listen()._configure()._xy().init();this.isInit=!0;this._draw();return this}};this._carve=function(){if(this.relative){var a=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width,10)/100:this.$div.parent().width(),d=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height,10)/100:this.$div.parent().height();this.w=this.h=Math.min(a,d)}else this.w=this.o.width,this.h=this.o.height;this.$div.css({width:this.w+
"px",height:this.h+"px"});this.$c.attr({width:this.w,height:this.h});1!==this.scale&&(this.$c[0].width*=this.scale,this.$c[0].height*=this.scale,this.$c.width(this.w),this.$c.height(this.h));return this};this._draw=function(){var a=!0;b.g=b.c;b.clear();b.dH&&(a=b.dH());!1!==a&&b.draw()};this._mouse=function(a){var d=function(f){f=b.xy2val(f.pageX,f.pageY);f===b.cv||b.cH&&!1===b.cH(f)||(b.change(b._validate(f)),b._draw())};d(a);r.bind("mousemove.k",d).bind("keyup.k",function(f){27===f.keyCode&&(r.unbind("mouseup.k mousemove.k keyup.k"),
b.eH&&!1===b.eH()||b.cancel())}).bind("mouseup.k",function(){r.unbind("mousemove.k mouseup.k keyup.k");b.val(b.cv)});return this};this._xy=function(){var a=this.$c.offset();this.x=a.left;this.y=a.top;return this};this._listen=function(){this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(a){a.preventDefault();b._xy()._mouse(a)}),this.listen());this.relative&&H(window).resize(function(){b._carve().init();b._draw()});return this};this._configure=function(){this.o.draw&&
(this.dH=this.o.draw);this.o.change&&(this.cH=this.o.change);this.o.cancel&&(this.eH=this.o.cancel);this.o.release&&(this.rH=this.o.release);this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.5"),this.fgColor=this.h2rgba(this.o.fgColor,"0.5")):this.fgColor=this.o.fgColor;return this};this._clear=function(){this.$c[0].width=this.$c[0].width};this._validate=function(a){return Math.round(~~((0>a?-.5:.5)+a/this.o.step)*this.o.step*100)/100};this.listen=function(){};this.extend=function(){};
this.init=function(){};this.change=function(){};this.val=function(){};this.xy2val=function(){};this.draw=function(){};this.clear=function(){this._clear()};this.h2rgba=function(a,d){a=a.substring(1,7);a=[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)];return"rgba("+a[0]+","+a[1]+","+a[2]+","+d+")"};this.copy=function(a,d){for(var f in a)d[f]=a[f]}};var l=function(){m.call(this);this.w2=this.cursorExt=this.lineWidth=this.radius=this.xy=this.startAngle=null;
this.PI2=2*Math.PI;this.extend=function(){this.o=H.extend({bgColor:this.$.data("bgcolor")||"#999",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)};this.val=function(b,a){if(null!==b)b=this.o.parse(b),!1!==a&&b!==this.v&&this.rH&&!1===this.rH(b)||(this.v=this.cv=this.o.stopper?k(p(b,this.o.max),this.o.min):b,this._draw());else return this.v};this.xy2val=function(b,a){b=Math.atan2(b-(this.x+this.w2),-(a-this.y-this.w2))-this.angleOffset;this.o.flip&&
(b=this.angleArc-b-this.PI2);this.angleArc!==this.PI2&&0>b&&-.5<b?b=0:0>b&&(b+=this.PI2);b=b*(this.o.max-this.o.min)/this.angleArc+this.o.min;this.o.stopper&&(b=k(p(b,this.o.max),this.o.min));return b};this.listen=function(){var b=this,a,d;this.$.bind("keydown",function(f){var e=f.keyCode;96<=e&&105>=e&&(e=f.keyCode=e-48);a=parseInt(String.fromCharCode(e),10);isNaN(a)&&13!==e&&8!==e&&9!==e&&f.preventDefault()}).bind("keyup",function(){isNaN(a)?d&&(window.clearTimeout(d),d=null,b.val(b.$.val())):b.$.val()>
b.o.max&&b.$.val(b.o.max)||b.$.val()<b.o.min&&b.$.val(b.o.min)})};this.init=function(){if(this.v<this.o.min||this.v>this.o.max)this.v=this.o.min;"degrees"===this.o.units?this.$.val(this.v):this.$.val(this.o.milsValue);this.w2=this.w/2;this.cursorExt=this.o.cursor*Math.PI/180/2;this.xy=this.w2*this.scale;this.lineWidth=this.xy*this.o.thickness;this.lineCap=this.o.lineCap;this.radius=this.xy-this.lineWidth/2;this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset);this.o.angleArc&&
(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc);this.angleOffset=this.o.angleOffset*Math.PI/180;this.angleArc=this.o.angleArc*Math.PI/180;this.startAngle=1.5*Math.PI+this.angleOffset;this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var b=k(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:this.w/2+4+"px",height:this.w/3+"px",position:"absolute","vertical-align":"middle","margin-top":this.w/3+"px","margin-left":"-"+
(3*this.w/4+2)+"px",border:0,background:"none",font:this.o.fontWeight+" "+this.w/b+"px "+this.o.font,"text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})};this.change=function(b){this.cv=b};this.angle=function(b){return(b-this.o.min)*this.angleArc/(this.o.max-this.o.min)};this.arc=function(b){b=this.angle(b);if(this.o.flip){var a=this.endAngle+1E-5;b=a-b-1E-5}else a=this.startAngle-1E-5,b=a+b+1E-5;
this.o.cursor&&(a=b-this.cursorExt)&&(b+=this.cursorExt);return{s:a,e:b,d:this.o.flip&&!this.o.cursor}};this.draw=function(){var b=this.g,a=this.arc(this.cv);var d=1;b.lineWidth=this.lineWidth;b.lineCap=this.lineCap;"none"!==this.o.bgColor&&(b.beginPath(),b.strokeStyle=this.o.bgColor,b.arc(this.xy,this.xy,this.radius,this.endAngle-1E-5,this.startAngle+1E-5,!0),b.stroke());this.o.displayPrevious&&(d=this.arc(this.v),b.beginPath(),b.strokeStyle=this.pColor,b.arc(this.xy,this.xy,this.radius,d.s,d.e,
d.d),b.stroke(),d=this.cv===this.v);b.beginPath();b.strokeStyle=d?this.o.fgColor:this.fgColor;b.arc(this.xy,this.xy,this.radius,a.s,a.e,a.d);b.stroke()};this.cancel=function(){this.val(this.v)}};H.fn.dial=H.fn.knob=function(b){return this.each(function(){var a=new l;a.o=b;a.$=H(this);a.run()}).parent()}})},"jimu/loaderplugins/jquery-loader":function(){define(["dojo/Deferred","dojo/when"],function(H,k){var p,r={},m=function(d){var f=new H;if(r.locked)return setTimeout(function(){m(d)},50),f;if(r[d])return r.locked=
!0,f.resolve(r[d]),f;r.locked=!0;p([d],function(){r[d]=window.jQuery;f.resolve(r[d])});return f},l=function(d,f,e){p([d[f]],function(){f===d.length-1?e.resolve():(f++,l(d,f,e))})},b=function(d,f){d=new H;f[0]?l(f,0,d):d.resolve();return d},a=function(d,f){var e=new H;m(d).then(function(h){b(d,f).then(function(){r.locked=!1;e.resolve(h)})});return e};return{load:function(d,f,e){d=d.split(",");var h=[];p=f;0===d.length?e(null):(f=d[0],h=d.slice(1),k(a(f,h),e))}}})},"widgets/Visibility/js/PrivilegeUtil":function(){define("dojo/_base/declare dojo/_base/lang jimu/portalUtils jimu/portalUrlUtils jimu/Role esri/lang".split(" "),
function(H,k,p,r,m,l){var b=null,a=H([],{userRole:null,userPortalUrl:null,portalAnalysis:null,portalSelf:null,portalUrl:null,_isServiceAvailable:!1,constructor:function(d){this.portalUrl=d},_clearLoadedInfo:function(){this.portalUrl=this.portalSelf=this.userPortalUrl=this.userRole=null},loadPrivileges:function(d){this.portalSelf=this.userPortalUrl=this.userRole=null;this._isServiceAvailable=!1;d&&(this.portalUrl=d);d=p.getPortal(this.portalUrl);return d.haveSignIn()?this._loadUserInfo(d):this._signIn(d)},
getPortalUrl:function(d){return d?r.getStandardPortalUrl(d):this.portalUrl?r.getStandardPortalUrl(this.portalUrl):r.getStandardPortalUrl(this.appConfig.portalUrl)},_privilegeLoaded:function(){return null!==this.portalSelf},getUserPortal:function(){return this._privilegeLoaded()?this.getPortalUrl(this.userPortalUrl):null},_signIn:function(d){return d.loadSelfInfo().then(k.hitch(this,function(f){var e=p.getPortal(f.portalHostname);return null===e?!1:e.signIn().then(k.hitch(this,function(h){return this._loadUserInfo(e,
h)}),function(){return!1})}),function(){return!1})},_loadUserInfo:function(d){return d.loadSelfInfo().then(k.hitch(this,function(f){this.userPortalUrl=f.urlKey?f.urlKey+"."+f.customBaseUrl:this.portalUrl;return f&&f.user?(this.userRole=new m({id:f.user.roleId?f.user.roleId:f.user.role,role:f.user.role}),f.user.privileges&&this.userRole.setPrivileges(f.user.privileges),this.portalSelf=f,!0):!1}),function(){return!1})},_canPerformElevationAnalysis:function(){this.portalSelf&&(this._isServiceAvailable=
l.isDefined(this.portalSelf.helperServices.elevation));return this.canPerformAnalysis()&&this._isServiceAvailable},canPerformAnalysis:function(){var d=!1;this.userRole&&(this.userRole.isAdmin()||this.userRole.isPublisher())?d=!0:this.userRole&&this.userRole.isCustom()&&(d=this.userRole.canCreateItem()&&this.userRole.canPublishFeatures()&&this.userRole.canUseSpatialAnalysis());this.portalSelf&&this.portalSelf.isPortal&&(d=d&&l.isDefined(this.portalSelf.helperServices.analysis)&&l.isDefined(this.portalSelf.helperServices.analysis.url));
return d}});a.getInstance=function(d){null===b&&(b=new a(d));return b};return a})},"widgets/Visibility/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/Visibility/templates/VisibilityControl.html":'\x3cdiv\x3e\r\n\x3cdiv class\x3d"" data-dojo-attach-point\x3d"visibiltyWidget"\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTNewHeader"\x3e\r\n\x3c!-- Panel Title --\x3e\r\n\x3cdiv class\x3d"esriCTMainTitleDiv esriCTEllipsis" title\x3d"${nls.mainPageTitle}"\x3e\r\n  ${nls.mainPageTitle}\r\n  \x3c/div\x3e\r\n  \x3c!-- Settings Icon --\x3e\r\n  \x3cdiv class\x3d"esriCTRightSideButton"\x3e\r\n    \x3cdiv class\x3d"esriCTSettingsIcon esriCTPointer" title\x3d"${nls.settingsTitle}" tabindex\x3d"0" role\x3d\'button\'\r\n    aria-label\x3d\'${nls.settingsTitle}\' data-dojo-attach-point\x3d"settingsIcon"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTSaveToLayerIcon esriCTPointer esriCTHidden" title\x3d"${nls.resultsTitle}" tabindex\x3d"0"  role\x3d\'button\' aria-label\x3d\'${nls.resultsTitle}\' data-dojo-attach-point\x3d"saveToLayerIcon"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3clabel data-dojo-attach-point\x3d"errorText" style\x3d"display: none"\x3e\x3c/label\x3e\r\n  \x3cdiv class\x3d"controls" data-dojo-attach-point\x3d"controls"\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"observerCoordsContainer"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel class\x3d"titleLabel" data-dojo-attach-point\x3d"FOVLabel"\x3e${nls.fieldOfView}\x3c/label\x3e\r\n      \x3cdiv class\x3d"center" data-dojo-attach-point\x3d"FOVGroup"\x3e\r\n        \x3cinput type\x3d"text" value\x3d"360" class\x3d"fov" data-displayInput\x3d"true" data-cursor\x3d"true" disabled\x3d"true"\r\n          data-dojo-attach-point\x3d"FOVInput" aria-label\x3d"${nls.fieldOfView}" /\x3e\r\n        \x3cp class\x3d"cursortooltip" data-dojo-attach-point\x3d"tooltip" hidden\x3d\'true\'\x3e\x3c/p\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3cinput class\x3d"switch-toggle" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-attach-point\x3d"angleUnits" checked\x3d"false" aria-label\x3d"${nls.useMilsText}"/\x3e\r\n      \x3clabel class\x3d"titleLabel"\x3e${nls.useMilsText}\x3c/label\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel class\x3d"titleLabel"\x3e${nls.observerHeight}\x3c/label\x3e\r\n      \x3cdiv\x3e\r\n        \x3cinput class\x3d"inputNumberTextbox" data-dojo-type\x3d\'dijit/form/NumberTextBox\' required\x3d"true" value\x3d"2"\r\n          data-dojo-props\x3d\'constraints: {min: 0}\' data-dojo-attach-point\x3d"observerHeight" aria-label\x3d"${nls.observerHeight}"\x3e\r\n        \x3cselect style\x3d"width: 100px" class\x3d"controlSpace noResize" data-dojo-type\x3d"jimu/dijit/formSelect"\r\n          data-dojo-attach-point\x3d"observerHeightDD" aria-label\x3d"${nls.observerHeight}"\x3e\r\n        \x3c/select\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel class\x3d"titleLabel"\x3e${nls.minObsDistance}\x3c/label\x3e\r\n      \x3cdiv\x3e\r\n        \x3cinput class\x3d"inputNumberTextbox" data-dojo-type\x3d\'dijit/form/NumberTextBox\' required\x3d"true" value\x3d"3"\r\n          data-dojo-props\x3d\'constraints: {min: 0},intermediateChanges:true\' data-dojo-attach-point\x3d"minObsRange"\r\n          aria-label\x3d"${nls.minObsDistance}"\x3e\r\n        \x3cselect style\x3d"width: 100px" class\x3d"controlSpace noResize" data-dojo-type\x3d"jimu/dijit/formSelect"\r\n          data-dojo-attach-point\x3d"distanceUnitDD" aria-label\x3d"${nls.minObsDistance}"\x3e\r\n        \x3c/select\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel class\x3d"titleLabel"\x3e${nls.maxObsDistance}\x3c/label\x3e\r\n      \x3cdiv\x3e\r\n        \x3cinput class\x3d"inputNumberTextbox" data-dojo-type\x3d\'dijit/form/NumberTextBox\' required\x3d"true" value\x3d"5"\r\n          data-dojo-props\x3d\'constraints: {min: 0}\' data-dojo-attach-point\x3d"maxObsRange" aria-label\x3d"${nls.maxObsDistance}"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"buttonContainer" data-dojo-attach-point\x3d"buttonContainer"\x3e\r\n      \x3cdiv class\x3d"btnContainer HalfWidthLeft"\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"btnCreate" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.createBtn}"\x3e${nls.createBtn}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"btnContainer HalfWidthRight"\x3e\r\n        \x3cdiv class\x3d"jimu-btn controlSpace" data-dojo-attach-point\x3d"btnClear" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.clearBtn}"\x3e${nls.clearBtn}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n\x3c/div\x3e\r\n\x3cdiv class\x3d"esriCTHidden" data-dojo-attach-point\x3d"portalPublishContainer"\x3e\x3c/div\x3e\r\n\x3cdiv class\x3d"esriCTHidden" data-dojo-attach-point\x3d"settingsContainer"\x3e\r\n  \x3cdiv\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTSettingHeader"\x3e\r\n      \x3cdiv class\x3d"esriCTBackButton" title\x3d"${nls.back}"\x3e\r\n        \x3cdiv class\x3d"esriCTItemLeftArrow" data-dojo-attach-point\x3d"settingsPanelBackButton" tabindex\x3d"0"\r\n          aria-label\x3d"${nls.back}" role\x3d"button"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTTitleDiv esriCTEllipsis" title\x3d"${nls.settingsTitle}"\x3e${nls.settingsTitle}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTMainPageRow"\x3e\r\n      \x3cdiv style\x3d"overflow: hidden;" data-dojo-attach-point\x3d"symbologySettingsNode"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/SingleFilter.html":'\x3cdiv class\x3d"esriSingleFilterForm singleFilter" id\x3d"${id}.singleFilter"\x3e\r\n  \x3cdiv\x3e\r\n    \x3ctable id\x3d"${id}.exprTable" class\x3d"rowTable" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column1"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column2"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column3"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column4"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column5"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column6"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column7"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3ca id\x3d"${id}.deleteExpression" href\x3d"JavaScript:void(0);" style\x3d"margin:0 5px;display:none;" class\x3d"esriAGOFilterRemoveIcon" title\x3d"${i18n.deleteExpression}"\x3e\x3c/a\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_interactiveFilterRow"\x3e\r\n          \x3ctd colspan\x3d"8"\x3e\r\n            \x3ctable cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"interactiveFilter"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd nowrap\x3d"nowrap"\x3e\r\n                    \x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n                      \x3ctbody\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            \x3cinput dojoAttachPoint\x3d"interactiveCheck" type\x3d"checkbox" class\x3d"promptCheckBox" title\x3d"${i18n.promptMsg}"/\x3e\r\n                          \x3c/td\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            \x3clabel class\x3d"labels" for\x3d"promptCheckBox"\x3e\r\n                              \x26nbsp;\x26nbsp;${i18n.askForValues}\r\n                            \x3c/label\x3e\r\n                          \x3c/td\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cspan dojoAttachPoint\x3d"interactiveArrow" style\x3d"color:#cbcbcb;cursor:pointer;" class\x3d"showHidePromptDiv"\x3e\x26nbsp;\x26#9660;\x3c/span\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                      \x3c/tbody\x3e\r\n                    \x3c/table\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr dojoAttachPoint\x3d"interactiveSpace" style\x3d"display:none"\x3e\r\n                  \x3ctd nowrap\x3d"nowrap"\x3e\r\n                    \x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n                      \x3ctbody\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            ${i18n.prompt}\r\n                          \x3c/td\x3e\r\n                          \x3ctd width\x3d"10"\x3e\r\n                            \x26nbsp;\r\n                          \x3c/td\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cdiv dojoAttachPoint\x3d"promptText" dojotype\x3d"dijit.form.TextBox" intermediateChanges\x3d"true" style\x3d"width:250px;"\x3e\r\n                            \x3c/div\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            ${i18n.hint}\r\n                          \x3c/td\x3e\r\n                          \x3ctd width\x3d"10"\x3e\r\n                            \x26nbsp;\r\n                          \x3c/td\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cdiv dojoAttachPoint\x3d"hintText" dojotype\x3d"dijit.form.TextBox" intermediateChanges\x3d"true" style\x3d"width:250px;"\x3e\r\n                            \x3c/div\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                      \x3c/tbody\x3e\r\n                    \x3c/table\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"promptDiv" style\x3d"display:none;padding:10px 0px;"\x3e\r\n    \x3clabel class\x3d"labels promptLabels" for\x3d"txtPrompt"\x3e\r\n      ${i18n.prompt}\r\n    \x3c/label\x3e\r\n    \x3cinput class\x3d"promptFields txtPrompt" type\x3d"text"/\x3e\r\n    \x3cbr/\x3e\r\n    \x3clabel class\x3d"labels promptLabels" for\x3d"txtHint"\x3e\r\n      ${i18n.hint}\r\n    \x3c/label\x3e\r\n    \x3cinput class\x3d"promptFields txtHint" type\x3d"text" /\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/actionBar.html":"\x3cdiv class\x3d'dijitDialogPaneActionBar' data-dojo-attach-point\x3d\"actionBarNode\"\x3e\r\n\t\x3cbutton data-dojo-type\x3d'dijit/form/Button' type\x3d'submit' data-dojo-attach-point\x3d\"okButton\"\x3e\x3c/button\x3e\r\n\t\x3cbutton data-dojo-type\x3d'dijit/form/Button' type\x3d'button'\r\n\t\t\tdata-dojo-attach-point\x3d\"cancelButton\" data-dojo-attach-event\x3d'click:onCancel'\x3e\x3c/button\x3e\r\n\x3c/div\x3e\r\n","url:esri/dijit/analysis/templates/JobsList.html":'\x3cdiv class\x3d"esriAnalysis"\x3e\r\n   \x3cdiv class\x3d"analysisCategoryCtr" style\x3d"overflow:auto;" data-dojo-attach-point\x3d"_tableDiv"\x3e\r\n    \x3ctable class\x3d"calciteWebTable table-striped"\x3e\r\n       \x3cthead\x3e\r\n         \x3ctr\x3e\r\n          \x3cth\x3e${i18n.toolName}\x3c/th\x3e\r\n          \x3cth\x3e${i18n.dateCreated}\x3c/th\x3e\r\n         \x3c/tr\x3e\r\n      \x3c/thead\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"_analysisJobTBody"\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n   \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/analysis/templates/Settings.html":'\x3cdiv class\x3d"esriAnalysis"\x3e\r\n  \x3cdiv\x3e\r\n    \x3cdiv class\x3d"analysisTitle" style\x3d"padding:1em;" data-dojo-attach-point\x3d"_settingsHeader"\x3e\r\n         \x3ctable class\x3d"esriFormTable"\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" colspan\x3d"2"\x3e\r\n                \x3clabel data-dojo-attach-point\x3d"_analysisTitle"\x3e${i18n.analysisEnv}\x3c/label\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cdiv class\x3d"esriFloatTrailing" style\x3d"padding:0;"\x3e\r\n                    \x3cdiv class\x3d"esriFloatTrailing" data-dojo-attach-point\x3d"_closeDiv"\x3e\r\n                      \x3ca href\x3d"#" data-dojo-attach-point\x3d"_closeBtn" title\x3d"${i18n.close}" class\x3d"esriAnalysisCloseIcon"\x3e\x3c/a\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n         \x3c/table\x3e\r\n    \x3c/div\x3e\r\n    \x3cnav class\x3d"tab-nav feature-nav" data-dojo-attach-point\x3d"_settingsNavCtrl" style\x3d"display:none;"\x3e\r\n      \x3ca href\x3d"#" class\x3d"tab-title is-active general-tab" data-dojo-attach-point\x3d"_generalTab"\x3eGeneral\x3c/a\x3e\r\n      \x3ca href\x3d"#" class\x3d"tab-title history-tab" data-dojo-attach-point\x3d"_historyTab"\x3eHistory\x3c/a\x3e\r\n    \x3c/nav\x3e\r\n   \x3c!--\x3cdiv style\x3d"clear:both; border-bottom: #CCC thin solid; height:1px;width:100%;"\x3e\x3c/div\x3e--\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"_form" readOnly\x3d"true"\x3e\r\n     \x3ctable class\x3d"esriFormTable"\x3e\r\n       \x3ctbody\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_overwriteRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriSelectLabel esriLeadingMargin1"\x3e\r\n               \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_overwriteCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:false" name\x3d"overwriteResult" value\x3d"false" /\x3e\r\n               ${i18n.overwriteResultLayer}\r\n             \x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' data-dojo-attach-point\x3d"_analysisFieldHelpLink" esriHelpTopic\x3d"overwriteResult"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_closeAnalysisRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriSelectLabel esriLeadingMargin1"\x3e\r\n               \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_closeAnalysisCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:${viewModel.closeAnalysisWidget}" data-dojo-attach-event\x3d"onChange:_handleCloseAnalysisCheck" name\x3d"closeAnalysisWidget" value\x3d"false" /\x3e\r\n               ${i18n.closeAnalysisWisget}\r\n             \x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' data-dojo-attach-point\x3d"_analysisFieldHelpLink" esriHelpTopic\x3d"closeAnalysisWidget"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_storeAnalysisRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriSelectLabel esriLeadingMargin1"\x3e\r\n               \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_storeAnalysisCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:false" data-dojo-attach-event\x3d"onChange:_handleReturnFeatureCollectionCheck" name\x3d"storeAnalysisResults" value\x3d"false" /\x3e\r\n               ${i18n.storeAnalysisResults}\r\n             \x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' data-dojo-attach-point\x3d"_analysisFieldHelpLink" esriHelpTopic\x3d"storeAnalysisResults"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_coordinateLblRow"\x3e\r\n           \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.CoordinateSys}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_outSRLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.outSR}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"outputCoordinateSystem"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_outSRRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_outSRSelect" data-dojo-attach-event\x3d"onChange:_handleSRSelectChange"\x3e\r\n               \x3coption value\x3d"DEFAULT"\x3e${i18n.defaultExtentLabel}\x3c/option\x3e\r\n               \x3coption value\x3d"SPECIFIED"\x3e${i18n.extentSpecfiedBelow}\x3c/option\x3e\r\n             \x3c/select\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd style\x3d"width:15%"\x3e\r\n             \x3cdiv data-dojo-type\x3d"dijit/form/ToggleButton" data-dojo-props\x3d"showLabel:false,iconClass:\'esriAnalysisSRIcon\'" data-dojo-attach-point\x3d"_outSRBtn" data-dojo-attach-event\x3d"onChange:_handleOutSRBtnClick"\x3e\x3c/div\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_outSRCustomRow" style\x3d"display:none;"\x3e\r\n           \x3ctd colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin2"\x3e${i18n.spatialReference}\x3c/label\x3e\r\n             \x3cinput style\x3d"width:20%;" class\x3d"mediumInput esriMediumLabel" type\x3d"text" data-dojo-props\x3d"constraints: {pattern: \'######\', places: 0}" data-dojo-attach-point\x3d"_outSRInput" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"onChange:_handleOutSRInputChange"\x3e\x3c/input\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_outSRCustomInputRow" style\x3d"display:none;"\x3e\r\n           \x3ctd colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin2" data-dojo-attach-point\x3d"_outSRLabel"\x3e\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_processSRLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.processSR}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"processingCoordinateSystem"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_processSRRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_processSRSelect" data-dojo-attach-event\x3d"onChange:_handleProcessSRSelectChange"\x3e\r\n               \x3coption value\x3d"DEFAULT"\x3e${i18n.defaultExtentLabel}\x3c/option\x3e\r\n               \x3coption value\x3d"SPECIFIED"\x3e${i18n.extentSpecfiedBelow}\x3c/option\x3e\r\n             \x3c/select\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd style\x3d"width:15%"\x3e\r\n             \x3cdiv data-dojo-type\x3d"dijit/form/ToggleButton" class\x3d"esriFloatLeading" data-dojo-props\x3d"showLabel:false,iconClass:\'esriAnalysisSRIcon\'" data-dojo-attach-point\x3d"_processSRBtn" data-dojo-attach-event\x3d"onChange:_handleProcessSRBtnClick"\x3e\x3c/div\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_processSRCustomRow" style\x3d"display:none;"\x3e\r\n           \x3ctd colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin2"\x3e${i18n.spatialReference}\x3c/label\x3e\r\n             \x3cinput style\x3d"width:20%;" class\x3d"mediumInput esriMediumLabel" type\x3d"text" data-dojo-props\x3d"constraints: {pattern: \'######\', places: 0}" data-dojo-attach-point\x3d"_processSRInput" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"onChange:_handleProcessSRInputChange"\x3e\x3c/input\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_processSRCustomInputRow" style\x3d"display:none;"\x3e\r\n           \x3ctd colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin2" data-dojo-attach-point\x3d"_processSRLabel"\x3e\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_processExtLblRow"\x3e\r\n           \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.processExtent}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_extentLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.extent}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"processingExtent"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_extentRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_extentSelect" data-dojo-attach-event\x3d"onChange:_handleExtentOptionChange"\x3e\r\n               \x3coption value\x3d"DEFAULT"\x3e${i18n.defaultLabel}\x3c/option\x3e\r\n               \x3coption value\x3d"DISPLAY"\x3e${i18n.extentAsDisplay}\x3c/option\x3e\r\n               \x3coption value\x3d"SPECIFIED"\x3e${i18n.extentSpecfiedBelow}\x3c/option\x3e\r\n             \x3c/select\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_extentLbl"\x3e\r\n           \x3ctd style\x3d"padding:0" colspan\x3d"2"\x3e\r\n             \x3cdiv class\x3d"esriLeadingMargin1"\x3e\r\n               \x3clabel class\x3d"esriSmallLabel"\x3e${i18n.enterCoords}\x3c/label\x3e\r\n             \x3c/div\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_customExtentRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3ctable class\x3d"esriLeadigMargin1 esriFormTable" style\x3d"width:90%;"\x3e\r\n               \x3ctr\x3e\r\n                 \x3ctd\x3e\r\n                   \x3clabel class\x3d""\x3e${i18n.xMin}\x3c/label\x3e\r\n                   \x3cinput type\x3d"text" class\x3d"mediumInput" style\x3d"width:65%;" data-dojo-attach-point\x3d"_xMinInput" data-dojo-type\x3d"dijit/form/NumberTextBox"\x3e\x3c/input\x3e\r\n                 \x3c/td\x3e\r\n                 \x3ctd\x3e\r\n                   \x3clabel\x3e${i18n.xMax}\x3c/label\x3e\r\n                   \x3cinput type\x3d"text" class\x3d"mediumInput" style\x3d"width:65%;" data-dojo-attach-point\x3d"_xMaxInput" data-dojo-type\x3d"dijit/form/NumberTextBox"\x3e\x3c/input\x3e\r\n                 \x3c/td\x3e\r\n               \x3c/tr\x3e\r\n               \x3ctr\x3e\r\n                 \x3ctd\x3e\r\n                   \x3clabel class\x3d""\x3e${i18n.yMin}\x3c/label\x3e\r\n                   \x3cinput type\x3d"text" class\x3d"mediumInput" style\x3d"width:65%;" data-dojo-attach-point\x3d"_yMinInput" data-dojo-type\x3d"dijit/form/NumberTextBox"\x3e\x3c/input\x3e\r\n                 \x3c/td\x3e\r\n                 \x3ctd\x3e\r\n                   \x3clabel\x3e${i18n.yMax}\x3c/label\x3e\r\n                   \x3cinput type\x3d"text" class\x3d"mediumInput" style\x3d"width:65%;" data-dojo-attach-point\x3d"_yMaxInput" data-dojo-type\x3d"dijit/form/NumberTextBox"\x3e\x3c/input\x3e\r\n                 \x3c/td\x3e\r\n               \x3c/tr\x3e\r\n             \x3c/table\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_snapLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.snapRaster}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"snapRaster"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_snapSelRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_snapRasterSelect" data-dojo-attach-event\x3d"onChange:_handleSnapRasterSelectChange"\x3e\x3c/select\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_geoanalyticsLblRow"\x3e\r\n           \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.geoanalytis}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_datastoreLabelRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.datastoreLabel}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"dataStore"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_selectDataStore"\x3e\r\n           \x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"_dataStoreTd"\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_rasterLblRow"\x3e\r\n           \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.rasterLabel}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_cellLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.cellSize}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"cellSize"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_cellSelectRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_cellSizeSelect" data-dojo-attach-event\x3d"onChange:_handleCellSizeSelectChange"\x3e\x3c/select\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_cellSelectNumRow" style\x3d"display:none;"\x3e\r\n           \x3ctd colspan\x3d"3"\x3e\r\n             \x3cinput style\x3d"width:20%;" class\x3d"esriLeadingMargin1 mediumInput esriMediumLabel" type\x3d"text" data-dojo-attach-point\x3d"_cellSizeInput" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"onChange:_handleCellSizeInputChange"\x3e\x3c/input\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_maskLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.mask}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"mask"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_maskSelRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_maskSelect" data-dojo-attach-event\x3d"onChange:_handleMaskSelectChange"\x3e\x3c/select\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_creditWarningRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriSelectLabel esriLeadingMargin1"\x3e\r\n               \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_creditWarningCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:true" data-dojo-attach-event\x3d"onChange:_handleCreditWarningCheck" name\x3d"creditWarning" value\x3d"false" /\x3e\r\n               ${i18n.creditWarning}\r\n             \x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_storageLblRow"\x3e\r\n           \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.storageLabel}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_resamplingMethodLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.resamplingMethod}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"resamplingMethod"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_resamplingMethodSelRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_resamplingMethodSelect" data-dojo-attach-event\x3d"onChange:_handleResamplingMethodSelectChange"\x3e\x3c/select\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_processorLblRow"\x3e\r\n           \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.processorType}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_processorTypeLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.processorType}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"processorType"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_processorTypeSelRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_processorTypeSelect" data-dojo-attach-event\x3d"onChange:_handleProcessorTypeSelectChange"\x3e\x3c/select\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_parallelProcessingLblRow"\x3e\r\n           \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.parallelProcessingLabel}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_recycleProcessingWorkersLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.recycleProcessingWorkers}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"recycleProcessingWorkers"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_recycleProcessingWorkersNumRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cinput class\x3d"esriLeadingMargin1 mediumInput esriMediumLabel" type\x3d"text" data-dojo-attach-point\x3d"_recycleProcessingWorkersInput" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"onChange:_handlerecycleProcessingWorkersInputChange"\x3e\x3c/input\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_parallelProcessingFactorLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.parallelProcessingFactor}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"parallelProcessingFactor"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_parallelProcessingFactorNumRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cinput class\x3d"esriLeadingMargin1 mediumInput esriMediumLabel" type\x3d"text" data-dojo-attach-point\x3d"_parallelProcessingFactorInput" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"onChange:_handleparallelProcessingFactorInputChange"\x3e\x3c/input\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_retryOnFailuresLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.retryOnFailures}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"retryOnFailures"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_retryOnFailuresNumRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cinput class\x3d"esriLeadingMargin1 mediumInput esriMediumLabel" type\x3d"text" data-dojo-attach-point\x3d"_retryOnFailuresInput" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"onChange:_handleretryOnFailuresInputChange"\x3e\x3c/input\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n       \x3c/tbody\x3e\r\n     \x3c/table\x3e\r\n    \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"_jobHistoryCtr" style\x3d"display:none;"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_jobsListDiv"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriFormWarning esriRoundedBox" data-dojo-attach-point\x3d"_errorMessagePane" style\x3d"display:none;"\x3e\r\n      \x3ca href\x3d"#" title\x3d"${i18n.close}" class\x3d"esriFloatTrailing esriAnalysisCloseIcon" title\x3d\'${i18n.close}\' data-dojo-attach-event\x3d"onclick:_handleCloseMsg"\x3e\r\n      \x3c/a\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"_bodyNode"\x3e\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/ConfirmDialog" class\x3d"esriAnalysisStgSpatialDialog" title\x3d"${i18n.coordSysDialogTitle}" data-dojo-props\x3d"closable:false" data-dojo-attach-point\x3d"_coordDialog" style\x3d"width:40em;" data-dojo-attach-event\x3d"onExecute:_handleSRDlgOk,onCancel:_handleSRDlgCancel"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_spatialRefGridNode"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv  class\x3d"esriFloatTrailing" data-dojo-attach-point\x3d"_actionbuttonCtr"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/Button"  class\x3d"${cssClass.primaryButton}" data-dojo-attach-point\x3d"_addBtn" data-dojo-attach-event\x3d"onClick:_handleOkButtonClick"\x3e\r\n      ${i18n.apply}\r\n    \x3c/div\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"${cssClass.button}" data-dojo-attach-point\x3d"_closeBtn" data-dojo-attach-event\x3d"onClick:_handleCancelButtonClick"\x3e\r\n      ${i18n.cancel}\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/analysis/templates/ExpressionForm.html":'\x3cdiv class\x3d"esriAnalysis esriExpressionForm"\x3e\r\n  \x3cdiv class\x3d"esriFormError esriRoundedBox" data-dojo-attach-point\x3d"_errorMessagePane" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n  \x3c!--\x3cdiv class\x3d"clear" style\x3d"height:1em;"\x3e\x3c/div\x3e--\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Form" class\x3d"esriSimpleForm" data-dojo-attach-point\x3d"_expressionForm"\x3e\r\n    \x3ctable class\x3d"esriFormTable" style\x3d"border: 1px solid #929497;background-color: #F7F8F8 !important;"\x3e \r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_firstRow" \x3e\r\n          \x3ctd style\x3d"width:75%"\x3e\r\n            \x3cselect class\x3d"" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;table-layout:fixed;" data-dojo-attach-event\x3d"onChange:_handleFirstOperandChange" data-dojo-attach-point\x3d"_firstOperandSelect"\x3e\r\n            \x3c/select\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd style\x3d"width:25%"\x3e\r\n            \x3cselect class\x3d"" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"onChange:_handleOperatorChange" style\x3d"width:100%;table-layout:fixed;" data-dojo-attach-point\x3d"_operatorSelect"\x3e\r\n              \x3coption value\x3d"where"\x3e${i18n.where}\x3c/option\x3e\r\n              \x3coption value\x3d"intersects"\x3e${i18n.intersects}\x3c/option\x3e\r\n              \x3coption value\x3d"notIntersects"\x3e${i18n.notIntersects}\x3c/option\x3e\r\n              \x3coption value\x3d"withinDistance"\x3e${i18n.withinDistance}\x3c/option\x3e\r\n              \x3coption value\x3d"notWithinDistance"\x3e${i18n.notWithinDistance}\x3c/option\x3e\r\n              \x3coption value\x3d"contains"\x3e${i18n.contains}\x3c/option\x3e\r\n              \x3coption value\x3d"notContains"\x3e${i18n.notContains}\x3c/option\x3e\r\n              \x3coption value\x3d"within"\x3e${i18n.within}\x3c/option\x3e\r\n              \x3coption value\x3d"notWithin"\x3e${i18n.notWithin}\x3c/option\x3e\r\n              \x3coption value\x3d"nearest"\x3e${i18n.nearest}\x3c/option\x3e\r\n              \x3c!--\x3coption value\x3d"contains"\x3e${i18n.contains}\x3c/option\x3e\r\n              \x3coption value\x3d"notContains"\x3e${i18n.notContains}\x3c/option\x3e--\x3e\r\n              \x3c!--\x3coption value\x3d"within"\x3e${i18n.within}\x3c/option\x3e\r\n              \x3coption value\x3d"notWithin"\x3e${i18n.notWithin}\x3c/option\x3e--\x3e\r\n              \x3c!--\x3coption value\x3d"identical"\x3e${i18n.identical}\x3c/option\x3e\r\n              \x3coption value\x3d"notIdentical"\x3e${i18n.notIdentical}\x3c/option\x3e\r\n              \x3coption value\x3d"touches"\x3e${i18n.touches}\x3c/option\x3e\r\n              \x3coption value\x3d"notTouches"\x3e${i18n.notTouches}\x3c/option\x3e--\x3e\r\n              \x3c!--\x3coption value\x3d"crossesOutline"\x3e${i18n.crossesOutline}\x3c/option\x3e\r\n              \x3coption value\x3d"notCrossesOutline"\x3e${i18n.notCrossesOutline}\x3c/option\x3e--\x3e\r\n            \x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_secondRow" style\x3d"display:none;"\x3e\r\n          \x3ctd data-dojo-attach-point\x3d"_secondOperandTd" colspan\x3d"2"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_secondExpressionDiv" style\x3d"display:none; padding-bottom:0.25em;"\x3e\r\n              \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"onChange:_handleDistanceInputChange" data-dojo-props\x3d"intermediateChanges:true" data-dojo-attach-point\x3d"_distanceInput" style\x3d"width:20%;"\x3e\x3c/input\x3e\r\n              \x3cselect data-dojo-type\x3d"dijit/form/Select"  data-dojo-attach-point\x3d"_distanceUnitsSelect"  style\x3d"width:20%;table-layout:fixed;"\x3e\r\n                \x3coption value\x3d"Miles"\x3e${i18n.miles}\x3c/option\x3e\r\n                \x3coption value\x3d"Yards"\x3e${i18n.yards}\x3c/option\x3e\r\n                \x3coption value\x3d"Feet"\x3e${i18n.feet}\x3c/option\x3e\r\n                \x3coption type\x3d"separator"\x3e\x3c/option\x3e\r\n                \x3coption value\x3d"Kilometers"\x3e${i18n.kilometers}\x3c/option\x3e\r\n                \x3coption value\x3d"Meters"\x3e${i18n.meters}\x3c/option\x3e\r\n                \x3coption value\x3d"NauticalMiles"\x3e${i18n.nautMiles}\x3c/option\x3e\r\n              \x3c/select\x3e\r\n              \x3clabel\x3e ${i18n.from} \x3c/label\x3e\r\n            \x3c/div\x3e\r\n            \x3cselect class\x3d"" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:75%;table-layout:fixed;" data-dojo-attach-point\x3d"_secondOperandSelect" data-dojo-attach-event\x3d"onChange:_handleSecondOperandChange"\x3e\r\n            \x3c/select\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_attrFilterDiv" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n    \x3cdiv class\x3d"esriFormWarning esriRoundedBox" data-dojo-attach-point\x3d"_errorMessagePane" style\x3d"display:none;"\x3e\r\n      \x3ca href\x3d"#" title\x3d"${i18n.close}" class\x3d"esriFloatTrailing esriAnalysisInfoPaneCloseIcon" title\x3d\'${i18n.close}\' data-dojo-attach-event\x3d"onclick:_handleCloseMsg"\x3e\r\n      \x3c/a\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"_bodyNode"\x3e\x3c/span\x3e\r\n    \x3c/div\x3e    \r\n    \x3cdiv style\x3d"clear:both;"\x3e\x3c/div\x3e\r\n    \x3cdiv  class\x3d"esriFloatTrailing" style\x3d"padding: 10px 5px;"\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit/form/Button"  class\x3d"${_addBtnClass}" data-dojo-attach-point\x3d"_addBtn" data-dojo-attach-event\x3d"onClick:_handleAddButtonClick"\x3e\r\n        ${i18n.add}\r\n      \x3c/div\x3e\r\n       \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriLeadingMargin05" data-dojo-attach-point\x3d"_closeBtn" data-dojo-attach-event\x3d"onClick:_handleCloseButtonClick"\x3e\r\n        ${i18n.close}\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \r\n  \x3c/div\x3e\r\n\x3c/div\x3e  \r\n',
"url:esri/dijit/analysis/components/FilterAndSelection/FilterAndSelection.html":'\x3cdiv class\x3d"esriLeadingMargin1 esriFloatTrailing marginTop1"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/ToggleButton" class\x3d"esriActionButton" data-dojo-props\x3d"label:\'${i18n.selectLabel}\',iconClass:\'esriAnalysisSelectFilterIcon\',showLabel:false" data-dojo-attach-point\x3d"_selectBtn" data-dojo-attach-event\x3d"onChange:_handleSelectionButtonClick"\x3e\x3c/div\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriActionButton" data-dojo-props\x3d"label:\'${i18n.queryLabel}\',iconClass:\'esriAnalysisAttributeFiltercon\',showLabel:false" data-dojo-attach-point\x3d"_queryBtn" data-dojo-attach-event\x3d"onClick:_handleQueryButtonClick"\x3e\x3c/div\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" title\x3d"${i18n.expression}" data-dojo-props\x3d"closable:false" data-dojo-attach-point\x3d"_expDialog" style\x3d"width:65em;"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_expressionForm" data-dojo-type\x3d"esri/dijit/analysis/ExpressionForm" data-dojo-props\x3d"showFirstRow:false,primaryActionButttonClass:\'btn calcite blue\'"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/analysis/templates/CreditEstimator.html":'\x3cdiv class\x3d"esriAnalysis esriSimpleForm"\x3e\r\n  \x3ctable class\x3d"esriFormTable"  data-dojo-attach-point\x3d"_table"  style\x3d"border-collapse:collapse;border-spacing:5px;"\x3e\r\n     \x3c!--\x3ctr\x3e\r\n      \x3ctd\x3e\r\n        \x3clabel class\x3d"esriFloatLeading"\x3e${i18n.analysisLayersLabel}\x3c/label\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e--\x3e\r\n     \x3ctr\x3e\r\n      \x3ctd\x3e\r\n        \x3clabel class\x3d"esriFloatLeading" data-dojo-attach-point\x3d"_totalRecordsLabelNode"\x3e${i18n.totalRecordsLabel}\x3c/label\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd data-dojo-attach-point\x3d"_totalRecordsNode"\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n     \x3c!--\x3ctr\x3e\r\n      \x3ctd\x3e\r\n        \x3clabel class\x3d"esriFloatLeading"\x3e${i18n.creditsAvailLabel}\x3c/label\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e--\x3e\r\n     \x3ctr\x3e\r\n      \x3ctd\x3e\r\n        \x3clabel class\x3d"esriFloatLeading" data-dojo-attach-point\x3d"_costLabelNode"\x3e${i18n.creditsReqLabel}\x3c/label\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd data-dojo-attach-point\x3d"_creditsReqNode"\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"_messageDiv"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/analysis/templates/CreateViewshed.html":'\x3cdiv class\x3d"esriAnalysis"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" style\x3d"margin-top:0.5em; margin-bottom: 0.5em;"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_hotspotsToolContentTitle" class\x3d"analysisTitle"\x3e\r\n         \x3ctable class\x3d"esriFormTable" \x3e \r\n            \x3ctr\x3e\r\n              \x3ctd class\x3d"esriToolIconTd"\x3e\x3cdiv class\x3d"createViewshedIcon"\x3e\x3c/div\x3e\x3c/td\x3e\r\n              \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" data-dojo-attach-point\x3d"_toolTitle"\x3e\r\n                \x3clabel data-dojo-attach-point\x3d"_titleLbl"\x3e${i18n.createViewshed}\x3c/label\x3e\r\n                \x3cnav class\x3d"breadcrumbs"  data-dojo-attach-point\x3d"_analysisModeLblNode" style\x3d"display:none;"\x3e\r\n                  \x3ca href\x3d"#" class\x3d"crumb breadcrumbs__modelabel" data-dojo-attach-event\x3d"onclick:_handleModeCrumbClick" data-dojo-attach-point\x3d"_analysisModeCrumb"\x3e\x3c/a\x3e\r\n                  \x3ca href\x3d"#" class\x3d"crumb is-active" data-dojo-attach-point\x3d"_analysisTitleCrumb" style\x3d"font-size:16px;"\x3e${i18n.createViewshed}\x3c/a\x3e\r\n                \x3c/nav\x3e                 \r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cdiv class\x3d"esriFloatTrailing" style\x3d"padding:0;"\x3e\r\n                    \x3cdiv class\x3d"esriFloatLeading"\x3e\r\n                      \x3ca href\x3d"#" class\x3d\'esriFloatLeading helpIcon\' esriHelpTopic\x3d"toolDescription"\x3e\x3c/a\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n                      \x3ca href\x3d"#" data-dojo-attach-point\x3d"_closeBtn" title\x3d"${i18n.close}" class\x3d"esriAnalysisCloseIcon"\x3e\x3c/a\x3e\r\n                    \x3c/div\x3e              \r\n                \x3c/div\x3e  \r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n         \x3c/table\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv style\x3d"clear:both; border-bottom: #CCC thin solid; height:1px;width:100%;"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"_form" readOnly\x3d"true"\x3e\r\n     \x3ctable class\x3d"esriFormTable"\x3e \r\n       \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_titleRow"\x3e\r\n          \x3ctd  colspan\x3d"3" class\x3d"sectionHeader" data-dojo-attach-point\x3d"_interpolateToolDescription" \x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_analysisLabelRow" style\x3d"display:none;"\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3clabel class\x3d"esriFloatLeading  esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.oneLabel}\x3c/label\x3e\r\n            \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.analysisLayerLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd\x3e\r\n            \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"inputLayer"\x3e\x3c/a\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_selectAnalysisRow" style\x3d"display:none;"\x3e\r\n          \x3ctd  colspan\x3d"3"\x3e\r\n            \x3ctable style\x3d"width:100%;"\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd style\x3d"width:80%"\x3e  \r\n                \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel"  style\x3d"margin-top:1.0em;" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_analysisSelect" data-dojo-attach-event\x3d"onChange:_handleAnalysisLayerChange"\x3e\x3c/select\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd style\x3d"width:20%"\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/ToggleButton"  data-dojo-attach-point\x3d"_analysisPointDrawBtn"  class\x3d"esriFloatLeading esriActionButton" data-dojo-props\x3d"showLabel:false,iconClass:\'toolbarIcon esriPointIcon\',label:\'${i18n.drawLabel}\'" data-dojo-attach-event\x3d"onChange:_handleInputDrawPointChange"\x3e\x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/table\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e          \r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3clabel class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.oneLabel}\x3c/label\x3e\r\n            \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.viewshedOptionlabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3clabel class\x3d"esriLeadingMargin2"\x3e${i18n.observerHghtLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"shortTextInput"\x3e\r\n            \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"ObserverHeight"\x3e\x3c/a\x3e\r\n          \x3c/td\x3e                    \r\n        \x3c/tr\x3e                  \r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3" style\x3d"padding:0;"\x3e\r\n            \x3ctable class\x3d"esriFormTable esriLeadingMargin2" style\x3d"width:90%;"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                \x3ctd  style\x3d"width:50%;padding-right:1em;"\x3e\r\n            \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"value:${observerHeight},intermediateChanges:true,invalidMessage:\'${i18n.distanceInValidMsg}\',constraints:{min:0}" data-dojo-attach-point\x3d"_obsrHeightInput" style\x3d"width:100%;"\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd colspan\x3d"2"\x3e\r\n            \x3cselect class\x3d"longInput esriAnalysisSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_obsrUnitsSelect"\x3e\r\n            \x3c/select\x3e\r\n                \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3clabel class\x3d"esriLeadingMargin2"\x3e${i18n.targetHghtLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"shortTextInput"\x3e\r\n            \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"TargetHeight"\x3e\x3c/a\x3e\r\n          \x3c/td\x3e                    \r\n        \x3c/tr\x3e                  \r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3" style\x3d"padding:0;"\x3e\r\n            \x3ctable class\x3d"esriFormTable esriLeadingMargin2" style\x3d"width:90%;"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                \x3ctd  style\x3d"width:50%;padding-right:1em;"\x3e\r\n            \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"value:${targetHeight},intermediateChanges:true,invalidMessage:\'${i18n.distanceInValidMsg}\',constraints:{min:0}" data-dojo-attach-point\x3d"_targetHgtInput" style\x3d"width:100%;"\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd colspan\x3d"2"\x3e\r\n            \x3cselect class\x3d"longInput esriAnalysisSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_targetUnitsSelect"\x3e\r\n            \x3c/select\x3e\r\n                \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3clabel class\x3d"esriLeadingMargin2"\x3e${i18n.maxDistanceLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"shortTextInput"\x3e\r\n            \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"MaximumDistance"\x3e\x3c/a\x3e\r\n          \x3c/td\x3e                    \r\n        \x3c/tr\x3e                   \r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3" style\x3d"padding:0;"\x3e\r\n            \x3ctable class\x3d"esriFormTable esriLeadingMargin2" style\x3d"width:90%;"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                \x3ctd  style\x3d"width:50%;padding-right:1em;"\x3e\r\n            \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"value:${maximumDistance},intermediateChanges:true,invalidMessage:\'${i18n.distanceInValidMsg}\', constraints:{min:0}" data-dojo-attach-point\x3d"_maximumDistanceInput" style\x3d"width:100%;" data-dojo-attach-event\x3d"onChange:_handleMaxDstChange"\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd colspan\x3d"2"\x3e\r\n            \x3cselect class\x3d"longInput esriAnalysisSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_distanceUnitsSelect" data-dojo-attach-event\x3d"onChange:_handleMaxDstUnitsChange"\x3e\r\n            \x3c/select\x3e\r\n                \x3c/td\x3e\r\n               \x3c/tr\x3e                  \r\n                \x3c/tbody\x3e\r\n              \x3c/table\x3e\r\n            \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3" class\x3d"clear"\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3clabel class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.twoLabel}\x3c/label\x3e\r\n            \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.outputLayerLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"shortTextInput"\x3e\r\n            \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"OutputLayer"\x3e\x3c/a\x3e \r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"trim:true,required:true" class\x3d"longTextInput esriLeadingMargin1" data-dojo-attach-point\x3d"_outputLayerInput"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n             \x3cdiv data-dojo-attach-point\x3d"_chooseFolderRow" class\x3d"esriLeadingMargin1"\x3e\r\n               \x3clabel style\x3d"width:9px;font-size:smaller;"\x3e${i18n.saveResultIn}\x3c/label\x3e\r\n               \x3cinput class\x3d"longInput" data-dojo-attach-point\x3d"_webMapFolderSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" trim\x3d"true" style\x3d"width:55%;"\x3e\x3c/input\x3e\r\n             \x3c/div\x3e              \r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n     \x3c/table\x3e\r\n   \x3c/div\x3e\r\n  \x3cdiv style\x3d"padding:5px;margin-top:5px;border-top:solid 1px #BBB;"\x3e\r\n    \x3cdiv class\x3d"esriExtentCreditsCtr"\x3e\r\n      \x3ca class\x3d"esriFloatTrailing esriSmallFont"  href\x3d"#" data-dojo-attach-point\x3d"_showCreditsLink"\x3e${i18n.showCredits}\x3c/a\x3e\r\n     \x3clabel data-dojo-attach-point\x3d"_chooseExtentDiv" class\x3d"esriSelectLabel esriExtentLabel"\x3e\r\n       \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_useExtentCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:true" name\x3d"extent" value\x3d"true"/\x3e\r\n         ${i18n.useMapExtent}\r\n     \x3c/label\x3e\r\n    \x3c/div\x3e\r\n    \x3cbutton data-dojo-type\x3d"dijit/form/Button" type\x3d"submit" data-dojo-attach-point\x3d"_saveBtn" class\x3d"esriLeadingMargin4 esriAnalysisSubmitButton" data-dojo-attach-event\x3d"onClick:_handleSaveBtnClick"\x3e\r\n        ${i18n.runAnalysis}\r\n    \x3c/button\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" title\x3d"${i18n.creditTitle}" data-dojo-attach-point\x3d"_usageDialog" style\x3d"width:40em;"\x3e\r\n    \x3cdiv data-dojo-type\x3d"esri/dijit/analysis/CreditEstimator"  data-dojo-attach-point\x3d"_usageForm"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e    \r\n\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/CoordinateControl.html":"\x3cdiv class\x3d'coordinateContainer'\x3e\r\n  \x3cdiv class\x3d'coordLabel' data-dojo-attach-point\x3d'coordNameContainer' data-a11y-label-id\x3d'coordLabel'\x3e\r\n    \x3cspan data-dojo-type\x3d'dijit/InlineEditBox' width\x3d'75px' data-dojo-props\x3d\"editor:'dijit/form/TextBox', autoSave:true\"\r\n      data-dojo-attach-point\x3d'coordName'\x3e${type}\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d'add-with-icon coordInput'\x3e\r\n    \x3ctextarea data-a11y-label-by\x3d'coordLabel' tabindex\x3d\"0\" aria-multiline\x3d\"true\" role\x3d\"textbox\" id\x3d'${uid}' type\x3d'text' rows\x3d'1' data-dojo-attach-point\x3d'coordtext' spellcheck\x3d'false'\r\n    placeholder\x3d'${nls.coordinateInputLabel}' title\x3d'${nls.coordinateInputLabel}'\x3e\x3c/textarea\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d'coordactions'\x3e\r\n    \x3cdiv class\x3d'add-with-icon'\x3e\r\n      \x3cspan tabindex\x3d\"0\" role\x3d\"button\" id\x3d'${uid}_cpbtn' aria-label\x3d'${nls.copyToClipboard}' title\x3d'${nls.copyToClipboard}' data-dojo-attach-point\x3d'cpbtn' class\x3d'cpbtn'\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d'add-with-icon'\x3e\r\n      \x3cspan tabindex\x3d\"0\" role\x3d\"button\" title\x3d\"${nls.formatOutput}\" class\x3d'settingBtn' data-dojo-attach-point\x3d'formatButton'\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d'add-with-icon'\x3e\r\n      \x3cspan tabindex\x3d\"0\" role\x3d\"button\" aria-label\x3d'${nls.zoomLabel}' title\x3d'${nls.zoomLabel}' class\x3d'zoomBtn' data-dojo-attach-point\x3d'zoomButton'\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d'add-with-icon'\x3e\r\n      \x3cspan tabindex\x3d\"0\" role\x3d\"button\" aria-label\x3d'${nls.addPointLabel}' title\x3d'${nls.addPointLabel}' class\x3d'drawPointBtn' data-dojo-attach-point\x3d'drawPointButton'\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d'add-with-icon'\x3e\r\n      \x3cspan tabindex\x3d\"0\" role\x3d\"button\" aria-label\x3d'${nls.removeCoordinate}' title\x3d'${nls.removeCoordinate}' class\x3d'jimu-icon jimu-icon-close' data-dojo-attach-point\x3d'removeControlBtn'\r\n        data-dojo-attach-event\x3d'onclick: remove'\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d'add-with-icon'\x3e\r\n      \x3cspan tabindex\x3d\"0\" role\x3d\"button\" aria-label\x3d\"${nls.expandOutput}\" aria-expanded \x3d \"false\" title\x3d\"${nls.expandOutput}\" class\x3d'expandBtn' data-dojo-attach-point\x3d'expandButton'\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d'coordcontrols' class\x3d'coordarea' style\x3d\"display: none\"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d'sub1' class\x3d'coordformat'\x3e\r\n      \x3cdiv class\x3d'crdfrmtlabel'\x3e\r\n        \x3cspan data-dojo-attach-point\x3d'sub1label' data-a11y-label-id\x3d'sub1Label'/\x3e\r\n      \x3c/div\x3e\r\n      \x3cinput data-a11y-label-by\x3d'sub1Label' tabindex\x3d\"-1\" role\x3d\"textbox\" readonly data-dojo-attach-point\x3d'${uid}sub1val' class\x3d'jimu-input crds'\x3e\x3c/input\x3e\r\n      \x3cdiv class\x3d'add-with-icon'\x3e\r\n        \x3cspan tabindex\x3d\"-1\" role\x3d\"button\" id\x3d'${uid}sub1val~cpbtn' aria-label\x3d'${nls.copyToClipboard}' title\x3d'${nls.copyToClipboard}' data-dojo-attach-point\x3d'subVal1CpBtn' class\x3d'jimu-icon cpbtn'\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d'sub2' class\x3d'coordformat'\x3e\r\n      \x3cdiv class\x3d'crdfrmtlabel'\x3e\r\n        \x3cspan data-dojo-attach-point\x3d'sub2label' data-a11y-label-id\x3d'sub2Label'/\x3e\r\n      \x3c/div\x3e\r\n      \x3cinput data-a11y-label-by\x3d'sub2Label' tabindex\x3d\"-1\" role\x3d\"textbox\" readonly data-dojo-attach-point\x3d'${uid}sub2val' class\x3d'jimu-input crds'\x3e\x3c/input\x3e\r\n      \x3cdiv class\x3d'add-with-icon'\x3e\r\n        \x3cspan tabindex\x3d\"-1\" role\x3d\"button\" id\x3d'${uid}sub2val~cpbtn' aria-label\x3d'${nls.copyToClipboard}' title\x3d'${nls.copyToClipboard}' data-dojo-attach-point\x3d'subVal2CpBtn' class\x3d'jimu-icon cpbtn'\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d'sub3' class\x3d'coordformat sub3'\x3e\r\n      \x3cdiv class\x3d'crdfrmtlabel'\x3e\r\n        \x3cspan data-dojo-attach-point\x3d'sub3label' data-a11y-label-id\x3d'sub3Label'/\x3e\r\n      \x3c/div\x3e\r\n      \x3cinput data-a11y-label-by\x3d'sub3Label' tabindex\x3d\"-1\" role\x3d\"textbox\" readonly data-dojo-attach-point\x3d'${uid}sub3val' class\x3d'jimu-input crds'\x3e\r\n      \x3c/input\x3e\r\n      \x3cdiv class\x3d'add-with-icon'\x3e\r\n        \x3cspan tabindex\x3d\"-1\" role\x3d\"button\" id\x3d'${uid}sub3val~cpbtn' aria-label\x3d'$${nls.copyToClipboard}' title\x3d'$${nls.copyToClipboard}' data-dojo-attach-point\x3d'subVal3CpBtn' class\x3d'jimu-icon cpbtn'\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d'sub4' class\x3d'coordformat sub4'\x3e\r\n      \x3cdiv class\x3d'crdfrmtlabel'\x3e\r\n        \x3cspan data-dojo-attach-point\x3d'sub4label' data-a11y-label-id\x3d'sub4Label' /\x3e\r\n      \x3c/div\x3e\r\n      \x3cinput data-a11y-label-by\x3d'sub4Label' tabindex\x3d\"-1\" role\x3d\"textbox\" readonly data-dojo-attach-point\x3d'${uid}sub4val' class\x3d'jimu-input crds'\x3e\r\n      \x3c/input\x3e\r\n      \x3cdiv class\x3d'add-with-icon'\x3e\r\n        \x3cspan tabindex\x3d\"-1\" role\x3d\"button\" id\x3d'${uid}sub4val~cpbtn' aria-label\x3d'${nls.copyToClipboard} title\x3d'${nls.copyToClipboard}' data-dojo-attach-point\x3d'subVal4CpBtn' class\x3d'jimu-icon cpbtn'\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d\"line-separator\"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e",
"url:dijit/templates/InlineEditBox.html":'\x3cspan data-dojo-attach-point\x3d"editNode" role\x3d"presentation" class\x3d"dijitReset dijitInline dijitOffScreen"\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"editorPlaceholder"\x3e\x3c/span\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"buttonContainer"\r\n\t\t\x3e\x3cbutton data-dojo-type\x3d"./form/Button" data-dojo-props\x3d"label: \'${buttonSave}\', \'class\': \'saveButton\'"\r\n\t\t\tdata-dojo-attach-point\x3d"saveButton" data-dojo-attach-event\x3d"onClick:save"\x3e\x3c/button\r\n\t\t\x3e\x3cbutton data-dojo-type\x3d"./form/Button"  data-dojo-props\x3d"label: \'${buttonCancel}\', \'class\': \'cancelButton\'"\r\n\t\t\tdata-dojo-attach-point\x3d"cancelButton" data-dojo-attach-event\x3d"onClick:cancel"\x3e\x3c/button\r\n\t\x3e\x3c/span\r\n\x3e\x3c/span\x3e\r\n',
"url:widgets/Visibility/templates/portal-publish.html":'\x3cdiv class\x3d"esriCTFullHeight" data-dojo-attach-point\x3d"resultsPageNode"\x3e\r\n  \x3cdiv class\x3d"esriCTFullWidth esriCTSettingHeader"\x3e\r\n    \x3cdiv class\x3d"esriCTBackButton" title\x3d"${nls.back}"\x3e\r\n      \x3cdiv class\x3d"esriCTItemLeftArrow" data-dojo-attach-point\x3d"resultsPanelBackButton" tabindex\x3d"0"\r\n        aria-label\x3d"${nls.back}" role\x3d"button"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"esriCTTitleDiv esriCTEllipsis" title\x3d"${nls.resultsTitle}"\x3e${nls.resultsTitle}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTMainPageRow"\x3e\r\n      \x3c!-- esriCT Layer Name --\x3e\r\n      \x3cdiv class\x3d"esriCTFullWidth esriCTSettingRow"\x3e\r\n        \x3cdiv class\x3d"esriCTInputLabel esriCTEllipsis" title\x3d"${nls.layerName}"\x3e${nls.layerName}\x3c/div\x3e\r\n        \x3cinput aria-label\x3d"${nls.layerName}" class\x3d"esriCTHidden" style\x3d"width: 100%; margin-bottom: 8px;"\r\n          data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-point\x3d"addLayerNameArea"\r\n          data-dojo-props\x3d"regExp:\'[a-zA-Z0-9_ -]*\'" required\x3d"true" tabindex\x3d"0" trim\x3d"true"\x3e\x3c/input\x3e\r\n        \x3cselect class\x3d"publishSelect" aria-label\x3d"${nls.layerName}" data-dojo-type\x3d"jimu/dijit/formSelect" tabindex\x3d"0"\r\n          data-dojo-attach-point\x3d"featureLayerList"\x3e\x3c/select\x3e\r\n        \x3cdiv class\x3d"esriCTCheckBoxNode" data-dojo-attach-point\x3d"checkBoxParentContainer"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3c!-- Publish esriCT Button --\x3e\r\n      \x3cdiv class\x3d"esriCTPublishBtnContainer"\x3e\r\n        \x3cdiv class\x3d\'jimu-btn\' data-dojo-attach-point\x3d\'publishButton\' tabindex\x3d"0" aria-label\x3d"${nls.publishBtnLabel}"\r\n          role\x3d"button"\x3e${nls.publishBtnLabel}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3c!-- Publishing Message --\x3e\r\n      \x3cdiv class\x3d"esriCTPublishMessage" data-dojo-attach-point\x3d"publishMessage"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Visibility/templates/ColorPickerEditor.html":'\x3cdiv class\x3d"esriCTColorPickerEditor"\x3e\r\n  \x3cdiv class\x3d"colorPicker" data-dojo-attach-point\x3d"colorPicker"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTSliderWrapper"\x3e\r\n    \x3cdiv class\x3d"esriCTSliderbar" data-dojo-attach-point\x3d"sliderBar"\x3e\r\n      \x3col data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" class\x3d"esriCTSliderLabelHeight" style\x3d"height:2.5em;" container\x3d"topDecoration" data-dojo-attach-point\x3d"sliderBarLabel"\x3e\r\n        \x3cli\x3e${nls.transparency}\x3c/li\x3e\r\n        \x3cli\x3e\x3c/li\x3e\r\n      \x3c/ol\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberSpinner" value\x3d"0" data-dojo-attach-point\x3d"spinner"\r\n    data-dojo-props\x3d"smallDelta:10,intermediateChanges:true,constraints: {min:0,max:100}" aria-label\x3d"${nls.transparency}"\x3e\r\n  \x3cdiv class\x3d"esriCTOutFillSection"\x3e\r\n    \x3clabel for\x3d"${id}_select"\x3e${nls.style}\x3c/label\x3e\r\n    \x3cselect class\x3d"noResize" data-dojo-type\x3d"jimu/dijit/formSelect" aria-label\x3d"${nls.style}" data-dojo-attach-point\x3d"dropdown" /\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Visibility/templates/symbologySettings.html":'\x3cdiv\x3e\r\n       \x3c!-- Visible Section DropDown --\x3e\r\n       \x3cdiv class\x3d"esriCTSettingsRow"\x3e\r\n        \x3cdiv class\x3d"esriCTLabelSettingsRightButton esriCTSettingsButtonIcon esriCTPointer"\r\n          title\x3d"${nls.visibleSectionButtonLabel}" data-dojo-attach-point\x3d"visibleSectionSettingsButton"\r\n          role\x3d"button" aria-label\x3d"${nls.visibleSectionButtonLabel}" tabindex\x3d"0" aria-expanded \x3d"false"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTInputLabelSettings esriCTEllipsis esriCTSubTitle" title\x3d"${nls.visibleSectionLabel}"\x3e\r\n          ${nls.visibleSectionLabel}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3c!-- Visible Section Color Pickers --\x3e\r\n      \x3cdiv class\x3d"container esriCTGroupHidden" data-dojo-attach-point\x3d"visibleSectionContainer"\x3e\r\n        \x3cdiv class\x3d"esriCTEllipsis" title\x3d"${nls.outline}"\x3e${nls.outline}\x3c/div\x3e\r\n        \x3cdiv class\x3d"colorPicker Line" nodeId\x3d"visibleSectionOutlineColor"\r\n          data-dojo-attach-point\x3d"visibleAreaOutlineColorPicker"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTEllipsis" title\x3d"${nls.fill}"\x3e${nls.fill}\x3c/div\x3e\r\n        \x3cdiv class\x3d"colorPicker Fill" nodeId\x3d"visibleSectionFillColor"\r\n          data-dojo-attach-point\x3d"visibleAreaFillColorPicker"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3c!-- Non-visible Section DropDown --\x3e\r\n      \x3cdiv class\x3d"esriCTSettingsRow"\x3e\r\n        \x3cdiv class\x3d"esriCTLabelSettingsRightButton esriCTSettingsButtonIcon esriCTPointer"\r\n        title\x3d"${nls.nonVisibleSectionButtonLabel}" data-dojo-attach-point\x3d"nonVisibleSectionSettingsButton"\r\n        role\x3d"button" aria-label\x3d"${nls.nonVisibleSectionButtonLabel}" tabindex\x3d"0" aria-expanded \x3d"false"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTInputLabelSettings esriCTEllipsis esriCTSubTitle" title\x3d"${nls.nonVisibleSectionLabel}"\x3e${nls.nonVisibleSectionLabel}\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3c!-- Non-visible Section --\x3e\r\n      \x3cdiv class\x3d"container esriCTGroupHidden" data-dojo-attach-point\x3d"nonVisibleSectionContainer"\x3e\r\n        \x3cdiv class\x3d"esriCTEllipsis" title\x3d"${nls.outline}"\x3e${nls.outline}\x3c/div\x3e\r\n        \x3cdiv class\x3d"colorPicker Line" nodeId\x3d"nonVisibleSectionOutlineColor" data-dojo-attach-point\x3d"nonVisibleAreaOutlineColorPicker"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTEllipsis" title\x3d"${nls.fill}"\x3e${nls.fill}\x3c/div\x3e\r\n        \x3cdiv class\x3d"colorPicker Fill" nodeId\x3d"nonVisibleSectionFillColor" data-dojo-attach-point\x3d"nonVisibleAreaFillColorPicker"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e   \r\n\x3c/div\x3e',
"url:widgets/Visibility/Widget.html":"\x3cdiv\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d'visibilityContainer'\x3e\x3c/div\x3e\r\n\x3c/div\x3e","url:widgets/Visibility/css/style.css":".jimu-widget-visibility-control .controls {margin: 20px 0 0 0;}.jimu-widget-visibility-control .inputNumberTextbox {width: calc(100% - 120px) !important; margin: 0px;}.jimu-widget-visibility-control .controlGroup {padding: 4px 2px;}.jimu-widget-visibility-control .buttonContainer {display: flex;}.jimu-widget-visibility-control .controlSpace {margin-left: unset;}.jimu-widget-visibility-control .titleLabel {padding-bottom: 5px; display: block;}.jimu-widget-visibility-control .noResize .dijitSelectLabel,.jimu-widget-visibility-control .noResize .dijitTextBox .dijitInputInner,.jimu-widget-visibility-control .noResize.dijitValidationTextBox .dijitValidationContainer {text-overflow: ellipsis; overflow: hidden; width: 60px; text-align: initial; padding-top: 5px;}.jimu-widget-visibility-control .claro .dijitSelect {background-color: rgba(255, 255, 255, 0);}.jimu-widget-visibility-control .dijitSelect .dijitButtonContents {border-style: none none none none; background-color: #ffffff;}.jimu-widget-visibility-control .dijitSelect .dijitButtonContentsDartTheme {background-color: inherit;}.jimu-widget-visibility-control .dijitSelect .dijitArrowButton {background-color: #ffffff; background-image: none; border-color: #ffffff;}.jimu-widget-visibility-control .dijitSelect .dijitArrowButtonDartTheme {background-color: rgba(0, 0, 0, 0.5) !important;}.jimu-widget-visibility-control .dijitMenuItem {color: #7989a0;}.jimu-widget-visibility-control .dijitSelect .dijitInputField {margin-right: 8px;}.jimu-widget-visibility-control .cursortooltip {z-index: 10; position: fixed; border: 1px solid #777; color: black; background-color: white; margin: 2px; padding: 6px; border-radius: 6px;}.jimu-widget-visibility-control .center {display: table !important; margin: 0 auto;}.jimu-widget-visibility-control .btnContainer {text-align: right; margin-top: 15px; display: grid; padding: 15px 4px;}.jimu-widget-visibility-control .HalfWidthLeft {width: 50%;}.jimu-widget-visibility-control .HalfWidthRight {width: 50%;}.jimu-widget-visibility-control .jimu-coordinate-control textarea {width: 100%;}.jimu-widget-visibility-control .jimu-coordinate-control .add-with-icon.coordInput {width: calc(100% - 60px);}.jimu-widget-visibility-control .jimu-coordinate-control .coordLabel {font-size: 12px;}.jimu-widget-visibility-control .switch-toggle-group {padding: 5px;}.jimu-widget-visibility-control .switch-toggle-group .checkbox-inline {padding-left: 36px; vertical-align: top;}.jimu-widget-visibility-control .switch-toggle-group .switch-toggle.dijitCheckBox {margin-left: -36px;}.jimu-widget-visibility-control .switch-toggle.dijitCheckBox {height: 16px; width: 28px; border: 0 none; background: #adadad; position: relative; float: right; cursor: pointer; -moz-border-radius: 10px; -webkit-border-radius: 10px; border-radius: 10px;}.jimu-rtl .jimu-widget-visibility-control .switch-toggle.dijitCheckBox {float: left;}.jimu-widget-visibility-control .switch-toggle.dijitCheckBox:before {content: \"\"; background: #f8f8f8; position: absolute; padding: 0; height: 12px; width: 12px; left: auto; right: 14px; top: 2px; z-index: 1; -webkit-transition: right 0.3s; -moz-transition: right 0.3s; -o-transition: right 0.3s; transition: right 0.3s; -moz-border-radius: 50%; -webkit-border-radius: 50%; border-radius: 50%;}.jimu-widget-visibility-control .switch-toggle.dijitCheckBox input {width: 100%; height: 100%; position: absolute; left: 0; z-index: 2;}.jimu-widget-visibility-control .switch-toggle.dijitCheckBox.dijitCheckBoxChecked {background: #50ad4e;}.jimu-widget-visibility-control .switch-toggle.dijitCheckBox.dijitCheckBoxChecked:before {right: 2px;}.btnContainer {text-align: right; margin-top: 6px;}.settingsContainer {margin-top: 6px;}.checkBoxText {padding: 0 5px 0 5px;}.controlContainer {margin-top: 6px;}.customFormatTextbox {height: 30px; background-color: transparent; border: 1px solid #d2dae2; padding: 5px; margin: 0 3px 0 3px; width: 55%; font-family: 'Avenir Light', Verdana, Geneva, sans-serif;}.coordNotationSelect {background-color: transparent; height: 30px; user-select: none; width: 40%; float: left; border: 1px solid #d2dae2; font-family: 'Avenir Light', Verdana, Geneva, sans-serif; margin-bottom: 5px;}.jimu-rtl .coordNotationSelect {float: right;}.DartTheme .jimu-widget-visibility-control .cusrortooltip {background-color: #4c4c4c;}.claro .dartThemeClaroDijitTooltipContainerOverride .dijitTooltipContainer {background-color: #4c4c4c; background-image: -webkit-linear-gradient(bottom, rgb(76, 76, 76) 0px, #4c4c4c 10px); border: 1px solid #ffffff; color: #ffffff;}.claro .dartThemeClaroDijitTooltipContainerOverride .jimu-widget-subtitle {color: #ffffff;}.claro .dartThemeClaroDijitTooltipContainerOverride .dijitTooltipConnector {background-image: url('images/tooltip.png');}.jimu-widget-visibility-control .jimu-coordinate-control .settingBtn {margin-left: 1px;}.jimu-widget-visibility-control .jimu-coordinate-control .drawPointBtn {margin-left: 2px;}.jimu-widget-visibility-publish .esriCTFullHeight {height: 100%;}.jimu-widget-visibility-publish .esriCTFullWidth,.jimu-widget-visibility-control .esriCTFullWidth {width: 100%;}.jimu-widget-visibility-publish .esriCTSettingHeader,.jimu-widget-visibility-control .esriCTSettingHeader {height: 30px; border-bottom: 1px solid #464646;}.jimu-widget-visibility-publish .esriCTBackButton,.jimu-widget-visibility-control .esriCTBackButton {display: table; width: 100%;}.jimu-widget-visibility-publish .esriCTItemLeftArrow,.jimu-widget-visibility-control .esriCTItemLeftArrow {background-image: url('./images/left-arrow_black.png'); display: table-cell; width: 20px; height: 20px; background-repeat: no-repeat; background-position: center center; cursor: pointer;}.jimu-rtl .jimu-widget-visibility-publish .esriCTItemLeftArrow {transform: rotate(180deg);}.jimu-widget-visibility-publish .esriCTItemLeftArrow:hover {background-image: url('./images/left-arrow_black_hover.png');}.jimu-widget-visibility-publish .esriCTTitleDiv,.jimu-widget-visibility-control .esriCTTitleDiv {line-height: 10px; font-weight: bold; text-align: center; width: calc(100% - 50px); height: 20px; padding-top: 6px;}.jimu-widget-visibility-publish .esriCTEllipsis,.jimu-widget-visibility-control .esriCTEllipsis {overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-widget-visibility-publish .esriCTMainPageRow,.jimu-widget-visibility-control .esriCTMainPageRow {width: calc(100% - 20px); margin: 20px 10px 10px 10px; display: inline-block;}.jimu-widget-visibility-publish .esriCTInputLabel {float: left; line-height: 28px; padding: 5px 0px 0px 0px; width: 100%;}.jimu-widget-visibility-publish .SelectStyle {height: 30px; color: #7d7d7d; padding-left: 5px; font-size: 13px; width: 100%; margin: 1px 0 8px 0;}.jimu-widget-visibility-publish .publishSelect .dijitSelectLabel {overflow: hidden; white-space: nowrap; text-overflow: ellipsis; width: 288px; text-align: left;}.jimu-widget-visibility-publish .esriCTCheckBoxNode {padding-top: 10px;}.jimu-widget-visibility-publish .esriCTPublishBtnContainer {text-align: right; margin-top: 15px; display: grid;}.jimu-widget-visibility-publish .esriCTPublishMessage {float: left; line-height: 16px; padding: 18px 0px 0px 0; font-weight: bold; display: inline-block; word-break: break-all;}.jimu-rtl .jimu-widget-visibility-publish .esriCTPublishMessage {float: right;}.jimu-widget-visibility-publish .esriCTHidden {display: none;}.jimu-widget-visiblity .esriCTHidden {display: none;}.jimu-widget-visiblity .jimu-btn {width: 100%;}.jimu-widget-visibility-publish .esriCTPublishControl {float: right; min-width: 9px; line-height: 12px; padding-bottom: 3px; padding-top: 3px;}.jimu-widget-visibility-control .esriCTMainTitleDiv {line-height: 10px; font-weight: bold; text-align: left; width: calc(100% - 50px); padding: 5px 3px 5px 3px; display: inline-block;}.jimu-rtl .jimu-widget-visibility-control .esriCTMainTitleDiv {text-align: right;}.jimu-widget-visibility-control .esriCTSaveToLayerIcon {background-image: url('./images/left-arrow_black.png'); width: 20px; height: 20px; background-repeat: no-repeat; background-position: center center; cursor: pointer; transform: rotate(180deg);}.jimu-rtl .jimu-widget-visibility-control .esriCTSaveToLayerIcon {float: left; transform: rotate(360deg);}.jimu-widget-visibility-control .esriCTSaveToLayerIcon:hover {background-image: url('./images/left-arrow_black_hover.png'); background-repeat: no-repeat;}.jimu-widget-visibility-control .esriCTNewHeader {float: left; height: 30px; border-bottom: 1px solid #464646; padding: 0px 2px;}.jimu-widget-visibility-control .esriCTSliderWrapper {width: calc(100% - 278px); display: inline-block; margin: 5px;}.jimu-widget-visibility-control .dijitSlider {width: 100%;}.jimu-rtl .jimu-widget-visibility-control .dijitSlider {margin-left: auto; margin-right: 10px;}.jimu-widget-visibility-control .dijitSlider .dijitSliderImageHandleH {top: -10px; width: 20px; height: 20px;}.jimu-widget-visibility-control .esriCTColorPickerEditor {padding-top: 5px; padding-bottom: 8px; min-width: 350px; display: inline-table;}.jimu-widget-visibility-control .esriCTColorPickerEditor .jimu-color-picker {display: inline-block; width: 25px; height: 25px;}.jimu-widget-visibility-control .esriCTColorPickerEditor .dijitSpinner.dijitNumberTextBox.dijitValidationTextBox {width: 70px; height: 30px;}.jimu-widget-visibility-control .dijitSliderImageHandleH {top: -7px;}.jimu-widget-visibility-control .dijitSliderThumbHover {background-image: url(\"../images/sliderball.svg\"); background-position: 0 0;}.jimu-widget-visibility-control .dijitSliderImageHandle.dijitSliderImageHandleH {background-image: url(\"../images/sliderball.svg\"); background-position: 0 0;}.jimu-widget-visibility-control .dijitSliderImageHandle.dijitSliderImageHandleH.dojoMoveItem {background-image: url(\"../images/sliderball.svg\"); background-position: 0 0;}.jimu-widget-visibility-control .dijitSlider .dijitSliderProgressBarH,.jimu-widget-visibility-control .dijitSlider .dijitSliderLeftBumper {border-color: #000; background-color: #000; background-image: -webkit-linear-gradient(top, #000 0px, #000 1px, rgba(255, 255, 255, 0) 2px); background-image: -o-linear-gradient(top, #000 0px, #000 1px, rgba(255, 255, 255, 0) 2px); background-image: linear-gradient(top, #000 0px, #000 1px, rgba(255, 255, 255, 0) 2px);}.jimu-widget-visibility-control .dijitSlider .dijitSliderRemainingBarH,.jimu-widget-visibility-control .dijitSlider .dijitSliderRightBumper {border-color: #d7d7d7; background-color: #d7d7d7;}.jimu-widget-visibility-control .esriCTColorPickerEditor .trans {font-family: \"Avenir Light\"; font-size: 12px; padding: 0 5px 0 5px; letter-spacing: 0.33px;}.jimu-widget-visibility-control .sliderbar {width: 60px;}.dijitRuleLabelH {left: -12%;}.jimu-widget-visibility-control .esriCTOutFillSection {vertical-align: middle; display: inline-flex; flex-direction: column; margin: 0px 0px 14px 3px;}.jimu-rtl .jimu-widget-visibility-control .esriCTOutFillSection {margin: 0px 3px 14px 0px;}.jimu-widget-visibility-symbologySettings .esriCTSettingsRow {width: 100%; display: inline-flex;}.jimu-widget-visibility-symbologySettings .esriCTLabelSettingsRightButton {background: url(\"../images/arrow-right_black.png\") no-repeat;}.jimu-rtl .jimu-widget-visibility-symbologySettings .esriCTLabelSettingsRightButton {transform: rotate(180deg);}.jimu-widget-visibility-symbologySettings .esriCTLabelSettingsRightButton:hover {background: url(\"../images/arrow-right_black_hover.png\") no-repeat;}.jimu-widget-visibility-symbologySettings .esriCTSettingsButtonIcon {margin-top: 13px; height: 16px; width: 16px;}.jimu-rtl .jimu-widget-visibility-symbologySettings .esriCTSettingsButtonIcon {margin: 10px 0px 0px 5px;}.jimu-widget-visibility-symbologySettings .esriCTPointer {cursor: pointer;}.jimu-widget-visibility-symbologySettings .esriCTInputLabelSettings {float: left; line-height: 28px; padding: 5px 0px 0px 0px;}.jimu-widget-visibility-symbologySettings .esriCTEllipsis {overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-widget-visibility-symbologySettings .esriCTSubTitle {font-weight: bold;}.jimu-widget-visibility-symbologySettings .esriCTGroupHidden {display: none;}.jimu-widget-visibility-symbologySettings .esriCTLabelSettingsDownButton {background: url(\"../images/arrow-down_black.png\") no-repeat; margin-top: 15px;}.jimu-rtl .jimu-widget-visibility-symbologySettings .esriCTLabelSettingsDownButton {margin: 15px 0px 0px 5px;}.jimu-widget-visibility-symbologySettings .esriCTLabelSettingsDownButton:hover {background: url(\"../images/arrow-down_black_hover.png\") no-repeat;}.jimu-widget-visibility-control .esriCTSettingsIcon {background-image: url('./images/settings_black.png'); height: 16px; width: 16px; background-size: 16px; background-repeat: no-repeat; margin-top: 2px; margin-right: 13px; display: inline-block;}.jimu-rtl .jimu-widget-visibility-control .esriCTSettingsIcon {float: left;}.jimu-widget-visibility-control .esriCTSettingsIcon:hover {background-image: url('./images/settings_black_hover.png'); background-repeat: no-repeat;}.jimu-widget-visibility-symbologySettings .esriCTSettingsButtonIcon:focus {outline: 2px solid #24B5CC !important; outline-offset: -2px;}.jimu-widget-visibility-control .esriCTRightSideButton {float: right; display: inline-flex;}.jimu-rtl .jimu-widget-visibility-control .esriCTRightSideButton {float: left;}.DashboardTheme.light .jimu-widget-visibility-control .settingBtn {background-image: url(./images/settings_black.png);}.DashboardTheme.light .jimu-widget-visibility-control .settingBtn:hover {background-image: url(./images/settings_black_hover.png);}",
"*now":function(H){H(['dojo/i18n!*preload*widgets/Visibility/nls/Widget*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/topic dojo/dom-attr jimu/BaseWidget dijit/_WidgetsInTemplateMixin jimu/dijit/Message jimu/utils ./js/VisibilityControl ./js/PrivilegeUtil".split(" "),function(H,k,p,r,m,l,b,a,d,f,e){return H([l,b],{baseClass:"jimu-widget-visiblity",privilegeUtil:null,_visibilityControl:null,postMixInProperties:function(){this.nls=p.mixin(this.nls,window.jimuNls.coordinateControl)},destroy:function(){if(this._visibilityControl)this._visibilityControl.onClearBtnClicked();
this.inherited(arguments)},resize:function(){r.publish("WIDGET_RESIZE",{})},startup:function(){this.inherited(arguments);this.config.portalUrl?(this.config.hasOwnProperty("defaultObserverHeightUnit")||(this.config.defaultObserverHeightUnit="meters"),this.config.hasOwnProperty("defaultObservableDistanceUnit")||(this.config.defaultObservableDistanceUnit="kilometers"),this.config.hasOwnProperty("defaultAngleUnits")||(this.config.defaultAngleUnits=!1),this.privilegeUtil=e.getInstance(this.config.portalUrl),
this.privilegeUtil.loadPrivileges().then(p.hitch(this,this._validatePrivileges),p.hitch(this,this._showError))):this._showError(this.nls.portalURLError)},_validatePrivileges:function(h){h&&this.privilegeUtil._canPerformElevationAnalysis()?this._createVisibilityControl():this._showError()},_showError:function(h){h||(h=this.nls.privilegeError,this.privilegeUtil._isServiceAvailable||(h=this.nls.noServiceError));new a({message:h});m.set(this.visibilityContainer,"innerHTML",h)},_createVisibilityControl:function(){var h=
this.privilegeUtil.getUserPortal();!this._visibilityControl&&h&&(this._visibilityControl=(new f({config:this.config,parentWidget:this,nls:this.nls,appConfig:this.appConfig,portalUrl:h,pointSymbol:{color:[255,0,0,64],size:12,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,0,0,255],width:1,type:"esriSLS",style:"esriSLSSolid"}},map:this.map},k.create("div"))).placeAt(this.visibilityContainer),this._visibilityControl.startup(),this._setTheme())},_removeStyleFile:function(h,c){var g=null;g="js"===
c?"src":"css"===c?"href":"none";c=document.getElementsByTagName("js"===c?"script":"css"===c?"link":"none");for(var n=c.length;0<=n;n--)c[n]&&null!==c[n].getAttribute(g)&&-1!==c[n].getAttribute(g).indexOf(h)&&c[n].parentNode.removeChild(c[n])},_setTheme:function(){"DartTheme"===this.appConfig.theme.name?d.loadStyleLink("dartOverrideCSS",this.folderUrl+"css/dartTheme.css",null):this._removeStyleFile(this.folderUrl+"css/dartTheme.css","css");"DashboardTheme"===this.appConfig.theme.name?d.loadStyleLink("dashboardOverrideCSS",
this.folderUrl+"css/dashboardTheme.css",null):this._removeStyleFile(this.folderUrl+"css/dashboardTheme.css","css");"LaunchpadTheme"===this.appConfig.theme.name?d.loadStyleLink("launchpadOverrideCSS",this.folderUrl+"css/launchpadTheme.css",null):this._removeStyleFile(this.folderUrl+"css/launchpadTheme.css","css");"BoxTheme"===this.appConfig.theme.name?d.loadStyleLink("boxOverrideCSS",this.folderUrl+"css/boxTheme.css",null):this._removeStyleFile(this.folderUrl+"css/boxTheme.css","css")}})});